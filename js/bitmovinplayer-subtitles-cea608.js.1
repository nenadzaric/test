/**************************************************************************** 
 * Copyright (C) 2020, Bitmovin, Inc., All Rights Reserved 
 * 
 * This source code and its use and distribution, is subject to the terms 
 * and conditions of the applicable license agreement. 
 * 
 * Bitmovin Player Version 8.34.0 
 * 
 ****************************************************************************/
(function() {
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["subtitles-cea608"]=t():(e.bitmovin=e.bitmovin||{},e.bitmovin.player=e.bitmovin.player||{},e.bitmovin.player["subtitles-cea608"]=t())}(this,function(){return webpackJsonpbitmovin_player__name_([30],{134:function(e,t,s){"use strict";function o(e,t){return{nalUnitType:"sei_rbsp",escapedRBSP:new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength),pts:t}}Object.defineProperty(t,"__esModule",{value:!0});var r=s(152),a=s(2),n=s(0),i=s(500);t.MPEG_TS_TIMESCALE=9e4;var u=function(){function e(e){a.ModuleManager.has(n.ModuleName.ContainerMP4)&&(this.MP4Module=a.ModuleManager.get(n.ModuleName.ContainerMP4)),this.mp4Parser=e,this.timeScale=1,this.defaultSampleDuration=0}return e.prototype.extract=function(e){var t=this;if(!this.mp4Parser)return Promise.reject(new Error("no MP4 parser present"));var s=e.getParsedData().get("moov.trak.mdia.mdhd");s&&(this.timeScale=s.timescale);var a=e.getParsedData().get("moov.mvex.trex");a&&(this.defaultSampleDuration=a.default_sample_duration);var n=this.MP4Module.getMp4Fragments(e),i=n.flatMap(function(e){var s=e.moof.get("traf.tfdt"),a=t.mp4Parser.getAvcSamples(e.moof,e.mdat,[r.NalUnitType.SEI]),n=s?t.toSeconds(s.baseMediaDecodeTime):0;return a.flatMap(function(e){var s=e.nalus.map(function(s){return o(s,n+t.toSeconds(e.compositionTimeOffset))});return n+=Math.floor(t.toSeconds(e.duration||t.defaultSampleDuration)),s})});return this.parseCaptions(i)},e.prototype.toSeconds=function(e){return e/this.timeScale*t.MPEG_TS_TIMESCALE},e.prototype.parseCaptions=function(e){return 0===e.length?Promise.resolve([]):(this.cea608Processor||(this.cea608Processor=new i.WebWorkerCea608Processor),this.cea608Processor.getCaptions(e)["catch"](function(){return Promise.resolve([])}))},e.prototype.reset=function(){this.cea608Processor&&this.cea608Processor.reset()},e.prototype.dispose=function(){this.cea608Processor&&this.cea608Processor.dispose(),this.mp4Parser=null},e}();t.Cea608Extractor=u},499:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s(0),r=s(134);t.CeaSubtitlesModuleDefinition={name:o.ModuleName.SubtitlesCEA608,module:function(){return{Cea608Extractor:r.Cea608Extractor}},dependencies:[o.ModuleName.Subtitles]},t["default"]=t.CeaSubtitlesModuleDefinition},500:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s(2),r=s(0),a=s(134),n=function(){function e(){var e=this;this.handleTransmuxerEvent=function(t){if("caption"===t.data.action){var s=t.data.caption;s.startTime=s.startTime||s.startPts/a.MPEG_TS_TIMESCALE,s.endTime=s.endTime||s.endPts/a.MPEG_TS_TIMESCALE,e.captions.push(t.data.caption)}else if("done"===t.data.action&&"captions"===t.data.what)if(e.onCaptionsAvailable(e.captions),e.captions=[],e.jobQueue.length>0){var o=e.jobQueue[0];e.process(o.message)}else e.isProcessing=!1};var t=o.ModuleManager.get(r.ModuleName.ContainerTS).TransmuxerWorker;this.transmuxer=new t,this.transmuxer.onmessage=this.handleTransmuxerEvent,this.captions=[],this.jobQueue=[],this.isProcessing=!1,this.transmuxer.postMessage({action:"initCaptionParser"})}return e.prototype.getCaptions=function(e){var t=this;return new Promise(function(s,o){(!e||!Array.isArray(e)||e.length<1)&&o();var r={action:"pushCaptions",data:e};t.jobQueue.push({message:r,resolve:s,reject:o}),t.isProcessing||(t.isProcessing=!0,t.process(r))})},e.prototype.dispose=function(){this.transmuxer&&(this.transmuxer.postMessage({action:"dispose"}),this.transmuxer.terminate(),this.transmuxer=null)},e.prototype.process=function(e){this.transmuxer.postMessage(e),this.flush()},e.prototype.flush=function(){this.transmuxer.postMessage({action:"flushCaptions"})},e.prototype.reset=function(){this.transmuxer.postMessage({action:"resetCaptions"})},e.prototype.onCaptionsAvailable=function(e){var t=this.jobQueue.shift();t.resolve(e)},e}();t.WebWorkerCea608Processor=n}},[499])});
})();
