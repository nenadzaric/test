!function(){"use strict";const e=new class{constructor(){this.queue=[];let e=performance.now();const t=n=>{const i=Math.min(150,n-e);e=n;for(let e=this.queue.length-1;e>=0;e--){let t=this.queue[e];if(t.fps){if(n-t.last<1e3/t.fps)continue;t(++t.frame),t.last=n}else t(i,n)}requestAnimationFrame(t)};requestAnimationFrame(t)}add(e,t){t&&(e.fps=t,e.last=-1/0,e.frame=-1),this.queue.includes(e)||this.queue.unshift(e)}remove(e){this.queue.includes(e)&&this.queue.splice(this.queue.indexOf(e),1)}},t={linear:function(e){return e},inQuad:function(e){return e*e},outQuad:function(e){return e*(2-e)},inOutQuad:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},inCubic:function(e){return e*e*e},outCubic:function(e){return--e*e*e+1},inOutCubic:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},inQuart:function(e){return e*e*e*e},outQuart:function(e){return 1- --e*e*e*e},inOutQuart:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},inQuint:function(e){return e*e*e*e*e},outQuint:function(e){return--e*e*e*e*e+1},inOutQuint:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},inSine:function(e){return 1-Math.cos(e*Math.PI/2)},outSine:function(e){return Math.sin(e*Math.PI/2)},inOutSine:function(e){return.5*(1-Math.cos(Math.PI*e))},inExpo:function(e){return 0===e?0:Math.pow(1024,e-1)},outExpo:function(e){return 1===e?1:1-Math.pow(2,-10*e)},inOutExpo:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},inCirc:function(e){return 1-Math.sqrt(1-e*e)},outCirc:function(e){return Math.sqrt(1- --e*e)},inOutCirc:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},inElastic:function(e,t=1,n=.4){var i;return 0===e?0:1===e?1:(!t||t<1?(t=1,i=n/4):i=n*Math.asin(1/t)/(2*Math.PI),-t*Math.pow(2,10*(e-=1))*Math.sin((e-i)*(2*Math.PI)/n))},outElastic:function(e,t=1,n=.4){var i;return 0===e?0:1===e?1:(!t||t<1?(t=1,i=n/4):i=n*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*e)*Math.sin((e-i)*(2*Math.PI)/n)+1)},inOutElastic:function(e,t=1,n=.4){var i;return 0===e?0:1===e?1:(!t||t<1?(t=1,i=n/4):i=n*Math.asin(1/t)/(2*Math.PI),(e*=2)<1?t*Math.pow(2,10*(e-=1))*Math.sin((e-i)*(2*Math.PI)/n)*-.5:t*Math.pow(2,-10*(e-=1))*Math.sin((e-i)*(2*Math.PI)/n)*.5+1)},inBack:function(e){var t=1.70158;return e*e*((t+1)*e-t)},outBack:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},inOutBack:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},inBounce:function(e){return 1-t.outBounce(1-e)},outBounce:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},inOutBounce:function(e){return e<.5?.5*t.inBounce(2*e):.5*t.outBounce(2*e-1)+.5}};let n=[],i="outCubic";function r(e){const t=new o(null,e),n=t.promise();return n.clear=t.stop,n}e.add((function(e,t){for(let i=n.length-1;i>=0;i--){let r=n[i];r.update&&r.update(e,t)}}));class o{constructor(e,r,o){if(e&&e.forEach&&"object"==typeof e[0])return this.stagger(e,r,o);this.elapsed=0,this.object=e,this.duration=r,this.delay=0,this.suffix={},this.from={},this.to=Object.assign({},o),["ease","delay","spring","damping","repeat","repeatDelay","yoyo","yoyoEase"].forEach(e=>{void 0!==this.to[e]&&(this[e]=this.to[e],delete this.to[e])}),t[this.ease]||(this.ease=i),this.yoyo&&(this.yoyoEase=t[this.yoyoEase]||(()=>this.ease.includes("inOut")||"linear"===this.ease?t[this.ease]:this.ease.includes("out")?t[this.ease.replace("out","in")]:t[this.ease.replace("in","out")])()),this.ease=t[this.ease],["update","complete"].forEach(e=>{void 0!==this.to[e]&&(this[e+"Callbacks"]||(this[e+"Callbacks"]=[]),this[e+"Callbacks"].push(this.to[e]),delete this.to[e])}),e&&!e._anims&&(Object.defineProperty(e,"_anims",{enumerable:!1,writable:!0}),e._anims={});for(let t in this.to)if(e._anims[t]&&e._anims[t].override(t),this.from[t]=e[t],e._anims[t]=this,"string"==typeof this.from[t]){const e=this.from[t].split(/([^\d-.]+)/);this.from[t]=Number(e[0]),"string"==typeof this.to[t]&&(this.to[t]=Number(this.to[t].match(/([\d-.]+)/)[0])),this.suffix[t]=e[1]}return n.push(this),this}update(e){this.elapsed+=e;const t=Math.max(0,Math.min(1,(this.elapsed-this.delay)/this.duration)),n=this.ease(t,this.spring,this.damping);for(let e in this.to)this.object[e]=this.from[e]+(this.to[e]-this.from[e])*n,this.suffix[e]&&(this.object[e]+=this.suffix[e]);this.updateCallbacks&&this.updateCallbacks.forEach(e=>e&&e()),1===t&&this.complete()}complete(){if(this.repeat)return this.repeat>0&&this.repeat--,this.elapsed=0,this.delay=this.repeatDelay||0,void(this.yoyo&&this.reverse());for(let e in this.to)delete this.object._anims[e];this.stop(),this.completeCallbacks&&this.completeCallbacks.forEach(e=>e&&e()),this._promise&&this._promise.resolve()}stop(){n.includes(this)&&n.splice(n.indexOf(this),1)}stagger(e,t,n){const i=n.stagger||0,r="function"==typeof n.stagger?n.stagger:(e,t)=>i<0?-i*(t-1)+i*e:i*e,a=n.staggerComplete;n.stagger&&delete n.stagger,n.staggerComplete&&delete n.staggerComplete;const s=n.delay||0;let l;const u=e.map((i,a)=>{n.delay=s+r(a,e.length);const u=new o(i,t,n);return(!l||n.delay>l.delay)&&(l=u),u});return a&&l.onComplete(a),u}reverse(){for(let e in this.to){const t=this.to[e];this.to[e]=this.from[e],this.from[e]=t}const e=this.ease;this.ease=this.yoyoEase,this.yoyoEase=e}override(e){delete this.from[e],delete this.to[e],Object.keys(this.to).length||this.stop()}onUpdate(e){return this.updateCallbacks||(this.updateCallbacks=[]),this.updateCallbacks.push(e),this}onComplete(e){return this.completeCallbacks||(this.completeCallbacks=[]),this.completeCallbacks.push(e),this}promise(){return this._promise?this._promise:this._promise=function(){let e;const t=new Promise(t=>e=t);return t.resolve=e,t}()}static clear(e){if(e&&e._anims)for(let t in e._anims)e._anims[t].stop(),delete e._anims[t]}static setDefaultEase(e){i=e}}const a=new class{constructor(){this.events=[]}on(e,t){this.events.push({name:e,callback:t})}off(e,t){for(let n=this.events.length-1;n>=0;n--)this.events[n].name===e&&this.events[n].callback===t&&this.events.splice(n,1)}emit(e,t={}){this.events.forEach(n=>{n.name===e&&n.callback(t)})}};class s extends Array{constructor(e=0,t=e){return super(e,t),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}set(e,t=e){return e.length?this.copy(e):(this[0]=e,this[1]=t,this)}copy(e){return this[0]=e[0],this[1]=e[1],this}len(){return Math.sqrt(this[0]*this[0]+this[1]*this[1])}}const l=new class{constructor(){const e=this;let t,n;function i(){t=window.innerWidth,n=window.innerHeight}function r(e){l(e)}function o(e){l(e)}function a(){}function l(i){i.changedTouches&&i.changedTouches.length&&(i.x=i.changedTouches[0].pageX,i.y=i.changedTouches[0].pageY),void 0===i.x&&(i.x=i.pageX,i.y=i.pageY),e.pixel.set(i.x,i.y),e.normal.x=e.pixel.x/t,e.normal.y=e.pixel.y/n,e.normalFlip.x=e.normal.x,e.normalFlip.y=1-e.normal.y,e.tilt.x=2*e.normalFlip.x-1,e.tilt.y=2*e.normalFlip.y-1}this.pixel=new s,this.normal=new s(.5),this.tilt=new s,this.normalFlip=new s(.5),window.addEventListener("pointerdown",r),window.addEventListener("pointermove",o),window.addEventListener("touchmove",o),window.addEventListener("pointerup",a),window.addEventListener("resize",i),window.addEventListener("orientationchange",i),i()}static create(e,t){const n=document.createElement(e);return t&&(n.className=t),this.setup(n),noe}},u=new Map([["opacity",1],["perspective",0],["x",0],["y",0],["z",0],["scale",1],["scaleX",null],["scaleY",null],["rotate",0],["rotateX",null],["rotateY",null],["rotateZ",null],["skewX",null],["skewY",null]]),c=["opacity","zIndex","fontWeight","strokeDashoffset"];class d{static setup(e){return e.isDOM||(e.transforms={},u.forEach((t,n)=>{e.transforms[n]=t}),e.animate=(t,n)=>this.animate(e,t,n),e.css=t=>{this.css(e,t)},e.isDOM=!0),e}static create(e="div",t){const n=document.createElement(e);return t&&(n.className=t),this.setup(n),n}static query(e,t=document){const n=t.querySelectorAll(e);return n.forEach(e=>{this.setup(e)}),n}static css(e,t){let n=!1;for(let i in t)u.has(i)?(e.transforms[i]=t[i],delete t[i],n=!0):"string"==typeof t[i]||c.includes(i)||(t[i]+="px");return Object.assign(e.style,t),n&&this.transform(e),this}static transform(e){let t="";const n=e.transforms;return n.perspective&&(t+=`perspective(${n.perspective}px)`),(n.x||n.y||n.z)&&(t+=" translate3d("+("string"==typeof n.x?n.x:n.x+"px")+", "+("string"==typeof n.y?n.y:n.y+"px")+", "+("string"==typeof n.z?n.z:n.z+"px")+")"),(n.skewX||n.skewY)&&(t+=" skew("+(n.skewX||0)+"deg, "+(n.skewY||0)+"deg)"),n.rotateY&&(t+=` rotateY(${n.rotateY}deg)`),n.rotateX&&(t+=` rotateX(${n.rotateX}deg)`),n.rotateZ&&(t+=` rotateZ(${n.rotateZ}deg)`),n.rotate&&(t+=` rotate(${n.rotate}deg)`),(1!==n.scale||n.scaleX||n.scaleY)&&(t+=" scale("+(n.scaleX||n.scale)+", "+(n.scaleY||n.scale)+")"),e.style.transform=t,e.style.opacity=n.opacity,e}static animate(e,t,n){"number"!=typeof t&&console.warn("DOM animate missing duration"),"string"==typeof e&&(e=this.query(e));const i=new o(e.transforms,t,n);return i.onUpdate(()=>this.transform(e)),i}}const h=new class{constructor(){this.data={},this.events={}}link(e,t){Array.isArray(e)||(e=[e]);let n=!1;e.forEach(e=>{void 0!==this.data[e]&&(n=!0),this.events[e]||(this.events[e]=[]),this.events[e].push(t)}),n&&t&&t(this.data)}unlink(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{this.events[e]&&this.events[e].includes(t)&&this.events[e].splice(this.events[e].indexOf(t),1)})}push(e){let t=[];for(let n in e)this.data[n]!==e[n]?this.events[n]&&this.events[n].forEach(e=>{t.includes(e)||t.push(e)}):delete e[n];0!==Object.entries(e).length&&(Object.assign(this.data,e),t.length&&t.forEach(e=>e&&e(this.data)))}};let p=Date.now()%1e9;class m{static sign(e){return 0===(e=+e)||isNaN(e)?Number(e):e>0?1:-1}static round(e,t=0){let n=Math.pow(10,t);return Math.round(e*n)/n}static random(e,t,n=0){return void 0===e?Math.random():e===t?e:(e=e||0,t=t||1,this.round(e+Math.random()*(t-e),n))}static flip(e=-1,t=1){return Math.random()>.5?e:t}static degrees(e){return e*(180/Math.PI)}static radians(e){return e*(Math.PI/180)}static clamp(e,t=0,n=1){return Math.min(Math.max(e,Math.min(t,n)),Math.max(t,n))}static map(e,t=-1,n=1,i=0,r=1,o){const a=(e-t)*(r-i)/(n-t)+i;return o?this.clamp(a,Math.min(i,r),Math.max(i,r)):a}static mix(e,t,n){return e*(1-n)+t*n}static step(e,t){return t<e?0:1}static smoothstep(e,t,n){const i=Math.clamp((n-e)/(t-e));return i*i*(3-2*i)}static fract(e){return e-Math.floor(e)}static mod(e,t){return(e%t+t)%t}static guid(){return(1e9*Math.random()>>>0)+p++}static padInt(e,t=2,n){n&&(e=Math.min(e,Math.pow(10,t)-1));let i=Math.floor(e).toString();return Math.pow(10,Math.max(0,t-i.length)).toString().slice(1)+i}static powerOfTwo(e){return Math.log2(e)%1==0}}function f(e){let t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)}function v(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function g(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function w(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function x(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function y(e){let t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function _(e,t){let n=t[0],i=t[1],r=t[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function b(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function M(e,t,n){let i=t[0],r=t[1],o=t[2],a=n[0],s=n[1],l=n[2];return e[0]=r*l-o*s,e[1]=o*a-i*l,e[2]=i*s-r*a,e}const A=function(){const e=[0,0,0],t=[0,0,0];return function(n,i){v(e,n),v(t,i),_(e,e),_(t,t);let r=b(e,t);return r>1?0:r<-1?Math.PI:Math.acos(r)}}();class E extends Array{constructor(e=0,t=e,n=e){return super(e,t,n),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set(e,t=e,n=e){return e.length?this.copy(e):(function(e,t,n,i){e[0]=t,e[1]=n,e[2]=i}(this,e,t,n),this)}copy(e){return v(this,e),this}add(e,t){return t?g(this,e,t):g(this,this,e),this}sub(e,t){return t?w(this,e,t):w(this,this,e),this}multiply(e){var t,n,i;return e.length?(n=this,i=e,(t=this)[0]=n[0]*i[0],t[1]=n[1]*i[1],t[2]=n[2]*i[2]):x(this,this,e),this}divide(e){var t,n,i;return e.length?(n=this,i=e,(t=this)[0]=n[0]/i[0],t[1]=n[1]/i[1],t[2]=n[2]/i[2]):x(this,this,1/e),this}inverse(e=this){var t,n;return n=e,(t=this)[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],this}len(){return f(this)}distance(e){return e?function(e,t){let n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+i*i+r*r)}(this,e):f(this)}squaredLen(){return y(this)}squaredDistance(e){return e?function(e,t){let n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}(this,e):y(this)}negate(e=this){var t,n;return n=e,(t=this)[0]=-n[0],t[1]=-n[1],t[2]=-n[2],this}cross(e,t){return t?M(this,e,t):M(this,this,e),this}scale(e){return x(this,this,e),this}normalize(){return _(this,this),this}dot(e){return b(this,e)}equals(e){return n=e,(t=this)[0]===n[0]&&t[1]===n[1]&&t[2]===n[2];var t,n}applyMatrix4(e){return function(e,t,n){let i=t[0],r=t[1],o=t[2],a=n[3]*i+n[7]*r+n[11]*o+n[15];a=a||1,e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/a,e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/a,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/a}(this,this,e),this}scaleRotateMatrix4(e){return function(e,t,n){let i=t[0],r=t[1],o=t[2],a=n[3]*i+n[7]*r+n[11]*o+n[15];a=a||1,e[0]=(n[0]*i+n[4]*r+n[8]*o)/a,e[1]=(n[1]*i+n[5]*r+n[9]*o)/a,e[2]=(n[2]*i+n[6]*r+n[10]*o)/a}(this,this,e),this}applyQuaternion(e){return function(e,t,n){let i=t[0],r=t[1],o=t[2],a=n[0],s=n[1],l=n[2],u=s*o-l*r,c=l*i-a*o,d=a*r-s*i,h=s*d-l*c,p=l*u-a*d,m=a*c-s*u,f=2*n[3];u*=f,c*=f,d*=f,h*=2,p*=2,m*=2,e[0]=i+u+h,e[1]=r+c+p,e[2]=o+d+m}(this,this,e),this}angle(e){return A(this,e)}lerp(e,t){return function(e,t,n,i){let r=t[0],o=t[1],a=t[2];e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=a+i*(n[2]-a)}(this,this,e,t),this}clone(){return new E(this[0],this[1],this[2])}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this[2]=e[t+2],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e}transformDirection(e){const t=this[0],n=this[1],i=this[2];return this[0]=e[0]*t+e[4]*n+e[8]*i,this[1]=e[1]*t+e[5]*n+e[9]*i,this[2]=e[2]*t+e[6]*n+e[10]*i,this.normalize()}}const T=new E;let S=1,L=1,R=!1;class F{constructor(e,t={}){e.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=e,this.attributes=t,this.id=S++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let e in t)this.addAttribute(e,t[e])}addAttribute(e,t){if(this.attributes[e]=t,t.id=L++,t.size=t.size||1,t.type=t.type||(t.data.constructor===Float32Array?this.gl.FLOAT:t.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),t.target="index"===e?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,t.normalized=t.normalized||!1,t.stride=t.stride||0,t.offset=t.offset||0,t.count=t.count||(t.stride?t.data.byteLength/t.stride:t.data.length/t.size),t.divisor=t.instanced||0,t.needsUpdate=!1,t.buffer||(t.buffer=this.gl.createBuffer(),this.updateAttribute(t)),t.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==t.count*t.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,t.count*t.divisor);this.instancedCount=t.count*t.divisor}else"index"===e?this.drawRange.count=t.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,t.count))}updateAttribute(e){this.glState.boundBuffer!==e.buffer&&(this.gl.bindBuffer(e.target,e.buffer),this.glState.boundBuffer=e.buffer),this.gl.bufferData(e.target,e.data,this.gl.STATIC_DRAW),e.needsUpdate=!1}setIndex(e){this.addAttribute("index",e)}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}setInstancedCount(e){this.instancedCount=e}createVAO(e){this.VAOs[e.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.bindAttributes(e)}bindAttributes(e){e.attributeLocations.forEach((e,{name:t,type:n})=>{if(!this.attributes[t])return void console.warn(`active attribute ${t} not being supplied`);const i=this.attributes[t];this.gl.bindBuffer(i.target,i.buffer),this.glState.boundBuffer=i.buffer;let r=1;35674===n&&(r=2),35675===n&&(r=3),35676===n&&(r=4);const o=i.size/r,a=1===r?0:r*r*r,s=1===r?0:r*r;for(let t=0;t<r;t++)this.gl.vertexAttribPointer(e+t,o,i.type,i.normalized,i.stride+a,i.offset+t*s),this.gl.enableVertexAttribArray(e+t),this.gl.renderer.vertexAttribDivisor(e+t,i.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:e,mode:t=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${e.attributeOrder}`&&(this.VAOs[e.attributeOrder]||this.createVAO(e),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${e.attributeOrder}`),e.attributeLocations.forEach((e,{name:t})=>{const n=this.attributes[t];n.needsUpdate&&this.updateAttribute(n)}),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(t,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(t,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(t,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start):this.gl.drawArrays(t,this.drawRange.start,this.drawRange.count)}getPositionArray(){const e=this.attributes.position;return e.min?[...e.min,...e.max]:e.data?e.data:R?void 0:(console.warn("No position buffer data found to compute bounds"),R=!0)}computeBoundingBox(e){e||(e=this.getPositionArray()),this.bounds||(this.bounds={min:new E,max:new E,center:new E,scale:new E,radius:1/0});const t=this.bounds.min,n=this.bounds.max,i=this.bounds.center,r=this.bounds.scale;t.set(1/0),n.set(-1/0);for(let i=0,r=e.length;i<r;i+=3){const r=e[i],o=e[i+1],a=e[i+2];t.x=Math.min(r,t.x),t.y=Math.min(o,t.y),t.z=Math.min(a,t.z),n.x=Math.max(r,n.x),n.y=Math.max(o,n.y),n.z=Math.max(a,n.z)}r.sub(n,t),i.add(t,n).divide(2)}computeBoundingSphere(e){e||(e=this.getPositionArray()),this.bounds||this.computeBoundingBox(e);let t=0;for(let n=0,i=e.length;n<i;n+=3)T.fromArray(e,n),t=Math.max(t,this.bounds.center.squaredDistance(T));this.bounds.radius=Math.sqrt(t)}remove(){this.vao&&this.gl.renderer.deleteVertexArray(this.vao);for(let e in this.attributes)this.gl.deleteBuffer(this.attributes[e].buffer),delete this.attributes[e]}}let C=1;const P={};class k{constructor(e,{vertex:t,fragment:n,uniforms:i={},transparent:r=!1,cullFace:o=e.BACK,frontFace:a=e.CCW,depthTest:s=!0,depthWrite:l=!0,depthFunc:u=e.LESS}={}){e.canvas||console.error("gl not passed as fist argument to Program"),this.gl=e,this.uniforms=i,this.id=C++,t||console.warn("vertex shader not supplied"),n||console.warn("fragment shader not supplied"),this.transparent=r,this.cullFace=o,this.frontFace=a,this.depthTest=s,this.depthWrite=l,this.depthFunc=u,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const c=e.createShader(e.VERTEX_SHADER);e.shaderSource(c,t),e.compileShader(c),""!==e.getShaderInfoLog(c)&&console.warn(`${e.getShaderInfoLog(c)}\nVertex Shader\n${I(t)}`);const d=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(d,n),e.compileShader(d),""!==e.getShaderInfoLog(d)&&console.warn(`${e.getShaderInfoLog(d)}\nFragment Shader\n${I(n)}`),this.program=e.createProgram(),e.attachShader(this.program,c),e.attachShader(this.program,d),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))return console.warn(e.getProgramInfoLog(this.program));e.deleteShader(c),e.deleteShader(d),this.uniformLocations=new Map;let h=e.getProgramParameter(this.program,e.ACTIVE_UNIFORMS);for(let t=0;t<h;t++){let n=e.getActiveUniform(this.program,t);this.uniformLocations.set(n,e.getUniformLocation(this.program,n.name));const i=n.name.match(/(\w+)/g);n.uniformName=i[0],3===i.length?(n.isStructArray=!0,n.structIndex=Number(i[1]),n.structProperty=i[2]):2===i.length&&isNaN(Number(i[1]))&&(n.isStruct=!0,n.structProperty=i[1])}this.attributeLocations=new Map;const p=[],m=e.getProgramParameter(this.program,e.ACTIVE_ATTRIBUTES);for(let t=0;t<m;t++){const n=e.getActiveAttrib(this.program,t),i=e.getAttribLocation(this.program,n.name);p[i]=n.name,this.attributeLocations.set(n,i)}this.attributeOrder=p.join("")}setBlendFunc(e,t,n,i){this.blendFunc.src=e,this.blendFunc.dst=t,this.blendFunc.srcAlpha=n,this.blendFunc.dstAlpha=i,e&&(this.transparent=!0)}setBlendEquation(e,t){this.blendEquation.modeRGB=e,this.blendEquation.modeAlpha=t}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:e=!1}={}){let t=-1;this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((e,n)=>{let i=n.uniformName,r=this.uniforms[i];if(n.isStruct&&(r=r[n.structProperty],i+="."+n.structProperty),n.isStructArray&&(r=r[n.structIndex][n.structProperty],i+=`[${n.structIndex}].${n.structProperty}`),!r)return N(`Active uniform ${i} has not been supplied`);if(r&&void 0===r.value)return N(i+" uniform is missing a value parameter");if(r.value.texture)return t+=1,r.value.update(t),O(this.gl,n.type,e,t);if(r.value.length&&r.value[0].texture){const i=[];return r.value.forEach(e=>{t+=1,e.update(t),i.push(t)}),O(this.gl,n.type,e,i)}O(this.gl,n.type,e,r.value)}),this.applyState(),e&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function O(e,t,n,i){i=i.length?function(e){const t=e.length,n=e[0].length;if(void 0===n)return e;const i=t*n;let r=P[i];r||(P[i]=r=new Float32Array(i));for(let i=0;i<t;i++)r.set(e[i],i*n);return r}(i):i;const r=e.renderer.state.uniformLocations.get(n);if(i.length)if(void 0===r||r.length!==i.length)e.renderer.state.uniformLocations.set(n,i.slice(0));else{if(function(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}(r,i))return;r.set?r.set(i):function(e,t){for(let n=0,i=e.length;n<i;n++)e[n]=t[n]}(r,i),e.renderer.state.uniformLocations.set(n,r)}else{if(r===i)return;e.renderer.state.uniformLocations.set(n,i)}switch(t){case 5126:return i.length?e.uniform1fv(n,i):e.uniform1f(n,i);case 35664:return e.uniform2fv(n,i);case 35665:return e.uniform3fv(n,i);case 35666:return e.uniform4fv(n,i);case 35670:case 5124:case 35678:case 35680:return i.length?e.uniform1iv(n,i):e.uniform1i(n,i);case 35671:case 35667:return e.uniform2iv(n,i);case 35672:case 35668:return e.uniform3iv(n,i);case 35673:case 35669:return e.uniform4iv(n,i);case 35674:return e.uniformMatrix2fv(n,!1,i);case 35675:return e.uniformMatrix3fv(n,!1,i);case 35676:return e.uniformMatrix4fv(n,!1,i)}}function I(e){let t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}let D=0;function N(e){D>100||(console.warn(e),D++,D>100&&console.warn("More than 100 program warnings - stopping logs."))}const U=new E;let B=1;class z{constructor({canvas:e=document.createElement("canvas"),width:t=300,height:n=150,dpr:i=1,alpha:r=!1,depth:o=!0,stencil:a=!1,antialias:s=!1,premultipliedAlpha:l=!1,preserveDrawingBuffer:u=!1,powerPreference:c="default",autoClear:d=!0,webgl:h=2}={}){const p={alpha:r,depth:o,stencil:a,antialias:s,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:c};this.dpr=i,this.alpha=r,this.color=!0,this.depth=o,this.stencil=a,this.premultipliedAlpha=l,this.autoClear=d,this.id=B++,2===h&&(this.gl=e.getContext("webgl2",p)),this.isWebgl2=!!this.gl,this.gl||(this.gl=e.getContext("webgl",p)||e.getContext("experimental-webgl",p)),this.gl.renderer=this,this.setSize(t,n),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(e,t){this.width=e,this.height=t,this.gl.canvas.width=e*this.dpr,this.gl.canvas.height=t*this.dpr,Object.assign(this.gl.canvas.style,{width:e+"px",height:t+"px"})}setViewport(e,t){this.state.viewport.width===e&&this.state.viewport.height===t||(this.state.viewport.width=e,this.state.viewport.height=t,this.gl.viewport(0,0,e,t))}enable(e){!0!==this.state[e]&&(this.gl.enable(e),this.state[e]=!0)}disable(e){!1!==this.state[e]&&(this.gl.disable(e),this.state[e]=!1)}setBlendFunc(e,t,n,i){this.state.blendFunc.src===e&&this.state.blendFunc.dst===t&&this.state.blendFunc.srcAlpha===n&&this.state.blendFunc.dstAlpha===i||(this.state.blendFunc.src=e,this.state.blendFunc.dst=t,this.state.blendFunc.srcAlpha=n,this.state.blendFunc.dstAlpha=i,void 0!==n?this.gl.blendFuncSeparate(e,t,n,i):this.gl.blendFunc(e,t))}setBlendEquation(e,t){e=e||this.gl.FUNC_ADD,this.state.blendEquation.modeRGB===e&&this.state.blendEquation.modeAlpha===t||(this.state.blendEquation.modeRGB=e,this.state.blendEquation.modeAlpha=t,void 0!==t?this.gl.blendEquationSeparate(e,t):this.gl.blendEquation(e))}setCullFace(e){this.state.cullFace!==e&&(this.state.cullFace=e,this.gl.cullFace(e))}setFrontFace(e){this.state.frontFace!==e&&(this.state.frontFace=e,this.gl.frontFace(e))}setDepthMask(e){this.state.depthMask!==e&&(this.state.depthMask=e,this.gl.depthMask(e))}setDepthFunc(e){this.state.depthFunc!==e&&(this.state.depthFunc=e,this.gl.depthFunc(e))}activeTexture(e){this.state.activeTextureUnit!==e&&(this.state.activeTextureUnit=e,this.gl.activeTexture(this.gl.TEXTURE0+e))}bindFramebuffer({target:e=this.gl.FRAMEBUFFER,buffer:t=null}={}){this.state.framebuffer!==t&&(this.state.framebuffer=t,this.gl.bindFramebuffer(e,t))}getExtension(e,t,n){return t&&this.gl[t]?this.gl[t].bind(this.gl):(this.extensions[e]||(this.extensions[e]=this.gl.getExtension(e)),t?this.extensions[e]?this.extensions[e][n].bind(this.extensions[e]):null:this.extensions[e])}sortOpaque(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program.id!==t.program.id?e.program.id-t.program.id:e.zDepth!==t.zDepth?e.zDepth-t.zDepth:t.id-e.id}sortTransparent(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.zDepth!==t.zDepth?t.zDepth-e.zDepth:t.id-e.id}sortUI(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program.id!==t.program.id?e.program.id-t.program.id:t.id-e.id}getRenderList({scene:e,camera:t,frustumCull:n,sort:i}){let r=[];if(t&&n&&t.updateFrustum(),e.traverse(e=>{if(!e.visible)return!0;e.draw&&(n&&e.frustumCulled&&t&&!t.frustumIntersectsMesh(e)||r.push(e))}),i){const e=[],n=[],i=[];r.forEach(r=>{r.program.transparent?r.program.depthTest?n.push(r):i.push(r):e.push(r),r.zDepth=0,0===r.renderOrder&&r.program.depthTest&&t&&(r.worldMatrix.getTranslation(U),U.applyMatrix4(t.projectionViewMatrix),r.zDepth=U.z)}),e.sort(this.sortOpaque),n.sort(this.sortTransparent),i.sort(this.sortUI),r=e.concat(n,i)}return r}render({scene:e,camera:t,target:n=null,update:i=!0,sort:r=!0,frustumCull:o=!0,clear:a}){null===n?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(n),this.setViewport(n.width,n.height)),(a||this.autoClear&&!1!==a)&&(!this.depth||n&&!n.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),i&&e.updateMatrixWorld(),t&&t.updateMatrixWorld();this.getRenderList({scene:e,camera:t,frustumCull:o,sort:r}).forEach(e=>{e.draw({camera:t})})}}function V(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function G(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e}function H(e,t){let n=t[0],i=t[1],r=t[2],o=t[3],a=n*n+i*i+r*r+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=n*a,e[1]=i*a,e[2]=r*a,e[3]=o*a,e}function W(e,t,n){let i=t[0],r=t[1],o=t[2],a=t[3],s=n[0],l=n[1],u=n[2],c=n[3];return e[0]=i*c+a*s+r*u-o*l,e[1]=r*c+a*l+o*s-i*u,e[2]=o*c+a*u+i*l-r*s,e[3]=a*c-i*s-r*l-o*u,e}const q=V,j=G,X=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Y=H;class Z extends Array{constructor(e=0,t=0,n=0,i=1){return super(e,t,n,i),this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this[0]=e,this.onChange()}set y(e){this[1]=e,this.onChange()}set z(e){this[2]=e,this.onChange()}set w(e){this[3]=e,this.onChange()}identity(){var e;return(e=this)[0]=0,e[1]=0,e[2]=0,e[3]=1,this.onChange(),this}set(e,t,n,i){return e.length?this.copy(e):(j(this,e,t,n,i),this.onChange(),this)}rotateX(e){return function(e,t,n){n*=.5;let i=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);e[0]=i*l+a*s,e[1]=r*l+o*s,e[2]=o*l-r*s,e[3]=a*l-i*s}(this,this,e),this.onChange(),this}rotateY(e){return function(e,t,n){n*=.5;let i=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);e[0]=i*l-o*s,e[1]=r*l+a*s,e[2]=o*l+i*s,e[3]=a*l-r*s}(this,this,e),this.onChange(),this}rotateZ(e){return function(e,t,n){n*=.5;let i=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);e[0]=i*l+r*s,e[1]=r*l-i*s,e[2]=o*l+a*s,e[3]=a*l-o*s}(this,this,e),this.onChange(),this}inverse(e=this){return function(e,t){let n=t[0],i=t[1],r=t[2],o=t[3],a=n*n+i*i+r*r+o*o,s=a?1/a:0;e[0]=-n*s,e[1]=-i*s,e[2]=-r*s,e[3]=o*s}(this,e),this.onChange(),this}conjugate(e=this){var t,n;return n=e,(t=this)[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],this.onChange(),this}copy(e){return q(this,e),this.onChange(),this}normalize(e=this){return Y(this,e),this.onChange(),this}multiply(e,t){return t?W(this,e,t):W(this,this,e),this.onChange(),this}dot(e){return X(this,e)}fromMatrix3(e){return function(e,t){let n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);let r=(i+1)%3,o=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*r+r]-t[3*o+o]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*r+o]-t[3*o+r])*n,e[r]=(t[3*r+i]+t[3*i+r])*n,e[o]=(t[3*o+i]+t[3*i+o])*n}}(this,e),this.onChange(),this}fromEuler(e){return function(e,t,n="YXZ"){let i=Math.sin(.5*t[0]),r=Math.cos(.5*t[0]),o=Math.sin(.5*t[1]),a=Math.cos(.5*t[1]),s=Math.sin(.5*t[2]),l=Math.cos(.5*t[2]);"XYZ"===n?(e[0]=i*a*l+r*o*s,e[1]=r*o*l-i*a*s,e[2]=r*a*s+i*o*l,e[3]=r*a*l-i*o*s):"YXZ"===n?(e[0]=i*a*l+r*o*s,e[1]=r*o*l-i*a*s,e[2]=r*a*s-i*o*l,e[3]=r*a*l+i*o*s):"ZXY"===n?(e[0]=i*a*l-r*o*s,e[1]=r*o*l+i*a*s,e[2]=r*a*s+i*o*l,e[3]=r*a*l-i*o*s):"ZYX"===n?(e[0]=i*a*l-r*o*s,e[1]=r*o*l+i*a*s,e[2]=r*a*s-i*o*l,e[3]=r*a*l+i*o*s):"YZX"===n?(e[0]=i*a*l+r*o*s,e[1]=r*o*l+i*a*s,e[2]=r*a*s-i*o*l,e[3]=r*a*l-i*o*s):"XZY"===n&&(e[0]=i*a*l-r*o*s,e[1]=r*o*l-i*a*s,e[2]=r*a*s+i*o*l,e[3]=r*a*l+i*o*s)}(this,e,e.order),this}fromAxisAngle(e,t){return function(e,t,n){n*=.5;let i=Math.sin(n);e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n)}(this,e,t),this}slerp(e,t){return function(e,t,n,i){let r,o,a,s,l,u=t[0],c=t[1],d=t[2],h=t[3],p=n[0],m=n[1],f=n[2],v=n[3];o=u*p+c*m+d*f+h*v,o<0&&(o=-o,p=-p,m=-m,f=-f,v=-v),1-o>1e-6?(r=Math.acos(o),a=Math.sin(r),s=Math.sin((1-i)*r)/a,l=Math.sin(i*r)/a):(s=1-i,l=i),e[0]=s*u+l*p,e[1]=s*c+l*m,e[2]=s*d+l*f,e[3]=s*h+l*v}(this,this,e,t),this}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this[2]=e[t+2],this[3]=e[t+3],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e}}function $(e,t,n){let i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],p=t[10],m=t[11],f=t[12],v=t[13],g=t[14],w=t[15],x=n[0],y=n[1],_=n[2],b=n[3];return e[0]=x*i+y*s+_*d+b*f,e[1]=x*r+y*l+_*h+b*v,e[2]=x*o+y*u+_*p+b*g,e[3]=x*a+y*c+_*m+b*w,x=n[4],y=n[5],_=n[6],b=n[7],e[4]=x*i+y*s+_*d+b*f,e[5]=x*r+y*l+_*h+b*v,e[6]=x*o+y*u+_*p+b*g,e[7]=x*a+y*c+_*m+b*w,x=n[8],y=n[9],_=n[10],b=n[11],e[8]=x*i+y*s+_*d+b*f,e[9]=x*r+y*l+_*h+b*v,e[10]=x*o+y*u+_*p+b*g,e[11]=x*a+y*c+_*m+b*w,x=n[12],y=n[13],_=n[14],b=n[15],e[12]=x*i+y*s+_*d+b*f,e[13]=x*r+y*l+_*h+b*v,e[14]=x*o+y*u+_*p+b*g,e[15]=x*a+y*c+_*m+b*w,e}function Q(e,t){let n=t[0],i=t[1],r=t[2],o=t[4],a=t[5],s=t[6],l=t[8],u=t[9],c=t[10];return e[0]=Math.hypot(n,i,r),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(l,u,c),e}const K=function(){const e=[0,0,0];return function(t,n){let i=e;Q(i,n);let r=1/i[0],o=1/i[1],a=1/i[2],s=n[0]*r,l=n[1]*o,u=n[2]*a,c=n[4]*r,d=n[5]*o,h=n[6]*a,p=n[8]*r,m=n[9]*o,f=n[10]*a,v=s+d+f,g=0;return v>0?(g=2*Math.sqrt(v+1),t[3]=.25*g,t[0]=(h-m)/g,t[1]=(p-u)/g,t[2]=(l-c)/g):s>d&&s>f?(g=2*Math.sqrt(1+s-d-f),t[3]=(h-m)/g,t[0]=.25*g,t[1]=(l+c)/g,t[2]=(p+u)/g):d>f?(g=2*Math.sqrt(1+d-s-f),t[3]=(p-u)/g,t[0]=(l+c)/g,t[1]=.25*g,t[2]=(h+m)/g):(g=2*Math.sqrt(1+f-s-d),t[3]=(l-c)/g,t[0]=(p+u)/g,t[1]=(h+m)/g,t[2]=.25*g),t}}();class J extends Array{constructor(e=1,t=0,n=0,i=0,r=0,o=1,a=0,s=0,l=0,u=0,c=1,d=0,h=0,p=0,m=0,f=1){return super(e,t,n,i,r,o,a,s,l,u,c,d,h,p,m,f),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(e){this[12]=e}set y(e){this[13]=e}set z(e){this[14]=e}set w(e){this[15]=e}set(e,t,n,i,r,o,a,s,l,u,c,d,h,p,m,f){return e.length?this.copy(e):(function(e,t,n,i,r,o,a,s,l,u,c,d,h,p,m,f,v){e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e[8]=u,e[9]=c,e[10]=d,e[11]=h,e[12]=p,e[13]=m,e[14]=f,e[15]=v}(this,e,t,n,i,r,o,a,s,l,u,c,d,h,p,m,f),this)}translate(e,t=this){return function(e,t,n){let i,r,o,a,s,l,u,c,d,h,p,m,f=n[0],v=n[1],g=n[2];t===e?(e[12]=t[0]*f+t[4]*v+t[8]*g+t[12],e[13]=t[1]*f+t[5]*v+t[9]*g+t[13],e[14]=t[2]*f+t[6]*v+t[10]*g+t[14],e[15]=t[3]*f+t[7]*v+t[11]*g+t[15]):(i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],p=t[10],m=t[11],e[0]=i,e[1]=r,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=d,e[9]=h,e[10]=p,e[11]=m,e[12]=i*f+s*v+d*g+t[12],e[13]=r*f+l*v+h*g+t[13],e[14]=o*f+u*v+p*g+t[14],e[15]=a*f+c*v+m*g+t[15])}(this,t,e),this}rotate(e,t,n=this){return function(e,t,n,i){let r,o,a,s,l,u,c,d,h,p,m,f,v,g,w,x,y,_,b,M,A,E,T,S,L=i[0],R=i[1],F=i[2],C=Math.hypot(L,R,F);Math.abs(C)<1e-6||(C=1/C,L*=C,R*=C,F*=C,r=Math.sin(n),o=Math.cos(n),a=1-o,s=t[0],l=t[1],u=t[2],c=t[3],d=t[4],h=t[5],p=t[6],m=t[7],f=t[8],v=t[9],g=t[10],w=t[11],x=L*L*a+o,y=R*L*a+F*r,_=F*L*a-R*r,b=L*R*a-F*r,M=R*R*a+o,A=F*R*a+L*r,E=L*F*a+R*r,T=R*F*a-L*r,S=F*F*a+o,e[0]=s*x+d*y+f*_,e[1]=l*x+h*y+v*_,e[2]=u*x+p*y+g*_,e[3]=c*x+m*y+w*_,e[4]=s*b+d*M+f*A,e[5]=l*b+h*M+v*A,e[6]=u*b+p*M+g*A,e[7]=c*b+m*M+w*A,e[8]=s*E+d*T+f*S,e[9]=l*E+h*T+v*S,e[10]=u*E+p*T+g*S,e[11]=c*E+m*T+w*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,n,e,t),this}scale(e,t=this){return function(e,t,n){let i=n[0],r=n[1],o=n[2];e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}(this,t,"number"==typeof e?[e,e,e]:e),this}multiply(e,t){return t?$(this,e,t):$(this,this,e),this}identity(){var e;return(e=this)[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}copy(e){var t,n;return n=e,(t=this)[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}fromPerspective({fov:e,aspect:t,near:n,far:i}={}){return function(e,t,n,i,r){let o=1/Math.tan(t/2),a=1/(i-r);e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(r+i)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*r*i*a,e[15]=0}(this,e,t,n,i),this}fromOrthogonal({left:e,right:t,bottom:n,top:i,near:r,far:o}){return function(e,t,n,i,r,o,a){let s=1/(t-n),l=1/(i-r),u=1/(o-a);e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*s,e[13]=(r+i)*l,e[14]=(a+o)*u,e[15]=1}(this,e,t,n,i,r,o),this}fromQuaternion(e){return function(e,t){let n=t[0],i=t[1],r=t[2],o=t[3],a=n+n,s=i+i,l=r+r,u=n*a,c=i*a,d=i*s,h=r*a,p=r*s,m=r*l,f=o*a,v=o*s,g=o*l;e[0]=1-d-m,e[1]=c+g,e[2]=h-v,e[3]=0,e[4]=c-g,e[5]=1-u-m,e[6]=p+f,e[7]=0,e[8]=h+v,e[9]=p-f,e[10]=1-u-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}inverse(e=this){return function(e,t){let n=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],p=t[11],m=t[12],f=t[13],v=t[14],g=t[15],w=n*s-i*a,x=n*l-r*a,y=n*u-o*a,_=i*l-r*s,b=i*u-o*s,M=r*u-o*l,A=c*f-d*m,E=c*v-h*m,T=c*g-p*m,S=d*v-h*f,L=d*g-p*f,R=h*g-p*v,F=w*R-x*L+y*S+_*T-b*E+M*A;F&&(F=1/F,e[0]=(s*R-l*L+u*S)*F,e[1]=(r*L-i*R-o*S)*F,e[2]=(f*M-v*b+g*_)*F,e[3]=(h*b-d*M-p*_)*F,e[4]=(l*T-a*R-u*E)*F,e[5]=(n*R-r*T+o*E)*F,e[6]=(v*y-m*M-g*x)*F,e[7]=(c*M-h*y+p*x)*F,e[8]=(a*L-s*T+u*A)*F,e[9]=(i*T-n*L-o*A)*F,e[10]=(m*b-f*y+g*w)*F,e[11]=(d*y-c*b-p*w)*F,e[12]=(s*E-a*S-l*A)*F,e[13]=(n*S-i*E+r*A)*F,e[14]=(f*x-m*_-v*w)*F,e[15]=(c*_-d*x+h*w)*F)}(this,e),this}compose(e,t,n){return function(e,t,n,i){let r=t[0],o=t[1],a=t[2],s=t[3],l=r+r,u=o+o,c=a+a,d=r*l,h=r*u,p=r*c,m=o*u,f=o*c,v=a*c,g=s*l,w=s*u,x=s*c,y=i[0],_=i[1],b=i[2];e[0]=(1-(m+v))*y,e[1]=(h+x)*y,e[2]=(p-w)*y,e[3]=0,e[4]=(h-x)*_,e[5]=(1-(d+v))*_,e[6]=(f+g)*_,e[7]=0,e[8]=(p+w)*b,e[9]=(f-g)*b,e[10]=(1-(d+m))*b,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1}(this,e,t,n),this}getRotation(e){return K(e,this),this}getTranslation(e){var t,n;return n=this,(t=e)[0]=n[12],t[1]=n[13],t[2]=n[14],this}getScaling(e){return Q(e,this),this}getMaxScaleOnAxis(){return function(e){let t=e[0],n=e[1],i=e[2],r=e[4],o=e[5],a=e[6],s=e[8],l=e[9],u=e[10];const c=t*t+n*n+i*i,d=r*r+o*o+a*a,h=s*s+l*l+u*u;return Math.sqrt(Math.max(c,d,h))}(this)}lookAt(e,t,n){return function(e,t,n,i){let r=t[0],o=t[1],a=t[2],s=i[0],l=i[1],u=i[2],c=r-n[0],d=o-n[1],h=a-n[2],p=c*c+d*d+h*h;0===p?h=1:(p=1/Math.sqrt(p),c*=p,d*=p,h*=p);let m=l*h-u*d,f=u*c-s*h,v=s*d-l*c;p=m*m+f*f+v*v,0===p&&(u?s+=1e-6:l?u+=1e-6:l+=1e-6,m=l*h-u*d,f=u*c-s*h,v=s*d-l*c,p=m*m+f*f+v*v),p=1/Math.sqrt(p),m*=p,f*=p,v*=p,e[0]=m,e[1]=f,e[2]=v,e[3]=0,e[4]=d*v-h*f,e[5]=h*m-c*v,e[6]=c*f-d*m,e[7]=0,e[8]=c,e[9]=d,e[10]=h,e[11]=0,e[12]=r,e[13]=o,e[14]=a,e[15]=1}(this,e,t,n),this}determinant(){return function(e){let t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],d=e[10],h=e[11],p=e[12],m=e[13],f=e[14],v=e[15];return(t*a-n*o)*(d*v-h*f)-(t*s-i*o)*(c*v-h*m)+(t*l-r*o)*(c*f-d*m)+(n*s-i*a)*(u*v-h*p)-(n*l-r*a)*(u*f-d*p)+(i*l-r*s)*(u*m-c*p)}(this)}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this[2]=e[t+2],this[3]=e[t+3],this[4]=e[t+4],this[5]=e[t+5],this[6]=e[t+6],this[7]=e[t+7],this[8]=e[t+8],this[9]=e[t+9],this[10]=e[t+10],this[11]=e[t+11],this[12]=e[t+12],this[13]=e[t+13],this[14]=e[t+14],this[15]=e[t+15],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e[t+4]=this[4],e[t+5]=this[5],e[t+6]=this[6],e[t+7]=this[7],e[t+8]=this[8],e[t+9]=this[9],e[t+10]=this[10],e[t+11]=this[11],e[t+12]=this[12],e[t+13]=this[13],e[t+14]=this[14],e[t+15]=this[15],e}}const ee=new J;class te extends Array{constructor(e=0,t=e,n=e,i="YXZ"){return super(e,t,n),this.order=i,this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e,this.onChange()}set y(e){this[1]=e,this.onChange()}set z(e){this[2]=e,this.onChange()}set(e,t=e,n=e){return e.length?this.copy(e):(this[0]=e,this[1]=t,this[2]=n,this.onChange(),this)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.onChange(),this}reorder(e){return this.order=e,this.onChange(),this}fromRotationMatrix(e,t=this.order){return function(e,t,n="YXZ"){"XYZ"===n?(e[1]=Math.asin(Math.min(Math.max(t[8],-1),1)),Math.abs(t[8])<.99999?(e[0]=Math.atan2(-t[9],t[10]),e[2]=Math.atan2(-t[4],t[0])):(e[0]=Math.atan2(t[6],t[5]),e[2]=0)):"YXZ"===n?(e[0]=Math.asin(-Math.min(Math.max(t[9],-1),1)),Math.abs(t[9])<.99999?(e[1]=Math.atan2(t[8],t[10]),e[2]=Math.atan2(t[1],t[5])):(e[1]=Math.atan2(-t[2],t[0]),e[2]=0)):"ZXY"===n?(e[0]=Math.asin(Math.min(Math.max(t[6],-1),1)),Math.abs(t[6])<.99999?(e[1]=Math.atan2(-t[2],t[10]),e[2]=Math.atan2(-t[4],t[5])):(e[1]=0,e[2]=Math.atan2(t[1],t[0]))):"ZYX"===n?(e[1]=Math.asin(-Math.min(Math.max(t[2],-1),1)),Math.abs(t[2])<.99999?(e[0]=Math.atan2(t[6],t[10]),e[2]=Math.atan2(t[1],t[0])):(e[0]=0,e[2]=Math.atan2(-t[4],t[5]))):"YZX"===n?(e[2]=Math.asin(Math.min(Math.max(t[1],-1),1)),Math.abs(t[1])<.99999?(e[0]=Math.atan2(-t[9],t[5]),e[1]=Math.atan2(-t[2],t[0])):(e[0]=0,e[1]=Math.atan2(t[8],t[10]))):"XZY"===n&&(e[2]=Math.asin(-Math.min(Math.max(t[4],-1),1)),Math.abs(t[4])<.99999?(e[0]=Math.atan2(t[6],t[5]),e[1]=Math.atan2(t[8],t[0])):(e[0]=Math.atan2(-t[9],t[10]),e[1]=0))}(this,e,t),this}fromQuaternion(e,t=this.order){return ee.fromQuaternion(e),this.fromRotationMatrix(ee,t)}}class ne{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new J,this.worldMatrix=new J,this.matrixAutoUpdate=!0,this.position=new E,this.quaternion=new Z,this.scale=new E(1),this.rotation=new te,this.up=new E(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(e,t=!0){t&&this.parent&&e!==this.parent&&this.parent.removeChild(this,!1),this.parent=e,t&&e&&e.addChild(this,!1)}addChild(e,t=!0){~this.children.indexOf(e)||this.children.push(e),t&&e.setParent(this,!1)}removeChild(e,t=!0){~this.children.indexOf(e)&&this.children.splice(this.children.indexOf(e),1),t&&e.setParent(null,!1)}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(let t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(e){if(!e(this))for(let t=0,n=this.children.length;t<n;t++)this.children[t].traverse(e)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(e,t=!1){t?this.matrix.lookAt(this.position,e,this.up):this.matrix.lookAt(e,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}const ie=new J,re=new E,oe=new E;class ae extends ne{constructor(e,{near:t=.1,far:n=100,fov:i=45,aspect:r=1,left:o,right:a,bottom:s,top:l,zoom:u=1}={}){super(),Object.assign(this,{near:t,far:n,fov:i,aspect:r,left:o,right:a,bottom:s,top:l,zoom:u}),this.projectionMatrix=new J,this.viewMatrix=new J,this.projectionViewMatrix=new J,this.worldPosition=new E,this.type=o||a?"orthographic":"perspective","orthographic"===this.type?this.orthographic():this.perspective()}perspective({near:e=this.near,far:t=this.far,fov:n=this.fov,aspect:i=this.aspect}={}){return Object.assign(this,{near:e,far:t,fov:n,aspect:i}),this.projectionMatrix.fromPerspective({fov:n*(Math.PI/180),aspect:i,near:e,far:t}),this.type="perspective",this}orthographic({near:e=this.near,far:t=this.far,left:n=this.left,right:i=this.right,bottom:r=this.bottom,top:o=this.top,zoom:a=this.zoom}={}){return Object.assign(this,{near:e,far:t,left:n,right:i,bottom:r,top:o,zoom:a}),n/=a,i/=a,r/=a,o/=a,this.projectionMatrix.fromOrthogonal({left:n,right:i,bottom:r,top:o,near:e,far:t}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(e){return super.lookAt(e,!0),this}project(e){return e.applyMatrix4(this.viewMatrix),e.applyMatrix4(this.projectionMatrix),this}unproject(e){return e.applyMatrix4(ie.inverse(this.projectionMatrix)),e.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new E,new E,new E,new E,new E,new E]);const e=this.projectionViewMatrix;this.frustum[0].set(e[3]-e[0],e[7]-e[4],e[11]-e[8]).constant=e[15]-e[12],this.frustum[1].set(e[3]+e[0],e[7]+e[4],e[11]+e[8]).constant=e[15]+e[12],this.frustum[2].set(e[3]+e[1],e[7]+e[5],e[11]+e[9]).constant=e[15]+e[13],this.frustum[3].set(e[3]-e[1],e[7]-e[5],e[11]-e[9]).constant=e[15]-e[13],this.frustum[4].set(e[3]-e[2],e[7]-e[6],e[11]-e[10]).constant=e[15]-e[14],this.frustum[5].set(e[3]+e[2],e[7]+e[6],e[11]+e[10]).constant=e[15]+e[14];for(let e=0;e<6;e++){const t=1/this.frustum[e].distance();this.frustum[e].multiply(t),this.frustum[e].constant*=t}}frustumIntersectsMesh(e){if(!e.geometry.attributes.position)return!0;if(e.geometry.bounds&&e.geometry.bounds.radius!==1/0||e.geometry.computeBoundingSphere(),!e.geometry.bounds)return!0;const t=re;t.copy(e.geometry.bounds.center),t.applyMatrix4(e.worldMatrix);const n=e.geometry.bounds.radius*e.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(t,n)}frustumIntersectsSphere(e,t){const n=oe;for(let i=0;i<6;i++){const r=this.frustum[i];if(n.copy(r).dot(e)+r.constant<-t)return!1}return!0}}function se(e,t,n){let i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=n[0],p=n[1],m=n[2],f=n[3],v=n[4],g=n[5],w=n[6],x=n[7],y=n[8];return e[0]=h*i+p*a+m*u,e[1]=h*r+p*s+m*c,e[2]=h*o+p*l+m*d,e[3]=f*i+v*a+g*u,e[4]=f*r+v*s+g*c,e[5]=f*o+v*l+g*d,e[6]=w*i+x*a+y*u,e[7]=w*r+x*s+y*c,e[8]=w*o+x*l+y*d,e}class le extends Array{constructor(e=1,t=0,n=0,i=0,r=1,o=0,a=0,s=0,l=1){return super(e,t,n,i,r,o,a,s,l),this}set(e,t,n,i,r,o,a,s,l){return e.length?this.copy(e):(function(e,t,n,i,r,o,a,s,l,u){e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e[8]=u}(this,e,t,n,i,r,o,a,s,l),this)}translate(e,t=this){return function(e,t,n){let i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=n[0],p=n[1];e[0]=i,e[1]=r,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=h*i+p*a+u,e[7]=h*r+p*s+c,e[8]=h*o+p*l+d}(this,t,e),this}rotate(e,t=this){return function(e,t,n){let i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=Math.sin(n),p=Math.cos(n);e[0]=p*i+h*a,e[1]=p*r+h*s,e[2]=p*o+h*l,e[3]=p*a-h*i,e[4]=p*s-h*r,e[5]=p*l-h*o,e[6]=u,e[7]=c,e[8]=d}(this,t,e),this}scale(e,t=this){return function(e,t,n){let i=n[0],r=n[1];e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]}(this,t,e),this}multiply(e,t){return t?se(this,e,t):se(this,this,e),this}identity(){var e;return(e=this)[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,this}copy(e){var t,n;return n=e,(t=this)[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}fromMatrix4(e){var t,n;return n=e,(t=this)[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],this}fromQuaternion(e){return function(e,t){let n=t[0],i=t[1],r=t[2],o=t[3],a=n+n,s=i+i,l=r+r,u=n*a,c=i*a,d=i*s,h=r*a,p=r*s,m=r*l,f=o*a,v=o*s,g=o*l;e[0]=1-d-m,e[3]=c-g,e[6]=h+v,e[1]=c+g,e[4]=1-u-m,e[7]=p-f,e[2]=h-v,e[5]=p+f,e[8]=1-u-d}(this,e),this}fromBasis(e,t,n){return this.set(e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2]),this}inverse(e=this){return function(e,t){let n=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=c*a-s*u,h=-c*o+s*l,p=u*o-a*l,m=n*d+i*h+r*p;m&&(m=1/m,e[0]=d*m,e[1]=(-c*i+r*u)*m,e[2]=(s*i-r*a)*m,e[3]=h*m,e[4]=(c*n-r*l)*m,e[5]=(-s*n+r*o)*m,e[6]=p*m,e[7]=(-u*n+i*l)*m,e[8]=(a*n-i*o)*m)}(this,e),this}getNormalMatrix(e){return function(e,t){let n=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],p=t[11],m=t[12],f=t[13],v=t[14],g=t[15],w=n*s-i*a,x=n*l-r*a,y=n*u-o*a,_=i*l-r*s,b=i*u-o*s,M=r*u-o*l,A=c*f-d*m,E=c*v-h*m,T=c*g-p*m,S=d*v-h*f,L=d*g-p*f,R=h*g-p*v,F=w*R-x*L+y*S+_*T-b*E+M*A;F&&(F=1/F,e[0]=(s*R-l*L+u*S)*F,e[1]=(l*T-a*R-u*E)*F,e[2]=(a*L-s*T+u*A)*F,e[3]=(r*L-i*R-o*S)*F,e[4]=(n*R-r*T+o*E)*F,e[5]=(i*T-n*L-o*A)*F,e[6]=(f*M-v*b+g*_)*F,e[7]=(v*y-m*M-g*x)*F,e[8]=(m*b-f*y+g*w)*F)}(this,e),this}}let ue=0;class ce extends ne{constructor(e,{geometry:t,program:n,mode:i=e.TRIANGLES,frustumCulled:r=!0,renderOrder:o=0}={}){super(),e.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=e,this.id=ue++,this.geometry=t,this.program=n,this.mode=i,this.frustumCulled=r,this.renderOrder=o,this.modelViewMatrix=new J,this.normalMatrix=new le,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(e){return this.beforeRenderCallbacks.push(e),this}onAfterRender(e){return this.afterRenderCallbacks.push(e),this}draw({camera:e}={}){this.beforeRenderCallbacks.forEach(t=>t&&t({mesh:this,camera:e})),e&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=e.projectionMatrix,this.program.uniforms.cameraPosition.value=e.worldPosition,this.program.uniforms.viewMatrix.value=e.viewMatrix,this.modelViewMatrix.multiply(e.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let t=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:t}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(t=>t&&t({mesh:this,camera:e}))}}const de=new Uint8Array(4);function he(e){return 0==(e&e-1)}let pe=1;class me{constructor(e,{image:t,target:n=e.TEXTURE_2D,type:i=e.UNSIGNED_BYTE,format:r=e.RGBA,internalFormat:o=r,wrapS:a=e.CLAMP_TO_EDGE,wrapT:s=e.CLAMP_TO_EDGE,generateMipmaps:l=!0,minFilter:u=(l?e.NEAREST_MIPMAP_LINEAR:e.LINEAR),magFilter:c=e.LINEAR,premultiplyAlpha:d=!1,unpackAlignment:h=4,flipY:p=n==e.TEXTURE_2D,anisotropy:m=0,level:f=0,width:v,height:g=v}={}){this.gl=e,this.id=pe++,this.image=t,this.target=n,this.type=i,this.format=r,this.internalFormat=o,this.minFilter=u,this.magFilter=c,this.wrapS=a,this.wrapT=s,this.generateMipmaps=l,this.premultiplyAlpha=d,this.unpackAlignment=h,this.flipY=p,this.anisotropy=Math.min(m,this.gl.renderer.parameters.maxAnisotropy),this.level=f,this.width=v,this.height=g,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(e=0){const t=!(this.image===this.store.image&&!this.needsUpdate);if((t||this.glState.textureUnits[e]!==this.id)&&(this.gl.renderer.activeTexture(e),this.bind()),t){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let e=0;e<6;e++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+e,this.level,this.internalFormat,this.format,this.type,this.image[e]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let e=0;e<this.image.length;e++)this.gl.compressedTexImage2D(this.target,e,this.internalFormat,this.image[e].width,this.image[e].height,0,this.image[e].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||he(this.image.width)&&he(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let e=0;e<6;e++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,de);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,de);this.store.image=this.image}}}class fe{constructor(e,{width:t=e.canvas.width,height:n=e.canvas.height,target:i=e.FRAMEBUFFER,color:r=1,depth:o=!0,stencil:a=!1,depthTexture:s=!1,wrapS:l=e.CLAMP_TO_EDGE,wrapT:u=e.CLAMP_TO_EDGE,minFilter:c=e.LINEAR,magFilter:d=c,type:h=e.UNSIGNED_BYTE,format:p=e.RGBA,internalFormat:m=p,unpackAlignment:f,premultiplyAlpha:v}={}){this.gl=e,this.width=t,this.height=n,this.depth=o,this.buffer=this.gl.createFramebuffer(),this.target=i,this.gl.bindFramebuffer(this.target,this.buffer),this.textures=[];const g=[];for(let i=0;i<r;i++)this.textures.push(new me(e,{width:t,height:n,wrapS:l,wrapT:u,minFilter:c,magFilter:d,type:h,format:p,internalFormat:m,unpackAlignment:f,premultiplyAlpha:v,flipY:!1,generateMipmaps:!1})),this.textures[i].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+i,this.gl.TEXTURE_2D,this.textures[i].texture,0),g.push(this.gl.COLOR_ATTACHMENT0+i);g.length>1&&this.gl.renderer.drawBuffers(g),this.texture=this.textures[0],s&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))?(this.depthTexture=new me(e,{width:t,height:n,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:e.renderer.isWebgl2?this.gl.DEPTH_COMPONENT16:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(o&&!a&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,t,n),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),a&&!o&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,t,n),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),o&&a&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,t,n),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer))),this.gl.bindFramebuffer(this.target,null)}}const ve={black:"#000000",white:"#ffffff",red:"#ff0000",green:"#00ff00",blue:"#0000ff",fuchsia:"#ff00ff",cyan:"#00ffff",yellow:"#ffff00",orange:"#ff8000"};function ge(e){4===e.length&&(e=e[0]+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]);const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t||console.warn(`Unable to convert hex string ${e} to rgb values`),[parseInt(t[1],16)/255,parseInt(t[2],16)/255,parseInt(t[3],16)/255]}function we(e){return[((e=parseInt(e))>>16&255)/255,(e>>8&255)/255,(255&e)/255]}function xe(e){return void 0===e?[0,0,0]:3===arguments.length?arguments:isNaN(e)?"#"===e[0]?ge(e):ve[e.toLowerCase()]?ge(ve[e.toLowerCase()]):(console.warn("Color format not recognised"),[0,0,0]):we(e)}class ye extends Array{constructor(e){return Array.isArray(e)?super(...e):super(...xe(...arguments))}get r(){return this[0]}get g(){return this[1]}get b(){return this[2]}set r(e){this[0]=e}set g(e){this[1]=e}set b(e){this[2]=e}set(e){return Array.isArray(e)?this.copy(e):this.copy(xe(...arguments))}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this}}function _e(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function be(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Me(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function Ae(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function Ee(e,t){return e[0]*t[1]-e[1]*t[0]}class Te extends Array{constructor(e=0,t=e){return super(e,t),this}get x(){return this[0]}get y(){return this[1]}set x(e){this[0]=e}set y(e){this[1]=e}set(e,t=e){return e.length?this.copy(e):(function(e,t,n){e[0]=t,e[1]=n}(this,e,t),this)}copy(e){var t,n;return n=e,(t=this)[0]=n[0],t[1]=n[1],this}add(e,t){return t?_e(this,e,t):_e(this,this,e),this}sub(e,t){return t?be(this,e,t):be(this,this,e),this}multiply(e){var t,n,i;return e.length?(n=this,i=e,(t=this)[0]=n[0]*i[0],t[1]=n[1]*i[1]):Me(this,this,e),this}divide(e){var t,n,i;return e.length?(n=this,i=e,(t=this)[0]=n[0]/i[0],t[1]=n[1]/i[1]):Me(this,this,1/e),this}inverse(e=this){var t,n;return n=e,(t=this)[0]=1/n[0],t[1]=1/n[1],this}len(){return Ae(this)}distance(e){return e?(t=this,i=(n=e)[0]-t[0],r=n[1]-t[1],Math.sqrt(i*i+r*r)):Ae(this);var t,n,i,r}squaredLen(){return this.squaredDistance()}squaredDistance(e){return e?(t=this,i=(n=e)[0]-t[0],r=n[1]-t[1],i*i+r*r):function(e){var t=e[0],n=e[1];return t*t+n*n}(this);var t,n,i,r}negate(e=this){var t,n;return n=e,(t=this)[0]=-n[0],t[1]=-n[1],this}cross(e,t){return t?Ee(e,t):Ee(this,e)}scale(e){return Me(this,this,e),this}normalize(){var e,t,n,i,r;return e=this,n=(t=this)[0],i=t[1],(r=n*n+i*i)>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,this}dot(e){return n=e,(t=this)[0]*n[0]+t[1]*n[1];var t,n}equals(e){return n=e,(t=this)[0]===n[0]&&t[1]===n[1];var t,n}applyMatrix3(e){var t,n,i,r,o;return t=this,i=e,r=(n=this)[0],o=n[1],t[0]=i[0]*r+i[3]*o+i[6],t[1]=i[1]*r+i[4]*o+i[7],this}applyMatrix4(e){return function(e,t,n){let i=t[0],r=t[1];e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13]}(this,this,e),this}lerp(e,t){!function(e,t,n,i){var r=t[0],o=t[1];e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o)}(this,this,e,t)}clone(){return new Te(this[0],this[1])}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e}}class Se extends F{constructor(e,{width:t=1,height:n=1,widthSegments:i=1,heightSegments:r=1,attributes:o={}}={}){const a=i,s=r,l=(a+1)*(s+1),u=a*s*6,c=new Float32Array(3*l),d=new Float32Array(3*l),h=new Float32Array(2*l),p=l>65536?new Uint32Array(u):new Uint16Array(u);Se.buildPlane(c,d,h,p,t,n,0,a,s),Object.assign(o,{position:{size:3,data:c},normal:{size:3,data:d},uv:{size:2,data:h},index:{data:p}}),super(e,o)}static buildPlane(e,t,n,i,r,o,a,s,l,u=0,c=1,d=2,h=1,p=-1,m=0,f=0){const v=m,g=r/s,w=o/l;for(let x=0;x<=l;x++){let y=x*w-o/2;for(let o=0;o<=s;o++,m++){let w=o*g-r/2;if(e[3*m+u]=w*h,e[3*m+c]=y*p,e[3*m+d]=a/2,t[3*m+u]=0,t[3*m+c]=0,t[3*m+d]=a>=0?1:-1,n[2*m]=o/s,n[2*m+1]=1-x/l,x===l||o===s)continue;let _=v+o+x*(s+1),b=v+o+(x+1)*(s+1),M=v+o+(x+1)*(s+1)+1,A=v+o+x*(s+1)+1;i[6*f]=_,i[6*f+1]=b,i[6*f+2]=A,i[6*f+3]=b,i[6*f+4]=M,i[6*f+5]=A,f++}}}}class Le extends F{constructor(e,{attributes:t={}}={}){Object.assign(t,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),super(e,t)}}const Re=-1,Fe=0,Ce=1,Pe=2,ke=3,Oe=new E,Ie=new Te,De=new Te;function Ne(e,{element:t=document,enabled:n=!0,target:i=new E,ease:r=.25,inertia:o=.85,enableRotate:a=!0,rotateSpeed:s=.1,autoRotate:l=!1,autoRotateSpeed:u=1,enableZoom:c=!0,zoomSpeed:d=1,enablePan:h=!0,panSpeed:p=.1,minPolarAngle:m=0,maxPolarAngle:f=Math.PI,minAzimuthAngle:v=-1/0,maxAzimuthAngle:g=1/0,minDistance:w=0,maxDistance:x=1/0}={}){this.enabled=n,this.target=i,r=r||1,o=o||0,this.minDistance=w,this.maxDistance=x;const y={radius:1,phi:0,theta:0},_={radius:1,phi:0,theta:0},b={radius:1,phi:0,theta:0},M=new E,A=new E;A.copy(e.position).sub(this.target),b.radius=_.radius=A.distance(),b.theta=_.theta=Math.atan2(A.x,A.z),b.phi=_.phi=Math.acos(Math.min(Math.max(A.y/_.radius,-1),1)),this.offset=A,this.update=()=>{l&&function(){const e=2*Math.PI/60/60*u;y.theta-=e}(),_.radius*=y.radius,_.theta+=y.theta,_.phi+=y.phi,_.theta=Math.max(v,Math.min(g,_.theta)),_.phi=Math.max(m,Math.min(f,_.phi)),_.radius=Math.max(this.minDistance,Math.min(this.maxDistance,_.radius)),b.phi+=(_.phi-b.phi)*r,b.theta+=(_.theta-b.theta)*r,b.radius+=(_.radius-b.radius)*r,this.target.add(M);let t=b.radius*Math.sin(Math.max(1e-6,b.phi));A.x=t*Math.sin(b.theta),A.y=b.radius*Math.cos(b.phi),A.z=t*Math.cos(b.theta),e.position.copy(this.target).add(A),e.lookAt(this.target),y.theta*=o,y.phi*=o,M.multiply(o),y.radius=1},this.forcePosition=()=>{A.copy(e.position).sub(this.target),b.radius=_.radius=A.distance(),b.theta=_.theta=Math.atan2(A.x,A.z),b.phi=_.phi=Math.acos(Math.min(Math.max(A.y/_.radius,-1),1)),e.lookAt(this.target)};const T=new Te,S=new Te,L=new Te;let R=Re;function F(){return Math.pow(.95,d)}this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};const C=(n,i)=>{let r=t===document?document.body:t;Oe.copy(e.position).sub(this.target);let o=Oe.distance();o*=Math.tan((e.fov||45)/2*Math.PI/180),function(e,t){Oe.set(t[0],t[1],t[2]),Oe.multiply(-e),M.add(Oe)}(2*n*o/r.clientHeight,e.matrix),function(e,t){Oe.set(t[4],t[5],t[6]),Oe.multiply(e),M.add(Oe)}(2*i*o/r.clientHeight,e.matrix)};function P(e){y.radius/=e}function k(e,n){Ie.set(e,n),De.sub(Ie,T).multiply(s);let i=t===document?document.body:t;y.theta-=2*Math.PI*De.x/i.clientHeight,y.phi-=2*Math.PI*De.y/i.clientHeight,T.copy(Ie)}function O(e,t){Ie.set(e,t),De.sub(Ie,S).multiply(p),C(De.x,De.y),S.copy(Ie)}const I=e=>{if(this.enabled){switch(e.button){case this.mouseButtons.ORBIT:if(!1===a)return;T.set(e.clientX,e.clientY),R=Fe;break;case this.mouseButtons.ZOOM:if(!1===c)return;L.set(e.clientX,e.clientY),R=Ce;break;case this.mouseButtons.PAN:if(!1===h)return;S.set(e.clientX,e.clientY),R=Pe}R!==Re&&(window.addEventListener("mousemove",D,!1),window.addEventListener("mouseup",N,!1))}},D=e=>{if(this.enabled)switch(R){case Fe:if(!1===a)return;k(e.clientX,e.clientY);break;case Ce:if(!1===c)return;!function(e){Ie.set(e.clientX,e.clientY),De.sub(Ie,L),De.y>0?P(F()):De.y<0&&P(1/F()),L.copy(Ie)}(e);break;case Pe:if(!1===h)return;O(e.clientX,e.clientY)}},N=()=>{window.removeEventListener("mousemove",D,!1),window.removeEventListener("mouseup",N,!1),R=Re},U=e=>{this.enabled&&c&&(R===Re||R===Fe)&&(e.stopPropagation(),e.preventDefault(),e.deltaY<0?P(1/F()):e.deltaY>0&&P(F()))},B=e=>{if(this.enabled)switch(e.preventDefault(),e.touches.length){case 1:if(!1===a)return;T.set(e.touches[0].pageX,e.touches[0].pageY),R=Fe;break;case 2:if(!1===c&&!1===h)return;!function(e){if(c){let t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);L.set(0,i)}if(h){let t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);S.set(t,n)}}(e),R=ke;break;default:R=Re}},z=e=>{if(this.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===a)return;k(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!1===c&&!1===h)return;!function(e){if(c){let t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);Ie.set(0,i),De.set(0,Math.pow(Ie.y/L.y,d)),P(De.y),L.copy(Ie)}h&&O(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY))}(e);break;default:R=Re}},V=()=>{this.enabled&&(R=Re)},G=e=>{this.enabled&&e.preventDefault()};this.remove=function(){t.removeEventListener("contextmenu",G),t.removeEventListener("mousedown",I),t.removeEventListener("wheel",U),t.removeEventListener("touchstart",B),t.removeEventListener("touchend",V),t.removeEventListener("touchmove",z),window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",N)},t.addEventListener("contextmenu",G,!1),t.addEventListener("mousedown",I,!1),t.addEventListener("wheel",U,{passive:!1}),t.addEventListener("touchstart",B,{passive:!1}),t.addEventListener("touchend",V,!1),t.addEventListener("touchmove",z,{passive:!1})}const Ue=new Te,Be=new Te,ze=new Te,Ve=new E,Ge=new E,He=new E,We=new E,qe=new E,je=new E,Xe=new E,Ye=new E,Ze=new E,$e=new E,Qe=new E,Ke=new J;class Je{constructor(){this.origin=new E,this.direction=new E}castMouse(e,t=[0,0]){if("orthographic"===e.type){const{left:n,right:i,bottom:r,top:o,zoom:a}=e,s=n/a+(i-n)/a*(.5*t[0]+.5),l=r/a+(o-r)/a*(.5*t[1]+.5);this.origin.set(s,l,0),this.origin.applyMatrix4(e.worldMatrix),this.direction.x=-e.worldMatrix[8],this.direction.y=-e.worldMatrix[9],this.direction.z=-e.worldMatrix[10]}else e.worldMatrix.getTranslation(this.origin),this.direction.set(t[0],t[1],.5),e.unproject(this.direction),this.direction.sub(this.origin).normalize()}intersectBounds(e,{maxDistance:t,output:n=[]}={}){Array.isArray(e)||(e=[e]);const i=Ke,r=Ve,o=Ge,a=n;return a.length=0,e.forEach(e=>{e.geometry.bounds&&e.geometry.bounds.radius!==1/0||e.geometry.computeBoundingSphere();const n=e.geometry.bounds;let s;if(i.inverse(e.worldMatrix),t&&(o.copy(this.direction).scaleRotateMatrix4(i),s=t*o.len()),r.copy(this.origin).applyMatrix4(i),o.copy(this.direction).transformDirection(i),t&&r.distance(n.center)-n.radius>s)return;let l=0;if("sphere"===e.geometry.raycast){if(r.distance(n.center)>n.radius&&(l=this.intersectSphere(n,r,o),!l))return}else if((r.x<n.min.x||r.x>n.max.x||r.y<n.min.y||r.y>n.max.y||r.z<n.min.z||r.z>n.max.z)&&(l=this.intersectBox(n,r,o),!l))return;t&&l>s||(e.hit||(e.hit={localPoint:new E,point:new E}),e.hit.localPoint.copy(o).multiply(l).add(r),e.hit.point.copy(e.hit.localPoint).applyMatrix4(e.worldMatrix),e.hit.distance=e.hit.point.distance(this.origin),a.push(e))}),a.sort((e,t)=>e.hit.distance-t.hit.distance),a}intersectMeshes(e,{cullFace:t=!0,maxDistance:n,includeUV:i=!0,includeNormal:r=!0,output:o=[]}={}){const a=this.intersectBounds(e,{maxDistance:n,output:o});if(!a.length)return a;const s=Ke,l=Ve,u=Ge,c=He,d=We,h=qe,p=je,m=Xe,f=Ye,v=Ue,g=Be,w=ze;for(let e=a.length-1;e>=0;e--){const o=a[e];let x;s.inverse(o.worldMatrix),n&&(u.copy(this.direction).scaleRotateMatrix4(s),x=n*u.len()),l.copy(this.origin).applyMatrix4(s),u.copy(this.direction).transformDirection(s);let y,_,b,M=0;const A=o.geometry,T=A.attributes,S=T.index,L=Math.max(0,A.drawRange.start),R=Math.min(S?S.count:T.position.count,A.drawRange.start+A.drawRange.count);for(let e=L;e<R;e+=3){const i=S?S.data[e]:e,r=S?S.data[e+1]:e+1,o=S?S.data[e+2]:e+2;c.fromArray(T.position.data,3*i),d.fromArray(T.position.data,3*r),h.fromArray(T.position.data,3*o);const a=this.intersectTriangle(c,d,h,t,l,u,m);a&&(n&&a>x||(!M||a<M)&&(M=a,y=i,_=r,b=o,p.copy(m)))}M||a.splice(e,1),o.hit.localPoint.copy(u).multiply(M).add(l),o.hit.point.copy(o.hit.localPoint).applyMatrix4(o.worldMatrix),o.hit.distance=o.hit.point.distance(this.origin),o.hit.faceNormal||(o.hit.localFaceNormal=new E,o.hit.faceNormal=new E,o.hit.uv=new Te,o.hit.localNormal=new E,o.hit.normal=new E),o.hit.localFaceNormal.copy(p),o.hit.faceNormal.copy(o.hit.localFaceNormal).transformDirection(o.worldMatrix),(i||r)&&(c.fromArray(T.position.data,3*y),d.fromArray(T.position.data,3*_),h.fromArray(T.position.data,3*b),this.getBarycoord(o.hit.localPoint,c,d,h,f)),i&&T.uv&&(v.fromArray(T.uv.data,2*y),g.fromArray(T.uv.data,2*_),w.fromArray(T.uv.data,2*b),o.hit.uv.set(v.x*f.x+g.x*f.y+w.x*f.z,v.y*f.x+g.y*f.y+w.y*f.z)),r&&T.normal&&(c.fromArray(T.normal.data,3*y),d.fromArray(T.normal.data,3*_),h.fromArray(T.normal.data,3*b),o.hit.localNormal.set(c.x*f.x+d.x*f.y+h.x*f.z,c.y*f.x+d.y*f.y+h.y*f.z,c.z*f.x+d.z*f.y+h.z*f.z),o.hit.normal.copy(o.hit.localNormal).transformDirection(o.worldMatrix))}return a.sort((e,t)=>e.hit.distance-t.hit.distance),a}intersectSphere(e,t=this.origin,n=this.direction){const i=He;i.sub(e.center,t);const r=i.dot(n),o=i.dot(i)-r*r,a=e.radius*e.radius;if(o>a)return 0;const s=Math.sqrt(a-o),l=r-s,u=r+s;return l<0&&u<0?0:l<0?u:l}intersectBox(e,t=this.origin,n=this.direction){let i,r,o,a,s,l;const u=1/n.x,c=1/n.y,d=1/n.z,h=e.min,p=e.max;return i=((u>=0?h.x:p.x)-t.x)*u,r=((u>=0?p.x:h.x)-t.x)*u,o=((c>=0?h.y:p.y)-t.y)*c,a=((c>=0?p.y:h.y)-t.y)*c,i>a||o>r?0:(o>i&&(i=o),a<r&&(r=a),s=((d>=0?h.z:p.z)-t.z)*d,l=((d>=0?p.z:h.z)-t.z)*d,i>l||s>r?0:(s>i&&(i=s),l<r&&(r=l),r<0?0:i>=0?i:r))}intersectTriangle(e,t,n,i=!0,r=this.origin,o=this.direction,a=Xe){const s=Ye,l=Ze,u=$e;s.sub(t,e),l.sub(n,e),a.cross(s,l);let c,d=o.dot(a);if(!d)return 0;if(d>0){if(i)return 0;c=1}else c=-1,d=-d;u.sub(r,e);let h=c*o.dot(l.cross(u,l));if(h<0)return 0;let p=c*o.dot(s.cross(u));if(p<0)return 0;if(h+p>d)return 0;let m=-c*u.dot(a);return m<0?0:m/d}getBarycoord(e,t,n,i,r=Ye){const o=Ze,a=$e,s=Qe;o.sub(i,t),a.sub(n,t),s.sub(e,t);const l=o.dot(o),u=o.dot(a),c=o.dot(s),d=a.dot(a),h=a.dot(s),p=l*d-u*u;if(0===p)return r.set(-2,-1,-1);const m=1/p,f=(d*c-u*h)*m,v=(l*h-u*c)*m;return r.set(1-f-v,v,f)}}const et="catmullrom",tt="cubicbezier",nt="quadraticbezier",it=new E,rt=new E,ot=new E,at=new E;function st(e,t,n,i){const r=1-e;it.copy(t).scale(r**2),rt.copy(n).scale(2*r*e),ot.copy(i).scale(e**2);const o=new E;return o.add(it,rt).add(ot),o}function lt(e,t,n,i,r){const o=1-e;it.copy(t).scale(o**3),rt.copy(n).scale(3*o**2*e),ot.copy(i).scale(3*o*e**2),at.copy(r).scale(e**3);const a=new E;return a.add(it,rt).add(ot).add(at),a}class ut{constructor({points:e=[new E(0,0,0),new E(0,1,0),new E(1,1,0),new E(1,0,0)],divisions:t=12,type:n=et}={}){this.points=e,this.divisions=t,this.type=n}_getQuadraticBezierPoints(e=this.divisions){const t=[],n=this.points.length;if(n<3)return console.warn("Not enough points provided."),[];const i=this.points[0];let r=this.points[1],o=this.points[2];for(let n=0;n<=e;n++){const a=st(n/e,i,r,o);t.push(a)}let a=3;for(;n-a>0;){i.copy(o),r=o.scale(2).sub(r),o=this.points[a];for(let n=1;n<=e;n++){const a=st(n/e,i,r,o);t.push(a)}a++}return t}_getCubicBezierPoints(e=this.divisions){const t=[],n=this.points.length;if(n<4)return console.warn("Not enough points provided."),[];let i=this.points[0],r=this.points[1],o=this.points[2],a=this.points[3];for(let n=0;n<=e;n++){const s=lt(n/e,i,r,o,a);t.push(s)}let s=4;for(;n-s>1;){i.copy(a),r=a.scale(2).sub(o),o=this.points[s],a=this.points[s+1];for(let n=1;n<=e;n++){const s=lt(n/e,i,r,o,a);t.push(s)}s+=2}return t}_getCatmullRomPoints(e=this.divisions,t=.168,n=.168){const i=[];if(this.points.length<=2)return this.points;let r;return this.points.forEach((o,a)=>{if(0===a)r=o;else{const[s,l]=function(e,t,n=.168,i=.168){if(t<1?it.sub(e[1],e[0]).scale(n).add(e[0]):it.sub(e[t+1],e[t-1]).scale(n).add(e[t]),t>e.length-3){const t=e.length-1;rt.sub(e[t-1],e[t]).scale(i).add(e[t])}else rt.sub(e[t],e[t+2]).scale(i).add(e[t+1]);return[it.clone(),rt.clone()]}(this.points,a-1,t,n),u=new ut({points:[r,s,l,o],type:tt});i.pop(),i.push(...u.getPoints(e)),r=o}}),i}getPoints(e=this.divisions,t=.168,n=.168){const i=this.type;return i===nt?this._getQuadraticBezierPoints(e):i===tt?this._getCubicBezierPoints(e):i===et?this._getCatmullRomPoints(e,t,n):this.points}}ut.CATMULLROM=et,ut.CUBICBEZIER=tt,ut.QUADRATICBEZIER=nt;const ct="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",dt="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",ht=new E,pt=new Z,mt=new E,ft=new E,vt=new Z,gt=new E;class wt{constructor({objects:e,data:t}){this.objects=e,this.data=t,this.elapsed=0,this.weight=1,this.duration=t.frames.length-1}update(e=1,t){const n=t?1:this.weight/e,i=this.elapsed%this.duration,r=Math.floor(i),o=i-r,a=this.data.frames[r],s=this.data.frames[(r+1)%this.duration];this.objects.forEach((e,t)=>{ht.fromArray(a.position,3*t),pt.fromArray(a.quaternion,4*t),mt.fromArray(a.scale,3*t),ft.fromArray(s.position,3*t),vt.fromArray(s.quaternion,4*t),gt.fromArray(s.scale,3*t),ht.lerp(ft,o),pt.slerp(vt,o),mt.lerp(gt,o),e.position.lerp(ht,n),e.quaternion.slerp(pt,n),e.scale.lerp(mt,n)})}}const xt=new J;function yt(e){return new k(e,{vertex:"\n    precision highp float;\n    precision highp int;\n\n    attribute vec3 position;\n    attribute vec3 normal;\n\n    uniform mat3 normalMatrix;\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vNormal;\n\n    void main() {\n        vNormal = normalize(normalMatrix * normal);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n",fragment:"\n    precision highp float;\n    precision highp int;\n\n    varying vec3 vNormal;\n\n    void main() {\n        gl_FragColor.rgb = normalize(vNormal);\n        gl_FragColor.a = 1.0;\n    }\n",cullFace:null})}const _t="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",bt="\n    precision highp float;\n\n    uniform sampler2D tMap;\n\n    uniform float uFalloff;\n    uniform float uAlpha;\n    uniform float uDissipation;\n    \n    uniform float uAspect;\n    uniform vec2 uMouse;\n    uniform vec2 uVelocity;\n\n    varying vec2 vUv;\n\n    void main() {\n        vec4 color = texture2D(tMap, vUv) * uDissipation;\n\n        vec2 cursor = vUv - uMouse;\n        cursor.x *= uAspect;\n\n        vec3 stamp = vec3(uVelocity * vec2(1, -1), 1.0 - pow(1.0 - min(1.0, length(uVelocity)), 3.0));\n        float falloff = smoothstep(uFalloff, 0.0, length(cursor)) * uAlpha;\n\n        color.rgb = mix(color.rgb, stamp, vec3(falloff));\n\n        gl_FragColor = color;\n    }\n";const Mt="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",At="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",Et=new E;const Tt="\n    precision highp float;\n\n    attribute vec3 position;\n    attribute vec3 next;\n    attribute vec3 prev;\n    attribute vec2 uv;\n    attribute float side;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform vec2 uResolution;\n    uniform float uDPR;\n    uniform float uThickness;\n    uniform float uMiter;\n\n    varying vec2 vUv;\n\n    vec4 getPosition() {\n        mat4 mvp = projectionMatrix * modelViewMatrix;\n        vec4 current = mvp * vec4(position, 1);\n        vec4 nextPos = mvp * vec4(next, 1);\n        vec4 prevPos = mvp * vec4(prev, 1);\n\n        vec2 aspect = vec2(uResolution.x / uResolution.y, 1);    \n        vec2 currentScreen = current.xy / current.w * aspect;\n        vec2 nextScreen = nextPos.xy / nextPos.w * aspect;\n        vec2 prevScreen = prevPos.xy / prevPos.w * aspect;\n    \n        vec2 dir1 = normalize(currentScreen - prevScreen);\n        vec2 dir2 = normalize(nextScreen - currentScreen);\n        vec2 dir = normalize(dir1 + dir2);\n    \n        vec2 normal = vec2(-dir.y, dir.x);\n        normal /= mix(1.0, max(0.3, dot(normal, vec2(-dir1.y, dir1.x))), uMiter);\n        normal /= aspect;\n\n        float pixelWidthRatio = 1.0 / (uResolution.y / uDPR);\n        float pixelWidth = current.w * pixelWidthRatio;\n        normal *= pixelWidth * uThickness;\n        current.xy -= normal * side;\n    \n        return current;\n    }\n\n    void main() {\n        vUv = uv;\n        gl_Position = getPosition();\n    }\n",St="\n    precision highp float;\n\n    uniform vec3 uColor;\n    \n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor.rgb = uColor;\n        gl_FragColor.a = 1.0;\n    }\n";const Lt="\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n",Rt="\n    precision highp float;\n\n    vec4 packRGBA (float v) {\n        vec4 pack = fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * v);\n        pack -= pack.yzww * vec2(1.0 / 255.0, 0.0).xxxy;\n        return pack;\n    }\n\n    void main() {\n        gl_FragColor = packRGBA(gl_FragCoord.z);\n    }\n";class Ft extends me{constructor(e,{buffer:t,wrapS:n=e.CLAMP_TO_EDGE,wrapT:i=e.CLAMP_TO_EDGE,anisotropy:r=0,minFilter:o,magFilter:a}={}){if(super(e,{generateMipmaps:!1,wrapS:n,wrapT:i,anisotropy:r,minFilter:o,magFilter:a}),t)return this.parseBuffer(t)}parseBuffer(e){const t=new Ct(e);t.mipmaps.isCompressedTexture=!0,this.image=t.mipmaps,this.internalFormat=t.glInternalFormat,t.numberOfMipmapLevels>1?this.minFilter===this.gl.LINEAR&&(this.minFilter=this.gl.NEAREST_MIPMAP_LINEAR):this.minFilter===this.gl.NEAREST_MIPMAP_LINEAR&&(this.minFilter=this.gl.LINEAR)}}function Ct(e){const t=[171,75,84,88,32,49,49,187,13,10,26,10],n=new Uint8Array(e,0,12);for(let e=0;e<n.length;e++)if(n[e]!==t[e])return console.error("File missing KTX identifier");const i=Uint32Array.BYTES_PER_ELEMENT,r=new DataView(e,12,13*i),o=67305985===r.getUint32(0,!0);if(0!==r.getUint32(1*i,o))return console.warn("only compressed formats currently supported");this.glInternalFormat=r.getUint32(4*i,o);let a=r.getUint32(6*i,o),s=r.getUint32(7*i,o);this.numberOfFaces=r.getUint32(10*i,o),this.numberOfMipmapLevels=Math.max(1,r.getUint32(11*i,o));const l=r.getUint32(12*i,o);this.mipmaps=[];let u=64+l;for(let t=0;t<this.numberOfMipmapLevels;t++){const t=new Int32Array(e,u,1)[0];u+=4;for(let n=0;n<this.numberOfFaces;n++){const n=new Uint8Array(e,u,t);this.mipmaps.push({data:n,width:a,height:s}),u+=t,u+=3-(t+3)%4}a>>=1,s>>=1}}let Pt={};const kt=[];class Ot{static load(e,{src:t,wrapS:n=e.CLAMP_TO_EDGE,wrapT:i=e.CLAMP_TO_EDGE,anisotropy:r=0,format:o=e.RGBA,internalFormat:a=o,generateMipmaps:s=!0,minFilter:l=(s?e.NEAREST_MIPMAP_LINEAR:e.LINEAR),magFilter:u=e.LINEAR,premultiplyAlpha:c=!1,unpackAlignment:d=4,flipY:h=!0}={}){const p=this.getSupportedExtensions(e);let m="none";if("string"==typeof t&&(m=t.split(".").pop().split("?")[0].toLowerCase()),"object"==typeof t)for(const e in t)if(p.includes(e.toLowerCase())){m=e.toLowerCase(),t=t[e];break}const f=t+n+i+r+o+a+s+l+u+c+d+h+e.renderer.id;if(Pt[f])return Pt[f];let v;switch(m){case"ktx":case"pvrtc":case"s3tc":case"etc":case"etc1":case"astc":v=new Ft(e,{src:t,wrapS:n,wrapT:i,anisotropy:r,minFilter:l,magFilter:u}),v.loaded=this.loadKTX(t,v);break;case"webp":case"jpg":case"jpeg":case"png":v=new me(e,{wrapS:n,wrapT:i,anisotropy:r,format:o,internalFormat:a,generateMipmaps:s,minFilter:l,magFilter:u,premultiplyAlpha:c,unpackAlignment:d,flipY:h}),v.loaded=this.loadImage(e,t,v);break;default:console.warn("No supported format supplied"),v=new me(e)}return v.ext=m,Pt[f]=v,v}static getSupportedExtensions(e){if(kt.length)return kt;const t={pvrtc:e.renderer.getExtension("WEBGL_compressed_texture_pvrtc")||e.renderer.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),s3tc:e.renderer.getExtension("WEBGL_compressed_texture_s3tc")||e.renderer.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.renderer.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),etc:e.renderer.getExtension("WEBGL_compressed_texture_etc"),etc1:e.renderer.getExtension("WEBGL_compressed_texture_etc1"),astc:e.renderer.getExtension("WEBGL_compressed_texture_astc")};for(const e in t)t[e]&&kt.push(e);return It&&kt.push("webp"),kt.push("png","jpg"),kt}static loadKTX(e,t){return fetch(e).then(e=>e.arrayBuffer()).then(e=>t.parseBuffer(e))}static loadImage(e,t,n){return function(e){return new Promise(t=>{const n=new Image;n.crossOrigin="",n.src=e;const i=navigator.userAgent.toLowerCase().includes("chrome");window.createImageBitmap&&i?n.onload=()=>{createImageBitmap(n,{imageOrientation:"flipY",premultiplyAlpha:"none"}).then(e=>{t(e)})}:n.onload=()=>t(n)})}(t).then(t=>(Dt(t.width)&&Dt(t.height)||(n.generateMipmaps&&(n.generateMipmaps=!1),n.minFilter===e.NEAREST_MIPMAP_LINEAR&&(n.minFilter=e.LINEAR),n.wrapS===e.REPEAT&&(n.wrapS=n.wrapT=e.CLAMP_TO_EDGE)),n.image=t,n.onUpdate=()=>{t.close&&t.close(),n.onUpdate=null},t))}static clearCache(){Pt={}}}function It(){return 0==document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}function Dt(e){return Math.log2(e)%1==0}const Nt=new E,Ut=new E,Bt=new E,zt=new E,Vt=new Z,Gt=new Z,Ht=new Z,Wt=new Z;class qt{constructor(e,t=1){this.data=e,this.elapsed=0,this.weight=t,this.loop=!0,this.duration=e.reduce((e,{times:t})=>Math.max(e,t[t.length-1]),0)}update(e=1,t){const n=t?1:this.weight/e,i=this.loop?this.elapsed%this.duration:Math.min(this.elapsed,this.duration);this.data.forEach(({node:e,transform:t,interpolation:r,times:o,values:a})=>{const s=Math.max(1,o.findIndex(e=>e>i))-1,l=s+1;let u=(i-o[s])/(o[l]-o[s]);"STEP"===r&&(u=0);let c=Nt,d=Ut,h=Bt,p=zt,m=3;"quaternion"===t&&(c=Vt,d=Gt,h=Ht,p=Wt,m=4),"CUBICSPLINE"===r?(c.fromArray(a,s*m*3+1*m),d.fromArray(a,s*m*3+2*m),h.fromArray(a,l*m*3+0*m),p.fromArray(a,l*m*3+1*m),c=this.cubicSplineInterpolate(u,c,d,h,p),4===m&&c.normalize()):(c.fromArray(a,s*m),p.fromArray(a,l*m),4===m?c.slerp(p,u):c.lerp(p,u)),4===m?e[t].slerp(c,n):e[t].lerp(c,n)})}cubicSplineInterpolate(e,t,n,i,r){const o=e*e,a=o*e,s=3*o-2*a,l=a-o,u=1-s,c=l-o+e;for(let o=0;o<t.length;o++)t[o]=u*t[o]+c*(1-e)*n[o]+s*r[o]+l*e*i[o];return t}}const jt=new J,Xt=new J;class Yt extends ce{constructor(e,{skeleton:t,geometry:n,program:i,mode:r=e.TRIANGLES}={}){super(e,{geometry:n,program:i,mode:r}),this.skeleton=t,this.program=i,this.createBoneTexture(),this.animations=[]}createBoneTexture(){if(!this.skeleton.joints.length)return;const e=Math.max(4,Math.pow(2,Math.ceil(Math.log(Math.sqrt(4*this.skeleton.joints.length))/Math.LN2)));this.boneMatrices=new Float32Array(e*e*4),this.boneTextureSize=e,this.boneTexture=new me(this.gl,{image:this.boneMatrices,generateMipmaps:!1,type:this.gl.FLOAT,internalFormat:this.gl.renderer.isWebgl2?this.gl.RGBA32F:this.gl.RGBA,flipY:!1,width:e})}updateUniforms(){this.skeleton.joints.forEach((e,t)=>{jt.multiply(e.worldMatrix,e.bindInverse),this.boneMatrices.set(jt,16*t)}),this.boneTexture&&(this.boneTexture.needsUpdate=!0)}draw({camera:e}={}){this.program.uniforms.boneTexture||Object.assign(this.program.uniforms,{boneTexture:{value:this.boneTexture},boneTextureSize:{value:this.boneTextureSize}}),this.updateUniforms();const t=this.worldMatrix;this.worldMatrix=Xt,super.draw({camera:e}),this.worldMatrix=t}}const Zt={5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array,"image/jpeg":Uint8Array,"image/png":Uint8Array},$t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Qt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Kt={translation:"position",rotation:"quaternion",scale:"scale"};class Jt{static async load(e,t){const n=t.split("/").slice(0,-1).join("/")+"/",i=await this.parseDesc(t);return await this.parse(e,i,n)}static async parse(e,t,n){(void 0===t.asset||t.asset.version[0]<2)&&console.warn("Only GLTF >=2.0 supported. Attempting to parse.");const i=await this.loadBuffers(t,n);e.renderer.bindVertexArray(null);const r=this.parseBufferViews(e,t,i),o=this.parseImages(e,t,n,r),a=this.parseTextures(e,t,o),s=this.parseMaterials(e,t,a),l=this.parseSkins(e,t,r),u=this.parseMeshes(e,t,r,s,l),c=this.parseNodes(e,t,u,l);this.populateSkins(l,c);const d=this.parseAnimations(e,t,c,r),h=this.parseScenes(t,c),p=h[t.scene];for(let e=c.length;e>=0;e--)c[e]||c.splice(e,1);return{json:t,buffers:i,bufferViews:r,images:o,textures:a,materials:s,meshes:u,nodes:c,animations:d,scenes:h,scene:p}}static async parseDesc(e){return e.match(/\.glb$/)?await fetch(e).then(e=>e.arrayBuffer()).then(e=>this.unpackGLB(e)):await fetch(e).then(e=>e.json())}static unpackGLB(e){const t=new Uint32Array(e,0,3);if(1179937895!==t[0])throw new Error("Invalid glTF asset.");if(2!==t[1])throw new Error(`Unsupported glTF binary version, "${t[1]}".`);const n=new Uint32Array(e,12,2),i=n[0];if(1313821514!==n[1])throw new Error("Unexpected GLB layout.");const r=(new TextDecoder).decode(e.slice(20,20+i)),o=JSON.parse(r);if(20+i===e.byteLength)return o;const a=new Uint32Array(e,20+i,2);if(5130562!==a[1])throw new Error("Unexpected GLB layout.");const s=20+i+8,l=a[0],u=e.slice(s,s+l);return o.buffers[0].binary=u,o}static resolveURI(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}static async loadBuffers(e,t){return e.buffers?await Promise.all(e.buffers.map(e=>{if(e.binary)return e.binary;const n=this.resolveURI(e.uri,t);return fetch(n).then(e=>e.arrayBuffer())})):null}static parseBufferViews(e,t,n){if(!t.bufferViews)return null;const i=t.bufferViews.map(e=>Object.assign({},e));return t.meshes&&t.meshes.forEach(({primitives:n})=>{n.forEach(({attributes:n,indices:r})=>{for(let e in n)i[t.accessors[n[e]].bufferView].isAttribute=!0;void 0!==r&&(i[t.accessors[r].bufferView].isAttribute=!0,i[t.accessors[r].bufferView].target=e.ELEMENT_ARRAY_BUFFER)})}),t.accessors.forEach(({bufferView:e,componentType:t})=>{i[e].componentType=t}),t.images&&t.images.forEach(({uri:e,bufferView:t,mimeType:n})=>{void 0!==t&&(i[t].mimeType=n)}),i.forEach(({buffer:t,byteOffset:r=0,byteLength:o,byteStride:a,target:s=e.ARRAY_BUFFER,name:l,extensions:u,extras:c,componentType:d,mimeType:h,isAttribute:p},m)=>{const f=Zt[d||h],v=f.BYTES_PER_ELEMENT,g=new f(n[t],r,o/v);if(i[m].data=g,!p)return;const w=e.createBuffer();e.bindBuffer(s,w),e.renderer.state.boundBuffer=w,e.bufferData(s,g,e.STATIC_DRAW),i[m].buffer=w}),i}static parseImages(e,t,n,i){return t.images?t.images.map(({uri:e,bufferView:t,mimeType:r,name:o})=>{const a=new Image;if(a.name=o,e)a.src=this.resolveURI(e,n);else if(void 0!==t){const{data:e}=i[t],n=new Blob([e],{type:r});a.src=URL.createObjectURL(n)}return a.ready=new Promise(e=>{a.onload=()=>e()}),a}):null}static parseTextures(e,t,n){return t.textures?t.textures.map(({sampler:i,source:r,name:o,extensions:a,extras:s})=>{const l={flipY:!1,wrapS:e.REPEAT,wrapT:e.REPEAT},u=void 0!==i?t.samplers[i]:null;u&&["magFilter","minFilter","wrapS","wrapT"].forEach(e=>{u[e]&&(l[e]=u[e])});const c=new me(e,l);c.name=o;const d=n[r];return d.ready.then(()=>c.image=d),c}):null}static parseMaterials(e,t,n){return t.materials?t.materials.map(({name:e,extensions:t,extras:i,pbrMetallicRoughness:r={},normalTexture:o,occlusionTexture:a,emissiveTexture:s,emissiveFactor:l=[0,0,0],alphaMode:u="OPAQUE",alphaCutoff:c=.5,doubleSided:d=!1})=>{const{baseColorFactor:h=[1,1,1,1],baseColorTexture:p,metallicFactor:m=1,roughnessFactor:f=1,metallicRoughnessTexture:v}=r;return p&&(p.texture=n[p.index]),o&&(o.texture=n[o.index]),v&&(v.texture=n[v.index]),a&&(a.texture=n[a.index]),s&&(s.texture=n[s.index]),{name:e,baseColorFactor:h,baseColorTexture:p,metallicFactor:m,roughnessFactor:f,metallicRoughnessTexture:v,normalTexture:o,occlusionTexture:a,emissiveTexture:s,emissiveFactor:l,alphaMode:u,alphaCutoff:c,doubleSided:d}}):null}static parseSkins(e,t,n){return t.skins?t.skins.map(({inverseBindMatrices:e,skeleton:i,joints:r})=>({inverseBindMatrices:this.parseAccessor(e,t,n),skeleton:i,joints:r})):null}static parseMeshes(e,t,n,i,r){return t.meshes?t.meshes.map(({primitives:o,weights:a,name:s,extensions:l,extras:u},c)=>{let d=0,h=!1;return t.nodes&&t.nodes.forEach(({mesh:e,skin:t})=>{e===c&&(d++,void 0!==t&&(h=t))}),{primitives:o=this.parsePrimitives(e,o,t,n,i,d).map(({geometry:t,program:n,mode:i})=>{const o="number"==typeof h?new Yt(e,{skeleton:r[h],geometry:t,program:n,mode:i}):new ce(e,{geometry:t,program:n,mode:i});return o.name=s,o.geometry.isInstanced&&(o.numInstances=d,o.frustumCulled=!1),o}),weights:a,name:s}}):null}static parsePrimitives(e,t,n,i,r,o){return t.map(({attributes:t,indices:a,material:s,mode:l=4,targets:u,extensions:c,extras:d})=>{const h=new F(e);for(let e in t)h.addAttribute(Qt[e],this.parseAccessor(t[e],n,i));void 0!==a&&h.addAttribute("index",this.parseAccessor(a,n,i)),o>1&&h.addAttribute("instanceMatrix",{instanced:1,size:16,data:new Float32Array(16*o)});const p=new yt(e);return void 0!==s&&(p.gltfMaterial=r[s]),{geometry:h,program:p,mode:l}})}static parseAccessor(e,t,n){const{bufferView:i,byteOffset:r=0,componentType:o,normalized:a=!1,count:s,type:l,min:u,max:c,sparse:d}=t.accessors[e],{data:h,buffer:p,byteStride:m=0,target:f}=n[i];return{data:h,size:$t[l],type:o,normalized:a,buffer:p,stride:m,offset:r,count:s,min:u,max:c}}static parseNodes(e,t,n,i){if(!t.nodes)return null;const r=t.nodes.map(({camera:e,children:t,skin:i,matrix:r,mesh:o,rotation:a,scale:s,translation:l,weights:u,name:c,extensions:d,extras:h})=>{const p=new ne;c&&(p.name=c),r?(p.matrix.copy(r),p.decompose()):(a&&p.quaternion.copy(a),s&&p.scale.copy(s),l&&p.position.copy(l),p.updateMatrix());let m=!1,f=!0;if(void 0!==o&&n[o].primitives.forEach(e=>{e.geometry.isInstanced&&(m=!0,e.instanceCount?f=!1:e.instanceCount=0,p.matrix.toArray(e.geometry.attributes.instanceMatrix.data,16*e.instanceCount),e.instanceCount++,e.instanceCount===e.numInstances&&(delete e.numInstances,delete e.instanceCount,e.geometry.attributes.instanceMatrix.needsUpdate=!0)),m?f&&e.setParent(p):e.setParent(p)}),m){if(!f)return null;p.matrix.identity(),p.decompose()}return p});return t.nodes.forEach(({children:e=[]},t)=>{e.forEach(e=>{r[e]&&r[e].setParent(r[t])})}),r}static populateSkins(e,t){e&&e.forEach(e=>{e.joints=e.joints.map((n,i)=>{const r=t[n];return r.bindInverse=new J(...e.inverseBindMatrices.data.slice(16*i,16*(i+1))),r}),e.skeleton&&(e.skeleton=t[e.skeleton])})}static parseAnimations(e,t,n,i){return t.animations?t.animations.map(({channels:e,samplers:r,name:o})=>{const a=e.map(({sampler:e,target:o})=>{const{input:a,interpolation:s="LINEAR",output:l}=r[e],{node:u,path:c}=o,d=n[u],h=Kt[c],p=this.parseAccessor(a,t,i),m=p.data.slice(p.offset/4,p.offset/4+p.count*p.size),f=this.parseAccessor(l,t,i);return{node:d,transform:h,interpolation:s,times:m,values:f.data.slice(f.offset/4,f.offset/4+f.count*f.size)}});return{name:o,animation:new qt(a)}}):null}static parseScenes(e,t){return e.scenes?e.scenes.map(({nodes:e=[],name:n,extensions:i,extras:r})=>e.reduce((e,n)=>(t[n]&&e.push(t[n]),e),[])):null}}var en=Object.freeze({__proto__:null,Geometry:F,Program:k,Renderer:z,Camera:ae,Transform:ne,Mesh:ce,Texture:me,RenderTarget:fe,Color:ye,Euler:te,Mat3:le,Mat4:J,Quat:Z,Vec2:Te,Vec3:E,Vec4:class extends Array{constructor(e=0,t=e,n=e,i=e){return super(e,t,n,i),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set w(e){this[3]=e}set(e,t,n,i){return e.length?this.copy(e):(G(this,e,t,n,i),this)}copy(e){return V(this,e),this}normalize(){return H(this,this),this}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this[2]=e[t+2],this[3]=e[t+3],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e}},Plane:Se,Box:class extends F{constructor(e,{width:t=1,height:n=1,depth:i=1,widthSegments:r=1,heightSegments:o=1,depthSegments:a=1,attributes:s={}}={}){const l=r,u=o,c=a,d=(l+1)*(u+1)*2+(l+1)*(c+1)*2+(u+1)*(c+1)*2,h=6*(l*u*2+l*c*2+u*c*2),p=new Float32Array(3*d),m=new Float32Array(3*d),f=new Float32Array(2*d),v=d>65536?new Uint32Array(h):new Uint16Array(h);let g=0,w=0;Se.buildPlane(p,m,f,v,i,n,t,c,u,2,1,0,-1,-1,g,w),Se.buildPlane(p,m,f,v,i,n,-t,c,u,2,1,0,1,-1,g+=(c+1)*(u+1),w+=c*u),Se.buildPlane(p,m,f,v,t,i,n,c,u,0,2,1,1,1,g+=(c+1)*(u+1),w+=c*u),Se.buildPlane(p,m,f,v,t,i,-n,c,u,0,2,1,1,-1,g+=(l+1)*(c+1),w+=l*c),Se.buildPlane(p,m,f,v,t,n,-i,l,u,0,1,2,-1,-1,g+=(l+1)*(c+1),w+=l*c),Se.buildPlane(p,m,f,v,t,n,i,l,u,0,1,2,1,-1,g+=(l+1)*(u+1),w+=l*u),Object.assign(s,{position:{size:3,data:p},normal:{size:3,data:m},uv:{size:2,data:f},index:{data:v}}),super(e,s)}},Sphere:class extends F{constructor(e,{radius:t=.5,widthSegments:n=16,heightSegments:i=Math.ceil(.5*n),phiStart:r=0,phiLength:o=2*Math.PI,thetaStart:a=0,thetaLength:s=Math.PI,attributes:l={}}={}){const u=n,c=i,d=r,h=o,p=a,m=s,f=(u+1)*(c+1),v=u*c*6,g=new Float32Array(3*f),w=new Float32Array(3*f),x=new Float32Array(2*f),y=f>65536?new Uint32Array(v):new Uint16Array(v);let _=0,b=0,M=0,A=p+m;const T=[];let S=new E;for(let e=0;e<=c;e++){let n=[],i=e/c;for(let e=0;e<=u;e++,_++){let r=e/u,o=-t*Math.cos(d+r*h)*Math.sin(p+i*m),a=t*Math.cos(p+i*m),s=t*Math.sin(d+r*h)*Math.sin(p+i*m);g[3*_]=o,g[3*_+1]=a,g[3*_+2]=s,S.set(o,a,s).normalize(),w[3*_]=S.x,w[3*_+1]=S.y,w[3*_+2]=S.z,x[2*_]=r,x[2*_+1]=1-i,n.push(b++)}T.push(n)}for(let e=0;e<c;e++)for(let t=0;t<u;t++){let n=T[e][t+1],i=T[e][t],r=T[e+1][t],o=T[e+1][t+1];(0!==e||p>0)&&(y[3*M]=n,y[3*M+1]=i,y[3*M+2]=o,M++),(e!==c-1||A<Math.PI)&&(y[3*M]=i,y[3*M+1]=r,y[3*M+2]=o,M++)}Object.assign(l,{position:{size:3,data:g},normal:{size:3,data:w},uv:{size:2,data:x},index:{data:y}}),super(e,l)}},Cylinder:class extends F{constructor(e,{radiusTop:t=.5,radiusBottom:n=.5,height:i=1,radialSegments:r=8,heightSegments:o=1,openEnded:a=!1,thetaStart:s=0,thetaLength:l=2*Math.PI,attributes:u={}}={}){const c=r,d=o,h=s,p=l,m=a?0:n&&t?2:1,f=(c+1)*(d+1+m)+m,v=c*d*6+m*c*3,g=new Float32Array(3*f),w=new Float32Array(3*f),x=new Float32Array(2*f),y=f>65536?new Uint32Array(v):new Uint16Array(v);let _=0,b=0;const M=[];function A(e){let r;const o=!0===e?t:n,a=!0===e?1:-1,s=_;for(g.set([0,.5*i*a,0],3*_),w.set([0,a,0],3*_),x.set([.5,.5],2*_),_++,r=0;r<=c;r++){const e=r/c*p+h,t=Math.cos(e),n=Math.sin(e);g.set([o*n,.5*i*a,o*t],3*_),w.set([0,a,0],3*_),x.set([.5*t+.5,.5*n*a+.5],2*_),_++}for(r=0;r<c;r++){const t=s+r+1;e?y.set([t,t+1,s],3*b):y.set([t+1,t,s],3*b),b++}}!function(){let e,r;const o=new E,a=(n-t)/i;for(r=0;r<=d;r++){const s=[],l=r/d,u=l*(n-t)+t;for(e=0;e<=c;e++){const t=e/c,n=t*p+h,r=Math.sin(n),d=Math.cos(n);g.set([u*r,(.5-l)*i,u*d],3*_),o.set(r,a,d).normalize(),w.set([o.x,o.y,o.z],3*_),x.set([t,1-l],2*_),s.push(_++)}M.push(s)}for(e=0;e<c;e++)for(r=0;r<d;r++){const t=M[r][e],n=M[r+1][e],i=M[r+1][e+1],o=M[r][e+1];y.set([t,n,o,n,i,o],3*b),b+=2}}(),a||(t&&A(!0),n&&A(!1)),Object.assign(u,{position:{size:3,data:g},normal:{size:3,data:w},uv:{size:2,data:x},index:{data:y}}),super(e,u)}},Triangle:Le,Torus:class extends F{constructor(e,{radius:t=.5,tube:n=.2,radialSegments:i=8,tubularSegments:r=6,arc:o=2*Math.PI,attributes:a={}}={}){const s=(i+1)*(r+1),l=i*r*6,u=new Float32Array(3*s),c=new Float32Array(3*s),d=new Float32Array(2*s),h=s>65536?new Uint32Array(l):new Uint16Array(l),p=new E,m=new E,f=new E;let v=0;for(let e=0;e<=i;e++)for(let a=0;a<=r;a++,v++){const s=a/r*o,l=e/i*Math.PI*2;m.x=(t+n*Math.cos(l))*Math.cos(s),m.y=(t+n*Math.cos(l))*Math.sin(s),m.z=n*Math.sin(l),u.set([m.x,m.y,m.z],3*v),p.x=t*Math.cos(s),p.y=t*Math.sin(s),f.sub(m,p).normalize(),c.set([f.x,f.y,f.z],3*v),d.set([a/r,e/i],2*v)}v=0;for(let e=1;e<=i;e++)for(let t=1;t<=r;t++,v++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,o=(r+1)*(e-1)+t,a=(r+1)*e+t;h.set([n,i,a,i,o,a],6*v)}Object.assign(a,{position:{size:3,data:u},normal:{size:3,data:c},uv:{size:2,data:d},index:{data:h}}),super(e,a)}},Orbit:Ne,Raycast:Je,Curve:ut,Post:class{constructor(e,{width:t,height:n,dpr:i,wrapS:r=e.CLAMP_TO_EDGE,wrapT:o=e.CLAMP_TO_EDGE,minFilter:a=e.LINEAR,magFilter:s=e.LINEAR,geometry:l=new Le(e),targetOnly:u=null}={}){this.gl=e,this.options={wrapS:r,wrapT:o,minFilter:a,magFilter:s},this.passes=[],this.geometry=l,this.uniform={value:null},this.targetOnly=u;const c=this.fbo={read:null,write:null,swap:()=>{let e=c.read;c.read=c.write,c.write=e}};this.resize({width:t,height:n,dpr:i})}addPass({vertex:e=ct,fragment:t=dt,uniforms:n={},textureUniform:i="tMap",enabled:r=!0}={}){n[i]={value:this.fbo.read.texture};const o=new k(this.gl,{vertex:e,fragment:t,uniforms:n}),a={mesh:new ce(this.gl,{geometry:this.geometry,program:o}),program:o,uniforms:n,enabled:r,textureUniform:i};return this.passes.push(a),a}resize({width:e,height:t,dpr:n}={}){n&&(this.dpr=n),e&&(this.width=e,this.height=t||e),n=this.dpr||this.gl.renderer.dpr,e=(this.width||this.gl.renderer.width)*n,t=(this.height||this.gl.renderer.height)*n,this.options.width=e,this.options.height=t,this.fbo.read=new fe(this.gl,this.options),this.fbo.write=new fe(this.gl,this.options)}render({scene:e,camera:t,target:n=null,update:i=!0,sort:r=!0,frustumCull:o=!0}){const a=this.passes.filter(e=>e.enabled);this.gl.renderer.render({scene:e,camera:t,target:a.length||!n&&this.targetOnly?this.fbo.write:n,update:i,sort:r,frustumCull:o}),this.fbo.swap(),a.forEach((e,t)=>{e.mesh.program.uniforms[e.textureUniform].value=this.fbo.read.texture,this.gl.renderer.render({scene:e.mesh,target:t!==a.length-1||!n&&this.targetOnly?this.fbo.write:n,clear:!0}),this.fbo.swap()}),this.uniform.value=this.fbo.read.texture}},Skin:class extends ce{constructor(e,{rig:t,geometry:n,program:i,mode:r=e.TRIANGLES}={}){super(e,{geometry:n,program:i,mode:r}),this.createBones(t),this.createBoneTexture(),this.animations=[],Object.assign(this.program.uniforms,{boneTexture:{value:this.boneTexture},boneTextureSize:{value:this.boneTextureSize}})}createBones(e){if(this.root=new ne,this.bones=[],e.bones&&e.bones.length){for(let t=0;t<e.bones.length;t++){const n=new ne;n.position.fromArray(e.bindPose.position,3*t),n.quaternion.fromArray(e.bindPose.quaternion,4*t),n.scale.fromArray(e.bindPose.scale,3*t),this.bones.push(n)}e.bones.forEach((e,t)=>{if(this.bones[t].name=e.name,-1===e.parent)return this.bones[t].setParent(this.root);this.bones[t].setParent(this.bones[e.parent])}),this.root.updateMatrixWorld(!0),this.bones.forEach(e=>{e.bindInverse=new J(...e.worldMatrix).inverse()})}}createBoneTexture(){if(!this.bones.length)return;const e=Math.max(4,Math.pow(2,Math.ceil(Math.log(Math.sqrt(4*this.bones.length))/Math.LN2)));this.boneMatrices=new Float32Array(e*e*4),this.boneTextureSize=e,this.boneTexture=new me(this.gl,{image:this.boneMatrices,generateMipmaps:!1,type:this.gl.FLOAT,internalFormat:this.gl.renderer.isWebgl2?this.gl.RGBA32F:this.gl.RGBA,flipY:!1,width:e})}addAnimation(e){const t=new wt({objects:this.bones,data:e});return this.animations.push(t),t}update(){let e=0;this.animations.forEach(t=>e+=t.weight),this.animations.forEach((t,n)=>{t.update(e,0===n)})}draw({camera:e}={}){this.root.updateMatrixWorld(!0),this.bones.forEach((e,t)=>{xt.multiply(e.worldMatrix,e.bindInverse),this.boneMatrices.set(xt,16*t)}),this.boneTexture&&(this.boneTexture.needsUpdate=!0),super.draw({camera:e})}},Animation:wt,Text:function({font:e,text:t,width:n=1/0,align:i="left",size:r=1,letterSpacing:o=0,lineHeight:a=1.4,wordSpacing:s=0,wordBreak:l=!1}){const u=this;let c,d,h,p,m;const f=/\n/,v=/\s/;function g(){h=e.common.lineHeight,p=e.common.base,m=r/p;let n=t.replace(/[ \n]/g,"").length;d={position:new Float32Array(4*n*3),uv:new Float32Array(4*n*2),id:new Float32Array(4*n),index:new Uint16Array(6*n)};for(let e=0;e<n;e++)d.id[e]=e,d.index.set([4*e,4*e+2,4*e+1,4*e+1,4*e+2,4*e+3],6*e);w()}function w(){const h=[];let p=0,g=0,w=0,y=_();function _(){const e={width:0,glyphs:[]};return h.push(e),g=p,w=0,e}let b=0;for(;p<t.length&&b<100;){b++;const e=t[p];if(!y.width&&v.test(e)){p++,g=p,w=0;continue}if(f.test(e)){p++,y=_();continue}const i=c[e]||c[" "];if(y.glyphs.length){const e=y.glyphs[y.glyphs.length-1][0];let t=x(i.id,e.id)*m;y.width+=t,w+=t}y.glyphs.push([i,y.width]);let a=0;if(v.test(e)?(g=p,w=0,a+=s*r):a+=o*r,a+=i.xadvance*m,y.width+=a,w+=a,y.width>n){if(l&&y.glyphs.length>1){y.width-=a,y.glyphs.pop(),y=_();continue}if(!l&&w!==y.width){let e=p-g+1;y.glyphs.splice(-e,e),p=g,y.width-=w,y=_();continue}}p++}y.width||h.pop(),function(t){const n=e.common.scaleW,o=e.common.scaleH;let s=.07*r,l=0;for(let e=0;e<t.length;e++){let u=t[e];for(let e=0;e<u.glyphs.length;e++){const t=u.glyphs[e][0];let r=u.glyphs[e][1];if("center"===i?r-=.5*u.width:"right"===i&&(r-=u.width),v.test(t.char))continue;r+=t.xoffset*m,s-=t.yoffset*m;let a=t.width*m,c=t.height*m;d.position.set([r,s-c,0,r,s,0,r+a,s-c,0,r+a,s,0],4*l*3);let h=t.x/n,p=t.width/n,f=1-t.y/o,g=t.height/o;d.uv.set([h,f-g,h,f,h+p,f-g,h+p,f],4*l*2),s+=t.yoffset*m,l++}s-=r*a}u.buffers=d,u.numLines=t.length,u.height=u.numLines*r*a}(h)}function x(t,n){for(let i=0;i<e.kernings.length;i++){let r=e.kernings[i];if(!(r.first<t)&&!(r.second<n))return r.first>t||r.first===t&&r.second>n?0:r.amount}return 0}c={},e.chars.forEach(e=>c[e.char]=e),g(),this.resize=function(e){({width:n}=e),w()},this.update=function(e){({text:t}=e),g()}},NormalProgram:yt,Flowmap:class{constructor(e,{size:t=128,falloff:n=.3,alpha:i=1,dissipation:r=.98,type:o}={}){const a=this;this.gl=e,this.uniform={value:null},this.mask={read:null,write:null,swap:()=>{let e=a.mask.read;a.mask.read=a.mask.write,a.mask.write=e,a.uniform.value=a.mask.read.texture}},function(){o||(o=e.HALF_FLOAT||e.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES);let n=e.renderer.isWebgl2||e.renderer.extensions[`OES_texture_${o===e.FLOAT?"":"half_"}float_linear`]?e.LINEAR:e.NEAREST;const i={width:t,height:t,type:o,format:e.RGBA,internalFormat:e.renderer.isWebgl2?o===e.FLOAT?e.RGBA32F:e.RGBA16F:e.RGBA,minFilter:n,depth:!1};a.mask.read=new fe(e,i),a.mask.write=new fe(e,i),a.mask.swap()}(),this.aspect=1,this.mouse=new Te,this.velocity=new Te,this.mesh=new ce(e,{geometry:new Le(e),program:new k(e,{vertex:_t,fragment:bt,uniforms:{tMap:a.uniform,uFalloff:{value:.5*n},uAlpha:{value:i},uDissipation:{value:r},uAspect:{value:1},uMouse:{value:a.mouse},uVelocity:{value:a.velocity}},depthTest:!1})})}update(){this.mesh.program.uniforms.uAspect.value=this.aspect,this.gl.renderer.render({scene:this.mesh,target:this.mask.write,clear:!1}),this.mask.swap()}},GPGPU:class{constructor(e,{data:t=new Float32Array(16),geometry:n=new Le(e),type:i}){this.gl=e;const r=t;this.passes=[],this.geometry=n,this.dataLength=r.length/4,this.size=Math.pow(2,Math.ceil(Math.log(Math.ceil(Math.sqrt(this.dataLength)))/Math.LN2)),this.coords=new Float32Array(2*this.dataLength);for(let e=0;e<this.dataLength;e++){const t=e%this.size/this.size,n=Math.floor(e/this.size)/this.size;this.coords.set([t,n],2*e)}const o=(()=>{if(r.length===this.size*this.size*4)return r;{const e=new Float32Array(this.size*this.size*4);return e.set(r),e}})();this.uniform={value:new me(e,{image:o,target:e.TEXTURE_2D,type:e.FLOAT,format:e.RGBA,internalFormat:e.renderer.isWebgl2?e.RGBA32F:e.RGBA,wrapS:e.CLAMP_TO_EDGE,wrapT:e.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:e.NEAREST,magFilter:e.NEAREST,width:this.size,flipY:!1})};const a={width:this.size,height:this.size,type:i||e.HALF_FLOAT||e.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES,format:e.RGBA,internalFormat:e.renderer.isWebgl2?i===e.FLOAT?e.RGBA32F:e.RGBA16F:e.RGBA,minFilter:e.NEAREST,depth:!1,unpackAlignment:1};this.fbo={read:new fe(e,a),write:new fe(e,a),swap:()=>{let e=this.fbo.read;this.fbo.read=this.fbo.write,this.fbo.write=e,this.uniform.value=this.fbo.read.texture}}}addPass({vertex:e=Mt,fragment:t=At,uniforms:n={},textureUniform:i="tMap",enabled:r=!0}={}){n[i]=this.uniform;const o=new k(this.gl,{vertex:e,fragment:t,uniforms:n}),a={mesh:new ce(this.gl,{geometry:this.geometry,program:o}),program:o,uniforms:n,enabled:r,textureUniform:i};return this.passes.push(a),a}render(){this.passes.filter(e=>e.enabled).forEach((e,t)=>{this.gl.renderer.render({scene:e.mesh,target:this.fbo.write,clear:!1}),this.fbo.swap()})}},Polyline:class{constructor(e,{points:t,vertex:n=Tt,fragment:i=St,uniforms:r={},attributes:o={}}){this.gl=e,this.points=t,this.count=t.length,this.position=new Float32Array(3*this.count*2),this.prev=new Float32Array(3*this.count*2),this.next=new Float32Array(3*this.count*2);const a=new Float32Array(1*this.count*2),s=new Float32Array(2*this.count*2),l=new Uint16Array(3*(this.count-1)*2);for(let e=0;e<this.count;e++){a.set([-1,1],2*e);const t=e/(this.count-1);if(s.set([0,t,1,t],4*e),e===this.count-1)continue;const n=2*e;l.set([n+0,n+1,n+2],3*(n+0)),l.set([n+2,n+1,n+3],3*(n+1))}const u=this.geometry=new F(e,Object.assign(o,{position:{size:3,data:this.position},prev:{size:3,data:this.prev},next:{size:3,data:this.next},side:{size:1,data:a},uv:{size:2,data:s},index:{size:1,data:l}}));this.updateGeometry(),r.uResolution||(this.resolution=r.uResolution={value:new Te}),r.uDPR||(this.dpr=r.uDPR={value:1}),r.uThickness||(this.thickness=r.uThickness={value:1}),r.uColor||(this.color=r.uColor={value:new ye("#000")}),r.uMiter||(this.miter=r.uMiter={value:1}),this.resize();const c=this.program=new k(e,{vertex:n,fragment:i,uniforms:r});this.mesh=new ce(e,{geometry:u,program:c})}updateGeometry(){this.points.forEach((e,t)=>{e.toArray(this.position,3*t*2),e.toArray(this.position,3*t*2+3),t?(e.toArray(this.next,3*(t-1)*2),e.toArray(this.next,3*(t-1)*2+3)):(Et.copy(e).sub(this.points[t+1]).add(e),Et.toArray(this.prev,3*t*2),Et.toArray(this.prev,3*t*2+3)),t===this.points.length-1?(Et.copy(e).sub(this.points[t-1]).add(e),Et.toArray(this.next,3*t*2),Et.toArray(this.next,3*t*2+3)):(e.toArray(this.prev,3*(t+1)*2),e.toArray(this.prev,3*(t+1)*2+3))}),this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.prev.needsUpdate=!0,this.geometry.attributes.next.needsUpdate=!0}resize(){this.resolution&&this.resolution.value.set(this.gl.canvas.width,this.gl.canvas.height),this.dpr&&(this.dpr.value=this.gl.renderer.dpr)}},Shadow:class{constructor(e,{light:t=new ae(e),width:n=1024,height:i=n}){this.gl=e,this.light=t,this.target=new fe(e,{width:n,height:i}),this.depthProgram=new k(e,{vertex:Lt,fragment:Rt,cullFace:null}),this.castMeshes=[]}add({mesh:e,receive:t=!0,cast:n=!0,vertex:i=Lt,fragment:r=Rt,uniformProjection:o="shadowProjectionMatrix",uniformView:a="shadowViewMatrix",uniformTexture:s="tShadow"}){t&&!e.program.uniforms[o]&&(e.program.uniforms[o]={value:this.light.projectionMatrix},e.program.uniforms[a]={value:this.light.viewMatrix},e.program.uniforms[s]={value:this.target.texture}),n&&(this.castMeshes.push(e),e.colorProgram=e.program,e.depthProgram||(e.depthProgram=i!==Lt||r!==Rt?new k(gl,{vertex:i,fragment:r,cullFace:null}):this.depthProgram))}render({scene:e}){e.traverse(e=>{e.draw&&(~this.castMeshes.indexOf(e)?e.program=e.depthProgram:(e.isForceVisibility=e.visible,e.visible=!1))}),this.gl.renderer.render({scene:e,camera:this.light,target:this.target}),e.traverse(e=>{e.draw&&(~this.castMeshes.indexOf(e)?e.program=e.colorProgram:e.visible=e.isForceVisibility)})}},KTXTexture:Ft,TextureLoader:Ot,GLTFLoader:Jt,GLTFSkin:Yt});class tn{constructor(e){const t=this,n=e.gl;let i;this.camera=null,this.controls=null,this.update=function(){u||(r.lerp(l.tilt,.05),s.lerp(r,.05),i.rotation.y=-.07*s.x,i.rotation.x=.07*s.y-Math.PI/2*.9,t.camera.position.x=-.5*s.x,t.camera.position.y=-.5*s.y);t.controls&&t.controls.enabled&&t.controls.update();i.updateMatrixWorld()},this.resize=function(){t.camera.perspective({aspect:n.canvas.width/n.canvas.height})};let r=new Te,s=new Te;const u="ontouchstart"in window;function c(){i.position.y=1,i.position.x=-5,i.position.z=7,new o(i.position,9e3,{x:0,y:0,z:0})}function d({mapDown:e}){new o(i.position,500,{y:e?.7:0,ease:e?"inOutCubic":"outCubic"})}t.camera=new ae(n,{fov:65,near:.1,far:200}),t.camera.position.set(0,0,10),t.controls=new Ne(t.camera,{enabled:!1,element:n.canvas}),i=new ne,i.rotation.reorder("ZXY"),t.camera.setParent(i),i.rotation.x=-Math.PI/2*.9,a.on("identity-start",c),h.link("mapDown",d)}}var nn={fragment:"\n    precision highp float;\n\n    uniform sampler2D tMap;\n    uniform sampler2D tFluid;\n    uniform float uTime;\n    varying vec2 vUv;\n\n    void main() {\n        vec3 fluid = texture2D(tFluid, vUv).rgb;\n        vec2 uv = vUv - fluid.rg * 0.0002;\n\n        gl_FragColor = mix( texture2D(tMap, uv), vec4(fluid * 0.1 + 0.5, 1), step(0.5, vUv.x) ) ;\n\n        // Oscillate between fluid values and the distorted scene\n        // gl_FragColor = mix(texture2D(tMap, uv), vec4(fluid * 0.1 + 0.5, 1), smoothstep(0.0, 0.7, sin(uTime)));\n    }\n    ",baseVertex:"\n    precision highp float;\n    attribute vec2 position;\n    attribute vec2 uv;\n    varying vec2 vUv;\n    varying vec2 vL;\n    varying vec2 vR;\n    varying vec2 vT;\n    varying vec2 vB;\n    uniform vec2 texelSize;\n    void main () {\n        vUv = uv;\n        vL = vUv - vec2(texelSize.x, 0.0);\n        vR = vUv + vec2(texelSize.x, 0.0);\n        vT = vUv + vec2(0.0, texelSize.y);\n        vB = vUv - vec2(0.0, texelSize.y);\n        gl_Position = vec4(position, 0, 1);\n    }\n    ",clearShader:"\n    precision mediump float;\n    precision mediump sampler2D;\n    varying highp vec2 vUv;\n    uniform sampler2D uTexture;\n    uniform float value;\n    void main () {\n        gl_FragColor = value * texture2D(uTexture, vUv);\n    }\n    ",splatShader:"\n    precision highp float;\n    precision highp sampler2D;\n    varying vec2 vUv;\n    uniform sampler2D uTarget;\n    uniform float aspectRatio;\n    uniform vec3 color;\n    uniform vec2 point;\n    uniform float radius;\n    void main () {\n        vec2 p = vUv - point.xy;\n        p.x *= aspectRatio;\n        vec3 splat = exp(-dot(p, p) / radius) * color;\n        vec3 base = texture2D(uTarget, vUv).xyz;\n        gl_FragColor = vec4(base + splat, 1.0);\n    }\n    ",advectionManualFilteringShader:"\n    precision highp float;\n    precision highp sampler2D;\n    varying vec2 vUv;\n    uniform sampler2D uVelocity;\n    uniform sampler2D uSource;\n    uniform vec2 texelSize;\n    uniform vec2 dyeTexelSize;\n    uniform float dt;\n    uniform float dissipation;\n    vec4 bilerp (sampler2D sam, vec2 uv, vec2 tsize) {\n        vec2 st = uv / tsize - 0.5;\n        vec2 iuv = floor(st);\n        vec2 fuv = fract(st);\n        vec4 a = texture2D(sam, (iuv + vec2(0.5, 0.5)) * tsize);\n        vec4 b = texture2D(sam, (iuv + vec2(1.5, 0.5)) * tsize);\n        vec4 c = texture2D(sam, (iuv + vec2(0.5, 1.5)) * tsize);\n        vec4 d = texture2D(sam, (iuv + vec2(1.5, 1.5)) * tsize);\n        return mix(mix(a, b, fuv.x), mix(c, d, fuv.x), fuv.y);\n    }\n    void main () {\n        vec2 coord = vUv - dt * bilerp(uVelocity, vUv, texelSize).xy * texelSize;\n        gl_FragColor = dissipation * bilerp(uSource, coord, dyeTexelSize);\n        gl_FragColor.a = 1.0;\n    }\n    ",advectionShader:"\n    precision highp float;\n    precision highp sampler2D;\n    varying vec2 vUv;\n    uniform sampler2D uVelocity;\n    uniform sampler2D uSource;\n    uniform vec2 texelSize;\n    uniform float dt;\n    uniform float dissipation;\n    void main () {\n        vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize;\n        gl_FragColor = dissipation * texture2D(uSource, coord);\n        gl_FragColor.a = 1.0;\n    }\n    ",divergenceShader:"\n    precision mediump float;\n    precision mediump sampler2D;\n    varying highp vec2 vUv;\n    varying highp vec2 vL;\n    varying highp vec2 vR;\n    varying highp vec2 vT;\n    varying highp vec2 vB;\n    uniform sampler2D uVelocity;\n    void main () {\n        float L = texture2D(uVelocity, vL).x;\n        float R = texture2D(uVelocity, vR).x;\n        float T = texture2D(uVelocity, vT).y;\n        float B = texture2D(uVelocity, vB).y;\n        vec2 C = texture2D(uVelocity, vUv).xy;\n        if (vL.x < 0.0) { L = -C.x; }\n        if (vR.x > 1.0) { R = -C.x; }\n        if (vT.y > 1.0) { T = -C.y; }\n        if (vB.y < 0.0) { B = -C.y; }\n        float div = 0.5 * (R - L + T - B);\n        gl_FragColor = vec4(div, 0.0, 0.0, 1.0);\n    }\n    ",curlShader:"\n    precision mediump float;\n    precision mediump sampler2D;\n    varying highp vec2 vUv;\n    varying highp vec2 vL;\n    varying highp vec2 vR;\n    varying highp vec2 vT;\n    varying highp vec2 vB;\n    uniform sampler2D uVelocity;\n    void main () {\n        float L = texture2D(uVelocity, vL).y;\n        float R = texture2D(uVelocity, vR).y;\n        float T = texture2D(uVelocity, vT).x;\n        float B = texture2D(uVelocity, vB).x;\n        float vorticity = R - L - T + B;\n        gl_FragColor = vec4(0.5 * vorticity, 0.0, 0.0, 1.0);\n    }\n    ",vorticityShader:"\n    precision highp float;\n    precision highp sampler2D;\n    varying vec2 vUv;\n    varying vec2 vL;\n    varying vec2 vR;\n    varying vec2 vT;\n    varying vec2 vB;\n    uniform sampler2D uVelocity;\n    uniform sampler2D uCurl;\n    uniform float curl;\n    uniform float dt;\n    void main () {\n        float L = texture2D(uCurl, vL).x;\n        float R = texture2D(uCurl, vR).x;\n        float T = texture2D(uCurl, vT).x;\n        float B = texture2D(uCurl, vB).x;\n        float C = texture2D(uCurl, vUv).x;\n        vec2 force = 0.5 * vec2(abs(T) - abs(B), abs(R) - abs(L));\n        force /= length(force) + 0.0001;\n        force *= curl * C;\n        force.y *= -1.0;\n        vec2 vel = texture2D(uVelocity, vUv).xy;\n        gl_FragColor = vec4(vel + force * dt, 0.0, 1.0);\n    }\n    ",pressureShader:"\n    precision mediump float;\n    precision mediump sampler2D;\n    varying highp vec2 vUv;\n    varying highp vec2 vL;\n    varying highp vec2 vR;\n    varying highp vec2 vT;\n    varying highp vec2 vB;\n    uniform sampler2D uPressure;\n    uniform sampler2D uDivergence;\n    void main () {\n        float L = texture2D(uPressure, vL).x;\n        float R = texture2D(uPressure, vR).x;\n        float T = texture2D(uPressure, vT).x;\n        float B = texture2D(uPressure, vB).x;\n        float C = texture2D(uPressure, vUv).x;\n        float divergence = texture2D(uDivergence, vUv).x;\n        float pressure = (L + R + B + T - divergence) * 0.25;\n        gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);\n    }\n    ",gradientSubtractShader:"\n    precision mediump float;\n    precision mediump sampler2D;\n    varying highp vec2 vUv;\n    varying highp vec2 vL;\n    varying highp vec2 vR;\n    varying highp vec2 vT;\n    varying highp vec2 vB;\n    uniform sampler2D uPressure;\n    uniform sampler2D uVelocity;\n    void main () {\n        float L = texture2D(uPressure, vL).x;\n        float R = texture2D(uPressure, vR).x;\n        float T = texture2D(uPressure, vT).x;\n        float B = texture2D(uPressure, vB).x;\n        vec2 velocity = texture2D(uVelocity, vUv).xy;\n        velocity.xy -= vec2(R - L, T - B);\n        gl_FragColor = vec4(velocity, 0.0, 1.0);\n    }\n    "};class rn{constructor(t){const n=this,i=t.gl;this.uniform={value:null},this.enabled=!0;if("ontouchstart"in window)return void(n.uniform.value=new me(i));const r=128,o=256,a={value:new Te(1/r)},s=new Te;let l,u,c,d=i.renderer.extensions[`OES_texture_${i.renderer.isWebgl2?"":"half_"}float_linear`];const h=i.renderer.isWebgl2?i.HALF_FLOAT:i.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES,p=d?i.LINEAR:i.NEAREST;i.renderer.isWebgl2?(l=on(i,i.RGBA16F,i.RGBA,h),u=on(i,i.RG16F,i.RG,h),c=on(i,i.R16F,i.RED,h)):(l=on(i,i.RGBA,i.RGBA,h),u=l,c=l);const m=an(i,{width:o,height:o,type:h,format:l.format,internalFormat:l.internalFormat,minFilter:p,depth:!1}),f=an(i,{width:r,height:r,type:h,format:u.format,internalFormat:u.internalFormat,minFilter:p,depth:!1}),v=an(i,{width:r,height:r,type:h,format:c.format,internalFormat:c.internalFormat,minFilter:i.NEAREST,depth:!1}),g=new fe(i,{width:r,height:r,type:h,format:c.format,internalFormat:c.internalFormat,minFilter:i.NEAREST,depth:!1}),w=new fe(i,{width:r,height:r,type:h,format:c.format,internalFormat:c.internalFormat,minFilter:i.NEAREST,depth:!1}),x=t.triangle,{baseVertex:y,clearShader:_,splatShader:b,advectionShader:M,advectionManualFilteringShader:A,divergenceShader:E,curlShader:T,vorticityShader:S,pressureShader:L,gradientSubtractShader:R}=nn,F=new ce(i,{geometry:x,program:new k(i,{vertex:y,fragment:_,uniforms:{texelSize:a,uTexture:{value:null},value:{value:.995}},depthTest:!1,depthWrite:!1})}),C=new ce(i,{geometry:x,program:new k(i,{vertex:y,fragment:b,uniforms:{texelSize:a,uTarget:{value:null},aspectRatio:{value:1},color:{value:new ye},point:{value:new Te},radius:{value:1}},depthTest:!1,depthWrite:!1})}),P=new ce(i,{geometry:x,program:new k(i,{vertex:y,fragment:d?M:A,uniforms:{texelSize:a,dyeTexelSize:{value:new Te(1/o,1/o)},uVelocity:{value:null},uSource:{value:null},dt:{value:.016},dissipation:{value:1}},depthTest:!1,depthWrite:!1})}),O=new ce(i,{geometry:x,program:new k(i,{vertex:y,fragment:E,uniforms:{texelSize:a,uVelocity:{value:null}},depthTest:!1,depthWrite:!1})}),I=new ce(i,{geometry:x,program:new k(i,{vertex:y,fragment:T,uniforms:{texelSize:a,uVelocity:{value:null}},depthTest:!1,depthWrite:!1})}),D=new ce(i,{geometry:x,program:new k(i,{vertex:y,fragment:S,uniforms:{texelSize:a,uVelocity:{value:null},uCurl:{value:null},curl:{value:20},dt:{value:.016}},depthTest:!1,depthWrite:!1})}),N=new ce(i,{geometry:x,program:new k(i,{vertex:y,fragment:L,uniforms:{texelSize:a,uPressure:{value:null},uDivergence:{value:null}},depthTest:!1,depthWrite:!1})}),U=new ce(i,{geometry:x,program:new k(i,{vertex:y,fragment:R,uniforms:{texelSize:a,uPressure:{value:null},uVelocity:{value:null}},depthTest:!1,depthWrite:!1})}),B=[];function z({x:e,y:t,dx:n,dy:r}){C.program.uniforms.uTarget.value=f.read.texture,C.program.uniforms.aspectRatio.value=i.renderer.width/i.renderer.height,C.program.uniforms.point.value.set(e,t),C.program.uniforms.color.value.set(n,r,1),C.program.uniforms.radius.value=.002,i.renderer.render({scene:C,target:f.write,sort:!1,update:!1}),f.swap(),C.program.uniforms.uTarget.value=m.read.texture,i.renderer.render({scene:C,target:m.write,sort:!1,update:!1}),m.swap()}window.addEventListener("pointerdown",(function(){n.isMouseDown=!0})),window.addEventListener("pointerup",(function(){n.isMouseDown=!1})),window.addEventListener("pointermove",(function(e){e.changedTouches&&e.changedTouches.length&&(e.x=e.changedTouches[0].pageX,e.y=e.changedTouches[0].pageY);void 0===e.x&&(e.x=e.pageX,e.y=e.pageY);s.isInit||(s.isInit=!0,s.set(e.x,e.y));const t=e.x-s.x,r=e.y-s.y;if(s.set(e.x,e.y),n.isMouseDown)return;(Math.abs(t)||Math.abs(r))&&B.push({x:e.x/i.renderer.width,y:1-e.y/i.renderer.height,dx:1.5*t,dy:-1.5*r})})),e.add((function(){if(!n.enabled)return;i.renderer.autoClear=!1;for(let e=B.length-1;e>=0;e--)z(B.splice(e,1)[0]);I.program.uniforms.uVelocity.value=f.read.texture,i.renderer.render({scene:I,target:w,sort:!1,update:!1}),D.program.uniforms.uVelocity.value=f.read.texture,D.program.uniforms.uCurl.value=w.texture,i.renderer.render({scene:D,target:f.write,sort:!1,update:!1}),f.swap(),O.program.uniforms.uVelocity.value=f.read.texture,i.renderer.render({scene:O,target:g,sort:!1,update:!1}),F.program.uniforms.uTexture.value=v.read.texture,F.program.uniforms.value.value=.995,i.renderer.render({scene:F,target:v.write,sort:!1,update:!1}),v.swap(),N.program.uniforms.uDivergence.value=g.texture;for(let e=0;e<1;e++)N.program.uniforms.uPressure.value=v.read.texture,i.renderer.render({scene:N,target:v.write,sort:!1,update:!1}),v.swap();U.program.uniforms.uPressure.value=v.read.texture,U.program.uniforms.uVelocity.value=f.read.texture,i.renderer.render({scene:U,target:f.write,sort:!1,update:!1}),f.swap(),P.program.uniforms.dyeTexelSize.value.set(1/r),P.program.uniforms.uVelocity.value=f.read.texture,P.program.uniforms.uSource.value=f.read.texture,P.program.uniforms.dissipation.value=.995,i.renderer.render({scene:P,target:f.write,sort:!1,update:!1}),f.swap(),P.program.uniforms.dyeTexelSize.value.set(1/o),P.program.uniforms.uVelocity.value=f.read.texture,P.program.uniforms.uSource.value=m.read.texture,P.program.uniforms.dissipation.value=.995,i.renderer.render({scene:P,target:m.write,sort:!1,update:!1}),m.swap(),i.renderer.autoClear=!0,n.uniform.value=m.read.texture}))}}function on(e,t,n,i){if(!function(e,t,n,i){let r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,t,4,4,0,n,i,null);let o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);return e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE}(e,t,n,i))switch(t){case e.R16F:return on(e,e.RG16F,e.RG,i);case e.RG16F:return on(e,e.RGBA16F,e.RGBA,i);default:return null}return{internalFormat:t,format:n}}function an(e,{width:t,height:n,wrapS:i,wrapT:r,minFilter:o=e.LINEAR,magFilter:a=o,type:s,format:l,internalFormat:u,depth:c}={}){const d={width:t,height:n,wrapS:i,wrapT:r,minFilter:o,magFilter:a,type:s,format:l,internalFormat:u,depth:c},h={read:new fe(e,d),write:new fe(e,d),swap:()=>{let e=h.read;h.read=h.write,h.write=e}};return h}var sn={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec2 position;\nattribute vec2 uv;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = vec4(position, 0, 1);\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform float uTime;\nuniform float uFade;\nuniform float uIntro;\nuniform vec2 uResolution;\nuniform sampler2D tMap;\nuniform sampler2D tUI;\nuniform sampler2D tHash;\n\nvarying vec2 vUv;\n\nhighp float random(vec2 co) {\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\nfloat blendOverlay(float base, float blend) {\n\treturn base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend));\n}\n\nvec3 blendOverlay(vec3 base, vec3 blend) {\n\treturn vec3(blendOverlay(base.r, blend.r), blendOverlay(base.g, blend.g), blendOverlay(base.b, blend.b));\n}\n\nvec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n\treturn (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n}\n\nvoid addMap(inout vec3 color) {\n    vec2 uv = vUv;\n    if (uFade < 1.0) {\n        float steps = pow(2.0, floor(mix(5.0, 12.0, uFade)));\n        uv = ceil(vUv * steps) / steps;\n    }\n\n    float introFade = mix(1.0, 0.5, smoothstep(0.1, 0.4, uIntro) * smoothstep(1.0, 0.6, uIntro));\n    introFade = mix(introFade, 1.0, smoothstep(0.0, 0.8, abs(vUv.y -0.5)));\n    // mix(mix(0.5, 1.0, smoothstep(0.0, 0.5, abs(vUv.y -0.5))), 1.0, smoothstep(0.5, 1.0, uIntro))\n\n    color += texture2D(tMap, uv).rgb * introFade;\n}\n\nvoid addUI(inout vec3 color) {\n    vec2 uvUI = vUv;\n    color += texture2D(tUI, uvUI).rgb;\n}\n\nvoid addNoise(inout vec3 color, vec2 jitter) {\n    vec2 uvNoise = gl_FragCoord.xy / (300.0);\n\n    uvNoise += jitter;\n    vec3 noise = texture2D(tHash, uvNoise).rgb;\n    color = blendOverlay(color, noise, 1.0);\n}\n\nvoid main() {\n    vec3 color = vec3(0);\n\n    addMap(color);\n    \n    //jitter the noise but not every frame\n    float tick = floor(fract(uTime) * 15.0);\n    vec2 jitter = vec2(\n        mod(tick * 382.0231, 21.321),\n        mod(tick * 122.0142, 31.243)\n    );\n\n    // Vignette\n    color = mix(color, vec3(0), smoothstep(0.3, 1.0, length(vUv - vec2(0.5) + random(vUv + jitter) * 0.05)));\n\n    addUI(color);\n    \n    addNoise(color, jitter);\n\n    color *= uFade;\n\n    gl_FragColor = vec4(color, 1.0);\n}\n    "};const ln={init:function(t,n){const i=this;let s,u;function c(){const e=window.innerWidth,t=window.innerHeight;document.body.parentElement.scrollTop=document.body.scrollTop=0,i.renderer.setSize(e,t),i.resolution.value.set(e*i.dpr,t*i.dpr),i.ratio.value=e/t,i.cameraControls.resize(),i.revealTarget=new fe(s,{width:.25*e,height:.25*t}),i.mapTarget=new fe(s,{width:1*e,height:1*t}),i.uiTarget=new fe(s,{width:2*e,height:2*t}),i.revealUniform.value=i.revealTarget.texture,u.uniforms.tMap.value=i.mapTarget.texture,u.uniforms.tUI.value=i.uiTarget.texture,a.emit("resize")}this.COLS=5,this.ROWS=5,this.SIZE=20,this.CLICK_RADIUS=7,this.ZONE=1===n?20:2===n?35:100,this.dpr=2,this.renderer=null,this.gl=null,this.scene=null,this.uiScene=null,this.mapScene=null,this.revealScene=null,this.cameraControls=null,this.camera=null,this.controls=null,this.raycast=null,this.time=null,this.resolution=null,this.ratio=null,this.fluidMask=null,this.mapPos=null,this.mapSize=null,this.revealUniform=null,this.isTouch="ontouchstart"in window,function(){i.renderer=new z({canvas:t,dpr:i.dpr}),i.gl=s=i.renderer.gl,s.clearColor(0,0,0,1),i.scene=new ne,i.uiScene=new ne,i.mapScene=new ne,i.revealScene=new ne,i.cameraControls=new tn(i),i.camera=i.cameraControls.camera,i.controls=i.cameraControls.controls,i.raycast=new Je(s),i.triangle=new Le(s);const e=new rn(i);i.time={value:0},i.resolution={value:new Te},i.ratio={value:1},i.fluidMask=e.uniform,i.mapPos={value:new Te},i.mapSize={value:new Te(i.COLS*i.SIZE,i.ROWS*i.SIZE)},i.revealUniform={value:null}}(),function(){const e=i.triangle,{vertex:t,fragment:n}=sn;u=new k(s,{vertex:t,fragment:n,uniforms:{uTime:i.time,uResolution:i.resolution,tMap:{value:null},tUI:{value:null},tHash:{value:Ot.load(s,{src:WOLVES_CDN+"assets/images/noise/hash.jpg",wrapS:s.REPEAT,wrapT:s.REPEAT})},uFade:{value:0},uIntro:{value:0}}});new ce(s,{geometry:e,program:u}).setParent(i.scene)}(),window.addEventListener("resize",c),window.addEventListener("orientationchange",c),c(),a.on("identity-start",()=>{new o(u.uniforms.uFade,2500,{value:1,ease:"outSine",delay:100}),new o(u.uniforms.uIntro,6e3,{value:1,ease:"linear",delay:100})}),window.addEventListener("orientationchange",async()=>{await new r(400),c(),await new r(1e3),c()}),e.add((function(e){if(i.isPaused)return;i.time.value+=.001*e,i.cameraControls.update(),i.mapPos.value.set(-i.mapScene.position.x/i.SIZE,-i.mapScene.position.z/i.SIZE),i.raycast.castMouse(i.camera,l.tilt),i.renderer.render({scene:i.revealScene,camera:i.camera,target:i.revealTarget}),i.renderer.render({scene:i.mapScene,camera:i.camera,target:i.mapTarget}),i.renderer.render({scene:i.uiScene,camera:i.camera,target:i.uiTarget}),i.renderer.render({scene:i.scene})}))}};class un{constructor(e,t){let n,i,r;function o(){const e=r?.625:1280/720;ln.renderer.width/ln.renderer.height<e?n.css({height:"100%",width:"auto"}):n.css({height:"auto",width:"100%"})}function s(){window.removeEventListener("resize",o),window.removeEventListener("orientationchange",o),window.removeEventListener("touchend",s),window.removeEventListener("mouseup",s),t.removeChild(n),t.removeChild(i),n=null,i=null,a.emit("intro-end")}!function(){if(e)return setTimeout(()=>a.emit("intro-end"));localStorage.setItem("wolves_intro",!0),n=d.create("video","intro-video"),n.autoplay=!0,n.muted=!0,n.playsInline=!0,n.crossOrigin="anonymous",r=ln.ratio.value>1?"":"-mobile",n.src=WOLVES_CDN+`assets/videos/teaser${r}.mp4`,i=d.create("div","intro-skip-prompt"),i.innerText=` ${ln.isTouch?"Tap":"Click"} anywhere to skip`,t.appendChild(n),t.appendChild(i)}(),function(){if(e)return;n.addEventListener("ended",s),window.addEventListener("touchend",s),window.addEventListener("mouseup",s),window.addEventListener("resize",o),window.addEventListener("orientationchange",o),o()}()}}var cn={vertex:"\nprecision highp float;\nprecision highp int;\n\nin vec3 position;\nin vec2 uv;\nin vec3 normal;\n\n#ifdef INSTANCED\n  in mat4 instanceMatrix;\n#endif\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 modelMatrix;\nuniform mat3 normalMatrix;\n\nout vec2 vUv;\nout vec3 vNormal;\nout vec3 vMPos;\nout vec4 vMVPos;\n\nvoid main() {\n  vec4 pos = vec4(position, 1);\n  vec3 nml = normal;\n\n  #ifdef INSTANCED\n    pos = instanceMatrix * pos;\n\n    mat3 m = mat3(instanceMatrix);\n    nml /= vec3(dot(m[0], m[0]), dot(m[1], m[1]), dot(m[2], m[2]));\n    nml = m * nml;\n  #endif\n\n  vUv = uv;\n  // vNormal = normalize(normalMatrix * nml);\n  vNormal = normalize(nml);\n  vec4 mPos = modelMatrix * pos;\n  vMPos = mPos.xyz / mPos.w;\n  vMVPos = modelViewMatrix * pos;\n\n  gl_Position = projectionMatrix * vMVPos;\n}\n  ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\nuniform vec4 uBaseColorFactor;\nuniform sampler2D tBaseColor;\n\nuniform sampler2D tRM;\nuniform float uRoughness;\nuniform float uMetallic;\n\nuniform sampler2D tNormal;\nuniform float uNormalScale;\n\nuniform sampler2D tEmissive;\nuniform float uEmissive;\n\nuniform sampler2D tLUT;\nuniform sampler2D tEnvDiffuse;\nuniform sampler2D tEnvSpecular;\nuniform float uEnvDiffuse;\nuniform float uEnvSpecular;\n\nuniform vec3 uLightDirection;\nuniform vec3 uLightColor;\n\nuniform float uAlpha;\nuniform float uAlphaCutoff;\n\nuniform vec3 uPlayer;\n\nin vec2 vUv;\nin vec3 vNormal;\nin vec3 vMPos;\nin vec4 vMVPos;\n\nout vec4 FragColor;\n\nconst float PI = 3.14159265359;\nconst float RECIPROCAL_PI = 0.31830988618;\nconst float RECIPROCAL_PI2 = 0.15915494;\nconst float LN2 = 0.6931472;\n\nconst float ENV_LODS = 6.0;\n\nvec4 SRGBtoLinear(vec4 srgb) {\n  vec3 linOut = pow(srgb.xyz, vec3(2.2));\n  return vec4(linOut, srgb.w);;\n}\n\nvec4 RGBMToLinear(in vec4 value) {\n  float maxRange = 6.0;\n  return vec4(value.xyz * value.w * maxRange, 1.0);\n}\n\nvec3 linearToSRGB(vec3 color) {\n  return pow(color, vec3(1.0 / 2.2));\n}\n\nvec3 getNormal() {\n  #ifdef NORMAL_MAP  \n    vec3 pos_dx = dFdx(vMPos.xyz);\n    vec3 pos_dy = dFdy(vMPos.xyz);\n    vec2 tex_dx = dFdx(vUv);\n    vec2 tex_dy = dFdy(vUv);\n\n    // Tangent, Bitangent\n    vec3 t = normalize(pos_dx * tex_dy.t - pos_dy * tex_dx.t);\n    vec3 b = normalize(-pos_dx * tex_dy.s + pos_dy * tex_dx.s);\n    mat3 tbn = mat3(t, b, normalize(vNormal));\n\n    vec3 n = texture(tNormal, vUv).rgb * 2.0 - 1.0;\n    n.xy *= uNormalScale;\n    vec3 normal = normalize(tbn * n);\n\n    // Get world normal from view normal (normalMatrix * normal)\n    // return normalize((vec4(normal, 0.0) * viewMatrix).xyz);\n    return normalize(normal);\n  #else\n    return normalize(vNormal);\n  #endif\n}\n\nvec3 specularReflection(vec3 specularEnvR0, vec3 specularEnvR90, float VdH) {\n  return specularEnvR0 + (specularEnvR90 - specularEnvR0) * pow(clamp(1.0 - VdH, 0.0, 1.0), 5.0);\n}\n\nfloat geometricOcclusion(float NdL, float NdV, float roughness) {\n  float r = roughness;\n\n  float attenuationL = 2.0 * NdL / (NdL + sqrt(r * r + (1.0 - r * r) * (NdL * NdL)));\n  float attenuationV = 2.0 * NdV / (NdV + sqrt(r * r + (1.0 - r * r) * (NdV * NdV)));\n  return attenuationL * attenuationV;\n}\n\nfloat microfacetDistribution(float roughness, float NdH) {\n  float roughnessSq = roughness * roughness;\n  float f = (NdH * roughnessSq - NdH) * NdH + 1.0;\n  return roughnessSq / (PI * f * f);\n}\n\nvec2 cartesianToPolar(vec3 n) {\n  vec2 uv;\n  uv.x = atan(n.z, n.x) * RECIPROCAL_PI2 + 0.5;\n  uv.y = asin(n.y) * RECIPROCAL_PI + 0.5;\n  return uv;\n}\n\nvoid getIBLContribution(inout vec3 diffuse, inout vec3 specular, float NdV, float roughness, vec3 n, vec3 reflection, vec3 diffuseColor, vec3 specularColor) {\n  vec3 brdf = SRGBtoLinear(texture(tLUT, vec2(NdV, roughness))).rgb;\n\n  vec3 diffuseLight = RGBMToLinear(texture(tEnvDiffuse, cartesianToPolar(n))).rgb;\n  diffuseLight = mix(vec3(1), diffuseLight, uEnvDiffuse);\n\n  // Sample 2 levels and mix between to get smoother degradation\n  float blend = roughness * ENV_LODS;\n  float level0 = floor(blend);\n  float level1 = min(ENV_LODS, level0 + 1.0);\n  blend -= level0;\n  \n  // Sample the specular env map atlas depending on the roughness value\n  vec2 uvSpec = cartesianToPolar(reflection);\n  uvSpec.y /= 2.0;\n\n  vec2 uv0 = uvSpec;\n  vec2 uv1 = uvSpec;\n\n  uv0 /= pow(2.0, level0);\n  uv0.y += 1.0 - exp(-LN2 * level0);\n\n  uv1 /= pow(2.0, level1);\n  uv1.y += 1.0 - exp(-LN2 * level1);\n\n  vec3 specular0 = RGBMToLinear(texture(tEnvSpecular, uv0)).rgb;\n  vec3 specular1 = RGBMToLinear(texture(tEnvSpecular, uv1)).rgb;\n  vec3 specularLight = mix(specular0, specular1, blend);\n\n  diffuse = diffuseLight * diffuseColor;\n  \n  // Bit of extra reflection for smooth materials\n  float reflectivity = pow((1.0 - roughness), 2.0) * 0.05;\n  specular = specularLight * (specularColor * brdf.x + brdf.y + reflectivity);\n  specular *= uEnvSpecular;\n}\n\nvoid main() {\n  vec4 baseColor = uBaseColorFactor;\n  #ifdef COLOR_MAP\n    baseColor *= SRGBtoLinear(texture(tBaseColor, vUv));\n  #endif\n\n  // Get base alpha\n  float alpha = baseColor.a;\n\n  #ifdef ALPHA_MASK\n    if (alpha < uAlphaCutoff) discard;\n  #endif\n\n  // // RM map packed as gb = [nothing, roughness, metallic, nothing]\n  // vec4 rmSample = vec4(1);\n  // #ifdef RM_MAP\n  //   rmSample *= texture(tRM, vUv);\n  // #endif\n  // float roughness = clamp(rmSample.g * uRoughness, 0.04, 1.0);\n  // float metallic = clamp(rmSample.b * uMetallic, 0.04, 1.0);\n\n  // vec3 f0 = vec3(0.04);\n  // vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0) * (1.0 - metallic);\n  // vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n\n  // vec3 specularEnvR0 = specularColor;\n  // vec3 specularEnvR90 = vec3(clamp(max(max(specularColor.r, specularColor.g), specularColor.b) * 25.0, 0.0, 1.0));\n\n  // vec3 N = getNormal();\n  // vec3 V = normalize(cameraPosition - vMPos);\n  // vec3 L = normalize(uLightDirection);\n  // vec3 H = normalize(L + V);\n  // vec3 reflection = normalize(reflect(-V, N));\n\n  // float NdL = clamp(dot(N, L), 0.001, 1.0);\n  // float NdV = clamp(abs(dot(N, V)), 0.001, 1.0);\n  // float NdH = clamp(dot(N, H), 0.0, 1.0);\n  // float LdH = clamp(dot(L, H), 0.0, 1.0);\n  // float VdH = clamp(dot(V, H), 0.0, 1.0);\n\n  // vec3 F = specularReflection(specularEnvR0, specularEnvR90, VdH);\n  // float G = geometricOcclusion(NdL, NdV, roughness);\n  // float D = microfacetDistribution(roughness, NdH);\n\n  // vec3 diffuseContrib = (1.0 - F) * (diffuseColor / PI);\n  // vec3 specContrib = F * G * D / (4.0 * NdL * NdV);\n  \n  // // Shading based off lights\n  // vec3 color = NdL * uLightColor * (diffuseContrib + specContrib);\n\n  // // Add lights spec to alpha for reflections on transparent surfaces (glass)\n  // alpha = max(alpha, max(max(specContrib.r, specContrib.g), specContrib.b));\n\n  // // Calculate IBL lighting\n  // vec3 diffuseIBL;\n  // vec3 specularIBL;\n  // getIBLContribution(diffuseIBL, specularIBL, NdV, roughness, N, reflection, diffuseColor, specularColor);\n\n  // // Add IBL on top of color\n  // color += diffuseIBL + specularIBL;\n\n  // // Add IBL spec to alpha for reflections on transparent surfaces (glass)\n  // alpha = max(alpha, max(max(specularIBL.r, specularIBL.g), specularIBL.b));\n\n  // Multiply occlusion\n  // TODO: occlusion texture\n  // color = mix(color, color * rmSample.b, uOcclusion);\n\n  // Add emissive on top\n  // TODO: emissive\n  // vec3 emissive = SRGBtoLinear(texture(tEmissive, vUv)).rgb * uEmissive;\n  // color += emissive;\n\n  vec3 color = baseColor.rgb;\n\n  // Convert to sRGB to display\n  FragColor.rgb = linearToSRGB(color);\n\n  // Fog - add fog relative to the distance from the camera\n  // float dist = length(vMVPos);\n  // vec3 fogColor = vec3(0.544, 0.800, 0.823);\n  // float fogNear = 10.0;\n  // float fogFar = 200.0;\n  // float fog = smoothstep(fogNear, fogFar, dist);\n  // FragColor.rgb = mix(FragColor.rgb, fogColor, fog);\n  \n  // Apply uAlpha uniform at the end to overwrite any specular additions on transparent surfaces\n  FragColor.a = alpha * uAlpha;\n}\n  "};class dn{static init(){this.gl=ln.gl}static parseGLTF(e){const t=e.program.gltfMaterial||{};let{vertex:n,fragment:i}=cn,r=`#version 300 es\n      ${e.geometry.isInstanced?"#define INSTANCED":""}\n      ${"MASK"===t.alphaMode?"#define ALPHA_MASK":""}\n      ${t.baseColorTexture?"#define COLOR_MAP":""}\n      ${t.normalTexture?"#define NORMAL_MAP":""}\n      ${t.metallicRoughnessTexture?"#define RM_MAP":""}\n      ${t.occlusionTexture?"#define OCC_MAP":""}\n      ${t.emissiveTexture?"#define EMISSIVE_MAP":""}\n    `;n=r+n,i=r+i;return new k(this.gl,{vertex:n,fragment:i,uniforms:{uBaseColorFactor:{value:t.baseColorFactor||[1,1,1,1]},tBaseColor:{value:t.baseColorTexture?t.baseColorTexture.texture:null},tRM:{value:t.metallicRoughnessTexture?t.metallicRoughnessTexture.texture:null},uRoughness:{value:void 0!==t.roughnessFactor?t.roughnessFactor:1},uMetallic:{value:void 0!==t.metallicFactor?t.metallicFactor:1},tNormal:{value:t.normalTexture?t.normalTexture.texture:null},uNormalScale:{value:t.normalTexture&&t.normalTexture.scale||1},tLUT:{value:null},tEnvDiffuse:{value:null},tEnvSpecular:{value:null},uEnvDiffuse:{value:.5},uEnvSpecular:{value:1},uLightDirection:{value:new ye("#fff")},uLightColor:{value:new E(1)},uAlpha:{value:1},uAlphaCutoff:{value:t.alphaCutoff},uPlayer:ln.playerPosition},transparent:"BLEND"===t.alphaMode,cullFace:t.doubleSided?null:this.gl.BACK})}}class hn{constructor(t,n){function i(e,t){const{objectName:n,groupName:i,meshName:r,materialName:o}=e.match;return n&&t.name&&t.name===n?(e.add(t),[!0,!1]):i&&t.name&&t.name===i?(e.add(t),[!0,!0]):t.program&&(r&&t.name&&(t.name===r||"*"===r)||t.program.gltfMaterial&&o&&t.program.gltfMaterial.name===o)?(e.add(t),[!0,!1]):[!1,!1]}!function(){dn.init();const t={World:ln,Emitter:a,Tick:e,State:h,Animate:o,Mouse:l,PBRProgram:dn,ogl:en};n=n.map(e=>new e(t))}(),t.scene.forEach(e=>{e.setParent(ln.uiScene),e.traverse(e=>{for(let t=0;t<n.length;t++){const r=n[t],[o,a]=i(r,e);if(o&&(r.hasMatch=!0),a)return!0;if(o)return!1}})}),n.forEach(e=>{!e.hasMatch&&e.fallback&&e.fallback()})}}var pn={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec3 position;\nattribute vec2 uv;\nattribute vec3 normal;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec2 uResolution;\nuniform float uRatio;\nuniform float uHover;\n\nvarying vec2 vUv;\n\nmat4 billboardMatrix(mat4 inMat4) {\n    mat4 outMat4 = inMat4;\n    outMat4[0][0] = 1.0;\n    outMat4[0][1] = 0.0;\n    outMat4[0][2] = 0.0;\n    outMat4[1][0] = 0.0;\n    outMat4[1][1] = 1.0;\n    outMat4[1][2] = 0.0;\n    outMat4[2][0] = 0.0;\n    outMat4[2][1] = 0.0;\n    outMat4[2][2] = 1.0;\n    return outMat4;\n}\n\nvoid main() {\n    vUv = uv;\n    vec3 pos = position;\n    pos *= 4.0;\n\n    pos *= mix(1.0, 1.1, uHover);\n\n    pos *= 260.0 / uResolution.y;\n    // gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1);\n\n    vec4 clipPos = projectionMatrix * billboardMatrix(modelViewMatrix) * vec4(pos, 1);\n    pos.z -= pow(clipPos.x, 2.0) * 0.01 * 0.5 * mix(0.5, 1.0, smoothstep(0.5, 1.0, uRatio));\n    pos.z -= pow(clipPos.y, 2.0) * 0.002 * 0.5;\n    \n    pos.z += mix(0.0, 0.15, uHover);\n\n    gl_Position = projectionMatrix * billboardMatrix(modelViewMatrix) * vec4(pos, 1);\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nvarying vec2 vUv;\n\nuniform float uTime;\nuniform float uFade;\nuniform float uFound;\nuniform float uType;\n\nfloat triangle(vec2 p, float size) {\n    vec2 q = abs(p);\n    return smoothstep(0.0, -0.01, max(q.x * 0.866025 + p.y * 0.5, -p.y * 0.5) - size * 0.5);\n}\n\nfloat rect(vec2 p, float size) {\n    vec2 d = abs(p) - size;\n    return smoothstep(0.0, -0.01, min(max(d.x, d.y), 0.0) + length(max(d,0.0)));\n}\n\nfloat circle(vec2 p, float size) {\n    float d = length(p) - size;\n    return smoothstep(0.0, -0.01, d);\n}\n\nvoid main() {\n    vec3 color = vec3(0);\n    float alpha = 1.0;\n\n    if (uType < 0.5) {\n        // Image - triangle\n        float outerTri = triangle(vUv - vec2(0.5, 0.5), 0.4);\n        float innerTri = mix(0.0, triangle(vUv - vec2(0.5, 0.45), 0.23), uFound);\n        color += outerTri - innerTri;\n    } else if (uType > 1.5) {\n        // Behind the scenes - circle\n        float outerCirc = circle(vUv - vec2(0.5, 0.5), 0.45);\n        float innerCirc = mix(0.0, circle(vUv - vec2(0.5, 0.5), 0.33), uFound);\n        color += outerCirc - innerCirc;\n    } else {\n        // Video - square\n        float outerRect = rect(vUv - vec2(0.5, 0.5), 0.4);\n        float innerRect = mix(0.0, rect(vUv - vec2(0.5, 0.5), 0.29), uFound);\n        color += outerRect - innerRect;\n    }\n    \n    color *= uFade;\n    // alpha *= uFade;\n\n    gl_FragColor = vec4(color, alpha);\n}\n    "},mn={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec2 uv;\nattribute vec3 position;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec2 uResolution;\nuniform float uRatio;\nuniform float uHover;\n\nvarying vec2 vUv;\n\nmat4 billboardMatrix(mat4 inMat4) {\n    mat4 outMat4 = inMat4;\n    outMat4[0][0] = 1.0;\n    outMat4[0][1] = 0.0;\n    outMat4[0][2] = 0.0;\n    outMat4[1][0] = 0.0;\n    outMat4[1][1] = 1.0;\n    outMat4[1][2] = 0.0;\n    outMat4[2][0] = 0.0;\n    outMat4[2][1] = 0.0;\n    outMat4[2][2] = 1.0;\n    return outMat4;\n}\n\nvoid main() {\n    vUv = uv;\n    vec3 pos = position;\n\n    pos *= 240.0 / uResolution.y;\n\n    vec4 clipPos = projectionMatrix * billboardMatrix(modelViewMatrix) * vec4(pos, 1);\n    pos.z -= pow(clipPos.x, 2.0) * 0.01 * 0.5 * mix(0.5, 1.0, smoothstep(0.5, 1.0, uRatio));\n    pos.z -= pow(clipPos.y, 2.0) * 0.002 * 0.5;\n\n    pos.z += mix(0.0, 0.15, uHover);\n\n    gl_Position = projectionMatrix * billboardMatrix(modelViewMatrix) * vec4(pos, 1);\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D tFont;\nuniform float uFade;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vec3 color = vec3(1);\n    float alpha = 1.0;\n\n    vec3 tex = texture2D(tFont, vUv).rgb;\n    float signedDist = max(min(tex.r, tex.g), min(max(tex.r, tex.g), tex.b)) - 0.5;\n    float d = 0.001;\n    alpha *= smoothstep(-d, d, signedDist);\n\n    if (alpha < 0.01) discard;\n    alpha *= uFade;\n\n    color *= alpha;\n\n    gl_FragColor = vec4(color, alpha);\n}\n    "},fn={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec2 uv;\nattribute vec3 position;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec2 uResolution;\nuniform float uRatio;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    vec3 pos = position;\n\n    vec4 clipPos = projectionMatrix * modelViewMatrix * vec4(pos, 1);\n    pos.z -= pow(clipPos.x, 2.0) * 0.01 * 0.5 * mix(0.5, 1.0, smoothstep(0.5, 1.0, uRatio));\n    pos.z -= pow(clipPos.y, 2.0) * 0.002 * 0.5;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1);\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform float uFade;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vec3 color = vec3(1);\n    float alpha = 0.2;\n\n    alpha *= uFade;\n    if (alpha < 0.01) discard;\n\n    color *= alpha;\n\n    gl_FragColor = vec4(color, alpha);\n}\n    "},vn=[{id:"01",release:"A1",title:"Arrival",code:"91823gr",ext:"mp4",controls:!0},{id:"02",release:"A2",title:"Child",code:"l109jfs1",ext:"mp4",desc:"Human embryo. Appears to have been artificially gestated using non-human surrogate."},{id:"03",release:"A3",title:"Home",code:"87gff2fd",ext:"jpg",audio:"assets/audio/content-5.mp3",desc:"Small, portable domicile capable of expanding rapidly to create shelter from the elements."},{id:"04",release:"A4",title:"Wolf",code:"o0189h",ext:"mp4",controls:!0},{id:"05",release:"A5",title:"Weapon",code:"kfsf1123",ext:"mp4",desc:"Androids are not hostile unless they are programmed to be."},{id:"06",release:"A6",title:"Bones",code:"ao1f3d",ext:"mp4",desc:"Remains of extinct, indigenous reptile. Carbo vegetables appear to grow in soil where bones are buried."},{id:"07",release:"A7",title:"Mother",code:"vqi82m",ext:"jpg",audio:"assets/audio/content-6.mp3",desc:"Android model unknown. Anti-social behavior observed. Possesses long range acoustics. Do not approach."},{id:"08",release:"A8",title:"Father",code:"lqpidsfw",ext:"jpg",audio:"assets/audio/content-7.mp3",desc:"2135 generic service model. Programmed for human caregiving and home security."},{id:"09",release:"A9",title:"Marcus",code:"9h23rfds",ext:"jpg",audio:"assets/audio/content-5.mp3",desc:"Unknown human visitor detected. Facial recognition and biometric recognition are not in sync. Highly unusual."},{id:"10",release:"A10",title:"Creator",code:"8ihfuwe",ext:"mp4",controls:!0,bts:!0},{id:"11",release:"B1",title:"Scream",code:"18932ub",ext:"mp4",desc:"Even an indirect hit from a Necromancer instantly results in tumors, burns, rapid deterioration of cells, and in some cases, complete vaporization."},{id:"12",release:"B2",title:"Eyes",code:"p1nfus",ext:"mp4",desc:"Ocular units are standard / interchangeable on all android models."},{id:"13",release:"B3",title:"Sketch",code:"jiufw9e",ext:"mp4",controls:!0,bts:!0},{id:"14",release:"B4",title:"Health",code:"qwdf823",ext:"mp4",desc:"Life technician. Able to repair humans, androids and most terrestrial insects."},{id:"15",release:"B5",title:"Family",code:"hfd8s91",ext:"jpg",audio:"assets/audio/content-6.mp3",downloadText:"Access",downloadLink:"https://www.hbomax.com/raised-by-wolves/character-guide",desc:"In the absence of human parental figures, androids have been programmed to act as surrogates."},{id:"16",release:"B6",title:"Self",code:"xzag3f",ext:"mp4",desc:'Source: Combat Medical Guidebook "Pre-emptive bandage removal may cause pain, swelling, or irreparable epidermal damage."'},{id:"17",release:"B7",title:"Tech",code:"bywf234",ext:"mp4",controls:!0,bts:!0},{id:"18",release:"B8",title:"Aid",code:"q92ikfp",ext:"jpg",audio:"assets/audio/content-7.mp3",desc:"Medical tool kit used in severe cosmetic procedures."},{id:"19",release:"B9",title:"Podcast",code:"e9qmfd",ext:"mp4",bts:!0,downloadText:"Listen",downloadLink:"https://www.hbomax.com/raised-by-wolves",desc:"Audio excerpt from Peter Haas, Professor and the Co-Director of the Humanity Centered Robotics Initiative at Brown University. New Episodes Thursdays."},{id:"20",release:"B10",title:"Creature",code:"02hfjwd",ext:"mp4",desc:"Unidentified lifeform. Appears to have female mammalian similarities. Potentially hostile."},{id:"21",release:"C1",title:"Helmet",code:"l1239hf",ext:"jpg",audio:"assets/audio/content-7.mp3",desc:"Mobile prison unit. Tampering with the helmet or its android guard will result in cranial compression and death."},{id:"22",release:"C2",title:"Faith",code:"ulfd82d",ext:"mp4",controls:!0},{id:"23",release:"C3",title:"Comic",code:"dd8guf",ext:"jpg",audio:"assets/audio/content-6.mp3",downloadText:"Read Now",downloadLink:"https://www.hbomax.com/static/HBOMAX_Raised_by_Wolves_Comic.pdf",desc:"Necromancer historical record uncovered. Technical specs encrypted. Read for more information."},{id:"24",release:"C4",title:"Ark",code:"loihfd9",ext:"mp4",desc:"Ark is outfitted with stasis pods intended for long-distance space travel."},{id:"25",release:"C5",title:"Destruction",code:"z98hsd",ext:"mp4",desc:'Lifeforms undetected. Transmission from post-war Earth. Location: "Boston"'},{id:"26",release:"C6",title:"Wear",code:"owpfds2",ext:"mp4",controls:!0,bts:!0},{id:"27",release:"C7",title:"Order",code:"ao20r1",ext:"jpg",audio:"assets/audio/content-5.mp3",desc:"Traditional Mithraic garb. Outfitted for war, combat, and spiritual practice."},{id:"28",release:"C8",title:"Necromancer",code:"i3jbjfs",ext:"mp4",controls:!0,bts:!0},{id:"29",release:"C9",title:"Temple",code:"2ikbf9e",ext:"mp4",desc:"Rock-like structure of unknown origin. Gives off varying levels of heat intermittently. Approach with caution."},{id:"30",release:"C10",title:"Future",code:"29jfd83",ext:"mp4",controls:!0},{id:"31",release:"EE",title:"Bonus",code:"kore923",ext:"jpg",audio:"assets/audio/content-7.mp3",desc:"Tarantula: Large ship capable of transporting [REDACTED]. Approach with caution. Energy signature unknown. Inhabitants currently unidentified."}];function gn(){return vn}var wn=[function({World:e,Emitter:t,State:n,Tick:i,Animate:r,Mouse:o,PBRProgram:a,ogl:s}){const{Geometry:l,Program:u,Plane:c,TextureLoader:d,Mesh:h,Raycast:p,Vec2:m,Text:f}=s,v=this,g=e.gl,w=e.COLS,x=e.ROWS,y=e.SIZE,_=w*y,b=x*y,M=e.CLICK_RADIUS,A=gn(),E=new m,T=new m;this.match={groupName:"Items"};const S=[],L=[];let R,F,C,P,k=-1,O=0,I=null;function D({isInitial:n}){for(let i=O;i<WOLVES_PROGRESS.clicks.length;i+=2){O+=2;const o=WOLVES_PROGRESS.clicks[i],a=WOLVES_PROGRESS.clicks[i+1];E.set(o,a),S.forEach((i,o)=>{if(i.isUncovered)return;T.set(i.initialX*y,i.initialZ*y);if(Math.max(Math.abs(T.x),Math.abs(T.y))>e.ZONE)return;E.x-T.x>.5*_&&(T.x+=_),T.x-E.x>.5*_&&(T.x-=_),E.y-T.y>.5*b&&(T.y+=b),T.y-E.y>.5*b&&(T.y-=b);E.distance(T)>M||(i.isUncovered=!0,L.push(i.shape),n||t.emit("wolves-update-uncovered",{index:o}),v.isActive&&(new r(i.shape.program.uniforms.uFade,500,{value:1}),i.title&&new r(i.title.program.uniforms.uFade,500,{value:1}),i.line&&new r(i.line.program.uniforms.uFade,500,{value:1})))})}}function N({contentHover:e}){e>-1?(new r(I.shape.program.uniforms.uHover,500,{value:1}),new r(I.title.program.uniforms.uHover,500,{value:1})):I&&(new r(I.shape.program.uniforms.uHover,500,{value:0}),new r(I.title.program.uniforms.uHover,500,{value:0}))}function U(){n.link("view",B)}function B({view:e}){const t="map"===e;v.isActive!==t&&(v.isActive=t,v.isActive?S.forEach(e=>{e.isUncovered&&(new r(e.shape.program.uniforms.uFade,500,{value:1}),e.title&&new r(e.title.program.uniforms.uFade,500,{value:1}),e.line&&new r(e.line.program.uniforms.uFade,500,{value:1}))}):S.forEach(e=>{new r(e.shape.program.uniforms.uFade,500,{value:0}),e.title&&new r(e.title.program.uniforms.uFade,500,{value:0}),e.line&&new r(e.line.program.uniforms.uFade,500,{value:0})}))}function z(){if(!v.isActive)return;if(k<0)return;const e=k;A[e].isFound||(A[e].isFound=!0,WOLVES_PROGRESS.found.push(e),t.emit("wolves-update-found",{index:e}),new r(S[e].shape.program.uniforms.uFound,500,{value:1}),function(e,t,n){e.title.setParent(null);const{isFound:i,ext:r,title:o}=n;G(i,t,r,e,o)}(S[e],e,A[e])),t.emit("viewer-open",{index:e}),window.dataLayer.push({event:"rbw_map_click_item",name:A[e].title,section:"map",mapped_percentage:WOLVES_PROGRESS.percentage+"% mapped"})}function V(t,n){const{isFound:i,ext:r,code:o,title:a,release:s,bts:l}=A[n];o&&(!function(t,n,i,r,o){const a=new c(g);a.raycast="sphere";const{vertex:s,fragment:l}=pn,d=new u(g,{vertex:s,fragment:l,uniforms:{uRatio:e.ratio,uTime:e.time,uResolution:e.resolution,uFade:{value:0},uFound:{value:t?1:0},uType:{value:"jpg"===i?0:o?2:1},uHover:{value:0}},depthTest:!1,depthWrite:!1});d.setBlendFunc(g.ONE,g.ONE);const p=new h(g,{geometry:a,program:d});p.rotation.x=-Math.PI/2,p.frustumCulled=!1,p.setParent(r),p.index=n,r.shape=p,p.node=r}(i,n,r,t,l),function(t,n,i,r){const o=new c(g,{heightSegments:10}),{vertex:a,fragment:s}=fn,l=new u(g,{vertex:a,fragment:s,uniforms:{uRatio:e.ratio,uTime:e.time,uResolution:e.resolution,uFade:{value:0}},depthTest:!1,depthWrite:!1,cullFace:null});l.setBlendFunc(g.ONE,g.ONE);const d=new h(g,{geometry:o,program:l});d.scale.set(.01,120,1),d.rotation.x=-Math.PI/2,d.frustumCulled=!1,d.setParent(r),r.line=d}(0,0,0,t),G(i,n,r,t,a,s),t.initialX=t.position.x/y,t.initialZ=t.position.z/y,t.position.y=.5,t.isUncovered=!1,t.isFound=i,S.push(t))}async function G(t,n,i,r,o,a){const s=t?o:a,c=await R,d=await C,p=new f({font:t?c:d,text:t?s.toUpperCase():s.toLowerCase(),align:"jpg"===i?"center":"left",letterSpacing:.05,size:t?1:2});for(let e=0;e<p.buffers.position.length;e+=3)"jpg"===i?p.buffers.position[e+1]-=3:(p.buffers.position[e+0]+=3,p.buffers.position[e+1]+=.5);const m=new l(g,{position:{size:3,data:p.buffers.position},uv:{size:2,data:p.buffers.uv},id:{size:1,data:p.buffers.id},index:{data:p.buffers.index}}),{vertex:v,fragment:w}=mn,x=new u(g,{vertex:v,fragment:w,uniforms:{uRatio:e.ratio,uTime:e.time,uResolution:e.resolution,uFade:{value:0},tFont:{value:t?F:P},uHover:{value:0}},depthTest:!1,depthWrite:!1});x.setBlendFunc(g.ONE,g.ONE);const y=new h(g,{geometry:m,program:x});y.frustumCulled=!1,y.rotation.x=-Math.PI/2,y.setParent(r),r.title=y}n.push({cursorItemHover:!1}),async function(){F=d.load(g,{src:WOLVES_CDN+"assets/fonts/RTAliasRough-Regular.png",generateMipmaps:!1}),P=d.load(g,{src:WOLVES_CDN+"assets/fonts/Untitled1.png",generateMipmaps:!1}),R=fetch(WOLVES_CDN+"assets/fonts/RTAliasRough-Regular.json").then(e=>e.json()),C=fetch(WOLVES_CDN+"assets/fonts/Untitled1.json").then(e=>e.json())}(),function(){if(t.on("interaction-start",U),t.on("click",z),t.on("wolves-update-clicks",D),e.isTouch)return;n.link("contentHover",N)}(),i.add((function(){if(!v.isActive)return;S.forEach((t,n)=>{const i=(e.mapPos.value.x-t.initialX)/w,r=(e.mapPos.value.y-t.initialZ)/x,o=i>0?Math.floor(i+.5):Math.ceil(i-.5),a=r>0?Math.floor(r+.5):Math.ceil(r-.5),s=o*w,l=a*x;t.position.x=(t.initialX+s)*y,t.position.z=(t.initialZ+l)*y}),function(){k=-1;const t=e.raycast.intersectBounds(L);if(!t.length)return n.push({contentHover:k});k=t[0].index,I=t[0].node,n.push({contentHover:k})}(),n.push({cursorItemHover:k>-1})})),this.add=e=>{e.children.forEach(V),D({isInitial:!0})},this.fallback=()=>{console.log("ItemsHandler not used")}}];class xn{constructor(){const e=this,t=ln.gl,n=new Te,i=new Te,r=new Te;let o=0;function s(){h.link("view",u)}function u({view:n}){const i="map"===n;e.isActive!==i&&(e.isActive=i,i?ln.isTouch?(t.canvas.addEventListener("touchstart",c),window.addEventListener("touchmove",d,!1),window.addEventListener("touchend",p,!1),window.addEventListener("touchcancel",p,!1)):(t.canvas.addEventListener("mousedown",c),window.addEventListener("mousemove",d,!1),window.addEventListener("mouseup",p,!1)):ln.isTouch?(t.canvas.removeEventListener("touchstart",c),window.removeEventListener("touchmove",d,!1),window.removeEventListener("touchend",p,!1),window.removeEventListener("touchcancel",p,!1)):(t.canvas.removeEventListener("mousedown",c),window.removeEventListener("mousemove",d,!1),window.removeEventListener("mouseup",p,!1)))}async function c(t){2!==t.button&&(ln.isTouch&&t.preventDefault(),e.isDown=!0,n.copy(l.pixel),i.copy(l.pixel),o=performance.now(),h.push({mapDown:!0,cursorDragging:!0}),r.set(0))}function d(){e.isDown&&(r.copy(l.pixel).sub(i).multiply(1/t.canvas.height),i.copy(l.pixel),a.emit("drag",{delta:r}))}function p(t){2!==t.button&&e.isDown&&(e.isDown=!1,h.push({mapDown:!1,cursorDragging:!1}),r.multiply(5),a.emit("drag",{delta:r}),n.distance(l.pixel)>50||performance.now()-o>500||a.emit("click"))}h.push({cursorDragging:!1}),window.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1}),a.on("interaction-start",s)}}var yn={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec3 position;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 projectionMatrix;\n\nuniform sampler2D tMap;\n\nuniform float uRatio;\nuniform float uTileSize;\nuniform vec2 uWorldPos;\nuniform vec2 uMapSize;\n\nvarying vec2 vUv;\nvarying vec2 vTilePos;\nvarying vec2 vPos;\n\nvoid main() {\n    vUv = uv;\n    vTilePos = vec2(modelMatrix[3][0], -modelMatrix[3][2]) / uTileSize;\n    vec4 pos = vec4(position, 1);\n\n    // For phase zone\n    // vPos = pos.xy * uTileSize;\n    vPos = pos.xy * uTileSize + vec2(modelMatrix[3][0], -modelMatrix[3][2]) + uWorldPos * uTileSize * vec2(1.0, -1.0);\n    // Treadmill the position\n    vec2 diff = vPos / uMapSize;\n    vec2 diffStep = floor(diff) + step(vec2(0.5), fract(diff));\n    vPos -= diffStep * uMapSize;\n\n    // Treadmill the position\n    // Get scroll diff from point, in mapSize amounts\n    // vec2 diff = (uMapPos * uTileSize - pos.xz) / uMapSize;\n    // vec2 diffStep = floor(diff) + step(vec2(0.5), fract(diff));\n    // pos.xz += diffStep * uMapSize;\n\n    // vPos = vec2(modelMatrix[3][0], -modelMatrix[3][2]);\n\n    float displacement = texture2D(tMap, vUv).g;\n    pos.z += displacement * 0.15 - 0.1;\n\n    vec4 clipPos = projectionMatrix * modelViewMatrix * pos;\n    pos.z -= pow(clipPos.x, 2.0) * 0.0005 * mix(0.5, 1.0, smoothstep(0.5, 1.0, uRatio));\n    pos.z -= pow(clipPos.y, 2.0) * 0.0001;\n\n    gl_Position = projectionMatrix * modelViewMatrix * pos;\n}\n  ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform float uTime;\nuniform vec2 uResolution;\n\nuniform sampler2D tMap;\n\nuniform sampler2D tFluid;\nuniform sampler2D tClouds;\nuniform sampler2D tCoverClouds;\nuniform sampler2D tReveal;\nuniform sampler2D tNoise;\nuniform sampler2D tGradient;\nuniform vec2 uWorldPos;\nuniform float uSteps;\nuniform float uLoading;\nuniform float uZone;\n\nvarying vec2 vUv;\nvarying vec2 vTilePos;\nvarying vec2 vPos;\n// varying vec3 vNormal;\n// varying vec4 vMPos;\n// varying vec4 vMVPos;\n\nfloat blendOverlay(float base, float blend) {\n\treturn base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend));\n}\n\nvec3 blendOverlay(vec3 base, vec3 blend) {\n\treturn vec3(blendOverlay(base.r, blend.r), blendOverlay(base.g, blend.g), blendOverlay(base.b, blend.b));\n}\n\nvec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n\treturn (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n}\n\nvoid randomClouds(vec2 uvClouds, inout vec3 color, vec3 fluid, float height) {\n    uvClouds -= fluid.rg * 0.0001;\n\n    vec2 t = 1.5 * uTime * vec2(0.02, 0.01);\n    vec2 uvCloudsWhite = 0.8 * (uvClouds + t);\n    vec2 uvCloudsShadow = 0.8 * ((uvClouds + vec2(0.1, 0.0)) + t);\n\n    vec3 clouds = texture2D(tClouds, uvCloudsWhite).rgb;\n    float cloudAlpha = clouds.g * 0.5;\n    \n    color = mix(color, clouds, cloudAlpha * smoothstep(0.7, 0.2, height));\n}\n\nvoid coverClouds(vec2 uvClouds, inout vec3 color, vec3 fluid, float height, vec3 reveal) {\n\n    uvClouds -= fluid.rg * 0.0002;\n\n    vec3 clouds = texture2D(tCoverClouds, 0.3 * (uvClouds + uTime * vec2(0.02, 0.005))).rgb * 0.8 + 0.2;\n    // clouds *= vec3(0.348, 0.376, 0.385) * 4.0;//colour\n    float cloudAlpha = clouds.g * 0.9 + 0.3;\n    cloudAlpha *= smoothstep(1.3, 0.9, cloudAlpha);\n    // clouds = pow(clouds, vec3(1.5)) + 0.1;\n\n    // vec2 uvReveal = vUv;\n    // uvReveal -= fluid.rg * 0.0002;\n    // float dist = length(uvReveal - 0.5);\n    // cloudAlpha *= smoothstep(0.2, 0.3, dist) * (1.0 + 0.5 * smoothstep(0.31, 0.25, dist));\n    cloudAlpha *= 1.0 - reveal.g;\n\n    color = mix(color, clouds, cloudAlpha * 0.9 * smoothstep(0.6, 0.3, height));\n}\n\nvoid addNoise(inout vec3 color, float range) {\n    // vec2 uvNoise = gl_FragCoord.xy / (300.0);\n    vec2 uvNoise = vUv * 9.0;\n\n    //jitter the noise but not every frame\n    float tick = floor(fract(uTime) * 15.0);\n    vec2 jitter = vec2(\n        mod(tick * 382.0231, 21.321),\n        mod(tick * 122.0142, 31.243)\n    );\n\n    uvNoise += jitter;\n    float noise = texture2D(tNoise, uvNoise).g;\n    color = blendOverlay(color, vec3(noise), 0.5);\n    // color = blendOverlay(color, vec3(noise), range * 0.5);\n    color = mix(color, color * smoothstep(0.0, 0.8, noise), 0.2);\n}\n\nvoid main() {\n    vec2 uvStepped = ceil(vUv * uSteps) / uSteps;\n    vec2 uv = mix(vUv, uvStepped, uLoading);\n\n    // Phase zone\n    float zone = smoothstep(uZone, uZone - 2.0, max(abs(vPos.x), abs(vPos.y)));\n    uv = mix(ceil(vUv * 128.0) / 128.0, uv, zone);\n\n    vec2 data = texture2D(tMap, uv).rg;\n\n    float range = pow(data.r * 1.2, 3.0);\n    range = min(1.0, range);\n\n    float alpha = 1.0;\n\n    float height = data.g;\n\n    // float height = map.a;\n    // color += map.rgb;\n\n    vec2 uvScreen = gl_FragCoord.xy / (uResolution * 0.5);\n    vec3 fluid = texture2D(tFluid, uvScreen).rgb;\n    uvScreen -= fluid.rg * 0.0002;\n    vec3 reveal = texture2D(tReveal, uvScreen).rgb;\n\n\n    vec3 colorFound = texture2D(tGradient, vec2(range, 0.0)).rgb;\n    vec3 colorCover = texture2D(tGradient, vec2(range, 1.0)).rgb;\n    vec3 color = mix(colorCover, colorFound, reveal);\n    // vec3 color = colorFound;\n    // vec3 color = vec3(data.g);\n\n\n    vec2 uvClouds = vUv;\n    uvClouds += vTilePos + uWorldPos * vec2(1.0, -1.0) * 1.1;\n\n    addNoise(color, range);\n\n    randomClouds(uvClouds, color, fluid, height);\n    coverClouds(uvClouds, color, fluid, height, reveal);\n\n\n    gl_FragColor = vec4(color, 1.0);\n}\n    "};class _n{constructor(){const t=ln.gl,n=[],i=[],r=ln.COLS,a=ln.ROWS,s=ln.SIZE,l=new Se(t,{widthSegments:100,heightSegments:100}),{vertex:u,fragment:c}=yn;let d;function h(e){const i=Ot.load(t,{src:{s3tc:WOLVES_CDN+`assets/images/compressed-tiles/64/64_${m.padInt(e+1,2)}-s3tc.ktx`,jpg:WOLVES_CDN+`assets/images/tiles/64/64_${m.padInt(e+1,2)}.jpg`},magFilter:t.NEAREST,minFilter:t.NEAREST});n[e]=i,i.loadHiRes=async()=>{i.loadHiRes=null;const r=Ot.load(t,{src:{s3tc:WOLVES_CDN+`assets/images/compressed-tiles/1024/1024_${m.padInt(e+1,2)}-s3tc.ktx`,jpg:WOLVES_CDN+`assets/images/tiles/1024/1024_${m.padInt(e+1,2)}.jpg`}});await r.loaded,n[e]=r,r.textureLoading=!0,r.textureSteps=64,new o(r,1e3,{textureSteps:2048,ease:"inCubic",complete:()=>{r.textureLoading=!1}})}}function p(e,o){const u=new ce(t,{geometry:l,program:d});u.setParent(ln.mapScene),u.rotation.x=-Math.PI/2,u.scale.set(s+.1),u.tileX=e,u.tileZ=o,u.initialX=e-.5*r+.5,u.initialZ=o-.5*a+.5,u.position.x=u.initialX*s,u.position.z=u.initialZ*s,u.texture={value:n[0]},u.textureLoading=0,u.textureSteps=64,u.onBeforeRender(()=>{d.uniforms.tMap=u.texture,d.uniforms.uLoading.value=u.textureLoading,d.uniforms.uSteps.value=u.textureSteps}),i.push(u)}!function(){for(let e=0;e<r*a;e++)h(e);n[12].loadHiRes&&n[12].loadHiRes()}(),d=new k(t,{vertex:u,fragment:c,uniforms:{uTime:ln.time,uResolution:ln.resolution,uRatio:ln.ratio,tMap:{value:n[0]},uSteps:{value:64},uLoading:{value:0},uTileSize:{value:s},uWorldPos:ln.mapPos,uMapSize:ln.mapSize,uZone:{value:ln.ZONE},tReveal:ln.revealUniform,tFluid:ln.fluidMask,tCoverClouds:{value:Ot.load(t,{src:WOLVES_CDN+"assets/images/noise/clouds.jpg",wrapS:t.REPEAT,wrapT:t.REPEAT})},tClouds:{value:Ot.load(t,{src:WOLVES_CDN+"assets/images/noise/difference-clouds.jpg",wrapS:t.REPEAT,wrapT:t.REPEAT})},tNoise:{value:Ot.load(t,{src:WOLVES_CDN+"assets/images/noise/blue.png",wrapS:t.REPEAT,wrapT:t.REPEAT,generateMipmaps:!1})},tGradient:{value:Ot.load(t,{src:WOLVES_CDN+"assets/images/map-gradient.jpg"})}}}),function(){for(let e=0;e<3;e++)for(let t=0;t<3;t++)p(t,e)}(),e.add((function(){i.forEach((e,t)=>{const i=(ln.mapPos.value.x-e.initialX)/3,o=(ln.mapPos.value.y-e.initialZ)/3,l=i>0?Math.floor(i+.5):Math.ceil(i-.5),u=o>0?Math.floor(o+.5):Math.ceil(o-.5),c=3*l,d=3*u;e.position.x=(e.initialX+c)*s,e.position.z=(e.initialZ+d)*s;const h=m.mod(e.tileX+3*l,r),p=m.mod(e.tileZ+3*u,a),f=n[p*r+h];var v;e.texture.value=f,f.loadHiRes&&f.loadHiRes(),e.textureLoading=f.textureLoading?1:0,f.textureSteps&&(e.textureSteps=(v=f.textureSteps,1<<31-Math.clz32(v)))})}))}}var bn={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec2 position;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nuniform float uSize;\nuniform vec2 uMapSize;\nuniform vec2 uMapPos;\nuniform float uTileSize;\nuniform float uRatio;\n\nvoid main() {\n    vec3 pos = vec3(position.x, 0.1, position.y);\n\n    // Treadmill the position\n    // Get scroll diff from point, in mapSize amounts\n    vec2 diff = (uMapPos * uTileSize - pos.xz) / uMapSize;\n    vec2 diffStep = floor(diff) + step(vec2(0.5), fract(diff));\n    pos.xz += diffStep * uMapSize;\n\n    vec4 clipPos = projectionMatrix * modelViewMatrix * vec4(pos, 1);\n    pos.y -= pow(clipPos.x, 2.0) * 0.01 * 0.5 * mix(0.5, 1.0, smoothstep(0.5, 1.0, uRatio));\n    pos.y -= pow(clipPos.y, 2.0) * 0.002 * 0.5;\n    \n    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1);\n    gl_PointSize = uSize;\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform float uTime;\nuniform float uFade;\n\nvoid main() {\n    vec3 color = vec3(0);\n    float alpha = 1.0;\n\n    vec2 uv = gl_PointCoord.xy;\n    float dist = length(uv - 0.5);\n    float a = 0.001;\n    float r = 0.5;\n    float outer = smoothstep(r, r - a, dist);\n    color += outer;\n    color *= 0.8;\n    color *= uFade;\n\n    gl_FragColor = vec4(color, alpha);\n}\n    "},Mn={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec2 position;\nattribute vec2 uv;\nattribute vec2 offset;\nattribute float transition;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec2 uMapSize;\nuniform vec2 uMapPos;\nuniform float uTileSize;\nuniform float uRatio;\n\nvarying vec2 vUv;\nvarying float vTransition;\n\nvoid main() {\n    vUv = uv;\n    vTransition = transition;\n    vec3 pos = vec3(position.x, 1.5, -position.y);\n    pos.xz *= 7.0;\n\n    // Treadmill the position\n    vec2 treadmill = offset;\n    // Get scroll diff from point, in mapSize amounts\n    vec2 diff = (uMapPos * uTileSize - treadmill) / uMapSize;\n    vec2 diffStep = floor(diff) + step(vec2(0.5), fract(diff));\n    treadmill += diffStep * uMapSize;\n\n    pos.xz += treadmill;\n    // pos.xz += offset;\n\n    vec4 clipPos = projectionMatrix * modelViewMatrix * vec4(pos, 1);\n    pos.y -= pow(clipPos.x, 2.0) * 0.01 * 0.5 * mix(0.5, 1.0, smoothstep(0.5, 1.0, uRatio));\n    pos.y -= pow(clipPos.y, 2.0) * 0.002 * 0.5;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1);\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform float uTime;\nuniform float uFade;\n\nvarying vec2 vUv;\nvarying float vTransition;\n\nvoid main() {\n    vec3 color = vec3(0);\n    float alpha = 1.0;\n\n    float dist = length(vUv - 0.5);\n    float a = 0.001;\n    float t = 0.002;\n    float r = mix(0.2, 0.5, vTransition);\n    float outer = smoothstep(r, r - a, dist);\n    float inner = smoothstep(r - t, r - t + a, dist);\n    color += outer * inner;\n\n    color *= 0.2;\n\n    color *= uFade;\n\n    if (color.g < 0.001) discard;\n\n    gl_FragColor = vec4(color, alpha);\n}\n    "},An={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec2 position;\nattribute vec2 uv;\nattribute vec2 offset;\nattribute float transition;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 projectionMatrix;\nuniform vec2 uMapSize;\nuniform vec2 uMapPos;\nuniform float uTileSize;\n\nvarying vec2 vUv;\nvarying vec2 vPos;\nvarying float vTransition;\n\nvoid main() {\n    vUv = uv;\n    vTransition = transition;\n    vec3 pos = vec3(position.x, 0.0, -position.y);\n    pos.xz *= 7.0;\n\n    // Treadmill the position\n    vec2 treadmill = offset;\n    // Get scroll diff from point, in mapSize amounts\n    vec2 diff = (uMapPos * uTileSize - treadmill) / uMapSize;\n    vec2 diffStep = floor(diff) + step(vec2(0.5), fract(diff));\n    treadmill += diffStep * uMapSize;\n\n    vPos = pos.xz + offset;\n\n    pos.xz += treadmill;\n    // pos.xz += offset;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1);\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform float uTime;\nuniform float uFade;\nuniform float uZone;\n\nvarying vec2 vUv;\nvarying vec2 vPos;\nvarying float vTransition;\n\nvoid main() {\n    vec3 color = vec3(0);\n    float alpha = 1.0;\n\n    float dist = length(vUv - 0.5);\n    float a = 0.1;\n    float r = mix(0.2, 0.5, vTransition);\n    float outer = smoothstep(r, r - a, dist);\n    color += outer;\n    color *= uFade;\n\n    // Phase\n    // color *= smoothstep(uZone, uZone - 1.0, max(abs(vPos.x), abs(vPos.y)));\n\n    if (color.g < 0.001) discard;\n\n    gl_FragColor = vec4(color, alpha);\n}\n    "};class En{constructor(){const t=this,n=ln.gl,i=ln.COLS,r=ln.ROWS,s=ln.SIZE,l=200,u=200;let c,d,p;const f=[],v=new Te,g={position:new Float32Array(400),index:0},w="ontouchstart"in window;function x(){f[0].scale.set(25*ln.ratio.value,25,1),f[0].updateMatrixWorld()}function y(){h.link("view",_)}function _({view:e}){const n="map"===e;t.isActive!==n&&(t.isActive=n,t.isActive?(new o(p.program.uniforms.uFade,500,{value:1}),new o(c.program.uniforms.uFade,500,{value:1}),new o(d.program.uniforms.uFade,500,{value:1})):(new o(p.program.uniforms.uFade,500,{value:0}),new o(c.program.uniforms.uFade,500,{value:0}),new o(d.program.uniforms.uFade,500,{value:0})))}function b(){if(h.data.contentHover>-1)return;const e=ln.raycast.intersectMeshes(f,{includeNormal:!1});if(!e.length)return;let t=e[0].hit.point.x-ln.mapScene.position.x,n=e[0].hit.point.z-ln.mapScene.position.z;const o=i*s,l=r*s;t=m.mod(t+.5*o,o)-.5*o,n=m.mod(n+.5*l,l)-.5*l,v.set(t,n);Math.max(Math.abs(v.x),Math.abs(v.y))>ln.ZONE?a.emit("click_inaccessible"):(M(t,n),WOLVES_PROGRESS.clicks.push(t,n),a.emit("wolves-update-clicks"),window.dataLayer.push({event:"rbw_map_click",mapped_percentage:WOLVES_PROGRESS.percentage+"% mapped"}))}function M(e,t){const n=d.geometry.attributes.position,i=c.geometry.attributes.offset,r=p.geometry.attributes.offset,a=c.geometry.attributes.transition,s=p.geometry.attributes.transition;g.position.set([e,t],2*g.index%400),n.data.set([e,t],2*g.index%400),i.data.set([e,t],2*g.index%10),r.data.set([e,t],2*g.index%400),a.data[g.index%5]=0,s.data[g.index%u]=0,n.needsUpdate=!0,i.needsUpdate=!0,r.needsUpdate=!0,a.needsUpdate=!0,s.needsUpdate=!0;const h=g.index,m={x:0};new o(m,500,{x:1,update:()=>{a.data[h%5]=m.x,s.data[h%u]=m.x,a.needsUpdate=!0,s.needsUpdate=!0}}),g.index++,1===g.index&&(d.visible=!0,c.visible=!0,p.visible=!0),d.geometry.drawRange.count=Math.min(g.index,l),c.geometry.instancedCount=Math.min(g.index,5),p.geometry.instancedCount=Math.min(g.index,u)}h.push({cursorInaccessible:!1}),function(){const e=new Se(n,{widthSegments:10,heightSegments:10}),t=e.attributes.position;for(let e=0;e<t.count;e++){const n=4*t.data[3*e+0],i=4*t.data[3*e+1],r=1-1*Math.pow(n,2)-.08*Math.pow(i,2);t.data[3*e+2]=r}t.needsUpdate=!0;const i=new yt(n),r=new ce(n,{geometry:e,program:i,mode:n.LINES});r.rotation.x=-Math.PI/2,f.push(r)}(),function(){const e=new Float32Array(400),t=new F(n,{position:{size:2,data:e}}),{vertex:i,fragment:r}=bn,o=new k(n,{vertex:i,fragment:r,uniforms:{uRatio:ln.ratio,uSize:{value:3*ln.dpr},uMapSize:ln.mapSize,uMapPos:ln.mapPos,uTileSize:{value:s},uFade:{value:0}}});o.setBlendFunc(n.ONE,n.ONE),d=new ce(n,{geometry:t,program:o,mode:n.POINTS}),d.setParent(ln.uiScene),d.frustumCulled=!1,t.drawRange.count=0,d.visible=!1}(),function(){const e=new Le(n),t=new Float32Array(10),i=new Float32Array(5);e.addAttribute("offset",{instanced:1,size:2,data:t}),e.addAttribute("transition",{instanced:1,size:1,data:i});const{vertex:r,fragment:o}=Mn,a=new k(n,{vertex:r,fragment:o,uniforms:{uRatio:ln.ratio,uMapSize:ln.mapSize,uMapPos:ln.mapPos,uTileSize:{value:s},uFade:{value:0}},depthTest:!1,depthWrite:!1});a.setBlendFunc(n.ONE,n.ONE),c=new ce(n,{geometry:e,program:a}),c.setParent(ln.uiScene),c.frustumCulled=!1,e.instancedCount=0,c.visible=!1}(),function(){const e=new Le(n),t=new Float32Array(400),i=new Float32Array(200);e.addAttribute("offset",{instanced:1,size:2,data:t}),e.addAttribute("transition",{instanced:1,size:1,data:i});const{vertex:r,fragment:o}=An,a=new k(n,{vertex:r,fragment:o,uniforms:{uMapSize:ln.mapSize,uMapPos:ln.mapPos,uTileSize:{value:s},uFade:{value:0},uZone:{value:ln.ZONE}},depthTest:!1,depthWrite:!1});a.setBlendFunc(n.ONE,n.ONE),p=new ce(n,{geometry:e,program:a}),p.setParent(ln.revealScene),p.frustumCulled=!1,e.instancedCount=0,p.visible=!1}(),function(){for(let e=0;e<WOLVES_PROGRESS.clicks.length;e+=2){M(WOLVES_PROGRESS.clicks[e],WOLVES_PROGRESS.clicks[e+1])}}(),a.on("resize",x),x(),a.on("interaction-start",y),a.on("click",b),w||e.add((function(){const e=ln.raycast.intersectMeshes(f,{includeNormal:!1});if(!e.length)return;let t=e[0].hit.point.x-ln.mapScene.position.x,n=e[0].hit.point.z-ln.mapScene.position.z;const o=i*s,a=r*s;t=m.mod(t+.5*o,o)-.5*o,n=m.mod(n+.5*a,a)-.5*a,v.set(t,n);const l=Math.max(Math.abs(v.x),Math.abs(v.y));h.push({cursorInaccessible:l>ln.ZONE})}),15)}}class Tn{constructor(t){const n=ln.gl,i=new E;function r({delta:e}){e&&(i.x+=25*e.x,i.z+=25*e.y)}e.add((function(){if(ln.controls.enabled)return;ln.mapScene.position.lerp(i,.2),ln.uiScene.position.copy(ln.mapScene.position),ln.revealScene.position.copy(ln.mapScene.position)})),a.on("drag",r),window.addEventListener("resize",r),async function(){new xn,new _n,new En;const e=await Jt.load(n,WOLVES_CDN+"assets/scene/001-map.glb");new hn(e,wn),a.emit("map-loaded")}()}}class Sn{constructor(e,t){const n=d.query(".footer-progress",t)[0],i=d.query(".count",n)[0],r=d.query(".mapped",n)[0],o=(d.query(".location",n)[0],ln.COLS*ln.SIZE),s=ln.ROWS*ln.SIZE,l=Math.ceil(o/1),u=Math.ceil(s/1),c=ln.CLICK_RADIUS;let h=WOLVES_PROGRESS.found.length;30===h&&h++;let p=10*e,m=0;const f=new Te,v=new Te,g=new Float32Array(l*u);let w=0,x=0;async function y(){i.innerHTML=`${h}/${p}`,r.innerHTML=m.toFixed(3)+"% MAPPED"}function _(){h=WOLVES_PROGRESS.found.length,y()}function b({isInitial:e}){for(let e=w;e<WOLVES_PROGRESS.clicks.length;e+=2){w+=2,f.set(WOLVES_PROGRESS.clicks[e],WOLVES_PROGRESS.clicks[e+1]);for(let e=0;e<g.length;e++){if(g[e])continue;const t=1*(e%l+.5)-.5*o,n=1*(Math.floor(e/l)+.5)-.5*s;v.set(t,n),f.x-v.x>.5*o&&(v.x+=o),v.x-f.x>.5*o&&(v.x-=o),f.y-v.y>.5*s&&(v.y+=s),v.y-f.y>.5*s&&(v.y-=s),Math.abs(f.x-v.x)>c||(Math.abs(f.y-v.y)>c||(g[e]=1,x++))}}x/g.length*100>m&&(m=x/g.length*100,y(),e||a.emit("wolves-update-mapped",{perc:m}),WOLVES_PROGRESS.percentage=m)}a.on("wolves-update-clicks",b),a.on("wolves-update-found",_),b({isInitial:!0}),y()}}var Ln={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec2 position;\nattribute vec2 uv;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = vec4(position, 0, 1);\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nvarying vec2 vUv;\n\nuniform float uTime;\nuniform vec2 uResolution;\nuniform sampler2D tImage;\nuniform float uImageRatio;\nuniform vec2 uMouse;\nuniform float uFade;\nuniform float uLoaded;\n\nvoid main() {\n    vec3 color = vec3(0);\n    float alpha = 1.0;\n\n    float ratio = (uResolution.x / uResolution.y) / uImageRatio;\n    vec2 uv = vUv - 0.5;\n    uv.x *= min(1.0, ratio);\n    uv.y *= min(1.0, 1.0 / ratio);\n    uv /= 1.1;\n    uv += 0.5;\n\n    // uv += uMouse * 0.1;\n    uv.x += uMouse.x * 0.5 * (1.0 - min(1.0, ratio));\n    uv.y += uMouse.y * 0.5 * (1.0 - min(1.0, 1.0 / ratio));\n\n    uv.x += uMouse.x * 0.05;\n    uv.y += uMouse.y * 0.05;\n\n    // if (uLoaded < 1.0) {\n    //     float steps = pow(2.0, floor(mix(5.0, 12.0, uLoaded)));\n    //     uv = ceil(uv * steps) / steps;\n    // }\n\n    color = texture2D(tImage, uv).rgb;\n    // color *= smoothstep(0.0, 0.1, uLoaded);\n    color *= uLoaded;\n\n    alpha *= uFade;\n\n    gl_FragColor = vec4(color, alpha);\n}\n    "};function Rn(e){const t=e.innerHTML;e.innerHTML="";const n=t.split("<br>"),i=[];n.forEach((e,t)=>{t&&i.push("<br>"),i.push(...e.split(" "))});const r=[];return i.forEach((t,n)=>{if("<br>"===t){const t=d.create("br");return void e.appendChild(t)}if(n&&"<br>"!==i[n-1]){const t=d.create("span","split-space");t.innerHTML="&nbsp",e.appendChild(t)}const o=d.create("span","split-word");o.innerHTML=t,r.push(o),e.appendChild(o)}),r}function Fn(e,t=1){e.forEach(async(e,n)=>{e.css({opacity:0}),await e.animate(1e3,{opacity:1,delay:150*n*t,ease:"inOutCubic"}).promise()})}class Cn{constructor(e){const t=this;let n=!1;const i=d.create("div","viewer-loader"),r=d.create("div","loader-text"),o=d.create("div","spinner");r.innerHTML="\n            SYS<br>\n            <br>\n            OBJECT: SDF-6F<br>\n            <br>\n            SCAN<br>\n            IN PROGRESS<br>\n            <br>\n            <br>\n            loading\n        ",o.innerHTML='\n<svg \n    xmlns="http://www.w3.org/2000/svg"\n    width="100"\n    height="100"\n    viewBox="0 0 100 100" \n    stroke="none"\n    fill="white"\n>\n    <circle cx="50" cy="50" r="6" transform="rotate(0, 50, 50) translate(0, 25)"/>\n    <circle cx="50" cy="50" r="5" transform="rotate(45, 50, 50) translate(0, 25)"/>\n    <circle cx="50" cy="50" r="6" transform="rotate(90, 50, 50) translate(0, 25)"/>\n    <circle cx="50" cy="50" r="5" transform="rotate(135, 50, 50) translate(0, 25)"/>\n    <circle cx="50" cy="50" r="6" transform="rotate(180, 50, 50) translate(0, 25)"/>\n    <circle cx="50" cy="50" r="5" transform="rotate(225, 50, 50) translate(0, 25)"/>\n    <circle cx="50" cy="50" r="6" transform="rotate(270, 50, 50) translate(0, 25)"/>\n    <circle cx="50" cy="50" r="5" transform="rotate(315, 50, 50) translate(0, 25)"/>\n</svg>\n        ',i.appendChild(r),i.appendChild(o);const s=d.create("div","viewer-info"),u=d.create("div","order"),c=d.create("div","title"),p=d.create("div","description"),f=d.create("div","viewer-player"),v=d.create("button","play-toggle"),g=d.create("button","mute-toggle"),w=d.create("div","timeline"),x=d.create("div","progress");function y(e){e.preventDefault(),w.rect=w.getBoundingClientRect(),ln.isTouch?(window.addEventListener("touchmove",_,!1),window.addEventListener("touchend",b,!1),window.addEventListener("touchcancel",b,!1)):(window.addEventListener("mousemove",_,!1),window.addEventListener("mouseup",b,!1)),M()}function _(e){M()}function b(e){ln.isTouch?(window.removeEventListener("touchmove",_,!1),window.removeEventListener("touchend",b,!1),window.removeEventListener("touchcancel",b,!1)):(window.removeEventListener("mousemove",_,!1),window.removeEventListener("mouseup",b,!1))}function M(){const e=m.map(l.pixel.x,w.rect.left,w.rect.right,0,1,!0);t.onScrub&&t.onScrub(e)}function A(){t.isLoaded||(t.isLoaded=!0,i.parentNode&&i.parentNode.removeChild(i),e.appendChild(s),Fn(c.words))}v.innerText="Pause",g.innerText="Mute",s.appendChild(u),s.appendChild(c),s.appendChild(p),s.appendChild(f),f.appendChild(v),f.appendChild(g),f.appendChild(w),w.appendChild(x),a.on("viewer-loaded",A),g.addEventListener("click",()=>t.onMute&&t.onMute()),v.addEventListener("click",()=>t.onPlay&&t.onPlay()),h.push({video_play:!1,video_mute:!1,video_progress:0}),h.link("video_play",({video_play:e})=>{v.innerText=e?"Pause":"Play"}),h.link("video_progress",({video_progress:e})=>{x.css({x:100*(-1+e)+"%"})}),g.addEventListener("click",()=>{a.emit("toggle-mute",{mute:!n})}),a.on("toggle-mute",({mute:e})=>{n=e,g.innerText=e?"Unmute":"Mute"}),g.addEventListener("mouseenter",()=>a.emit("link-hover-enter")),g.addEventListener("mouseleave",()=>a.emit("link-hover-leave")),v.addEventListener("mouseenter",()=>a.emit("link-hover-enter")),v.addEventListener("mouseleave",()=>a.emit("link-hover-leave")),w.addEventListener("mouseenter",()=>a.emit("link-hover-enter")),w.addEventListener("mouseleave",()=>a.emit("link-hover-leave")),this.openItem=({id:n,title:r,release:o,desc:a,controls:s})=>{u.innerText=n+"/30",c.innerHTML=`${r}<br>${o}`,p.innerHTML=a,p.css({display:a?"block":"none"}),f.css({display:s?"block":"none"}),x.css({x:"-100%"}),t.isLoaded=!1,e.appendChild(i),i.css({opacity:0}),i.animate(2e3,{opacity:1,delay:1500}),ln.isTouch?w.addEventListener("touchstart",y):w.addEventListener("mousedown",y),c.words=Rn(c)},this.closeItem=()=>{ln.isTouch?w.removeEventListener("touchstart",y):w.removeEventListener("mousedown",y),i.parentNode&&i.parentNode.removeChild(i),s.parentNode&&s.parentNode.removeChild(s)}}}const Pn="ontouchstart"in window;class kn{constructor(t){const n=this,i=ln.gl,r=gn(),s=new Cn(t);let u,c;const d=new Te,p=new me(i),m=new me(i,{generateMipmaps:!1,width:2048,height:1024}),f=document.createElement("video");function v({index:e}){s.openItem(r[e]);const{id:t,code:l,ext:d}=r[e],h=ln.ratio.value>1?"":"-mobile",v=WOLVES_CDN+`assets/content/${t}/${l}${h}.${d}`;if("mp4"===d)n.isVideo=!0,f.src=v,f.playsInline=!0,f.play(),s.onScrub=e=>{f.duration&&(f.currentTime=e*f.duration)},u.uniforms.uImageRatio.value=h?.625:1280/720,u.uniforms.tImage.value=p,m.image=null;else{const e=Ot.load(i,{src:v});e.isLoading=!0,u.uniforms.tImage.value=e,a.on("viewer-close",(function t(){a.off("viewer-close",t),e.isLoading=!1})),e.width?(u.uniforms.uImageRatio.value=e.width/e.height,a.emit("viewer-loaded")):e.loaded.then(t=>{e.isLoading&&u.uniforms.tImage.value===e&&(u.uniforms.uImageRatio.value=t.width/t.height,a.emit("viewer-loaded"))})}setTimeout(w,100),c.setParent(ln.mapScene),u.uniforms.uLoaded.value=0,new o(u.uniforms.uFade,1500,{value:1})}async function g(){s.closeItem(),s.onScrub=null,i.canvas.removeEventListener("click",x),f.pause(),new o(u.uniforms.uLoaded,500,{value:0}),await new o(u.uniforms.uFade,500,{value:0}).promise(),c.setParent(null),n.isVideo=!1}function w(){i.canvas.addEventListener("click",x)}function x(){a.emit("viewer-close")}f.setAttribute("crossorigin","anonymous"),f.loop=!0,function(){const e=ln.triangle,{vertex:t,fragment:n}=Ln;u=new k(i,{vertex:t,fragment:n,uniforms:{uTime:ln.time,uResolution:ln.resolution,tImage:{value:null},uImageRatio:{value:1},uMouse:{value:new Te},uFade:{value:0},uLoaded:{value:0}},transparent:!0,depthTest:!1,depthWrite:!1}),c=new ce(i,{geometry:e,program:u}),c.frustumCulled=!1}(),a.on("viewer-open",v),a.on("viewer-close",g),f.addEventListener("pause",()=>{n.isVideoPlaying=!1,h.push({video_play:!1})}),f.addEventListener("play",()=>{n.isVideoPlaying=!0,h.push({video_play:!0})}),f.addEventListener("timeupdate",()=>{h.push({video_progress:f.currentTime/f.duration})}),s.onPlay=()=>{n.isVideoPlaying=!n.isVideoPlaying,n.isVideoPlaying?f.play():f.pause()},a.on("toggle-mute",({mute:e})=>{f.muted=e}),a.on("viewer-loaded",()=>{new o(u.uniforms.uLoaded,1500,{value:1})}),e.add((function(){Pn||(d.lerp(l.tilt,.1),u.uniforms.uMouse.value.lerp(d,.1));n.isVideo&&f.readyState>=f.HAVE_ENOUGH_DATA&&!f.paused&&(m.image||(m.image=f,u.uniforms.tImage.value=m,a.emit("viewer-loaded")),m.needsUpdate=!0)}))}}var On={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec3 position;\nattribute vec2 uv;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = vec4(position, 1);\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform float uTime;\nuniform vec2 uResolution;\nuniform float uFade;\nuniform sampler2D tBg;\nuniform float uRatio;\n\nvarying vec2 vUv;\n\nhighp float random(vec2 co) {\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\nvoid main() {\n    vec3 color = vec3(0);\n\n    float alpha = 1.0;\n    alpha *= uFade;\n    if (alpha <= 0.01) discard;\n\n    //jitter the noise but not every frame\n    float tick = floor(fract(uTime) * 12.0);\n    vec2 jitter = vec2(\n        mod(tick * 382.0231, 21.321),\n        mod(tick * 122.0142, 31.243)\n    );\n\n    float ratio = uRatio / 2.0;\n    vec2 uv = vUv - 0.5;\n    uv.x *= min(1.0, ratio);\n    uv.y *= min(1.0, 1.0 / ratio);\n    uv += 0.5;\n\n    // uv += random(vUv + jitter) * 0.005;\n\n    // color = texture2D(tBg, uv).rgb;\n    color = vec3(0.02);\n\n    color += random(vUv + jitter) * 0.05;\n    \n    gl_FragColor = vec4(color, alpha);\n}\n    "};class In{constructor(t,n){const i=d.create("div","dashboard-list"),r=d.create("img","dashboard-thumb"),o=d.create("div","dashboard-empty"),s=d.create("div","caption"),u=d.create("h2");s.innerText=" nothing found",u.innerHTML="Scan the<br>planet<br>for<br>secrets",o.appendChild(s),o.appendChild(u);const c=d.create("div","dashboard-complete");c.innerHTML=" Scan Complete";let p=[],f=[17,23,8,3,14,5,25,26,1,24,27,28,0,18,21,6,13,15,19,7,10,20,9,2,4,12,22,16,29,11];const v=[];function g({id:e,title:t,release:n,code:i,ext:r,isFound:o},a){if(a>=30)return;const s=d.create("button");s.innerText=o?t:i?n:"",o?s.classList.remove("symbols"):(s.innerText=i?n.toLowerCase():"",s.classList.add("symbols")),s.index=a,s.dataTitle=t,s.dataRelease=n,s.isReleased=!!i,s.isFound=o,s.thumbSrc=WOLVES_CDN+`assets/content/${e}/${i}-thumb.jpg`,w(s),v.push(s)}function w(e){e.isFound?e.classList.remove("symbols"):e.classList.add("symbols"),e.css({opacity:e.isFound?1:.1,visibility:e.isReleased?"visible":"hidden"})}function x({view:e}){"dashboard"===e?function(){n.appendChild(r),n.appendChild(i),n.appendChild(o),n.appendChild(c),o.css({display:WOLVES_PROGRESS.found.length?"none":"block"}),c.css({display:WOLVES_PROGRESS.found.length===10*t?"block":"none"});Fn(v.filter(e=>!!e.isFound&&!p.includes(e)),.4),p.forEach((e,t)=>{e.css({opacity:.1}),e.animate(500,{opacity:1,delay:500+200*t})}),p.length=0}():i.parentNode&&(n.removeChild(r),n.removeChild(i),n.removeChild(o),n.removeChild(c))}function y({index:e}){const t=v[e];t.isFound=!0,t.innerText=t.dataTitle,w(t),p.push(t)}function _({item:t}){const n=m.guid();r.currentID=n,r.src=t.thumbSrc,r.onload=()=>{r.currentID===n&&(r.css({display:"block",opacity:0,x:l.pixel.x,y:l.pixel.y}),r.animate(300,{opacity:1}),e.add(M))}}async function b(){r.currentID=null,e.remove(M),await r.animate(200,{opacity:0}).promise(),r.currentID||r.css({display:"none"})}function M(){r.css({x:r.transforms.x+.1*(l.pixel.x-r.transforms.x),y:r.transforms.y+.1*(l.pixel.y-r.transforms.y)})}gn().forEach(g),f.forEach(e=>{i.appendChild(v[e])}),h.link("view",x),[...i.children].forEach(e=>{e.addEventListener("mouseenter",()=>{e.isReleased&&e.isFound&&(a.emit("link-hover-enter"),a.emit("item-hover-enter",{item:e}))}),e.addEventListener("mouseleave",()=>{e.isReleased&&e.isFound&&(a.emit("link-hover-leave"),a.emit("item-hover-leave"))}),e.addEventListener("click",()=>{e.isReleased&&e.isFound&&(a.emit("link-hover-leave"),a.emit("item-hover-leave"),a.emit("viewer-open",{index:e.index}),window.dataLayer.push({event:"rbw_map_click_item",name:e.dataTitle,code:e.dataRelease,section:"menu",mapped_percentage:WOLVES_PROGRESS.percentage+"% mapped"}))})}),a.on("wolves-update-found",y),a.on("item-hover-enter",_),a.on("item-hover-leave",b)}}class Dn{constructor(e,t){const n=ln.gl;let i,r;async function a({view:e}){"dashboard"===e?(r.setParent(ln.mapScene),new o(i.uniforms.uFade,500,{value:1})):(await new o(i.uniforms.uFade,500,{value:0}).promise(),r.setParent(null))}new In(e,t),function(){const e=ln.triangle,{vertex:t,fragment:o}=On;i=new k(n,{vertex:t,fragment:o,uniforms:{uRatio:ln.ratio,uResolution:ln.resolution,uTime:ln.time,uFade:{value:0},tBg:{value:Ot.load(n,{src:WOLVES_CDN+"assets/images/dashboard-bg.jpg"})}},transparent:!0,depthWrite:!1,depthTest:!1}),r=new ce(n,{geometry:e,program:i}),r.frustumCulled=!1,r.setParent(ln.mapScene)}(),h.link("view",a)}}var Nn={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec3 position;\nattribute vec2 uv;\n\nuniform vec2 uResolution;\nuniform float uImageRatio;\nuniform float uSize;\nuniform float uTransition;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    vec3 pos = position;\n\n    // Ratio\n    float ratio = uResolution.x / uResolution.y / uImageRatio;\n\n    // Design grid\n    if (uSize > 0.5) {\n        // mobile\n\n        // Contain\n        pos.y *= min(ratio, 1.0);\n        pos.x *= min(1.0 / ratio, 1.0);\n\n    } else {\n        pos.x /= ratio;\n\n        // Logo to edges\n        pos *= 1.25;\n\n        pos *= uSize;\n    }\n\n    pos *= mix(0.9, 1.1, uTransition);\n\n    gl_Position = vec4(pos, 1);\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D tMap;\nuniform float uTime;\nuniform float uFade;\nuniform float uTransition;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vec4 tex = texture2D(tMap, vUv);\n\n    vec3 color = vec3(tex.r * 0.0);\n    float alpha = 1.0;\n    \n    color += tex.rgb * smoothstep(0.7, 0.3, abs(vUv.x - mix(-0.7, 1.7, smoothstep(0.0, 1.0, uTransition))) );\n\n    // color += tex.r;\n    // color += tex.r * smoothstep(0.2, 0.0, abs(vUv.x - (uTransition - 0.15)) );\n    // color += tex.g * smoothstep(0.2, 0.0, abs(vUv.x - uTransition) );\n    // color += uTransition;\n\n    color *= uFade;\n\n    gl_FragColor = vec4(color, alpha);\n}\n    "},Un={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec2 position;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.x, 0, -position.y, 1);\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D tMap;\nuniform float uFade;\nuniform float uTime;\n\nvarying vec2 vUv;\n\nvoid main() {\n    // vec3 color = vec3(0.875, 0.857, 0.740) * 1.1;\n    vec3 color = vec3(1);\n    float alpha = 0.0;\n\n    vec2 uv = vUv;\n    uv -= 0.5;\n    // uv *= 1.0 + (1.0 - uFade) * 2.0;\n    uv += 0.5;\n    vec3 tex = texture2D(tMap, uv).rgb;\n\n    alpha += tex.r;\n    alpha -= tex.g * smoothstep(0.2, 0.5, uFade);\n\n    alpha *= smoothstep(0.0, 0.01, uFade);\n    alpha *= smoothstep(1.0, 0.3, uFade);\n    alpha *= 0.5;\n\n    color *= alpha;\n    \n\n    gl_FragColor = vec4(color, alpha);\n}\n    "},Bn={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec2 position;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.x, 0, -position.y, 1);\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D tNoise;\nuniform float uFade;\nuniform float uTime;\n\nvarying vec2 vUv;\n\nhighp float random(vec2 co) {\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\nfloat addNoise() {\n    vec2 uvNoise = vUv;\n    float tick = floor(uTime * 30.0);\n    vec2 noise = vec2(random(vec2(tick * 0.5, tick * 1.0)), random(vec2(tick * 0.2, tick * 1.2)));\n    uvNoise += noise;\n\n    vec3 texNoise = texture2D(tNoise, uvNoise).rgb;\n\n    float init = smoothstep(0.3, 0.2, uFade);\n\n    float dist = length(vUv - 0.5);\n    float circle = pow(smoothstep(mix(0.3, 0.5, init), 0.0, dist), 2.0);\n    \n    float alpha = circle;\n    alpha *= texNoise.g * 1.2;\n    alpha *= smoothstep(0.4, 0.5, vUv.x - pow(abs(vUv.y - 0.5), 2.0) * 1.0);\n    alpha *= mix(0.6, 1.0, smoothstep(0.5, 0.3, uFade));\n    return alpha;\n}\n\nfloat addShip() {\n    float dist = length((vUv - 0.5) * vec2(1.0, 1.5));\n    float init = smoothstep(0.5, 0.3, uFade);\n    float circle = smoothstep(mix(0.1, 0.2, init), 0.0, dist);\n    float alpha = circle;\n    alpha *= mix(1.0, 0.5, init);\n    return alpha;\n}\n\nvoid main() {\n    vec3 color = vec3(1);\n    float alpha = 0.0;\n\n    alpha += addNoise();\n    float ship = addShip();\n    alpha += ship;\n\n    // color = mix(vec3(0.994, 0.923, 0.789), color, smoothstep(0.1, 0.13, uFade));\n    color = mix(vec3(0.994, 0.923, 0.789), color, smoothstep(0.2, 0.23, uFade));\n    color = mix(color, vec3(1), smoothstep(0.15, 0.0, length(vUv - 0.5)));\n    \n\n\n    // alpha += tex.r;\n    // alpha -= tex.g * smoothstep(0.2, 0.5, uFade);\n\n    // Fade in at start\n    alpha *= smoothstep(0.0, 0.01, uFade);\n    alpha *= smoothstep(1.0, 0.8, uFade);\n\n    gl_FragColor = vec4(color, alpha);\n}\n    "},zn={vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec2 position;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.x, 0, -position.y, 1);\n}\n    ",fragment:"\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D tNoise;\nuniform float uFade;\nuniform float uTime;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vec3 color = vec3(1);\n    float alpha = 0.0;\n\n    vec2 uvNoise = vUv * vec2(2.0, 0.5);\n    uvNoise -= uTime * 0.1;\n    vec3 tex = texture2D(tNoise, uvNoise).rgb;\n\n    float dist = abs(vUv.y - 0.5);\n    float line = smoothstep(0.5, 0.0, dist);\n    // Edges\n    line *= smoothstep(0.5, 0.4, abs(vUv.x - 0.5));\n    // Progress line\n    line *= smoothstep(uFade, uFade - 0.01, 1.0 - vUv.x);\n    // Progress fade\n    line *= smoothstep(uFade - 0.5, uFade, 1.0 - vUv.x);\n    alpha = line;\n\n    alpha *= tex.g;\n\n    // alpha += tex.r;\n    // alpha -= tex.g * smoothstep(0.2, 0.5, uFade);\n\n    // Fade at start and end\n    alpha *= smoothstep(0.0, 0.01, uFade);\n    alpha *= smoothstep(1.0, 0.8, uFade);\n\n    gl_FragColor = vec4(color, alpha);\n}\n    "};class Vn{constructor(){const e=ln.gl;let t,n,i,s,l,u,c,d;const h=new ne;async function p(){(async()=>{await new r(1e3),new o(t.uniforms.uTransition,4300,{value:1,delay:200,ease:"linear"}),await new o(t.uniforms.uFade,1e3,{value:1}).promise(),await new o(t.uniforms.uFade,1e3,{value:0,delay:3300}).promise(),n.setParent(null)})(),(async()=>{await new r(1e3),new o(l.uniforms.uFade,8e3,{value:1,ease:"linear"}),new o(i.uniforms.uFade,8e3,{value:1,ease:"linear"}),new o(s.position,8e3,{x:-5,y:0,z:5,ease:"linear"});new o(c.scale,2400,{x:1,y:1,z:1}),new o(c.position,2400,{x:-.5,z:.5,ease:"linear"}),new o(d.scale,2160,{x:.5,y:.5,z:.5,delay:240}),new o(d.position,2400,{x:-1,z:1,ease:"linear"}),new o(u.uniforms.uFade,2400,{value:1}),await new r(8e3),h.setParent(null)})(),await new r(5500),a.emit("identity-end")}h.position.set(3.8,0,0),h.setParent(ln.mapScene),function(){const i=ln.triangle,{vertex:r,fragment:o}=Nn,a=new k(e,{vertex:r,fragment:o,uniforms:{uRatio:ln.ratio,uResolution:ln.resolution,uTime:ln.time,uImageRatio:{value:ln.ratio.value>1.1?16:2},uSize:{value:ln.ratio.value>1.1?.0555:1},tMap:{value:Ot.load(e,{src:WOLVES_CDN+`assets/images/identity${ln.ratio.value>1.1?"":"-mobile"}.jpg`})},uFade:{value:0},uTransition:{value:0}},transparent:!0,depthWrite:!1,depthTest:!1});a.setBlendFunc(e.ONE,e.ONE);const s=new ce(e,{geometry:i,program:a});s.frustumCulled=!1,s.setParent(ln.scene),t=a,n=s}(),function(){const t=ln.triangle,{vertex:n,fragment:r}=Bn,o=new k(e,{vertex:n,fragment:r,uniforms:{uTime:ln.time,tNoise:{value:Ot.load(e,{src:WOLVES_CDN+"assets/images/noise/clouds.jpg",wrapS:e.REPEAT,wrapT:e.REPEAT})},uFade:{value:0}},transparent:!0,depthWrite:!1,depthTest:!1}),a=new ce(e,{geometry:t,program:o});a.frustumCulled=!1,a.setParent(h),a.scale.set(.8),a.rotation.set(0,.77,0),i=o,s=a}(),function(){const t=ln.triangle,{vertex:n,fragment:i}=Un,r=new k(e,{vertex:n,fragment:i,uniforms:{uTime:ln.time,tMap:{value:Ot.load(e,{src:WOLVES_CDN+"assets/images/explosion.jpg"})},uFade:{value:0}},transparent:!0,depthWrite:!1,depthTest:!1});r.setBlendFunc(e.ONE,e.ONE);const o=new ce(e,{geometry:t,program:r});o.frustumCulled=!1,o.setParent(h);const a=new ce(e,{geometry:t,program:r});a.frustumCulled=!1,a.setParent(h),o.scale.set(.1),o.rotation.reorder("XZY"),o.rotation.set(.8,0,.9),a.scale.set(.05),a.rotation.reorder("XZY"),a.rotation.set(.8,1,.6),a.position.set(.1,0,-.1),u=r,c=o,d=a}(),function(){const t=ln.triangle,{vertex:n,fragment:i}=zn,r=new k(e,{vertex:n,fragment:i,uniforms:{uTime:ln.time,tNoise:{value:Ot.load(e,{src:WOLVES_CDN+"assets/images/noise/clouds.jpg",wrapS:e.REPEAT,wrapT:e.REPEAT})},uFade:{value:0}},transparent:!0,depthWrite:!1,depthTest:!1}),o=new ce(e,{geometry:t,program:r});o.frustumCulled=!1,o.setParent(h),o.scale.set(3.5325,1,.07),o.rotation.set(0,.77,0),o.position.set(-2.5,0,2.5),l=r}(),a.on("identity-start",p)}}class Gn{constructor(t){const n=this;let i,r=!1;const o=d.query(".toggle-prompt",t)[0],s=d.query("#close",o)[0],l=d.query("#burger",o)[0],u=d.query("footer",t)[0],c=d.query(".bonus-prompt",t)[0],p=d.query("a",u),f=(d.query(".footer-streaming, .footer-sign-up",u),d.query(".footer-title",u)[0],d.query(".landscape-prompt",t)[0]),v=d.query(".mute-prompt",t)[0],g=d.query(".text",v)[0],w=d.query("path",v),x=[];for(let e=0;e<3;e++){const e=d.create("div","random-corners");e.innerHTML='\n<svg\n    xmlns="http://www.w3.org/2000/svg"\n    width="30"\n    height="30"\n    viewBox="0 0 100 100"\n    stroke="white"\n    fill="none"\n    stroke-width="8"\n>\n    <path d="M0 0 L0 16 M0 0 L16 0" transform="rotate(0, 50, 50)" />\n    <path d="M0 0 L0 16 M0 0 L16 0" transform="rotate(90, 50, 50)" />\n    <path d="M0 0 L0 16 M0 0 L16 0" transform="rotate(180, 50, 50)" />\n    <path d="M0 0 L0 16 M0 0 L16 0" transform="rotate(270, 50, 50)" />\n</svg>\n            ',x.push(e)}function y(){n.isStarted=!0,o.css({display:"block"}),u.css({display:"block",opacity:0}),u.animate(2e3,{opacity:1,ease:"inOutCubic"}),l.css({opacity:0}),s.css({opacity:0}),h.link("view",_),o.addEventListener("click",b),n.isBonus&&t.appendChild(c),x.forEach(e=>{e.randomModulo=m.random(1e3,5e3),e.timer=1/0,t.appendChild(e)}),e.add(T)}function _({view:e}){i=e;const r="signup"===e||"message"===e;if(t.host.style.color=r?"#1b1b1b":"#fff",t.host.style.fill=r?"#1b1b1b":"#fff","map"===e)s.animate(500,{opacity:0}),l.animate(1e3,{opacity:1,delay:200});else{o="signup"===e,l.animate(500,{opacity:0}),s.animate(500,{opacity:1,delay:200}),s.css({stroke:o?"#1b1b1b":"#fff"})}var o;n.isBonus&&("viewer"===i?t.removeChild(c):t.appendChild(c))}function b(){switch(i){case"map":a.emit("dashboard-open");break;case"dashboard":a.emit("dashboard-close");break;case"viewer":a.emit("viewer-close");break;case"signup":a.emit("signup-close");break;case"message":a.emit("message-close")}}function M(){n.isBonus=!0,c.addEventListener("click",()=>a.emit("viewer-open",{index:30})),n.isStarted&&"viewer"!==i&&t.appendChild(c)}function A(){a.emit("toggle-mute",{mute:!r})}function E({mute:e}){r=e,localStorage.setItem("wolves_mute",r),g.innerText=r?"unmute":"mute",w.forEach((e,t)=>{e.animate(500,{y:r?15*t:0,delay:50*t})})}function T(e,t){ln.renderer.width<=780||x.forEach(t=>{t.timer+=e,t.timer>t.randomModulo&&(t.timer=0,t.css({left:m.random(20,80)+"%",top:m.random(20,80)+"%"}))})}t.removeChild(c),ln.isTouch||f.classList.add("desktop"),a.on("interaction-start",y),a.on("show-bonus",M),v.addEventListener("click",A),a.on("toggle-mute",E),o.addEventListener("mouseenter",()=>a.emit("link-hover-enter")),o.addEventListener("mouseleave",()=>a.emit("link-hover-leave")),c.addEventListener("mouseenter",()=>a.emit("link-hover-enter")),c.addEventListener("mouseleave",()=>a.emit("link-hover-leave")),c.addEventListener("click",()=>{a.emit("link-hover-leave"),window.dataLayer.push({event:"rbw_items_found",amount:31})}),v.addEventListener("mouseenter",()=>a.emit("link-hover-enter")),v.addEventListener("mouseleave",()=>a.emit("link-hover-leave")),p.forEach(e=>{e.addEventListener("mouseenter",()=>a.emit("link-hover-enter")),e.addEventListener("mouseleave",()=>a.emit("link-hover-leave")),e.addEventListener("click",()=>{e.dataset.text&&window.dataLayer.push({event:"rbw_link_click",click_text:e.dataset.text,click_url:e.href})})}),a.on("viewer-open",()=>{u.classList.add("viewer-open")}),a.on("viewer-close",()=>{u.classList.remove("viewer-open")}),a.on("dashboard-open",()=>{u.classList.add("dashboard-open")}),a.on("dashboard-close",()=>{u.classList.remove("dashboard-open")}),a.on("signup-open",()=>{u.classList.add("signup-open"),v.classList.add("signup-open"),c.classList.add("signup-open")}),a.on("signup-close",()=>{u.classList.remove("signup-open"),v.classList.remove("signup-open"),c.classList.remove("signup-open")}),a.on("message-open",()=>{u.classList.add("message-open"),v.classList.add("message-open"),c.classList.add("message-open")}),a.on("message-close",()=>{u.classList.remove("message-open"),v.classList.remove("message-open"),c.classList.remove("message-open")}),"true"===localStorage.getItem("wolves_mute")&&(r=!0,a.emit("toggle-mute",{mute:r}))}}class Hn{constructor(e){const t=gn(),n=d.query(".share-prompt",e)[0],i=d.query(".toggle",n)[0];let r="MISSING IMAGE";function o({index:e}){setTimeout(()=>{const{id:o,title:a,code:s,ext:l,downloadLink:u,downloadText:c}=t[e];u&&(i.innerText=c||"Download",r=u?u.includes("//")?u:WOLVES_CDN+u:"",i.css({display:"block",opacity:1}),n.css({display:"block",opacity:0}),n.animate(1e3,{opacity:1,delay:350,ease:"inOutCubic"}))},0)}async function s(){await n.animate(200,{opacity:0}).promise(),i.css({display:"block",opacity:1}),n.css({display:"none",opacity:0})}a.on("viewer-open",o),a.on("viewer-close",s),n.addEventListener("click",()=>{open(r,"_blank"),window.dataLayer.push({event:"rbw_link_click",click_text:i.innerText,click_url:r})}),n.addEventListener("mouseenter",()=>a.emit("link-hover-enter")),n.addEventListener("mouseleave",()=>a.emit("link-hover-leave"))}}class Wn{constructor(e){const t=this,n=d.query(".footer-sign-up",e)[0],i=d.query(".signup-form",e)[0],r=d.query(".input-step",i)[0],o=d.query(".success-step",i)[0],s=d.query("form",i)[0],l=d.query(".email-input",i)[0],u=d.query(".submit",i)[0],c=d.query(".continue-prompt",i)[0];function p({view:e}){"signup"===e?function(){if(t.isActive)return;t.isActive=!0,r.css({display:"block"}),o.css({display:"none"}),i.css({display:"block"}),n.css({display:"none"})}():"message"===e?m():"viewer"===e?(f(),m()):f()}function m(){n.css({display:"none"})}function f(){n.css({display:"block"}),t.isActive&&(t.isActive=!1,i.css({display:"none"}))}function v(e){e.preventDefault(),async function(e){fetch("https://rest.iad-01.braze.com/users/track",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer 1008b03d-4086-41fb-9c3e-c784c24c1a65",Accept:"application/json"},body:JSON.stringify({attributes:[{user_alias:{alias_name:e,alias_label:"email"},_update_existing_only:!1,email:e,microsite_source:{add:["raised by wolves"]},microsite_source_group:{add:["max originals"]}}]})}).then(e=>e.json()).then(e=>console.log(e)).catch(e=>console.log(e))}(l.value),r.css({display:"none"}),o.css({display:"block"}),l.value="",window.dataLayer.push({event:"rbw_email_submit"})}h.link("view",p),s.addEventListener("submit",v),a.on("interaction-start",()=>{n.addEventListener("click",()=>a.emit("signup-open")),c.addEventListener("click",()=>a.emit("signup-close"))}),u.addEventListener("mouseenter",()=>a.emit("link-hover-enter")),u.addEventListener("mouseleave",()=>a.emit("link-hover-leave")),c.addEventListener("mouseenter",()=>a.emit("link-hover-enter")),c.addEventListener("mouseleave",()=>a.emit("link-hover-leave"))}}class qn{constructor(e){const t=this;let n;const i=d.query(".message-container",e)[0],r=d.query(".title",i)[0],o=d.query(".ok-prompt",i)[0],s=d.query(".description",i)[0];function l({title:e,prompt:t,message:i,callback:a}){r.innerHTML=e,o.innerText=t,s.innerText=i,n=a,r.words=Rn(r)}function u({view:e}){setTimeout(()=>{"message"===e?function(){if(t.isActive)return;t.isActive=!0,i.css({display:"block"}),Fn(r.words)}():function(){if(!t.isActive)return;t.isActive=!1,i.css({display:"none"})}()},0)}a.on("message-open",l),h.link("view",u),o.addEventListener("click",()=>{a.emit("message-close"),n&&n(),a.emit("link-hover-leave")}),o.addEventListener("mouseenter",()=>a.emit("link-hover-enter")),o.addEventListener("mouseleave",()=>a.emit("link-hover-leave"))}}class jn{constructor(e){const t=this;let n;const i=d.query(".instructions",e)[0],o=d.query(".caption",i)[0],s=d.query("h2",i)[0];async function l({caption:e,title:i}){t.isRequested=!0,await new r(500),o.innerText=e,s.innerHTML=i,s.words=Rn(s),"map"===n&&p()}function u(){t.isRequested=!1,"map"===n&&m()}function c({view:e}){n=e,"map"===e&&t.isRequested?p():m()}function p(){t.isActive||(t.isActive=!0,i.css({display:"block"}),o.css({opacity:0}),o.animate(300,{opacity:1,ease:"inOutCubic"}),s.css({opacity:1}),Fn(s.words))}async function m(){t.isActive&&(t.isActive=!1,o.animate(300,{opacity:0}),s.animate(300,{opacity:0}),await new r(300),t.isActive||i.css({display:"none"}))}a.on("instructions-open",l),a.on("instructions-close",u),h.link("view",c)}}class Xn{constructor(t){const n=this;let i,o,s,u,c,p,m,f;const v=[];let g,w=0,x=0;function y(){const{x:e,y:t}=l.pixel;i.css({x:e,y:t})}function _(){x=1,b(),document.removeEventListener("mousemove",_)}function b({cursorInaccessible:e,cursorItemHover:t,cursorDragging:n}=h.data){i.css({display:x?"block":"none"});let r=0;"map"===g&&(e&&(r=3),t&&(r=2),n&&(r=1),w>0&&(r=5)),"viewer"===g&&(r=6,w>0&&(r=5)),["dashboard","signup","message"].includes(g)&&(r=4,w>0&&(r=5)),v.forEach((e,t)=>{e.css({display:t===r?"block":"none"})}),i.css({mixBlendMode:3===r||1===r?"unset":"difference"})}(()=>{if("ontouchstart"in window)return i=d.create("div","cursor"),i.innerHTML='\n                <svg \n                    xmlns="http://www.w3.org/2000/svg"\n                    xmlns:xlink="http://www.w3.org/1999/xlink"\n                    width="100"\n                    height="100"\n                    viewBox="0 0 100 100" \n                    stroke="white"\n                    fill="none"\n                    stroke-width="1"\n                    stroke-linecap="butt"\n                >\n                    <path id="textCurve" stroke="none" d="\n                        M 5, 50\n                        a 45, 45 0 1, 1 90, 0\n                        a 45, 45 0 1, 1 -90, 0\n                    " />\n                    <text \n                        class="rotate-text"\n                        stroke="none" \n                        fill="white" \n                        style="\n                            font-size: 5px;\n                            text-transform: uppercase;\n                        ">\n                        <textPath \n                            xlink:href="#textCurve" \n                            textLength="280">\n                            Area encrypted  Return September 9  Area encrypted  Return September 9  \n                        </textPath>\n                    </text>\n                    <circle cx="50" cy="50" r="41" stroke-width="0.5" style="opacity: 0.3"/>\n                    <circle cx="50" cy="50" r="32" stroke-width="1"/>\n                    <circle cx="50" cy="50" r="13" stroke-width="1"/>\n                    <path d="M41 41 L59 59" />\n                    <path d="M59 41 L41 59" />\n                </svg>\n                ',t.appendChild(i),i.css({display:"block",opacity:0}),a.on("click_inaccessible",async()=>{n.clickTimeout&&n.clickTimeout.clear(),n.isClick=!0,i.css({opacity:1,x:l.pixel.x,y:l.pixel.y,scale:1.05}),i.animate(500,{scale:1,ease:"outElastic",damping:.6}),i.animate(500,{opacity:0,ease:"inOutCubic",delay:700}),n.clickTimeout=new r(700),await n.clickTimeout,n.isClick=!1}),void a.on("drag",()=>{n.isClick&&(n.isClick=!1,i.animate(300,{opacity:0,ease:"outCubic",delay:0}))});i=d.create("div","cursor"),i.innerHTML='\n                <svg \n                    xmlns="http://www.w3.org/2000/svg"\n                    xmlns:xlink="http://www.w3.org/1999/xlink"\n                    width="100"\n                    height="100"\n                    viewBox="0 0 100 100" \n                    stroke="white"\n                    fill="none"\n                    stroke-width="1"\n                    stroke-linecap="butt"\n                >\n                    <g class="cursor-map-idle">\n                        <circle cx="50" cy="50" r="21" stroke-width="6"/>\n                        <circle cx="50" cy="50" r="1" stroke="none" fill="white"/>\n                    </g>\n                    <g class="cursor-map-grab">\n                        <circle cx="50" cy="50" r="41" stroke-width="0.5" style="opacity: 0.3"/>\n                        <path d="M43 43 L43 46 M43 43 L46 43 M43 43 L46 46" stroke-width="0.6" transform="rotate(45, 50, 50)"/>\n                        <path d="M43 43 L43 46 M43 43 L46 43 M43 43 L46 46" stroke-width="0.6" transform="rotate(135, 50, 50)"/>\n                        <path d="M43 43 L43 46 M43 43 L46 43 M43 43 L46 46" stroke-width="0.6" transform="rotate(225, 50, 50)"/>\n                        <path d="M43 43 L43 46 M43 43 L46 43 M43 43 L46 46" stroke-width="0.6" transform="rotate(315, 50, 50)"/>\n                    </g>\n                    <g class="cursor-map-hover">\n                        <circle cx="50" cy="50" r="41" stroke-width="0.5" style="opacity: 0.3"/>\n                        <circle cx="50" cy="50" r="32" stroke="none" fill="white"/>\n                        <circle cx="50" cy="50" r="1" stroke="none" fill="black"/>\n                    </g>\n                    <g class="cursor-map-inaccessible">\n                        <path id="textCurve" stroke="none" d="\n                            M 5, 50\n                            a 45, 45 0 1, 1 90, 0\n                            a 45, 45 0 1, 1 -90, 0\n                        " />\n                        <text \n                            class="rotate-text"\n                            stroke="none" \n                            fill="white" \n                            style="\n                                font-size: 5px;\n                                text-transform: uppercase;\n                            ">\n                            <textPath \n                                xlink:href="#textCurve" \n                                textLength="280">\n                                Area encrypted  Return September 23  Area encrypted  Return September 23  \n                            </textPath>\n                        </text>\n                        <circle cx="50" cy="50" r="41" stroke-width="0.5" style="opacity: 0.3"/>\n                        <circle cx="50" cy="50" r="32" stroke-width="1"/>\n                        <circle cx="50" cy="50" r="13" stroke-width="1"/>\n                        <path d="M41 41 L59 59" />\n                        <path d="M59 41 L41 59" />\n                    </g>\n                    <g class="cursor-menu-idle">\n                        <circle cx="50" cy="50" r="21" stroke-width="6"/>\n                        <circle cx="50" cy="50" r="1" stroke="none" fill="white"/>\n                    </g>\n                    <g class="cursor-menu-hover">\n                        <circle cx="50" cy="50" r="32" stroke="none" fill="white"/>\n                        <path d="M50 43 L50 57" stroke="black"/>\n                        <path d="M43 50 L57 50" stroke="black"/>\n                    </g>\n                    <g class="cursor-viewer-close">\n                        <circle cx="50" cy="50" r="21" stroke-width="6"/>\n                        <path d="M45 45 L55 55"/>\n                        <path d="M55 45 L45 55"/>\n                    </g>\n                </svg>\n                ',o=d.query(".cursor-map-idle",i)[0],s=d.query(".cursor-map-grab",i)[0],u=d.query(".cursor-map-hover",i)[0],c=d.query(".cursor-map-inaccessible",i)[0],p=d.query(".cursor-menu-idle",i)[0],m=d.query(".cursor-menu-hover",i)[0],f=d.query(".cursor-viewer-close",i)[0],v.push(o,s,u,c,p,m,f),t.appendChild(i),document.addEventListener("mousemove",_),document.body.addEventListener("mouseleave",()=>{x=0,b()}),document.body.addEventListener("mouseenter",()=>{x=1,b()}),h.link("view",({view:e})=>{g=e,b()}),h.link(["cursorInaccessible","cursorItemHover","cursorDragging"],b),a.on("link-hover-enter",()=>{w++,b()}),a.on("link-hover-leave",()=>{w--,w<0&&(w=0),b()}),e.add(y)})()}}!function(){var e=function(){this.init()};e.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var n=this||t;if(e=parseFloat(e),n.ctx||u(),void 0!==e&&e>=0&&e<=1){if(n._volume=e,n._muted)return n;n.usingWebAudio&&n.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var i=0;i<n._howls.length;i++)if(!n._howls[i]._webAudio)for(var r=n._howls[i]._getSoundIds(),o=0;o<r.length;o++){var a=n._howls[i]._soundById(r[o]);a&&a._node&&(a._node.volume=a._volume*e)}return n}return n._volume},mute:function(e){var n=this||t;n.ctx||u(),n._muted=e,n.usingWebAudio&&n.masterGain.gain.setValueAtTime(e?0:n._volume,t.ctx.currentTime);for(var i=0;i<n._howls.length;i++)if(!n._howls[i]._webAudio)for(var r=n._howls[i]._getSoundIds(),o=0;o<r.length;o++){var a=n._howls[i]._soundById(r[o]);a&&a._node&&(a._node.muted=!!e||a._muted)}return n},stop:function(){for(var e=this||t,n=0;n<e._howls.length;n++)e._howls[n].stop();return e},unload:function(){for(var e=this||t,n=e._howls.length-1;n>=0;n--)e._howls[n].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,u()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,n=null;try{n="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!n||"function"!=typeof n.canPlayType)return e;var i=n.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),o=r&&parseInt(r[0].split("/")[1],10)<33;return e._codecs={mp3:!(o||!i&&!n.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!n.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!n.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!n.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/m4a;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(n.canPlayType("audio/x-m4b;")||n.canPlayType("audio/m4b;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(n.canPlayType("audio/x-mp4;")||n.canPlayType("audio/mp4;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!n.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(n.canPlayType("audio/x-flac;")||n.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var n=function(t){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var i=new Audio;i._unlocked=!0,e._releaseHtml5Audio(i)}catch(t){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var o=e._howls[r]._getSoundIds(),a=0;a<o.length;a++){var s=e._howls[r]._soundById(o[a]);s&&s._node&&!s._node._unlocked&&(s._node._unlocked=!0,s._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",n,!0),document.removeEventListener("touchend",n,!0),document.removeEventListener("click",n,!0);for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("unlock")}};return document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("click",n,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var n=(new Audio).play();return n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)&&n.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var n=this||t;return e._unlocked&&n._html5AudioPool.push(e),n},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&t.usingWebAudio){for(var n=0;n<e._howls.length;n++)if(e._howls[n]._webAudio)for(var i=0;i<e._howls[n]._sounds.length;i++)if(!e._howls[n]._sounds[i]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&t.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var t=new e,n=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};n.prototype={init:function(e){var n=this;return t.ctx||u(),n._autoplay=e.autoplay||!1,n._format="string"!=typeof e.format?e.format:[e.format],n._html5=e.html5||!1,n._muted=e.mute||!1,n._loop=e.loop||!1,n._pool=e.pool||5,n._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,n._rate=e.rate||1,n._sprite=e.sprite||{},n._src="string"!=typeof e.src?e.src:[e.src],n._volume=void 0!==e.volume?e.volume:1,n._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},n._duration=0,n._state="unloaded",n._sounds=[],n._endTimers={},n._queue=[],n._playLock=!1,n._onend=e.onend?[{fn:e.onend}]:[],n._onfade=e.onfade?[{fn:e.onfade}]:[],n._onload=e.onload?[{fn:e.onload}]:[],n._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],n._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],n._onpause=e.onpause?[{fn:e.onpause}]:[],n._onplay=e.onplay?[{fn:e.onplay}]:[],n._onstop=e.onstop?[{fn:e.onstop}]:[],n._onmute=e.onmute?[{fn:e.onmute}]:[],n._onvolume=e.onvolume?[{fn:e.onvolume}]:[],n._onrate=e.onrate?[{fn:e.onrate}]:[],n._onseek=e.onseek?[{fn:e.onseek}]:[],n._onunlock=e.onunlock?[{fn:e.onunlock}]:[],n._onresume=[],n._webAudio=t.usingWebAudio&&!n._html5,void 0!==t.ctx&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(n),n._autoplay&&n._queue.push({event:"play",action:function(){n.play()}}),n._preload&&"none"!==n._preload&&n.load(),n},load:function(){var e=this,n=null;if(t.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var r=0;r<e._src.length;r++){var a,s;if(e._format&&e._format[r])a=e._format[r];else{if("string"!=typeof(s=e._src[r])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(a=/^data:audio\/([^;,]+);/i.exec(s))||(a=/\.([^.]+)$/.exec(s.split("?",1)[0])),a&&(a=a[1].toLowerCase())}if(a||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),a&&t.codecs(a)){n=e._src[r];break}}if(n)return e._src=n,e._state="loading","https:"===window.location.protocol&&"http:"===n.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new i(e),e._webAudio&&o(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,n){var i=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===i._state&&!i._sprite[e])return null;if(void 0===e&&(e="__default",!i._playLock)){for(var o=0,a=0;a<i._sounds.length;a++)i._sounds[a]._paused&&!i._sounds[a]._ended&&(o++,r=i._sounds[a]._id);1===o?e=null:r=null}}var s=r?i._soundById(r):i._inactiveSound();if(!s)return null;if(r&&!e&&(e=s._sprite||"__default"),"loaded"!==i._state){s._sprite=e,s._ended=!1;var l=s._id;return i._queue.push({event:"play",action:function(){i.play(l)}}),l}if(r&&!s._paused)return n||i._loadQueue("play"),s._id;i._webAudio&&t._autoResume();var u=Math.max(0,s._seek>0?s._seek:i._sprite[e][0]/1e3),c=Math.max(0,(i._sprite[e][0]+i._sprite[e][1])/1e3-u),d=1e3*c/Math.abs(s._rate),h=i._sprite[e][0]/1e3,p=(i._sprite[e][0]+i._sprite[e][1])/1e3;s._sprite=e,s._ended=!1;var m=function(){s._paused=!1,s._seek=u,s._start=h,s._stop=p,s._loop=!(!s._loop&&!i._sprite[e][2])};if(!(u>=p)){var f=s._node;if(i._webAudio){var v=function(){i._playLock=!1,m(),i._refreshBuffer(s);var e=s._muted||i._muted?0:s._volume;f.gain.setValueAtTime(e,t.ctx.currentTime),s._playStart=t.ctx.currentTime,void 0===f.bufferSource.start?s._loop?f.bufferSource.noteGrainOn(0,u,86400):f.bufferSource.noteGrainOn(0,u,c):s._loop?f.bufferSource.start(0,u,86400):f.bufferSource.start(0,u,c),d!==1/0&&(i._endTimers[s._id]=setTimeout(i._ended.bind(i,s),d)),n||setTimeout((function(){i._emit("play",s._id),i._loadQueue()}),0)};"running"===t.state&&"interrupted"!==t.ctx.state?v():(i._playLock=!0,i.once("resume",v),i._clearTimer(s._id))}else{var g=function(){f.currentTime=u,f.muted=s._muted||i._muted||t._muted||f.muted,f.volume=s._volume*t.volume(),f.playbackRate=s._rate;try{var r=f.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(i._playLock=!0,m(),r.then((function(){i._playLock=!1,f._unlocked=!0,n||(i._emit("play",s._id),i._loadQueue())})).catch((function(){i._playLock=!1,i._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0}))):n||(i._playLock=!1,m(),i._emit("play",s._id),i._loadQueue()),f.playbackRate=s._rate,f.paused)return void i._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||s._loop?i._endTimers[s._id]=setTimeout(i._ended.bind(i,s),d):(i._endTimers[s._id]=function(){i._ended(s),f.removeEventListener("ended",i._endTimers[s._id],!1)},f.addEventListener("ended",i._endTimers[s._id],!1))}catch(e){i._emit("playerror",s._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===f.src&&(f.src=i._src,f.load());var w=window&&window.ejecta||!f.readyState&&t._navigator.isCocoonJS;if(f.readyState>=3||w)g();else{i._playLock=!0;var x=function(){g(),f.removeEventListener(t._canPlayEvent,x,!1)};f.addEventListener(t._canPlayEvent,x,!1),i._clearTimer(s._id)}}return s._id}i._ended(s)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),i=0;i<n.length;i++){t._clearTimer(n[i]);var r=t._soundById(n[i]);if(r&&!r._paused&&(r._seek=t.seek(n[i]),r._rateSeek=0,r._paused=!0,t._stopFade(n[i]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var i=n._getSoundIds(e),r=0;r<i.length;r++){n._clearTimer(i[r]);var o=n._soundById(i[r]);o&&(o._seek=o._start||0,o._rateSeek=0,o._paused=!0,o._ended=!0,n._stopFade(i[r]),o._node&&(n._webAudio?o._node.bufferSource&&(void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),n._cleanBuffer(o._node)):isNaN(o._node.duration)&&o._node.duration!==1/0||(o._node.currentTime=o._start||0,o._node.pause(),o._node.duration===1/0&&n._clearSound(o._node))),t||n._emit("stop",o._id))}return n},mute:function(e,n){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(e,n)}}),i;if(void 0===n){if("boolean"!=typeof e)return i._muted;i._muted=e}for(var r=i._getSoundIds(n),o=0;o<r.length;o++){var a=i._soundById(r[o]);a&&(a._muted=e,a._interval&&i._stopFade(a._id),i._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume,t.ctx.currentTime):a._node&&(a._node.muted=!!t._muted||e),i._emit("mute",a._id))}return i},volume:function(){var e,n,i,r=this,o=arguments;if(0===o.length)return r._volume;if(1===o.length||2===o.length&&void 0===o[1]){var a=r._getSoundIds(),s=a.indexOf(o[0]);s>=0?n=parseInt(o[0],10):e=parseFloat(o[0])}else o.length>=2&&(e=parseFloat(o[0]),n=parseInt(o[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(i=n?r._soundById(n):r._sounds[0])?i._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,o)}}),r;void 0===n&&(r._volume=e),n=r._getSoundIds(n);for(var l=0;l<n.length;l++)(i=r._soundById(n[l]))&&(i._volume=e,o[2]||r._stopFade(n[l]),r._webAudio&&i._node&&!i._muted?i._node.gain.setValueAtTime(e,t.ctx.currentTime):i._node&&!i._muted&&(i._node.volume=e*t.volume()),r._emit("volume",i._id));return r},fade:function(e,n,i,r){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"fade",action:function(){o.fade(e,n,i,r)}}),o;e=Math.min(Math.max(0,parseFloat(e)),1),n=Math.min(Math.max(0,parseFloat(n)),1),i=parseFloat(i),o.volume(e,r);for(var a=o._getSoundIds(r),s=0;s<a.length;s++){var l=o._soundById(a[s]);if(l){if(r||o._stopFade(a[s]),o._webAudio&&!l._muted){var u=t.ctx.currentTime,c=u+i/1e3;l._volume=e,l._node.gain.setValueAtTime(e,u),l._node.gain.linearRampToValueAtTime(n,c)}o._startFadeInterval(l,e,n,i,a[s],void 0===r)}}return o},_startFadeInterval:function(e,t,n,i,r,o){var a=this,s=t,l=n-t,u=Math.abs(l/.01),c=Math.max(4,u>0?i/u:i),d=Date.now();e._fadeTo=n,e._interval=setInterval((function(){var r=(Date.now()-d)/i;d=Date.now(),s+=l*r,s=l<0?Math.max(n,s):Math.min(n,s),s=Math.round(100*s)/100,a._webAudio?e._volume=s:a.volume(s,e._id,!0),o&&(a._volume=s),(n<t&&s<=n||n>t&&s>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,a.volume(n,e._id),a._emit("fade",e._id))}),c)},_stopFade:function(e){var n=this,i=n._soundById(e);return i&&i._interval&&(n._webAudio&&i._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(i._interval),i._interval=null,n.volume(i._fadeTo,e),i._fadeTo=null,n._emit("fade",e)),n},loop:function(){var e,t,n,i=this,r=arguments;if(0===r.length)return i._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(n=i._soundById(parseInt(r[0],10)))&&n._loop;e=r[0],i._loop=e}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var o=i._getSoundIds(t),a=0;a<o.length;a++)(n=i._soundById(o[a]))&&(n._loop=e,i._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop)));return i},rate:function(){var e,n,i,r=this,o=arguments;if(0===o.length)n=r._sounds[0]._id;else if(1===o.length){var a=r._getSoundIds(),s=a.indexOf(o[0]);s>=0?n=parseInt(o[0],10):e=parseFloat(o[0])}else 2===o.length&&(e=parseFloat(o[0]),n=parseInt(o[1],10));if("number"!=typeof e)return(i=r._soundById(n))?i._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,o)}}),r;void 0===n&&(r._rate=e),n=r._getSoundIds(n);for(var l=0;l<n.length;l++)if(i=r._soundById(n[l])){r.playing(n[l])&&(i._rateSeek=r.seek(n[l]),i._playStart=r._webAudio?t.ctx.currentTime:i._playStart),i._rate=e,r._webAudio&&i._node&&i._node.bufferSource?i._node.bufferSource.playbackRate.setValueAtTime(e,t.ctx.currentTime):i._node&&(i._node.playbackRate=e);var u=r.seek(n[l]),c=(r._sprite[i._sprite][0]+r._sprite[i._sprite][1])/1e3-u,d=1e3*c/Math.abs(i._rate);!r._endTimers[n[l]]&&i._paused||(r._clearTimer(n[l]),r._endTimers[n[l]]=setTimeout(r._ended.bind(r,i),d)),r._emit("rate",i._id)}return r},seek:function(){var e,n,i=this,r=arguments;if(0===r.length)n=i._sounds[0]._id;else if(1===r.length){var o=i._getSoundIds(),a=o.indexOf(r[0]);a>=0?n=parseInt(r[0],10):i._sounds.length&&(n=i._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),n=parseInt(r[1],10));if(void 0===n)return i;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"seek",action:function(){i.seek.apply(i,r)}}),i;var s=i._soundById(n);if(s){if(!("number"==typeof e&&e>=0)){if(i._webAudio){var l=i.playing(n)?t.ctx.currentTime-s._playStart:0,u=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(u+l*Math.abs(s._rate))}return s._node.currentTime}var c=i.playing(n);c&&i.pause(n,!0),s._seek=e,s._ended=!1,i._clearTimer(n),i._webAudio||!s._node||isNaN(s._node.duration)||(s._node.currentTime=e);var d=function(){i._emit("seek",n),c&&i.play(n,!0)};if(c&&!i._webAudio){var h=function(){i._playLock?setTimeout(h,0):d()};setTimeout(h,0)}else d()}return i},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var i=0;i<t._sounds.length;i++)if(!t._sounds[i]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,i=t._soundById(e);return i&&(n=t._sprite[i._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,n=e._sounds,i=0;i<n.length;i++)n[i]._paused||e.stop(n[i]._id),e._webAudio||(e._clearSound(n[i]._node),n[i]._node.removeEventListener("error",n[i]._errorFn,!1),n[i]._node.removeEventListener(t._canPlayEvent,n[i]._loadFn,!1),t._releaseHtml5Audio(n[i]._node)),delete n[i]._node,e._clearTimer(n[i]._id);var o=t._howls.indexOf(e);o>=0&&t._howls.splice(o,1);var a=!0;for(i=0;i<t._howls.length;i++)if(t._howls[i]._src===e._src||e._src.indexOf(t._howls[i]._src)>=0){a=!1;break}return r&&a&&delete r[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,i){var r=this["_on"+e];return"function"==typeof t&&r.push(i?{id:n,fn:t,once:i}:{id:n,fn:t}),this},off:function(e,t,n){var i=this,r=i["_on"+e],o=0;if("number"==typeof t&&(n=t,t=null),t||n)for(o=0;o<r.length;o++){var a=n===r[o].id;if(t===r[o].fn&&a||!t&&a){r.splice(o,1);break}}else if(e)i["_on"+e]=[];else{var s=Object.keys(i);for(o=0;o<s.length;o++)0===s[o].indexOf("_on")&&Array.isArray(i[s[o]])&&(i[s[o]]=[])}return i},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var i=this,r=i["_on"+e],o=r.length-1;o>=0;o--)r[o].id&&r[o].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(i,r[o].fn),0),r[o].once&&i.off(e,r[o].fn,r[o].id));return i._loadQueue(e),i},_loadQueue:function(e){var t=this;if(t._queue.length>0){var n=t._queue[0];n.event===e&&(t._queue.shift(),t._loadQueue()),e||n.action()}return t},_ended:function(e){var n=this,i=e._sprite;if(!n._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(n._ended.bind(n,e),100),n;var r=!(!e._loop&&!n._sprite[i][2]);if(n._emit("end",e._id),!n._webAudio&&r&&n.stop(e._id,!0).play(e._id),n._webAudio&&r){n._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var o=1e3*(e._stop-e._start)/Math.abs(e._rate);n._endTimers[e._id]=setTimeout(n._ended.bind(n,e),o)}return n._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,n._clearTimer(e._id),n._cleanBuffer(e._node),t._autoSuspend()),n._webAudio||r||n.stop(e._id,!0),n},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var n=t._soundById(e);n&&n._node&&n._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new i(e)},_drain:function(){var e=this,t=e._pool,n=0,i=0;if(!(e._sounds.length<t)){for(i=0;i<e._sounds.length;i++)e._sounds[i]._ended&&n++;for(i=e._sounds.length-1;i>=0;i--){if(n<=t)return;e._sounds[i]._ended&&(e._webAudio&&e._sounds[i]._node&&e._sounds[i]._node.disconnect(0),e._sounds.splice(i,1),n--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=r[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),this},_cleanBuffer:function(e){var n=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),n))try{e.bufferSource.buffer=t._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var i=function(e){this._parent=e,this.init()};i.prototype={init:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._rate=n._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,n._sounds.push(e),e.create(),e},create:function(){var e=this,n=e._parent,i=t._muted||e._muted||e._parent._muted?0:e._volume;return n._webAudio?(e._node=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(i,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._node.src=n._src,e._node.preload=!0===n._preload?"auto":n._preload,e._node.volume=i*t.volume(),e._node.load()),e},reset:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._rate=n._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,n=e._parent;n._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(n._sprite).length&&(n._sprite={__default:[0,1e3*n._duration]}),"loaded"!==n._state&&(n._state="loaded",n._emit("load"),n._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)}};var r={},o=function(e){var t=e._src;if(r[t])return e._duration=r[t].duration,void l(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),i=new Uint8Array(n.length),o=0;o<n.length;++o)i[o]=n.charCodeAt(o);s(i.buffer,e)}else{var u=new XMLHttpRequest;u.open(e._xhr.method,t,!0),u.withCredentials=e._xhr.withCredentials,u.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){u.setRequestHeader(t,e._xhr.headers[t])})),u.onload=function(){var t=(u.status+"")[0];"0"===t||"2"===t||"3"===t?s(u.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+u.status+".")},u.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete r[t],e.load())},a(u)}},a=function(e){try{e.send()}catch(t){e.onerror()}},s=function(e,n){var i=function(){n._emit("loaderror",null,"Decoding audio data failed.")},o=function(e){e&&n._sounds.length>0?(r[n._src]=e,l(n,e)):i()};"undefined"!=typeof Promise&&1===t.ctx.decodeAudioData.length?t.ctx.decodeAudioData(e).then(o).catch(i):t.ctx.decodeAudioData(e,o,i)},l=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},u=function(){if(t.usingWebAudio){try{"undefined"!=typeof AudioContext?t.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch(e){t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),n=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=n?parseInt(n[1],10):null;if(e&&i&&i<9){var r=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!r&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};"function"==typeof define&&define.amd&&define([],(function(){return{Howler:t,Howl:n}})),"undefined"!=typeof exports&&(exports.Howler=t,exports.Howl=n),"undefined"!=typeof global?(global.HowlerGlobal=e,global.Howler=t,global.Howl=n,global.Sound=i):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=i)}(),function(){var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;n>=0;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var i=this;return i.ctx&&i.ctx.listener?(t="number"!=typeof t?i._pos[1]:t,n="number"!=typeof n?i._pos[2]:n,"number"!=typeof e?i._pos:(i._pos=[e,t,n],void 0!==i.ctx.listener.positionX?(i.ctx.listener.positionX.setTargetAtTime(i._pos[0],Howler.ctx.currentTime,.1),i.ctx.listener.positionY.setTargetAtTime(i._pos[1],Howler.ctx.currentTime,.1),i.ctx.listener.positionZ.setTargetAtTime(i._pos[2],Howler.ctx.currentTime,.1)):i.ctx.listener.setPosition(i._pos[0],i._pos[1],i._pos[2]),i)):i},HowlerGlobal.prototype.orientation=function(e,t,n,i,r,o){var a=this;if(!a.ctx||!a.ctx.listener)return a;var s=a._orientation;return t="number"!=typeof t?s[1]:t,n="number"!=typeof n?s[2]:n,i="number"!=typeof i?s[3]:i,r="number"!=typeof r?s[4]:r,o="number"!=typeof o?s[5]:o,"number"!=typeof e?s:(a._orientation=[e,t,n,i,r,o],void 0!==a.ctx.listener.forwardX?(a.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(i,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(e,t,n,i,r,o),a)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._stereo=t.stereo||null,n._pos=t.pos||null,n._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},n._onstereo=t.onstereo?[{fn:t.onstereo}]:[],n._onpos=t.onpos?[{fn:t.onpos}]:[],n._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,n){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"stereo",action:function(){i.stereo(e,n)}}),i;var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof e)return i._stereo;i._stereo=e,i._pos=[e,0,0]}for(var o=i._getSoundIds(n),a=0;a<o.length;a++){var s=i._soundById(o[a]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||t(s,r),"spatial"===r?void 0!==s._panner.positionX?(s._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),i._emit("stereo",s._id)}}return i},Howl.prototype.pos=function(e,n,i,r){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"pos",action:function(){o.pos(e,n,i,r)}}),o;if(n="number"!=typeof n?0:n,i="number"!=typeof i?-.5:i,void 0===r){if("number"!=typeof e)return o._pos;o._pos=[e,n,i]}for(var a=o._getSoundIds(r),s=0;s<a.length;s++){var l=o._soundById(a[s]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,n,i],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):l._panner.setPosition(e,n,i)),o._emit("pos",l._id)}}return o},Howl.prototype.orientation=function(e,n,i,r){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"orientation",action:function(){o.orientation(e,n,i,r)}}),o;if(n="number"!=typeof n?o._orientation[1]:n,i="number"!=typeof i?o._orientation[2]:i,void 0===r){if("number"!=typeof e)return o._orientation;o._orientation=[e,n,i]}for(var a=o._getSoundIds(r),s=0;s<a.length;s++){var l=o._soundById(a[s]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,n,i],l._node&&(l._panner||(l._pos||(l._pos=o._pos||[0,0,-.5]),t(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):l._panner.setOrientation(e,n,i)),o._emit("orientation",l._id)}}return o},Howl.prototype.pannerAttr=function(){var e,n,i,r=this,o=arguments;if(!r._webAudio)return r;if(0===o.length)return r._pannerAttr;if(1===o.length){if("object"!=typeof o[0])return(i=r._soundById(parseInt(o[0],10)))?i._pannerAttr:r._pannerAttr;e=o[0],void 0===n&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),r._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:r._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:r._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:r._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:r._panningModel})}else 2===o.length&&(e=o[0],n=parseInt(o[1],10));for(var a=r._getSoundIds(n),s=0;s<a.length;s++)if(i=r._soundById(a[s])){var l=i._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var u=i._panner;u?(u.coneInnerAngle=l.coneInnerAngle,u.coneOuterAngle=l.coneOuterAngle,u.coneOuterGain=l.coneOuterGain,u.distanceModel=l.distanceModel,u.maxDistance=l.maxDistance,u.refDistance=l.refDistance,u.rolloffFactor=l.rolloffFactor,u.panningModel=l.panningModel):(i._pos||(i._pos=r._pos||[0,0,-.5]),t(i,"spatial"))}return r},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent;t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this),t._stereo?n.stereo(t._stereo):t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,t._stereo?n.stereo(t._stereo):t._pos?n.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,n._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}(),window.WOLVES_CDN="localhost"===location.hostname||"8080"===location.port?"":"https://raised-by-wolves.micro.hbo.com/";const Yn=(()=>{if(location.search.includes("fallback"))return!0;if(window.MSInputMethodContext&&document.documentMode)return!0;try{const e=document.createElement("canvas");if(!(!!window.WebGLRenderingContext&&e.getContext("webgl")))return!0}catch(e){return!0}return!1})();class Zn extends HTMLElement{constructor(){super();const e=this;if(Yn)return;window.WOLVES_PROGRESS={};const t=new URL(location.href);window.WOLVES_URL=t;const n="ontouchstart"in window,i=document.createElement("link");i.rel="stylesheet",i.href=WOLVES_CDN+"assets/css/font-face.css?v=5",document.head.appendChild(i);const r=document.createElement("link");r.rel="stylesheet",r.href="https://fast.fonts.net/cssapi/c74e648c-2df9-47d9-869f-c05e3572bb01.css",document.head.appendChild(r),this.attachShadow({mode:"open"}).innerHTML=`\n<style>\n    :host {\n        display: none;\n    }\n</style>\n\n<link rel="stylesheet" href="${WOLVES_CDN}assets/css/global.css?v=5" />\n<link rel="stylesheet" href="${WOLVES_CDN}assets/css/typography.css?v=5" />\n<link rel="stylesheet" href="${WOLVES_CDN}assets/css/wolves-canvas.css?v=5">\n<link rel="stylesheet" href="${WOLVES_CDN}assets/css/wolves-canvas-desktop.css?v=5">\n<link rel="stylesheet" href="${WOLVES_CDN}assets/css/wolves-canvas-tablet.css?v=5">\n<link rel="stylesheet" href="${WOLVES_CDN}assets/css/wolves-canvas-mobile.css?v=5">\n\n<div class="font-load">\n    <div class="FuturaBT">load</div>\n    <div class="RTAliasRoughRegular">load</div>\n    <div class="RTAliasRoughBold">load</div>\n    <div class="RTAliasMedium">load</div>\n</div>\n\n<canvas></canvas>\n\n<div class="instructions">\n    <p class="caption"></p>\n    <h2></h2>\n</div>\n\n<div class="signup-form">\n    <div class="input-step">\n        <h2>ACCESS</h2>\n        <p class="description">Sign up to be notified whenever new materials become available</p>\n        <form>\n            <label class="email-label" for="email">Enter<br>your email</label>\n            <input class="email-input" type="email" name="email" required placeholder="your@email.info">\n            <p class="legal">By clicking submit, you agree to receive marketing emails from HBO Max and its affiliates, and to their <a target="_blank" href="https://www.hbomax.com/terms-of-use">Terms of Use</a> and <a target="_blank" href="https://www.hbomax.com/privacy">Privacy Policy</a>.</p>\n            <input class="submit" type="submit" value="Submit">\n        </form>\n    </div>\n    <div class="success-step">\n        <h2>ACCESS</h2>\n        <div class="access-granted">Access: Granted</div>\n        <button class="continue-prompt">Continue</button>\n        <div class="success-message">You have successfully signed up to be alerted of future missions.</div>\n    </div>\n</div>\n\n<div class="message-container">\n    <div class="background"></div>\n    <div class="title"></div>\n    \n    <div class="message-content">\n        <div class="description"></div>\n        <button class="ok-prompt"></button>\n    </div>\n</div>\n\n<a class="bonus-prompt" role="button">!</a>\n<div class="share-prompt">\n    <div class="background"></div>\n    <a class="toggle" role="button"></a>\n</div>\n<a class="toggle-prompt" role="button" aria-label="Menu">\n    <svg\n        viewBox="0 0 100 100"\n        stroke-linecap="butt"\n        stroke-width="3"\n        stroke="#fff"\n        fill="none"\n    >   \n        <defs>\n            <mask id="burger-mask">\n                <rect x="0" y="0" width="100" height="100" fill="#fff"/>\n                <path d="M41 43 L59 43" stroke="#000" stroke-width="2" />\n                <path d="M41 50 L59 50" stroke="#000" stroke-width="2" />\n                <path d="M41 57 L59 57" stroke="#000" stroke-width="2" />\n            </mask>\n        </defs>\n        <g id="burger">\n            <g class="hover">\n                <circle mask="url(#burger-mask)" cx="50" cy="50" r="40" fill="#fff" />\n            </g>\n            <g class="idle">\n                <circle cx="50" cy="50" r="40" />\n                <path d="M41 43 L59 43" stroke-width="2" />\n                <path d="M41 50 L59 50" stroke-width="2" />\n                <path d="M41 57 L59 57" stroke-width="2" />\n            </g>\n        </g>\n        <g id="close">\n            <circle cx="50" cy="50" r="40" stroke-width="4" />\n            <path d="M43 57 L57 43" stroke-width="2.5" />\n            <path d="M43 43 L57 57" stroke-width="2.5" />\n        </g>\n    </svg>\n</a>\n\n<button class="mute-prompt">\n    <div class="text">mute</div>\n    <svg \n        xmlns="http://www.w3.org/2000/svg"\n        width="20"\n        height="20"\n        viewBox="0 0 100 100" \n        stroke="white"\n        fill="none"\n        stroke-width="4"\n    >\n        <path d="M20 100 L20 90"/>\n        <path d="M40 100 L40 75"/>\n        <path d="M60 100 L60 60"/>\n        <path d="M80 100 L80 45"/>\n    </svg>\n</button>\n\n<footer>\n    <div class="footer-title">\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 679.42 40.87" fill="white">\n            <path d="M39.42,38.44H43l4.63-11.39h14.1l4.63,11.39h3.57L54.78.89Zm15.3-29L60.49,24H48.86Z"/>\n            <rect x="92.16" y="2.75" width="3.29" height="35.69"/>\n            <path d="M138.56,21.25a34.73,34.73,0,0,0-5.22-2.83l-1.85-.89c-3.45-1.69-5.72-2.81-5.72-6.21a5.7,5.7,0,0,1,6-5.95,6.92,6.92,0,0,1,6.37,4l.28.56,2.46-2.07-.2-.36a9.75,9.75,0,0,0-8.86-5.2,9,9,0,0,0-9.39,9.13,8,8,0,0,0,1.16,4.21c1.3,2.15,3.24,3.16,6.55,4.77,2.86,1.4,4.88,2.44,5.84,3a5.67,5.67,0,0,1,3.14,5,7.53,7.53,0,0,1-7.87,7.51,7.88,7.88,0,0,1-6.12-2.78A11.79,11.79,0,0,1,123.3,30l-.18-.53-2.89,1.37.15.42a11.82,11.82,0,0,0,2.33,4A10.38,10.38,0,0,0,131.15,39c6.34,0,11.31-4.67,11.31-10.64A8.19,8.19,0,0,0,138.56,21.25Z"/>\n            <polygon points="166.63 38.44 184.27 38.44 184.27 35.36 169.92 35.36 169.92 20.5 183.96 20.5 183.96 17.42 169.92 17.42 169.92 5.83 184.27 5.83 184.27 2.75 166.63 2.75 166.63 38.44"/>\n            <path d="M675.51,21.25a34.07,34.07,0,0,0-5.21-2.83l-1.86-.89c-3.44-1.69-5.71-2.81-5.71-6.21a5.7,5.7,0,0,1,5.95-5.95,6.91,6.91,0,0,1,6.36,4l.29.56,2.46-2.07-.2-.36a9.75,9.75,0,0,0-8.86-5.2,9,9,0,0,0-9.39,9.13,8,8,0,0,0,1.16,4.21c1.3,2.14,3.24,3.16,6.55,4.77,2.86,1.4,4.89,2.44,5.84,3a5.67,5.67,0,0,1,3.14,5,7.53,7.53,0,0,1-7.87,7.51A7.88,7.88,0,0,1,662,33.15,11.52,11.52,0,0,1,660.26,30l-.19-.53-2.88,1.37.15.42a11.82,11.82,0,0,0,2.33,4A10.37,10.37,0,0,0,668.1,39c6.35,0,11.32-4.67,11.32-10.64A8.17,8.17,0,0,0,675.51,21.25Z"/>\n            <path d="M10.75,21.36a8.83,8.83,0,0,0,6.16-8.9,9.17,9.17,0,0,0-3.8-7.85C10.6,2.9,8,2.75,5.49,2.75H0V38.44H3.29V22.06h.27L14.8,38.44h3.81L7.26,22A13.17,13.17,0,0,0,10.75,21.36ZM6.12,19H3.29V5.83H5.65a11.72,11.72,0,0,1,5.07,1c.65.35,2.8,1.8,2.8,5.59C13.52,16.58,10.82,19,6.12,19Z"/>\n            <path d="M216,2.75h-7.36V38.44H216c5.42,0,9.84-1.68,13.15-5a18.66,18.66,0,0,0,0-25.72C225.84,4.43,221.42,2.75,216,2.75Zm14.9,17.87c0,8.68-6.15,14.74-15,14.74h-4V5.83h4C224.75,5.83,230.9,11.92,230.9,20.62Z"/>\n            <polygon points="343.58 19.78 333.88 2.75 330.13 2.75 341.88 23.25 341.88 38.44 345.17 38.44 345.17 23.26 357.24 2.75 353.48 2.75 343.58 19.78"/>\n            <path d="M304.9,19.29a8.91,8.91,0,0,0,3.34-7.35c0-5.58-3.95-9.19-10.07-9.19h-8.09V38.44h10c6.85,0,11.27-4,11.27-10.22A8.82,8.82,0,0,0,304.9,19.29Zm-11.53,2.25h4.9c3.74,0,5.39.54,6.3.94,2.32,1.07,3.4,3,3.4,6a6.23,6.23,0,0,1-2.07,4.93c-2.2,2-4.86,2-7.21,2h-5.32Zm9.42-4.42a6.16,6.16,0,0,1-4.41,1.34h-5V5.83h3.92c1.81,0,3.88.11,5.45,1.35a6.2,6.2,0,0,1,2.16,5A6.1,6.1,0,0,1,302.79,17.12Z"/>\n            <polygon points="442.78 31.25 431.04 0 418.54 31.22 409.29 2.75 405.74 2.75 418.08 40.69 431.01 9.1 442.78 40.67 456.86 2.75 453.3 2.75 442.78 31.25"/>\n            <polygon points="582.64 31.24 572.82 2.75 569.26 2.75 582.66 40.87 595.73 2.75 592.17 2.75 582.64 31.24"/>\n            <polygon points="543.19 2.75 539.9 2.75 539.9 38.44 552.86 38.44 552.86 35.36 543.19 35.36 543.19 2.75"/>\n            <path d="M495.83,2.29a18.24,18.24,0,0,0-18.49,18.39,18.49,18.49,0,0,0,37,0A18.24,18.24,0,0,0,495.83,2.29Zm15.1,18.39a15.1,15.1,0,1,1-30.2,0,15.1,15.1,0,1,1,30.2,0Z"/>\n            <polygon points="617.94 38.44 635.58 38.44 635.58 35.36 621.23 35.36 621.23 20.5 635.26 20.5 635.26 17.42 621.23 17.42 621.23 5.83 635.58 5.83 635.58 2.75 617.94 2.75 617.94 38.44"/>\n        </svg>\n    </div>\n    <a class="footer-streaming" href="https://www.hbomax.com/raisedbywolves" data-text="Stream Now" target="_blank">\n        <div class="series">NEW SERIES</div>\n        <div class="date">Stream Now</div>\n    </a>\n    <a class="footer-sign-up" role="button">SIGN UP<br>FOR UPDATES</a>\n    <div class="footer-legals">\n        <a href="https://www.hbomax.com/privacy" data-text="Privacy Policy" target="_blank">Privacy Policy</a> / <a href="https://www.hbomax.com/terms-of-use" data-text="Terms of Use" target="_blank">Terms of Use</a> <span class="mobile-slash">/</span> <br class="desktop-break"><a href="https://www.hbomax.com/privacy#yourchoices" data-text="Ad Choices" target="_blank">Ad Choices</a> <span class="desktop-slash">/</span> <br class="mobile-break"><a id="wolves-ccpa" role="button">Do Not Sell My Personal Information</a>\n    </div>\n    <div class="footer-progress">\n        <div class="count"></div>\n        <div class="mapped"></div>\n        <div class="location">Kepler <span class="dash"></span> 22B</div>\n    </div>\n</footer>\n<div class="landscape-prompt">\n    <div class="spinner"></div>\n    <div class="message">Error<br><br>Rotate device<br>for access</div>\n</div>\n        `;const o=this.shadowRoot.querySelector("canvas");ln.init(o,3);const s=gn();let l=!1,u=!1,c=!1,d=!1,p=!1;async function m(){!function(){let e,t=!1,n=!1;const i=new Howl({src:[WOLVES_CDN+"assets/audio/landing.mp3"],autoplay:!0,loop:!0,volume:.5});function r(){e&&(e.off("fade",r),e.unload(),e=null)}a.on("viewer-open",({index:r})=>{const{audio:o,ext:a}=s[r];if(!o&&"mp4"!==a)return;if(t=!0,i.fade(.5,0,1e3),!o)return;const l=o.includes("//")?o:WOLVES_CDN+o;e=new Howl({src:[l],autoplay:!0,loop:!0,volume:1,mute:n})}),a.on("viewer-close",()=>{t&&(i.fade(0,.5,1e3),t=!1),e&&(e.on("fade",r),e.fade(1,0,500))}),a.on("toggle-mute",({mute:t})=>{n=t,i.mute(n),e&&e.mute(n)}),document.addEventListener("visibilitychange",(function(){Howler.mute(document.hidden)}))}(),new un(p,e.shadowRoot),new Tn(3),new Sn(3,e.shadowRoot),new Vn,new Dn(3,e.shadowRoot),new kn(e.shadowRoot),new Gn(e.shadowRoot),new Hn(e.shadowRoot),new Wn(e.shadowRoot),new qn(e.shadowRoot),new jn(e.shadowRoot),new Xn(e.shadowRoot);let t=2;function i(){t--,t||a.emit("identity-start")}a.on("map-loaded",i),a.on("intro-end",i),a.on("identity-end",()=>{a.emit("interaction-start")}),a.on("interaction-start",()=>{WOLVES_PROGRESS.found.length||(e.isClickInstructions=!0,a.emit("instructions-open",{caption:" Attention",title:(n?"Tap":"Click")+" to<br>uncover<br>location"}))}),f()}function f(){let e="map";u&&(e="dashboard"),l&&(e="viewer"),c&&(e="signup"),d&&(e="message"),h.push({view:e})}function v(){localStorage.setItem("wolves_content",JSON.stringify(WOLVES_PROGRESS))}function g(){30===WOLVES_PROGRESS.found.length&&(e.queueCompleteMessage=!0)}function w(){e.isClickInstructions&&(e.isClickInstructions=!1,a.emit("instructions-close"))}function x({perc:t}){if(!e.isMappedMessage)return localStorage.getItem("wolves_mapped")?e.isMappedMessage=!0:void(t>=100&&(e.isMappedMessage=!0,localStorage.setItem("wolves_mapped",!0),a.emit("message-open",{title:"100% MAPPED",prompt:"Watch Sneak Peak",message:`Well done. You have scanned all available Kepler-22B terrain in ${WOLVES_PROGRESS.clicks.length/2} scane. You've unlocked this sneak peak to season 2 of Raised by Wolves.`,callback:()=>open("https://www.youtube.com/watch?v=dQw4w9WgXcQ","_blank")}),window.dataLayer.push({event:"rbw_100pc_mapped"})))}function y(){if(!e.isOnceFoundInstructions){if(WOLVES_PROGRESS.found.length)return;e.isOnceFoundInstructions=!0,e.isFoundInstructions=!0,a.emit("instructions-open",{caption:" New Object Found",title:(n?"Tap":"Click")+"<br>icons to<br>examine"})}}function _(){a.off("viewer-close",_),e.isOnceMovedInstructions||ln.mapPos.value.len()>.3||(e.isOnceMovedInstructions=!0,a.emit("instructions-open",{caption:" Instruction",title:"Drag to<br>explore<br>the map"}),a.on("drag",(function e(){a.off("drag",e),a.emit("instructions-close")})))}function b({view:t}){"map"===t?window.dataLayer.push({event:"rbw_screen_viewed",screen:"map"}):"dashboard"===t?window.dataLayer.push({event:"rbw_screen_viewed",screen:"menu"}):"signup"===t&&window.dataLayer.push({event:"rbw_screen_viewed",screen:"sign-up"}),"map"===t&&setTimeout(()=>{e.queuePhase1Message&&(e.queuePhase1Message=!1,a.emit("message-open",{title:"SCAN COMPLETE",prompt:"Get updates",message:"You have found all transmissions currently available. More will be discovered soon.",callback:()=>a.emit("signup-open")}),window.dataLayer.push({event:"rbw_items_found",amount:10})),e.queuePhase2Message&&(e.queuePhase2Message=!1,a.emit("message-open",{title:"SCAN COMPLETE",prompt:"Get updates",message:"You have found all transmissions currently available. More will be discovered soon.",callback:()=>a.emit("signup-open")}),window.dataLayer.push({event:"rbw_items_found",amount:20})),e.queueCompleteMessage&&(e.queueCompleteMessage=!1,a.emit("message-open",{title:"MISSION COMPLETE",prompt:"View Exclusive Content",message:`You have uncovered all of the available content on planet Kepler-22B. You scanned ${WOLVES_PROGRESS.clicks.length/2} times.`,callback:()=>{M(),a.emit("viewer-open",{index:30}),window.dataLayer.push({event:"rbw_items_found",amount:31})}}),window.dataLayer.push({event:"rbw_items_found",amount:30}))},0),"viewer"===t&&e.isFoundInstructions&&a.emit("instructions-close")}function M(){a.emit("show-bonus")}function A(){m()}function E(){}window.dataLayer=window.dataLayer||[],function(){if("localhost"===location.hostname)return;if(!n)return;document.addEventListener("touchend",()=>{document.body.requestFullscreen()},!1)}(),function(){const t=e.shadowRoot.querySelector("#wolves-ccpa"),n=document.querySelector("#compliance-link");if(n){const e=document.querySelector("footer");e&&Object.assign(e.style,{position:"fixed",bottom:"100%"}),t.addEventListener("click",()=>n.click())}}(),function(){t.searchParams.has("skip")&&(p=!0,t.searchParams.delete("skip"));localStorage.getItem("wolves_intro")&&(p=!0)}(),function(){let e=JSON.parse(localStorage.getItem("wolves_content"));if(!e)return WOLVES_PROGRESS.clicks=[],void(WOLVES_PROGRESS.found=[]);WOLVES_PROGRESS.clicks=e.clicks.slice(),WOLVES_PROGRESS.found=e.found.slice(),e.found.forEach(e=>{s[e].isFound=!0}),30===WOLVES_PROGRESS.found.length&&setTimeout(M)}(),e.onAttach=A,e.onDetach=E,a.on("viewer-open",()=>{l=!0,f()}),a.on("viewer-close",()=>{l=!1,f()}),a.on("dashboard-open",()=>{u=!0,f()}),a.on("dashboard-close",()=>{u=!1,f()}),a.on("signup-open",()=>{l&&a.emit("viewer-close"),c=!0,f()}),a.on("signup-close",()=>{c=!1,f()}),a.on("message-open",()=>{l&&a.emit("viewer-close"),u&&a.emit("dashboard-close"),d=!0,f()}),a.on("message-close",()=>{d=!1,f()}),window.addEventListener("unload",v),h.link("view",b),a.on("wolves-update-found",g),a.on("wolves-update-clicks",w),a.on("wolves-update-uncovered",y),a.on("wolves-update-mapped",x),WOLVES_PROGRESS.found.length||a.on("viewer-close",_),location.search&&history.replaceState(null,"",t.toString())}connectedCallback(){this.onAttach&&this.onAttach()}disconnectedCallback(){this.onDetach&&this.onDetach()}}if(Yn)new function(){const e=document.createElement("link");e.rel="stylesheet",e.href="https://fast.fonts.net/cssapi/c74e648c-2df9-47d9-869f-c05e3572bb01.css",document.head.appendChild(e);const t=document.createElement("div");t.className="fallback",t.innerHTML=`\n        <link rel="stylesheet" href="${WOLVES_CDN}assets/css/fallback.css" />\n        <div class="fallback-title"></div>\n        <div class="fallback-message">Your browser<br>is not supported.</div>\n        <div class="fallback-text">Gain access using<br>the latest version of<br><a href="https://www.mozilla.org/en-US/firefox/new/">Firefox</a>, <a href="https://www.google.com/chrome/">Chrome</a> or <a href="https://www.microsoft.com/en-us/edge">Edge</a></div>\n        <div class="fallback-footer-legals">\n            <a href="https://www.hbomax.com/privacy">Privacy Policy</a> / <a href="https://www.hbomax.com/terms-of-use">Terms of Use</a>\n            <a id="wolves-ccpa" role="button">Do Not Sell My Personal Information</a>\n        </div>\n    `,(document.querySelector("#app-mount-rbw")||document.body).appendChild(t)};else{customElements.define("wolves-canvas",Zn);(document.querySelector("#app-mount-rbw")||document.body).appendChild(document.createElement("wolves-canvas"))}}();
