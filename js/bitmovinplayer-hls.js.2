/**************************************************************************** 
 * Copyright (C) 2020, Bitmovin, Inc., All Rights Reserved 
 * 
 * This source code and its use and distribution, is subject to the terms 
 * and conditions of the applicable license agreement. 
 * 
 * Bitmovin Player Version 8.34.0 
 * 
 ****************************************************************************/
(function() {
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.hls=e():(t.bitmovin=t.bitmovin||{},t.bitmovin.player=t.bitmovin.player||{},t.bitmovin.player.hls=e())}(this,function(){return webpackJsonpbitmovin_player__name_([7],{115:function(t,e,n){"use strict";function i(t){var e="";return t.RESOLUTION&&(e+=t.RESOLUTION.height+"_"),e+=t.BANDWIDTH}var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),s=n(54),o=n(28),u=function(){function t(){var t=this;this.on=function(e,n){t.listeners.hasOwnProperty(e)||(t.listeners[e]=[]),t.listeners[e].push(n)},this.off=function(e,n){if(!t.listeners.hasOwnProperty(e))return!1;var i=t.listeners[e].indexOf(n);return i>-1&&(t.listeners[e].splice(i,1),!0)},this.trigger=function(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];t.listeners.hasOwnProperty(e)&&t.listeners[e].forEach(function(t){return t.apply(null,n)})},this.pipe=function(e){t.on("data",function(t){e.push(t)})},this.dispose=function(){t.listeners={}},this.listeners={}}return t}(),c=function(t){function e(){var e=t.call(this)||this;return e.buffer="",e}return r(e,t),e.prototype.push=function(t){this.buffer+=t;for(var e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},e}(u),l=function(t){function e(){return t.call(this)||this}return r(e,t),e.parseAttributes=function(t){for(var n=t.split(e.attributeSeparator),i=n.length,r={};i--;)if(""!==n[i]){var a=/([^=]*)=(.*)/.exec(n[i]).slice(1);a[0]=a[0].replace(/^\s+|\s+$/g,""),a[1]=a[1].replace(/^\s+|\s+$/g,""),a[1]=a[1].replace(/^['"](.*)['"]$/g,"$1"),r[a[0]]=a[1]}return r},e.prototype.push=function(t){var n,i;if(t=t.replace(/^[\u0000\s]+|[\u0000\s]+$/g,""),0!==t.length){if("#"!==t[0])return void this.trigger("data",{type:"uri",uri:t});if(t=t.replace("\r",""),n=/^#EXTM3U/.exec(t))return void this.trigger("data",{type:"tag",tagType:"m3u"});if(n=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(t))return void this.trigger("data",{type:"tag",tagType:"independent-segments"});if(n=/^#EXT-X-MEDIA:(.*)$/.exec(t))return i={type:"tag",tagType:"media"},n[1]&&(i.attributes=e.parseAttributes(n[1])),void this.trigger("data",i);if(n=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return i={type:"tag",tagType:"inf"},n[1]&&(i.duration=parseFloat(n[1])),n[2]&&(i.title=n[2]),void this.trigger("data",i);if(n=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"targetduration"},n[1]&&(i.duration=parseInt(n[1],10)),void this.trigger("data",i);if(n=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"version"},n[1]&&(i.version=parseInt(n[1],10)),void this.trigger("data",i);if(n=/^#EXT-X-START:(.*)$/.exec(t))return i={type:"tag",tagType:"start"},n[1]&&(i.attributes=e.parseAttributes(n[1])),void this.trigger("data",i);if(n=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return i={type:"tag",tagType:"media-sequence"},n[1]&&(i.number=parseInt(n[1],10)),void this.trigger("data",i);if(n=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return i={type:"tag",tagType:"discontinuity-sequence"},n[1]&&(i.number=parseInt(n[1],10)),void this.trigger("data",i);if(n=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return i={type:"tag",tagType:"playlist-type"},n[1]&&(i.playlistType=n[1]),void this.trigger("data",i);if(n=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"byterange"},n[1]&&(i.length=parseInt(n[1],10)),n[2]&&(i.offset=parseInt(n[2],10)),void this.trigger("data",i);if(n=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return i={type:"tag",tagType:"allow-cache"},n[1]&&(i.allowed=!/NO/.test(n[1])),void this.trigger("data",i);if(n=/^#EXT-X-SESSION-DATA:?(.*)$/.exec(t))return i={type:"tag",tagType:"session-data"},n[1]&&(i.attributes=e.parseAttributes(n[1])),void this.trigger("data",i);if(n=/^#EXT-X-SESSION-KEY:?(.*)$/.exec(t))return i={type:"tag",tagType:"session-key"},n[1]&&(i.attributes=e.parseAttributes(n[1]),i.attributes.IV&&(i.attributes.IV=i.attributes.IV.toLowerCase(),"0x"===i.attributes.IV.substring(0,2)&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=new Uint8Array(o.FormatHelper.hexToBytes(i.attributes.IV)).buffer)),void this.trigger("data",i);if(n=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t)){if(i={type:"tag",tagType:"stream-inf"},n[1]){if(i.attributes=e.parseAttributes(n[1]),i.attributes.RESOLUTION){var r=i.attributes.RESOLUTION.split("x"),a={};r[0]&&(a.width=parseInt(r[0],10)),r[1]&&(a.height=parseInt(r[1],10)),i.attributes.RESOLUTION=a}i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["AVERAGE-BANDWIDTH"]&&(i.attributes["AVERAGE-BANDWIDTH"]=parseInt(i.attributes["AVERAGE-BANDWIDTH"],10)),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))}return void this.trigger("data",i)}if(n=/^#EXT-X-I-FRAME-STREAM-INF:?(.*)$/.exec(t)){if(i={type:"tag",tagType:"i-frame-stream-inf"},n[1]&&(i.attributes=e.parseAttributes(n[1]),i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["AVERAGE-BANDWIDTH"]&&(i.attributes["AVERAGE-BANDWIDTH"]=parseInt(i.attributes["AVERAGE-BANDWIDTH"],10)),i.attributes.RESOLUTION)){var r=i.attributes.RESOLUTION.split("x"),a={};r[0]&&(a.width=parseInt(r[0],10)),r[1]&&(a.height=parseInt(r[1],10)),i.attributes.RESOLUTION=a}return void this.trigger("data",i)}return(n=/^#EXT-X-ENDLIST/.exec(t))?void this.trigger("data",{type:"tag",tagType:"endlist"}):(n=/^#EXT-X-DISCONTINUITY/.exec(t))?void this.trigger("data",{type:"tag",tagType:"discontinuity"}):(n=/^#EXT-X-KEY:?(.*)$/.exec(t))?(i={type:"tag",tagType:"key"},n[1]&&(i.attributes=e.parseAttributes(n[1]),i.attributes.IV&&(i.attributes.IV=i.attributes.IV.toLowerCase(),"0x"===i.attributes.IV.substring(0,2)&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=new Uint8Array(o.FormatHelper.hexToBytes(i.attributes.IV)).buffer)),void this.trigger("data",i)):(n=/^#EXT-X-MAP:?(.*)$/.exec(t))?(i={type:"tag",tagType:"map"},n[1]&&(i.attributes=e.parseAttributes(n[1])),void this.trigger("data",i)):(n=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))?(i={type:"tag",tagType:"date-time"},n[1]&&(i.dateTime=new Date(n[1])),void this.trigger("data",i)):(n=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))?void this.trigger("data",{type:"tag",tagType:"cue-out-cont",data:n[1]||""}):(n=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))?void this.trigger("data",{type:"tag",tagType:"cue-out",data:n[1]||""}):(n=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))?void this.trigger("data",{type:"tag",tagType:"cue-in",data:n[1]||""}):(n=/^#EXT-X-SCTE35:?(.*)?$/.exec(t))?void this.trigger("data",{type:"tag",tagType:"scte35",data:n[1]||""}):(n=/^#EXT-X-DATERANGE:?(.*)?$/.exec(t))?void this.trigger("data",{type:"tag",tagType:"daterange",data:n[1]||""}):void this.trigger("data",{type:"tag",tagType:"unknown",data:t.slice(0,t.length)})}},e.attributeSeparator=new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))'),e}(u),d=function(t){function e(n){var r=t.call(this)||this;return r.onData=function(t){({tag:function(){(({"allow-cache":function(){r.manifestObj.allowCache=t.allowed,"allowed"in t||(r.trigger("info",{message:"defaulting allowCache to YES"}),r.manifestObj.allowCache=!0)},byterange:function(){var e={};"length"in t&&(r.currentUri.byterange=e,e.length=t.length,"offset"in t||(r.trigger("info",{message:"defaulting offset to zero"}),t.offset=0)),"offset"in t&&(r.currentUri.byterange=e,e.offset=t.offset)},endlist:function(){r.manifestObj.endList=!0},inf:function(){"mediaSequence"in r.manifest||(r.manifestObj.mediaSequence=0,r.trigger("info",{message:"defaulting media sequence to zero"})),t.duration>=0&&(r.currentUri.duration=t.duration),r.manifestObj.segments=r.uris},key:function(){if(!t.attributes)return void r.trigger("warn",{message:"ignoring key declaration without attribute list"});if("NONE"===t.attributes.METHOD)return void(r.keys=[]);if(!t.attributes.URI)return void r.trigger("warn",{message:"ignoring key declaration without URI"});t.attributes.METHOD||r.trigger("warn",{message:"defaulting key method to AES-128"}),r.keysInUse&&(r.keys=[],r.keysInUse=!1);var e={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI};void 0!==t.attributes.IV&&(e.iv=t.attributes.IV),t.attributes.KEYFORMAT&&(e.keyformat=t.attributes.KEYFORMAT),t.attributes.KEYFORMATVERSIONS&&(e.keyformatversions=t.attributes.KEYFORMATVERSIONS),t.attributes.KEYID&&(e.keyid=t.attributes.KEYID),r.keys.push(e)},"media-sequence":function(){return isFinite(t.number)?void(r.manifestObj.mediaSequence=t.number):void r.trigger("warn",{message:"ignoring invalid media sequence: "+t.number})},"discontinuity-sequence":function(){return isFinite(t.number)?void(r.manifestObj.discontinuitySequence=t.number):void r.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number})},"playlist-type":function(){return/VOD|EVENT/.test(t.playlistType)?void(r.manifestObj.playlistType=t.playlistType):void r.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist})},"stream-inf":function(){return r.manifestObj.playlists=r.uris,t.attributes?(r.currentUri.attributes||(r.currentUri.attributes={}),r.currentUri.id=i(t.attributes),void(r.currentUri.attributes=e.mergeFn(t.attributes,r.currentUri.attributes))):void r.trigger("warn",{message:"ignoring empty stream-inf attributes"})},"i-frame-stream-inf":function(){var e={name:"i-frame-stream-inf"};t.attributes&&(e.attributes=t.attributes),r.manifestObj.tags.push(e)},media:function(){r.manifestObj.media.push({attributes:t.attributes});var e={name:"media"};t.attributes&&(e.attributes=t.attributes),r.manifestObj.tags.push(e)},start:function(){var e={};t.attributes.hasOwnProperty("TIME-OFFSET")&&(e.timeOffset=Number(t.attributes["TIME-OFFSET"]),e.precise="YES"===t.attributes.PRECISE,r.manifestObj.start=e);var n={name:"start"};e.hasOwnProperty("timeOffset")&&(n.attributes={"TIME-OFFSET":e.timeOffset,PRECISE:e.precise}),r.manifestObj.tags.push(n)},discontinuity:function(){r.currentUri.discontinuity=!0,r.manifestObj.discontinuityStarts.push(r.uris.length)},"date-time":function(){r.manifestObj.dateTime=t.dateTime},targetduration:function(){return!isFinite(t.duration)||t.duration<0?void r.trigger("warn",{message:"ignoring invalid target duration: "+t.duration}):void(r.manifestObj.targetDuration=t.duration)},map:function(){if(t.attributes&&t.attributes.URI&&(r.init={url:t.attributes.URI},t.attributes.BYTERANGE)){var e=t.attributes.BYTERANGE.split("@"),n=e[0],i=e[1];r.init.byteRange={start:parseInt(i),end:parseInt(i)+parseInt(n)-1}}},"independent-segments":function(){r.manifestObj.independentSegments=!0,r.manifestObj.tags.push({name:"independent-segments"})},"session-data":function(){var e={name:"session-data"};t.attributes&&(e.attributes=t.attributes),r.manifestObj.tags.push(e)},"session-key":function(){var e={name:"session-key"};t.attributes&&(e.attributes=t.attributes),r.manifestObj.tags.push(e)},"cue-out":function(){r.cueTag=e.getCueTag(t)},"cue-out-cont":function(){r.cueTag=e.getCueTag(t)},"cue-in":function(){r.cueTag=e.getCueTag(t)},scte35:function(){r.scte35.push({type:a.MetadataType.SCTE,attributes:l.parseAttributes(t.data)})},daterange:function(){r.dateRange=e.getDateRange(t)},version:function(){r.manifestObj.version=void 0!==t.version?t.version:1},unknown:function(){r.customTags.push({type:a.MetadataType.CUSTOM,attributes:t.data});var e=r.getCustomTag(t.data);e&&r.manifestObj.tags.push(e)}})[t.tagType]||function(){})()},uri:function(){r.currentUri.uri=t.uri,!r.manifestObj.targetDuration||"duration"in r.currentUri||(r.trigger("warn",{message:"defaulting segment duration to the target duration"}),r.currentUri.duration=r.manifestObj.targetDuration),r.keys.length>0&&(r.currentUri.keys=r.keys,r.keysInUse=!0),r.init&&(r.currentUri.init=r.init),r.cueTag&&(r.currentUri.cueTag=r.cueTag,r.cueTag=null),r.scte35.length>0&&(r.currentUri.scte35=r.scte35,r.scte35=[]),r.dateRange&&(r.currentUri.dateRange=r.dateRange,r.dateRange=null),r.customTags.length>0&&(r.currentUri.customTags=r.customTags,r.customTags=[]),r.manifestObj.dateTime&&(r.currentUri.dateTime=r.manifestObj.dateTime,delete r.manifestObj.dateTime),r.uris.push(r.currentUri),r.currentUri.duration&&(r.manifestObj.totalDuration+=r.currentUri.duration),r.currentUri={}},comment:function(){}})[t.type]()},r.end=function(){r.lineStream.push("\n")},r.logger=n,r.uris=[],r.currentUri={},r.keys=[],r.keysInUse=!1,r.cueTag=null,r.scte35=[],r.customTags=[],r.lineStream=new c,r.parseStream=new l,r.lineStream.pipe(r.parseStream),r.manifestObj={allowCache:!0,discontinuityStarts:[],endList:!1,media:[],segments:[],totalDuration:0,tags:[],version:1},r.parseStream.on("data",r.onData),r}return r(e,t),Object.defineProperty(e.prototype,"manifest",{get:function(){return this.manifestObj},enumerable:!0,configurable:!0}),e.getCueTag=function(t){var e={type:t.tagType.toUpperCase()};return t.data&&(e.attributes=t.data.split(",").map(function(t){return t.trim()})),e},e.getDateRange=function(t){var e={type:a.MetadataType.DATERANGE};if(t.data){var n=l.parseAttributes(t.data);e.clientAttributes={};for(var i in n)n.hasOwnProperty(i)&&(0===i.indexOf("X-")?e.clientAttributes[s.StringUtils.kebabCaseToCamelCase(i.substr(2))]=n[i]:e[s.StringUtils.kebabCaseToCamelCase(i)]=n[i])}return e.duration&&(e.duration=Number(e.duration)),e.plannedDuration&&(e.plannedDuration=Number(e.plannedDuration)),e.endOnNext&&(e.endOnNext=!0),e},e.prototype.getCustomTag=function(t){try{var e=/^#([^:=]*)(:|=)?(.*)$/.exec(t);if(e[1]){var n={name:e[1]},i="";if("="===e[2]&&e[3])i=e[3];else if(":"===e[2]&&e[3]){var r=/^([^:="]*)(:|=)?(.*)$/.exec(e[3]);"="===r[2]&&r[3]?n.attributes=l.parseAttributes(e[3]):i=e[3]}return i&&(n.value=i.replace(/^['"](.*)['"]$/g,"$1")),n}}catch(a){return this.logger&&this.logger.debug("Error occurred while parsing custom HLS tag: "+t),null}},e.prototype.push=function(t){this.lineStream.push(t)},e.mergeFn=function(t,n){if("object"!=typeof t||"object"!=typeof n)return t;if(Array.isArray(t)&&Array.isArray(t))return t;for(var i in t)n.hasOwnProperty(i)?n[i]=e.mergeFn(t[i],n[i]):n[i]=t[i];return n},e}(u),p=function(){function t(){}return t.parsePlaylist=function(t,e){var n=new d(e);if(n.push(t),n.end(),"playlists"in n.manifest){var i=n.manifest.playlists.map(function(t){return{name:"stream-inf",value:t.uri,attributes:t.attributes}});n.manifest.tags=n.manifest.tags.concat(i)}return n.manifest},t}();e.HlsUtils=p},127:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(25),r=n(174);e.setMasterPlaylistString=function(t){return i.createAction(r.HlsActionType.SetMasterPlaylistString,t)},e.setPlaylistType=function(t){return i.createAction(r.HlsActionType.SetPlaylistType,t)},e.setEndlist=function(t){return i.createAction(r.HlsActionType.SetEndlist,t)},e.setDefaultLanguages=function(t){return i.createAction(r.HlsActionType.SetDefaultLanguages,t)},e.setCustomTags=function(t){return i.createAction(r.HlsActionType.SetCustomTags,t)},e.updatePlaylist=function(t,e){return i.createAction(r.HlsActionType.UpdatePlaylist,{playlist:t,representation:e})},e.removeDroppedOutDiscontinuity=function(t,e){return i.createAction(r.HlsActionType.RemoveDroppedOutDiscontinuity,{discoSequences:t,representation:e})},e.updateDiscontinuityStartAndEndTimes=function(t,e){return i.createAction(r.HlsActionType.UpdateDiscontinuityStartAndEndTimes,{discoSequences:t,representation:e})},e.initExpectedPlaybackTimes=function(t,e,n){return i.createAction(r.HlsActionType.InitExpectedPlaybackTimes,{playlistId:t,segmentIndex:e,startTime:n})},e.initExpectedPlaybackTimesFromReferenceSegment=function(t){return i.createAction(r.HlsActionType.InitExpectedPlaybackTimesFromReferenceSegment,{playlistId:t.getRepresentationId().representationId,segmentUrl:t.getUrl(),segmentPlaybackTime:t.getPlaybackTime(),discontinuitySequenceNumber:t.getSegmentInfo().discontinuitySequenceNumber})},e.setPresentationTimeOffset=function(t,e){return i.createAction(r.HlsActionType.SetPresentationTimeOffset,{discoSequenceNumber:t,presentationTimeOffset:e})}},172:function(t,e,n){"use strict";var i=this&&this.__assign||function(){return i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},i.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var r=n(19),a=n(47),s=n(3),o=n(11),u=n(177),c=n(40),l=n(76),d=n(5),p=n(7),f=n(414),g=n(173),m=n(64),h=n(127),y=n(85);e.HLS_PERIOD_ID="0";var T=function(){function t(t){this.context=t,this.m3u8Translator=new g.M3u8Translator(t),this.totalDurationSec=1/0,this.dateRanges=[],this.sourceStore=t.serviceManager.get(d.ServiceName.SourceStoreService,t.sourceContext.sourceIdentifier)}return t.prototype.getFirstVideoAdaptationSet=function(){return this.getManifest().Period[0].AdaptationSet.find(function(t){var e=t._mimeType;return p.MimeTypeHelper.isVideo(e)})},t.prototype.getFirstAudioAdaptationSet=function(){var t=y.getDefaultLanguages(this.getCurrentHlsState()).AUDIO;return this.getManifest().Period[0].AdaptationSet.find(function(e){var n=e._mimeType,i=e._lang;return p.MimeTypeHelper.isAudio(n)&&(!t||i===t)})},t.prototype.getCurrentHlsState=function(){return y.getHlsState(this.sourceStore.getState())},t.prototype.findAdaptationSet=function(t){return this.getManifest().Period[0].AdaptationSet.find(function(e){return e._internalId.adaptationSetId===t})},t.prototype.onMasterPlaylistAvailable=function(t,e){this.m3u8Translator=new g.M3u8Translator(this.context);var n=this.m3u8Translator.createDashManifestSkeleton(e,t);n=u.initializeInternalIds(n),this.context.store.dispatch(c.setManifestAction(n)),this.context.store.dispatch(h.setDefaultLanguages(t)),this.context.store.dispatch(h.setCustomTags(t)),this.context.store.dispatch(h.setMasterPlaylistString(t.rawString))},t.prototype.getManifest=function(){return l.getManifest(this.sourceStore.getState())},t.prototype.getAllVariantRepresentions=function(){var t={video:[],audio:[],subtitles:[]};return this.getManifest().Period[0].AdaptationSet.forEach(function(e){var n,i,r;p.MimeTypeHelper.isVideo(e._mimeType)?(n=t.video).push.apply(n,e.Representation):p.MimeTypeHelper.isAudio(e._mimeType)?(i=t.audio).push.apply(i,e.Representation):p.MimeTypeHelper.isSubtitle(e._mimeType)&&(r=t.subtitles).push.apply(r,e.Representation)}),t},t.prototype.onMediaLoaded=function(t,e,n,i,r){var a=this;this.sourceStore.dispatch(h.setMasterPlaylistString(t)),this.sourceStore.dispatch(h.setEndlist(Boolean(n.endList))),n.playlistType&&!y.getPlaylistType(this.getCurrentHlsState())&&this.sourceStore.dispatch(h.setPlaylistType(n.playlistType)),p.MimeTypeHelper.isAV(e._mimeType)&&(this.trackPlaylistDuration(n),this.updateDashManifestProperties(n,r)),this.calculatePlaylistStartTime(n,r);var s=this.getManifest().Period[0],o=this.getRepresentationsFromUrl(e.Uri,s),u=o.map(function(t){return a.updateRepresentation(t,r,n,i)});return u.forEach(function(t){a.sourceStore.dispatch(h.updatePlaylist(n,t)),a.sourceStore.dispatch(h.removeDroppedOutDiscontinuity(i,t)),a.sourceStore.dispatch(h.updateDiscontinuityStartAndEndTimes(i,t));var e=t._id,r=y.getPlaylistSegments(a.getCurrentHlsState(),e),o=a.determineFirstDiscoStartTime(r,n);a.updatePeriodStartAndDuration(s,o,i);var u=r.length>0&&null==r[0].expectedPlaybackTime;u&&a.initExpectedPlaybackTimesFromDiscoSequenceStartTime(e,i)}),f.handleDateRangeMetadata(n,this.dateRanges,this.context.serviceManager.get(d.ServiceName.TimedMetadataService)),u.find(function(t){return t._id===e._id})},t.prototype.determineFirstDiscoStartTime=function(t,e){var n=t.length>0&&null!=t[0].expectedPlaybackTime;return n?y.getFirstDiscoSequenceTiming(this.getCurrentHlsState()).startTime:e.startTime},t.prototype.updatePeriodStartAndDuration=function(t,n,i){var r=i.reduce(function(t,e){return t+e.duration},0),a=0===t.duration?r:Math.min(t.duration,r),s=this.isLive()?1/0:a,o={start:n,_start:"PT"+n+"S",duration:s,_duration:"PT"+a+"S"};this.sourceStore.dispatch(c.updatePeriodTimingAction(e.HLS_PERIOD_ID,o))},t.prototype.trackPlaylistDuration=function(t){this.totalDurationSec=t.endList?Math.min(this.totalDurationSec,t.totalDuration):t.totalDuration},t.prototype.updateDashManifestProperties=function(t,e){var n,i=!t.endList,r=l.getManifest(this.sourceStore.getState()),a={_requestTimestamp:e,_type:i?"dynamic":"static",_mediaPresentationDuration:i?1/0:"PT"+this.totalDurationSec+"S",_maxSegmentDuration:"PT"+t.targetDuration+"S",_hasIndependentSegments:r._hasIndependentSegments||t.independentSegments};t.start&&(a._startOffset=m.PlaylistUtils.getStartOffset(t)),i&&(a._minimumUpdatePeriod="PT"+t.targetDuration+"S",a._timeShiftBufferDepth=-this.totalDurationSec,a._availabilityStartTime=(n=r._availabilityStartTime,null!==n&&void 0!==n?n:new Date(e-s.toMilliSeconds(this.totalDurationSec)).toISOString())),this.sourceStore.dispatch(c.updateManifestAction(a))},t.prototype.getRepresentationsFromUrl=function(t,e){return e.AdaptationSet.flatMap(function(e){return e.Representation.filter(function(e){return o.URLHelper.isSubUrl(t,e.Uri)})})},t.prototype.updateRepresentation=function(t,e,n,r){var a=i({},t);return a._requestTimestamp=e,a._updateInterval=m.calculateUpdateIntervalInSeconds(this.context.settings,n),a._hls=i(i({},a._hls),{requestTimestamp:e,mediaSequence:n.mediaSequence}),a.SegmentList=[{SegmentURL:[]}],this.updateSegmentList(a,n,r),this.sourceStore.dispatch(c.updateRepresentationAction(a)),a},t.prototype.updateSegmentList=function(e,n,i){var r=i.flatMap(function(t){return t.segments});if(0===r.length)return void this.context.logger.debug("No segments for representation "+e._id+" in loaded playlist");if(e.SegmentList){this.context.logger.debug("Updating segment list for playlist "+e._id);var a=this.getTranslatedSegmentList(e,r);a.contentProtectionInfos.length>0&&(e.ContentProtection=t.contentProtectionToXmlJson(a.contentProtectionInfos)),e.SegmentList[0].SegmentURL=a.entries,e.SegmentList[0]._duration=n.targetDuration,e.SegmentList[0]._timescale=1}},t.prototype.getTranslatedSegmentList=function(t,e){if(!this.isLive()){var n=this.context.serviceManager.maybeCall(d.ServiceName.ManifestCachingService,function(e){return e.getSegmentList(t.Uri)});return n||(n=this.m3u8Translator.translateSegmentList(t,e),this.context.serviceManager.maybeCall(d.ServiceName.ManifestCachingService,function(e){return e.cacheSegmentList(n,t.Uri)})),n}return this.m3u8Translator.translateSegmentList(t,e)},t.prototype.initExpectedPlaybackTimesFromDiscoSequenceStartTime=function(t,e){var n=this.getCurrentHlsState(),i=n.discontinuitySequenceTiming,r=Object.keys(i).reverse().find(function(t){return 0!==i[t].startTime});if(null!=r){var a=e.find(function(t){return String(t.id)===r});a&&a.segments[0].discontinuity&&this.sourceStore.dispatch(h.initExpectedPlaybackTimes(t,a.indexOfFirstSegment,i[r].startTime))}else this.context.logger.debug("Could not find any discontinuity start times to initialize expected segment playback times")},t.prototype.calculatePlaylistStartTime=function(t,e){var n=t.segments[0];t.endList?(t.startTime=a.getStartTimeOffset(this.sourceStore.getState()),t.segments[0].expectedPlaybackTime=t.startTime):n&&n.dateTime?(t.startTime=s.toSeconds(n.dateTime.getTime()),t.segments[0].expectedPlaybackTime=t.startTime):t.startTime=s.toSeconds(e)-t.totalDuration},t.prototype.isLive=function(){return"dynamic"===this.getManifest()._type},t.contentProtectionToXmlJson=function(t){return t.map(function(t){var e={_schemeIdUri:t.schemeIdUri};return t.defaultKid&&(e["_cenc:default_KID"]=t.defaultKid),t.pssh&&(e.pssh=[{__text:t.pssh}]),e})},t.prototype.dispose=function(){this.m3u8Translator=r.dispose(this.m3u8Translator)},t}();e.M3u8DashManifest=T},173:function(t,e,n){"use strict";function i(t,e){if(!c.ModuleManager.has(l.ModuleName.DRM))return null;var n=c.ModuleManager.get(l.ModuleName.DRM).ContentProtectionHelper;return n.parseContentProtection(t,e)}var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a,s=n(42),o=n(30),u=n(11),c=n(2),l=n(0),d=n(57),p=n(415);!function(t){t.Mp4="mp4"}(a=e.ContainerFormat||(e.ContainerFormat={}));var f=function(){function t(t){this.adaptationsetId=0,this.context=t,this.representationFactory=new p.M3u8RepresentationFactory(t)}return t.prototype.createCeaCaptionObjects=function(t,e){for(var n={},i={_schemeIdUri:"urn:scte:dash:cc:cea-"+e+":2015",_value:""},r=0;r<t.length;r++){var a=t[r]["INSTREAM-ID"];n[a]={lang:t[r].LANGUAGE||t[r].NAME||a,label:t[r].NAME||t[r].LANGUAGE||a},i._value.length>0&&(i._value+=";"),"708"===e?i._value+=a.substr(7)+"=lang:":i._value+=a+"=",i._value+=t[r].LANGUAGE}return{closedCaptionLabel:n,accessibility:i}},t.prototype.createCaptionElements=function(t){if(!t)return{closedCaptionLabel:null,accessibility:[]};var e=this.createCeaCaptionObjects(t.cea608,"608"),n=this.createCeaCaptionObjects(t.cea708,"708"),i=[],r=null;return e.accessibility._value&&(i.push(e.accessibility),r=e.closedCaptionLabel),n.accessibility._value&&i.push(n.accessibility),{closedCaptionLabel:r,accessibility:i}},t.prototype.createAdaptationSetWithUnknownCodecs=function(t,e){var n={_id:String(this.adaptationsetId),_mimeType:"unknown",_internalId:new d.AdaptationSetId(e,String(this.adaptationsetId++)),Representation:[{Uri:u.URLHelper.concatBaseUrlWithPartial(this.baseURL,t.uri),BaseURL:[{url:p.M3u8RepresentationFactory.getBaseUrl(this.baseURL,t.uri)}],_bandwidth:Number(t.attributes["AVERAGE-BANDWIDTH"]||t.attributes.BANDWIDTH)}],isTransmuxingRequired:!0};return n},t.prototype.createVideoAdaptationSet=function(t,e,n,i,r){for(var a=[],o=1/0,u=0,c=1/0,l=0,p=1/0,f=0,g=null,m="video/"+r,h=0,y=t;h<y.length;h++){var T=y[h];if(T.uri){var S=this.representationFactory.create(T,s.RepresentationType.VIDEO,r,this.baseURL,this.assumeAudioMuxedIntoVideoTs);a.push(S),o=Math.min(o,S._height),u=Math.max(u,S._height),c=Math.min(c,S._width),l=Math.max(l,S._width),p=Math.min(p,S._bandwidth),f=Math.max(f,S._bandwidth)}}a.sort(function(t,e){return t._bandwidth-e._bandwidth});var b={_id:"video",_contentType:"video"},v={Representation:a,ContentComponent:[b],_id:String(this.adaptationsetId),_group:g,_mimeType:m,_internalId:new d.AdaptationSetId(n,String(this.adaptationsetId++)),_minBandwidth:p,_maxBandwidth:f,_minHeight:o,_maxHeight:u,_minWidth:c,_maxWidth:l,_codecs:this.getVideoCodecForPlaylist(t[0],!0),isTransmuxingRequired:!0};i&&Object.keys(i).forEach(function(t){i[t].entries.filter(function(t){return!t.URI}).forEach(function(t){v.ContentComponent.push({_id:t.NAME,_contentType:"audio",_lang:t.LANGUAGE})})});var E=this.createCaptionElements(e);E.closedCaptionLabel&&(v.ClosedCaptionLabels=E.closedCaptionLabel),E.accessibility.length>0&&(v.Accessibility=E.accessibility);var A=this.getLabelForAdaptationSet(v);return A&&"string"==typeof A&&(v._label=A),v},t.prototype.createAudioAdaptationSet=function(t,e,n,i,r){for(var a=[],o=1/0,u=0,c=null,l=0,p=t;l<p.length;l++){var f=p[l];if(f.uri){var g=this.representationFactory.create(f,s.RepresentationType.AUDIO,r,this.baseURL,this.assumeAudioMuxedIntoVideoTs);a.push(g)}}a.sort(function(t,e){return t._bandwidth-e._bandwidth});var m={Representation:a,_id:String(this.adaptationsetId),_group:c,_mimeType:"audio/"+r,_internalId:new d.AdaptationSetId(n,String(this.adaptationsetId++)),_minBandwidth:o,_maxBandwidth:u,_codecs:this.getAudioCodecForPlaylist(t[0],!0),isTransmuxingRequired:!0},h=this.createCaptionElements(e);h.closedCaptionLabel&&(m.ClosedCaptionLabels=h.closedCaptionLabel),h.accessibility.length>0&&(m.Accessibility=h.accessibility);var y=this.getLabelForAdaptationSet(m);return y&&"string"==typeof y&&(m._label=y),m},t.prototype.createAudioAdaptationSets=function(t,e,n){var i=this,r=this.context.settings.IGNORE_HLS_AUDIO_GROUPS,a=0,o=[],u=function(e){return{Representation:[],_id:String(i.adaptationsetId),_internalId:new d.AdaptationSetId(t,String(i.adaptationsetId++)),_mimeType:"audio/"+n,_minBandwidth:1/0,_maxBandwidth:-1,_lang:e,_group:String(a++),_codecs:"",isTransmuxingRequired:!0}};return Object.keys(e).forEach(function(t){var a,c=e[t],l=c.entries.find(function(t){return t.LANGUAGE&&"und"!==t.LANGUAGE});l&&(a=l.LANGUAGE);var d;r||(d=u(a));for(var p in c.entries)if(c.entries.hasOwnProperty(p)&&c.entries[p].URI){r&&(d=u(a));var f=i.representationFactory.create(c.entries[p],s.RepresentationType.AUDIO,n,i.baseURL,i.assumeAudioMuxedIntoVideoTs);d.Representation.push(f),d._minBandwidth=Math.min(d._minBandwidth,f._bandwidth),d._maxBandwidth=Math.max(d._maxBandwidth,f._bandwidth);var g=c.entries[p].CHARACTERISTICS;if(g&&0===g.indexOf(i.context.settings.HLS_VR_CHARACTERISTICS_UTI)&&(d.Role=[{_schemeIdUri:i.context.settings.VR_SCHEME_ID_URI,_value:g.substring(i.context.settings.HLS_VR_CHARACTERISTICS_UTI.length)}]),!d._label){var m=i.getLabelForAdaptationSet(d);m&&"string"==typeof m?d._label=m:f._name?d._label=f._name:d._label=t}r&&d.Representation.length>0&&o.push(d),d.Representation.sort(function(t,e){return t._bandwidth-e._bandwidth})}!r&&d.Representation.length>0&&o.push(d)}),o},t.prototype.createSubtitleAdaptationSets=function(t,e,n){var i=this,r=0;return Object.values(e).filter(function(t){return t.URI}).map(function(e){var a={Representation:[],_id:String(i.adaptationsetId),_internalId:new d.AdaptationSetId(t,String(i.adaptationsetId++)),_mimeType:"application/mp4",_lang:e.LANGUAGE,_group:""+r++,_isFragmented:!0,_codecs:""},o=i.representationFactory.create(e,s.RepresentationType.SUBTITLE,n,i.baseURL,i.assumeAudioMuxedIntoVideoTs);a.Representation.push(o);var u=i.getLabelForAdaptationSet(a);return u&&"string"==typeof u?a._label=u:o._name?a._label=o._name:a._label=e.LANGUAGE,a})},t.prototype.getLabelForAdaptationSet=function(t){var e={mimeType:t._mimeType,lang:t._lang};t._label&&(e.label=t._label);var n=this.getLabelingFunctionForAdaptationSet();return n(e)},t.prototype.getLabelingFunctionForAdaptationSet=function(){var t=this.context.sourceContext,e=t&&t.source&&t.source.labeling;return e&&e.hls&&e.hls.tracks?"function"!=typeof e.hls.tracks?this.getDefaultLabelForAdaptationSet:e.hls.tracks:this.getDefaultLabelForAdaptationSet},t.prototype.getDefaultLabelForAdaptationSet=function(){return null},t.prototype.handleBackupStreams=function(t){for(var e=0;e<t.length;e++){var n=t[e];n.backupStreamUris=n.backupStreamUris||[];for(var i=e+1;i<t.length;i++){var r=t[i],a=n.attributes.BANDWIDTH===r.attributes.BANDWIDTH,s=n.attributes.RESOLUTION&&r.attributes.RESOLUTION,o=!s||s&&n.attributes.RESOLUTION.height===r.attributes.RESOLUTION.height&&n.attributes.RESOLUTION.width===r.attributes.RESOLUTION.width;a&&o&&(this.context.settings.DISABLE_HLS_BACKUP_STREAM_FAILOVER||n.backupStreamUris.push(r.uri),t.splice(i,1),i--)}}},t.prototype.createDashManifestSkeleton=function(t,e){var n=e;this.handleBackupStreams(n.playlists),this.playlistPreprocessing(n),this.assumeAudioMuxedIntoVideoTs=!this.hasAudioRenditionsWithUri(n),this.baseURL=u.URLHelper.removeLastPathPart(t);var i={BaseURL:[{url:this.baseURL}],Period:[this.createPeriod(n,"0")],_hasIndependentSegments:e.independentSegments,_isHls:!0};return i},t.prototype.isVariantOfMimeType=function(t,e){var n=o.CodecStringHelper.getMimeTypeForCodecString(t.attributes.CODECS);return n===e},t.prototype.removeUnsupportedAudioOnlyVariants=function(t){var e=this,n=t.playlists.some(function(t){return e.isVariantOfMimeType(t,"video")}),i=t.playlists.some(function(t){
return e.isVariantOfMimeType(t,"audio")});n&&i&&(t.playlists=t.playlists.filter(function(t){return e.isVariantOfMimeType(t,"video")}))},t.prototype.playlistPreprocessing=function(t){this.removeUnsupportedAudioOnlyVariants(t)},t.prototype.getVideoCodecForPlaylist=function(t,e){void 0===e&&(e=!1);var n=o.CodecStringHelper.extractCodecStrings(t.attributes.CODECS);return n.video?(o.CodecStringHelper.hasOldAvc1CodecFormat(n.video)&&(n.video=o.CodecStringHelper.convertAvc1ToAvcotiCodecFormat(n.video)),e?n.video:n.video.split(".")[0]):null},t.prototype.getAudioCodecForPlaylist=function(t,e){void 0===e&&(e=!1);var n=o.CodecStringHelper.extractCodecStrings(t.attributes.CODECS);return n.audio?e?n.audio:n.audio.split(".")[0]:null},t.prototype.getAllVideoCodecs=function(t){var e=this;return t.map(function(t){return e.getVideoCodecForPlaylist(t)}).filter(function(t,e,n){return t&&n.indexOf(t)===e})},t.prototype.getAllAudioCodecs=function(t){var e=this;return t.map(function(t){return e.getAudioCodecForPlaylist(t)}).filter(function(t,e,n){return t&&n.indexOf(t)===e})},t.prototype.groupPlaylistsByCodec=function(t){var e=this.getAllVideoCodecs(t),n=this.getAllAudioCodecs(t);if(0===e.length&&0===n.length)return{unknown:t};if(0===e.length){var i={};return n.forEach(function(e){i[e]=t.filter(function(t){return t.attributes.CODECS&&t.attributes.CODECS.includes(e)})}),i}var r={};return e.forEach(function(e){r[e]=t.filter(function(t){return t.attributes.CODECS&&t.attributes.CODECS.includes(e)})}),r},t.prototype.createPeriod=function(e,n){var i=this,r={_id:n,_duration:"PT0S",duration:0,AdaptationSet:[]},s=function(t){return null==t.attributes.CODECS||i.context.renderer.isMediaTypeSupported("video/mp4",t.attributes.CODECS)},u=g.extractMediaRenditions(e,this.context.settings.IGNORE_HLS_AUDIO_GROUPS,s),c=this.groupPlaylistsByCodec(e.playlists),l=Object.keys(c),d=l.filter(function(t){return o.CodecStringHelper.isVideoCodec(t)}).map(function(t){return i.createVideoAdaptationSet(c[t],u.captions,r._id,u.audio,a.Mp4)}).filter(function(e){return e.Representation=e.Representation.reduce(function(e,n){var r=t.isRepresentationSupported(n,i.context.renderer),a=Boolean(e.find(function(t){return t.Uri===n.Uri}));return r&&!a&&e.push(n),e},[]),e.Representation.length>0}),p=l.filter(function(t){return"unknown"===t}).flatMap(function(t){return c[t]}).map(function(t){return i.createAdaptationSetWithUnknownCodecs(t,r._id)}),f=this.createAudioAdaptationSets(r._id,u.audio,a.Mp4).filter(function(e){return e.Representation=e.Representation.filter(function(e){return t.isRepresentationSupported(e,i.context.renderer)}),e.Representation.length>0}).concat(l.filter(function(t){return o.CodecStringHelper.isAudioCodec(t)}).map(function(t){return i.createAudioAdaptationSet(c[t],u.captions,r._id,u.audio,a.Mp4)})),m=this.createSubtitleAdaptationSets(r._id,u.subtitles,a.Mp4);return r.AdaptationSet=[].concat(d,f,m,p),r},t.isRepresentationSupported=function(t,e){var n=!t._mimeType.includes("audio")&&!t._mimeType.includes("video");if(!t._codecs||n)return!0;var i=o.CodecStringHelper.extractCodecStrings(t._codecs);return Object.keys(i).every(function(t){return o.CodecStringHelper.isSupportedByRenderer(e,t+"/mp4",i[t])})},t.prototype.hasAudioRenditionsWithUri=function(t){return t.media.some(function(t){return"AUDIO"===t.attributes.TYPE&&Boolean(t.attributes.URI)})},t.parseBase64DataUrl=function(t){var e=new RegExp(/^data:text\/plain.*;base64.*,(.+)/),n=e.exec(t);return null!==n&&2===n.length?n[1]:null},t.prototype.translateSegmentList=function(e,n){var a=this,s=[],o=u.URLHelper.getDomainUrl(e.BaseURL[0].url),c=[];return n.forEach(function(n,l){n.uri=u.URLHelper.buildAbsoluteUrl(e.BaseURL[0].url,o,n.uri);var d=null;(n.keys||[]).forEach(function(n){var s=t.parseBase64DataUrl(n.uri);if(null!==s){var p=i(n,s);if(!p)return void a.context.logger.debug("Encountered unknown/unsupported DRM scheme:",n.keyformat);var f=void 0!==c.find(function(t){return!Object.keys(p).some(function(e){return p[e]!==t[e]})});f||c.push(p),c.length>0&&(d=null)}else{var g=new ArrayBuffer(16);new DataView(g).setInt32(12,e._hls.mediaSequence+l),d=r(r({iv:g},n),{uri:u.URLHelper.buildAbsoluteUrl(e.BaseURL[0].url,o,n.uri)})}}),n.init&&(n.init.url=u.URLHelper.buildAbsoluteUrl(e.BaseURL[0].url,o,n.init.url),d&&(n.init.key=d));var p={_media:n.uri,_duration:n.duration,_key:d,_metadata:[],_init:n.init,_discontinuitySequenceNumber:n.discontinuitySequenceNumber};["cueTag","scte35","customTags"].filter(function(t){return n.hasOwnProperty(t)}).forEach(function(t){return p._metadata=p._metadata.concat(n[t])}),n.dateTime&&(p._dateTime=n.dateTime),n.byterange&&(p._byteRange={start:n.byterange.offset,end:n.byterange.offset+n.byterange.length-1}),s.push(p)}),{entries:s,contentProtectionInfos:c}},t.prototype.dispose=function(){this.baseURL=null},t}();e.M3u8Translator=f;var g;!function(t){function e(t,e){var n={};return t.forEach(function(t){var i=e[t["GROUP-ID"]]||e[Object.keys(e)[0]];t.BANDWIDTH=i[0].BANDWIDTH,t.CODECS=i[0].CODECS;var r=t["AVERAGE-BANDWIDTH"]||t.BANDWIDTH,a=n[t.NAME];void 0!==a?(a.entries.push(t),a.MIN_BANDWIDTH=Math.min(a.MIN_BANDWIDTH,r),a.MAX_BANDWIDTH=Math.max(a.MAX_BANDWIDTH,r)):n[t.NAME]={entries:[t],MIN_BANDWIDTH:r,MAX_BANDWIDTH:r}}),n}function n(t){var e={};return t.forEach(function(t){return e[t.NAME]=t}),e}function i(t){var e={cea608:[],cea708:[]};return t.forEach(function(t){t["INSTREAM-ID"]&&0===t["INSTREAM-ID"].indexOf("CC")?e.cea608.push(t):t["INSTREAM-ID"]&&0===t["INSTREAM-ID"].indexOf("SERVICE")&&e.cea708.push(t)}),e}function r(t,r,a){var s=t.playlists.filter(a),o=t.media.map(function(t){return t.attributes}),c=u(s),l=o.filter(function(t){var e="AUDIO"===t.TYPE,n=c[t["GROUP-ID"]];return e&&(r||n)}),d=o.filter(function(t){return"SUBTITLES"===t.TYPE}),p=o.filter(function(t){return"CLOSED-CAPTIONS"===t.TYPE});return{audio:e(l,c),subtitles:n(d),captions:i(p)}}function a(t){var e={};return t.forEach(function(t){var n=t.attributes.AUDIO;e[n]||(e[n]=[]);var i={BANDWIDTH:t.attributes.BANDWIDTH,CODECS:void 0};t.attributes.CODECS&&t.attributes.CODECS.indexOf(",")>-1&&(i.CODECS=c(t)),e[n].push(i)}),e}function s(t){Object.values(t).forEach(function(t){t.sort(function(t,e){return t.BANDWIDTH-e.BANDWIDTH})})}function u(t){var e=a(t);return s(e),e}function c(t){var e=t.attributes.CODECS.split(",");return e.find(function(t){return o.CodecStringHelper.isAudioCodec(t)})}t.extractMediaRenditions=r,t.getPropertiesForAudioGroups=u}(g=e.HlsParsing||(e.HlsParsing={}))},174:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i;!function(t){t.SetMasterPlaylistString="@instance/hls/setmasterplayliststring",t.SetPlaylistType="@instance/hls/setplaylisttype",t.SetEndlist="@instance/hls/setendlist",t.SetDefaultLanguages="@instance/hls/setsefaultlanguages",t.SetCustomTags="@instance/hls/setsustomtags",t.UpdatePlaylist="@instance/hls/updatePlaylist",t.RemoveDroppedOutDiscontinuity="@instance/hls/removedroppedoutdiscontinuity",t.UpdateDiscontinuityStartAndEndTimes="@instance/hls/updatediscontinuitystartandendtimes",t.InitExpectedPlaybackTimes="@instance/hls/initexpectedplaybacktimes",t.InitExpectedPlaybackTimesFromReferenceSegment="@instance/hls/initexpectedplaybacktimesfromreferencesegment",t.SetPresentationTimeOffset="@instance/hls/setpresentationtimeoffset"}(i=e.HlsActionType||(e.HlsActionType={}))},225:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.mimeTypeFilter=t,this.discoSequenceNumberChangedListeners=[],this.reset()}return t.prototype.notifyListeners=function(t){var e=this;this.discoSequenceNumberChangedListeners.forEach(function(n){return n(e.currentDiscontinuitySequenceNumber,t)})},t.prototype.trackSegment=function(t){var e;if(this.mimeTypeFilter(t.getMimeType())){var n=t.getSegmentInfo(),i=null===(e=n)||void 0===e?void 0:e.discontinuitySequenceNumber,r=isFinite(this.currentDiscontinuitySequenceNumber),a=this.currentDiscontinuitySequenceNumber!==i;r&&a&&this.notifyListeners(i),this.currentDiscontinuitySequenceNumber=i}},t.prototype.subscribe=function(t){this.discoSequenceNumberChangedListeners.push(t)},t.prototype.unsubscribe=function(t){var e=this.discoSequenceNumberChangedListeners.indexOf(t);e<0||this.discoSequenceNumberChangedListeners.splice(e,1)},t.prototype.reset=function(){this.currentDiscontinuitySequenceNumber=-(1/0)},t.prototype.dispose=function(){this.reset(),this.discoSequenceNumberChangedListeners=[]},t}();e.DiscontinuitySequenceNumberTracker=i},226:function(t,e,n){"use strict";function i(t,e){var n=t.getSegmentInfo();return e.findIndex(function(t){var e=n.discontinuitySequenceNumber===t._discontinuitySequenceNumber,i=n.url.includes(t._media),a=r.compareValues(n.byteRange,t._byteRange);return e&&i&&a})}Object.defineProperty(e,"__esModule",{value:!0});var r=n(110),a=function(){function t(t,e){this.context=t,this.playbackTimeNextSegment=null,this.allowedGapSizeSec=e}return t.prototype.reset=function(){this.playbackTimeNextSegment=null},t.prototype.trackPlaybackTime=function(t){this.playbackTimeNextSegment=t.getPlaybackTime()+t.getDuration()},t.prototype.checkForTimelineGap=function(t,e,n){var r,a,s,o={hasGap:!1,expectedPlaybackTime:this.playbackTimeNextSegment,actualPlaybackTime:t.getPlaybackTime(),couldHandle:!0};if(null==this.playbackTimeNextSegment)return o;s=t.getPlaybackTime()-this.playbackTimeNextSegment;var u=s,c=e.SegmentList[0].SegmentURL,l=c.some(function(t){return t.downloaded}),d=i(t,c),p=d>=0?d:n,f=p;if(s>this.allowedGapSizeSec&&l){for(;c[f]&&!c[f].downloaded&&f>=0;)f--;o.hasGap=!0,o.couldHandle=!1,o.correctedIndex=f+1,o.gapSizeSec=u}else if(s>this.allowedGapSizeSec){for(;s>this.allowedGapSizeSec;)if(a=null===(r=c[f-1])||void 0===r?void 0:r._duration,s-=null!==a&&void 0!==a?a:0,f--,f<0){this.context.logger.debug("Could not handle gap on playlist switch (i.e. find right segment), reached lower boundary of segment list"),f=0,o.couldHandle=!1;break}o.hasGap=!0,o.gapSizeSec=u,o.correctedIndex=f}else if(s+t.getDuration()<-this.allowedGapSizeSec){for(;s+c[f]._duration<-this.allowedGapSizeSec;)if(s+=c[f]._duration,f++,f>=c.length){this.context.logger.debug("Could not handle gap on playlist switch (i.e. find right segment), reached upper boundary of segment list"),f=c.length;break}o.hasGap=!0,o.gapSizeSec=u,o.correctedIndex=f}return f===p&&o.hasGap&&(this.context.logger.debug("Ignoring gap as calculated new segment index did not change"),o.hasGap=!1),o},t}();e.HlsTimelineTracker=a},227:function(t,e,n){"use strict";function i(t,n,i){var r=t.serviceManager.maybeCall(m.ServiceName.ManifestCachingService,function(t){return t.getParsedManifest(n)});return r?r:e.parseHlsManifest(t,i)}function r(t,e){var n=U.PlaylistUtils.createDiscontinuitySequences(t,e);return n.forEach(function(t,e){U.PlaylistUtils.extrapolateProgramDateTime(t.segments),t.indexOfFirstSegment=0===e?0:n[e-1].indexOfLastSegment+1,t.indexOfLastSegment=t.indexOfFirstSegment+t.segments.length-1}),n}function a(t){return t in T.M3u8Error}function s(t){return I.getManifest(t.getState()).Period[0]}function o(t,e){return e.AdaptationSet.find(function(e){return e._internalId.equals(t)})}function u(t,e){var n=o(t,e);return n?n.Representation.find(function(e){return e._internalId.equals(t)}):null}var c=this&&this.__assign||function(){return c=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},c.apply(this,arguments)},l=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var i=Array(t),r=0,e=0;e<n;e++)for(var a=arguments[e],s=0,o=a.length;s<o;s++,r++)i[r]=a[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var d,p=n(115),f=n(4),g=n(6),m=n(5),h=n(19),y=n(1),T=n(151),S=n(16),b=n(12),v=n(24),E=n(17),A=n(7),_=n(3),P=n(40),I=n(76),R=n(413),M=n(172),D=n(173),O=n(416),U=n(64);!function(t){t[t.NoBackupStreams=0]="NoBackupStreams",t[t.LoadingFailed=1]="LoadingFailed"}(d=e.BackupStreamErrors||(e.BackupStreamErrors={}));var x=function(t){return t.playlists.length>0},C=function(t){return t.segments.length>0},L=function(t){return U.isMasterPlaylist(t)&&x(t)||U.isMediaPlaylist(t)&&C(t)};e.getParsedManifest=i,e.parseHlsManifest=function(t,e){var n=p.HlsUtils.parsePlaylist(e,t.logger);if("playlists"in n){var i=n.playlists.filter(function(e){return e.attributes.BANDWIDTH>=t.settings.HLS_AUDIO_ONLY_THRESHOLD_BITRATE});n.playlists=i.length?i:n.playlists}return n},e.ensureMasterPlaylist=function(t,n,i){if(U.isMasterPlaylist(n))return n;t.logger.debug("HLS manifest is not a master playlist but a variant. Using master playlist template!");var r=["#EXTM3U","#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=0",i].join("\n"),a=e.parseHlsManifest(t,r);if(!U.isMasterPlaylist(a))throw new Error("Template is not of type HLS MasterPlaylist");return a};var N=function(){function t(t){var e=this;this.variantUpdateLoaders={},this.onMasterLoaded=function(t){if(e.isCancelled)return Promise.reject();var n=t.url,r=t.body,a=i(e.context,n,r);return e.context.serviceManager.maybeCall(m.ServiceName.ManifestCachingService,function(e){e.cacheHttpResponse(t,n),e.cacheParsedManifest(a,n)}),e.verifyMissingCodecs(a,r,n).then(function(t){return e.handleMasterPlaylist(t,n),e.loadFirstVariants().then(function(){return e.translatedManifest.getManifest()})["catch"](function(){return Promise.reject(new g.PlayerError(f.ErrorCode.SOURCE_HLS_STREAM_ERROR))})})["catch"](function(t){var n=t instanceof g.PlayerError?t:new g.PlayerError(f.ErrorCode.SOURCE_MANIFEST_INVALID);return e.context.logger.debug("codec verification failed",t),Promise.reject(n)})},this.context=t,this.registeredOnPlayEventHandlers=[],this.registeredOnPausedEventHandlers=[],this.discontinuitySequences=[],this.isCancelled=!1,this.translatedManifest=new M.M3u8DashManifest(t),this.masterPlaylistLoader=this.createLoader(b.HttpRequestType.MANIFEST_HLS_MASTER),this.sourceStore=t.serviceManager.get(m.ServiceName.SourceStoreService,t.sourceContext.sourceIdentifier)}return t.prototype.loadFirstVariants=function(){var t=[],e=this.translatedManifest.getFirstVideoAdaptationSet(),n=this.translatedManifest.getFirstAudioAdaptationSet();return e&&t.push(this.loadFirstPlaylist(e)),n&&t.push(this.loadFirstPlaylist(n)),Promise.all(t)},t.prototype.loadFirstPlaylist=function(t){var e=this,n=A.MimeTypeHelper.extractContentType(t._mimeType),i=this.getStartRepresentation(t.Representation,n);return i?this.updateRepresentation(i)["catch"](function(){return e.context.logger.debug("Representation failed to load, dropping it",i._id),t.Representation=t.Representation.filter(function(t){return t!==i}),e.loadFirstPlaylist(t)}):(this.context.logger.warn("All "+n+" variants/rendition failed to load"),Promise.reject("all failed"))},t.prototype.getStartRepresentation=function(t,e){var n,i;switch(e){case"audio":n=this.context.settings.MIN_SELECTABLE_AUDIO_BITRATE,i=this.context.settings.MAX_SELECTABLE_AUDIO_BITRATE;break;case"video":n=this.context.settings.MIN_SELECTABLE_VIDEO_BITRATE,i=this.context.settings.MAX_SELECTABLE_VIDEO_BITRATE}var r=t.find(function(t){return t._bandwidth>=n&&t._bandwidth<=i});return r||t[t.length-1]},t.prototype.updateAdaptationSet=function(t){var e=this,n=this.translatedManifest.findAdaptationSet(t);return n?Promise.all(n.Representation.map(function(t){var n=e.createLoader(b.HttpRequestType.MANIFEST_HLS_VARIANT);return e.loadPlaylist(n,t.Uri).then(function(n){var i=e.onMediaLoaded(n,t);a(i)||e.sourceStore.dispatch(P.updateRepresentationAction(i))})})):Promise.reject("Could not find data")},t.prototype.verifyMissingCodecs=function(t,n,i){if(!L(t))return Promise.reject("invalid playlist");var r=c(c({},e.ensureMasterPlaylist(this.context,t,i)),{rawString:n}),a=new D.M3u8Translator(this.context),s=a.createDashManifestSkeleton(i,r),o=s.Period.flatMap(function(t){return t.AdaptationSet.filter(function(t){return A.MimeTypeHelper.isUnknown(t._mimeType)})});return 0===o.length?Promise.resolve(r):(this.context.logger.debug("Codecs are missing in master playlist - probing them from segments now"),this.parseMissingCodecs(r,o,a))},t.prototype.parseMissingCodecs=function(t,e,n){var r=this,a=e.map(function(t){var e=t.Representation;return e[0]}).filter(function(t){return!!t});e.forEach(function(t){t.Representation=t.Representation.slice(1)});var s=this.getStartRepresentation(a,"video");if(!s)return this.context.logger.warn("All video variants/rendition failed to load"),Promise.reject("all failed");var o=s.Uri,u=new S.DefaultContentLoader(this.context,{requestType:b.HttpRequestType.MANIFEST_HLS_VARIANT});return this.loadPlaylist(u,o).then(function(t){var e=t.url,a=t.body,u=i(r.context,o,a);s._hls={mediaSequence:u.mediaSequence};var c=n.translateSegmentList(s,u.segments),l=!u.endList,d=l?s._updateInterval:1/0,p=Date.now()+_.toMilliSeconds(d);return r.context.serviceManager.maybeCall(m.ServiceName.ManifestCachingService,function(n){n.cacheHttpResponse(t,e,p),n.cacheParsedManifest(u,e,p)}),new R.CodecDetector(r.context).probeCodecs(c.entries,l)}).then(function(e){return t.playlists.filter(function(t){return!t.attributes.hasOwnProperty("CODECS")}).forEach(function(t){t.attributes.CODECS=e}),t})},t.prototype.handleMasterPlaylist=function(t,e){var n=this;void 0===this.masterPlaylist&&(this.masterPlaylist=t),this.translatedManifest.onMasterPlaylistAvailable(t,e);var i=this.translatedManifest.getAllVariantRepresentions();i.video.forEach(function(t){n.variantUpdateLoaders[t._id]=n.createLoader(b.HttpRequestType.MANIFEST_HLS_VARIANT)});var r=i.audio.concat(i.subtitles);r.forEach(function(t){n.variantUpdateLoaders[t._id]=n.createLoader(b.HttpRequestType.MANIFEST_HLS_VARIANT)})},t.prototype.onMediaLoaded=function(t,e,n){void 0===n&&(n=Date.now());var a;if(this.isCancelled)return e;var s=t.url,o=t.body,u=i(this.context,s,o),c=O.M3u8Validator.checkForError(u);if(c)return T.M3u8Error.INAVLID;u.mediaSequence=u.mediaSequence||0,u.start=(a=u.start,null!==a&&void 0!==a?a:this.masterPlaylist.start),this.discontinuitySequences=r(u,this.discontinuitySequences);var l=this.filterTooSmallPeriods(this.discontinuitySequences,Boolean(u.endList)),d=this.translatedManifest.onMediaLoaded(o,e,u,l,n);return this.translatedManifest.isLive()||this.context.serviceManager.maybeCall(m.ServiceName.ManifestCachingService,function(e){e.cacheHttpResponse(t,s),e.cacheParsedManifest(u,s)}),d},t.prototype.filterTooSmallPeriods=function(t,e){return t.filter(function(n,i){var r=!e&&i===t.length-1,a=n.segments.reduce(function(t,e){return t+e.duration},0);return!!(0===i&&a>0||r)||a>0})},t.prototype.stop=function(){var t=this;this.registeredOnPlayEventHandlers.forEach(function(e){return t.context.eventHandler.off(y.PlayerEvent.Play,e)}),this.registeredOnPausedEventHandlers.forEach(function(e){return t.context.eventHandler.off(y.PlayerEvent.Paused,e)}),this.registeredOnPlayEventHandlers=[],this.registeredOnPausedEventHandlers=[],this.stopLoaders(),this.isCancelled=!0},t.prototype.stopLoaders=function(){var t=this;this.masterPlaylistLoader.cancel(),Object.keys(this.variantUpdateLoaders).forEach(function(e){t.variantUpdateLoaders[e].dispose(),delete t.variantUpdateLoaders[e]})},t.prototype.load=function(t){var e=this;return this.isCancelled=!1,this.loadPlaylist(this.masterPlaylistLoader,t).then(this.onMasterLoaded)["catch"](function(t){if(t&&!e.isCancelled){var n=t instanceof g.PlayerError?t:e.getErrorFromResponse(t);e.context.eventHandler.fireError(n)}return Promise.reject(null)})},t.prototype.updateRepresentation=function(t){var e=this;this.context.logger.debug("M3u8Loader: updateRepresentation ("+t.Uri+")");var n=this.variantUpdateLoaders[t._id];return this.loadPlaylist(n,t.Uri).then(function(n){var i=e.onMediaLoaded(n,t);if(a(i))throw i;return i})["catch"](function(){return e.context.logger.debug("M3u8Loader: updateRepresentation failed ("+t.Uri+")"),e.switchToBackupStream(t)["catch"](function(){throw T.M3u8Error.COULD_NOT_LOAD})})},t.prototype.loadPlaylist=function(t,e){var n;if(!e)return this.context.eventHandler.fireError(new g.PlayerError(f.ErrorCode.SOURCE_INVALID)),Promise.reject(f.ErrorCode[f.ErrorCode.SOURCE_INVALID]);var i=this.context.serviceManager.maybeCall(m.ServiceName.ManifestCachingService,function(t){return t.getHttpResponse(e)});if(i)return Promise.resolve(i);var r=null===(n=this.context.sourceContext.source.options)||void 0===n?void 0:n.manifestWithCredentials;return t.load(e,b.HttpRequestMethod.GET,null,null,null,r)},t.prototype.createLoader=function(t){var e=this;return new S.DefaultContentLoader(this.context,{onSuccess:function(t,n){t.length&&e.context.store.dispatch(v.addMetricsValue("default",E.MetricType.DownloadInformation,{bytes:t.length,time:t.elapsedTime,timeToFirstByte:t.timeToFirstByte}))},maxRetries:this.context.settings.MAX_MPD_RETRIES,requestType:t,resetRetriesWhenOffline:!0})},t.prototype.getErrorFromResponse=function(t){var e=new g.PlayerError(f.ErrorCode.SOURCE_COULD_NOT_LOAD_MANIFEST,{statusCode:t.status});return t.status===XMLHttpRequest.UNSENT&&(e=new g.PlayerError(f.ErrorCode.NETWORK_ERROR)),e},t.prototype.hasBackupStreams=function(t){return t.backupUris&&t.backupUris.length>0},t.prototype.switchToBackupStream=function(t){return this.hasBackupStreams(t)?this.rotatePlaylistUrl(t)["catch"](function(){return Promise.reject(d.LoadingFailed)}):Promise.reject(d.NoBackupStreams)},t.prototype.rotatePlaylistUrl=function(t,e){var n=this;if(void 0===e&&(e=[]),!this.hasBackupStreams(t))return Promise.reject(d.NoBackupStreams);var i=t._internalId,r=t.Uri,a=t.backupUris[0];e.push(r),this.context.logger.debug("Rotating URL for rep "+t._id+" from "+r+" to "+a);var o=c(c({},t),{Uri:a,backupUris:t.backupUris.slice(1)});return this.sourceStore.dispatch(P.updateRepresentationAction(o)),this.updateRepresentation(o)["catch"](function(){return n.rotatePlaylistUrl(u(i,s(n.sourceStore)),e)["catch"](function(t){var r=u(i,s(n.sourceStore));throw n.sourceStore.dispatch(P.updateRepresentationAction(c(c({},r),{backupUris:l(r.backupUris,[e.shift()])}))),t})}).then(function(){var t=u(i,s(n.sourceStore)),r=P.updateRepresentationAction(c(c({},t),{backupUris:l(t.backupUris,[e.shift()])}));return n.sourceStore.dispatch(r),t})},t.prototype.dispose=function(){var t=this;this.stop(),this.translatedManifest=h.dispose(this.translatedManifest),this.masterPlaylist=null,this.masterPlaylistLoader.dispose(),Object.keys(this.variantUpdateLoaders).forEach(function(e){return t.variantUpdateLoaders[e].dispose()}),this.variantUpdateLoaders=null},t}();e.M3u8Loader=N},228:function(t,e,n){"use strict";function i(t,e){return t.masterPlaylist.string?t:b(b({},t),{masterPlaylist:{string:e}})}function r(t,e){return b(b({},t),{playlistType:e})}function a(t,e){return b(b({},t),{endlist:e})}function s(t,e){var n,i=e.playlist,r=e.representation,a=r._id,s=i.startTime,o=t.playlists[a]?v(t.playlists[a].segments):[];A.PlaylistUtils.removeDroppedOutSegments(o,i.segments,r.BaseURL[0].url),A.PlaylistUtils.addNewSegments(o,i.segments,r.BaseURL[0].url),m(o);var u=t.playlists[a]?b(b({},t.playlists[a]),{segments:o,startTime:s}):{segments:o,startTime:s};return b(b({},t),{playlists:b(b({},t.playlists),(n={},n[a]=u,n))})}function o(t,e){var n=e.discoSequences,i=e.representation,r=_.getPlaylistSegments(t,i._id);if(!r||!r.length)return t;var a=r[0].expectedPlaybackTime,s={};return n.forEach(function(e){var n=String(e.id),i=_.getDiscoSequenceTiming(t,n);null===i?s[n]=null:a<i.endTime&&(s[n]=b({},i))}),b(b({},t),{discontinuitySequenceTiming:s})}function u(t,e){var n=e.discoSequences,i=e.representation,r=_.getPlaylistSegments(t,i._id),a=!t.endlist,s={};return r&&r.length?(n.forEach(function(e,n){var i=String(e.id),o=_.getDiscoSequenceTiming(t,i);s[i]=o?b({},o):{startTime:0,endTime:0};var u=s[i],c=r[e.indexOfFirstSegment].expectedPlaybackTime,l=r[e.indexOfLastSegment].expectedPlaybackTime+r[e.indexOfLastSegment].duration,d=null!=c&&null!=l;d&&(0!==u.startTime&&0!==n||(u.startTime=c),a?u.endTime=Math.max(u.endTime,l):u.endTime=Math.min(u.endTime||1/0,l))}),b(b({},t),{discontinuitySequenceTiming:b(b({},t.discontinuitySequenceTiming),s)})):t}function c(t,e){var n=e,i={};return n.media.forEach(function(t){var e=Boolean(t.attributes),n=e&&"YES"===t.attributes.DEFAULT,r=e&&Boolean(t.attributes.LANGUAGE),a=t.attributes,s=a.TYPE,o=a.LANGUAGE;n&&r&&!i[s]&&(i[s]=o)}),b(b({},t),{defaultLanguages:i})}function l(t,e){var n=e;return b(b({},t),{customTags:n.tags})}function d(t,e){var n,i=e.playlistId,r=e.segmentIndex,a=e.startTime,s=t.playlists[i];if(!s)return t;var o=b(b({},s),{segments:h(s.segments,r,a)});return b(b({},t),{playlists:b(b({},t.playlists),(n={},n[i]=o,n))})}function p(t,e){var n,i=e.playlistId,r=e.segmentUrl,a=e.segmentPlaybackTime,s=e.discontinuitySequenceNumber,o=t.playlists[i];if(!o||o.segments.length<1)return t;var u=null!=o.segments[0].expectedPlaybackTime;if(u)return t;var c=o.segments.findIndex(function(t){return r.includes(t.uri)&&s===t.discontinuitySequenceNumber});if(c<0)return t;var l=b(b({},o),{segments:h(o.segments,c,a)});return b(b({},t),{playlists:b(b({},t.playlists),(n={},n[i]=l,n))})}function f(t,e){var n,i=e.discoSequenceNumber,r=e.presentationTimeOffset;return b(b({},t),{presentationTimeOffsets:b(b({},t.presentationTimeOffsets),(n={},n[i]=r,n))})}function g(){return{masterPlaylist:{string:""},playlists:{},defaultLanguages:{},discontinuitySequenceTiming:{},presentationTimeOffsets:{}}}function m(t){if(!(t.length<1||null==t[0].expectedPlaybackTime)){for(var e,n=t.length-1;n>=0;n--)if(null!=t[n].expectedPlaybackTime){e=n;break}y(t,e)}}function h(t,e,n){var i=v(t);return i[e]=b({},i[e]),i[e].expectedPlaybackTime=n,T(i,e),y(i,e),i}function y(t,e){for(var n=e+1;n<t.length;n++)t[n]=b({},t[n]),t[n].expectedPlaybackTime=t[n-1].expectedPlaybackTime+t[n-1].duration}function T(t,e){for(var n=e-1;n>=0;n--)t[n]=b({},t[n]),t[n].expectedPlaybackTime=t[n+1].expectedPlaybackTime-t[n].duration}var S,b=this&&this.__assign||function(){return b=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},b.apply(this,arguments)},v=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var i=Array(t),r=0,e=0;e<n;e++)for(var a=arguments[e],s=0,o=a.length;s<o;s++,r++)i[r]=a[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var E=n(26),A=n(64),_=n(85),P=n(174);e.HlsReducer=E["default"](g(),(S={},S[P.HlsActionType.SetMasterPlaylistString]=function(t,e){var n=e.payload;return i(t,n)},S[P.HlsActionType.SetPlaylistType]=function(t,e){var n=e.payload;return r(t,n)},S[P.HlsActionType.SetEndlist]=function(t,e){var n=e.payload;return a(t,n)},S[P.HlsActionType.SetDefaultLanguages]=function(t,e){var n=e.payload;return c(t,n)},S[P.HlsActionType.SetCustomTags]=function(t,e){var n=e.payload;return l(t,n)},S[P.HlsActionType.UpdatePlaylist]=function(t,e){var n=e.payload;return s(t,n)},S[P.HlsActionType.RemoveDroppedOutDiscontinuity]=function(t,e){var n=e.payload;return o(t,n)},S[P.HlsActionType.UpdateDiscontinuityStartAndEndTimes]=function(t,e){var n=e.payload;return u(t,n)},S[P.HlsActionType.InitExpectedPlaybackTimes]=function(t,e){var n=e.payload;return d(t,n)},S[P.HlsActionType.InitExpectedPlaybackTimesFromReferenceSegment]=function(t,e){var n=e.payload;return p(t,n)},S[P.HlsActionType.SetPresentationTimeOffset]=function(t,e){var n=e.payload;return f(t,n)},S)),e.extrapolateExpectedPlaybackTime=h},413:function(t,e,n){"use strict";function i(t){for(var e="",n=0,i=t;n<i.length;n++){var r=i[n];if(!r.getCodec())return null;e+=(""===e?"":",")+r.getCodec()}return e}function r(t){for(var e=t.getData(),n=new DataView(e,0,e.byteLength),i=[],r=0;r+8<n.byteLength;){var a=n.getUint32(r);if(0===a)break;var s=u.ArrayHelper.extractAsciiString(n,r+4,4);i.push(s),r+=a}return t.isInit()?["ftyp","moov"].every(function(t){return i.includes(t)}):["moof","mdat"].every(function(t){return i.includes(t)})}function a(t,e){var n=e&&e._byteRange?e._byteRange:void 0,i=e&&e._key?e._key:void 0;return{url:t,key:i,byteRange:n,downloaded:!1,mimeType:"unknown/mp4",internalRepresentationId:null,isInitSegment:Boolean(e._init)}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(6),o=n(16),u=n(9),c=n(2),l=n(0),d=n(67),p=function(){function t(t){this.ContainerMp4Module=c.ModuleManager.get(l.ModuleName.ContainerMP4,!1),this.context=t,this.loader=new o.DefaultContentLoader(this.context),this.ContainerMp4Module&&(this.mp4Parser=new this.ContainerMp4Module.MP4Parser(this.context)),this.initTransmuxer(),this.CryptoApiModule=c.ModuleManager.get(l.ModuleName.Crypto,!1)}return t.prototype.initTransmuxer=function(){var t=c.ModuleManager.get(l.ModuleName.ContainerTS,!1);t&&(this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new t.WebWorkerTransmuxer(this.context))},t.prototype.fetchSegment=function(t){if(!this.context.segmentPrefetchingService)return Promise.reject();var e=this.context.segmentPrefetchingService.hasPrefetchedSegment(t)?this.context.segmentPrefetchingService.getPrefetchedSegment(t):this.context.segmentPrefetchingService.fetch(t);return e?e:Promise.reject()},t.prototype.probeCodecs=function(t,e){var n=this,i=t.slice();if(0===i.length)throw"could not load any segment";var r=e?i.pop():i.shift(),o=Boolean(r._init)?r._init.url:r._media,u=a(o,r);return this.fetchSegment(u).then(function(t){return n.extractCodecsFromSegment(t)})["catch"](function(t){if(t instanceof s.PlayerError)throw t;return n.context.logger.debug("Codec probing from segment failed",t),n.initTransmuxer(),n.probeCodecs(i,e)}).then(function(t){return n.context.logger.debug("Probed codec is",t),n.transmuxer&&n.transmuxer.dispose(),t})},t.prototype.extractCodecsFromSegment=function(t){return r(t)?this.extractCodecFromMp4Parser(t):this.extractCodecFromTransmuxer(t)},t.prototype.extractCodecFromTransmuxer=function(t){return c.ModuleManager.has(l.ModuleName.ContainerTS)?this.transmuxer.transmuxSegment(t).then(function(e){var n=i(e.transmuxedSegments);if(!n)throw"couldn't detect codec for "+t.getMimeType();return n}):Promise.reject(new d.PlayerModuleMissingError(l.ModuleName.ContainerTS))},t.prototype.extractCodecFromMp4Parser=function(t){if(!c.ModuleManager.has(l.ModuleName.ContainerMP4))return Promise.reject(new d.PlayerModuleMissingError(l.ModuleName.ContainerMP4));this.mp4Parser.parseSegment(t);var e=this.ContainerMp4Module.MP4Parser.getVideoCodec(t.getParsedData());return e?Promise.resolve(e):Promise.reject("couldn't detect codec for "+t.getMimeType())},t}();e.CodecDetector=p,e.mergeSegmentCodecs=i,e.isFmp4Segment=r},414:function(t,e,n){"use strict";function i(t,e){var n=e.findIndex(function(e){return e.id===t.id});e.splice(n,1,t)}function r(t,e){return e.some(function(e){return e.id===t.id})}function a(t,e){var n={};return n.startTime=o.toSeconds(Date.parse(t.startDate)),t.endDate?n.endTime=o.toSeconds(Date.parse(t.endDate)):t.duration?n.endTime=o.toSeconds(Date.parse(t.startDate))+t.duration:t.endOnNext&&e&&(n.endTime=o.toSeconds(Date.parse(e.startDate))),n.data=t,n}function s(t,e,n){for(var s=0;s<t.segments.length;s++){var o=t.segments[s].dateRange;o&&(r(o,e)?i(o,e):e.push(o))}return e.map(function(t,e,n){return a(t,n[e+1])}).forEach(function(t){return n.processDateRangeEvent(t,u.HLS_PERIOD_ID)})}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),u=n(172);e.getDateRangeEvent=a,e.handleDateRangeMetadata=s},415:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(42),r=n(30),a=n(11),s=function(){function t(t){this.context=t}return t.prototype.create=function(t,e,n,r,a){if(void 0===a&&(a=!0),!t)return null;var s=this.createBaseRepresentation(t,r);if(e===i.RepresentationType.AUDIO)s=this.extendToAudioRepresentation(t,s,n,r);else if(e===i.RepresentationType.VIDEO)s=this.extendToVideoRepresentation(t,s,n,r,a);else{if(e!==i.RepresentationType.SUBTITLE)return null;s=this.extendToSubtitleRepresentation(t,s,n,r)}var o=this.getLabelForRepresentation(s);
return o&&"string"==typeof o&&(s._label=o),s},t.prototype.createBaseRepresentation=function(t,e){var n=t.uri||t.URI;n&&!a.URLHelper.isUrlAbsolute(n)&&(n=a.URLHelper.concatBaseUrlWithPartial(e,n));var i={_id:"",_mimeType:"",_bandwidth:0,_codecs:"",_hls:{requestTimestamp:0},BaseURL:null,SegmentList:[{SegmentURL:[]}],Uri:n,backupUris:[]};return t.backupStreamUris&&t.backupStreamUris.forEach(function(t){a.URLHelper.isUrlAbsolute(t)?i.backupUris.push(t):i.backupUris.push(a.URLHelper.concatBaseUrlWithPartial(e,t))}),t.NAME&&(i._label=t.NAME),i},t.prototype.extendToVideoRepresentation=function(e,n,i,a,s){var o=n;if(o._mimeType="video/"+i,o._width=0,o._height=0,o.BaseURL=[{url:t.getBaseUrl(a,e.uri)}],o._bandwidth=e.attributes["AVERAGE-BANDWIDTH"]||e.attributes.BANDWIDTH,o._bandwidth||(o._bandwidth=this.context.settings.MIN_SELECTABLE_VIDEO_BITRATE),o._bandwidth=Number(o._bandwidth),e.attributes.CODECS){var u=r.CodecStringHelper.extractCodecStrings(e.attributes.CODECS);r.CodecStringHelper.hasOldAvc1CodecFormat(u.video)&&(u.video=r.CodecStringHelper.convertAvc1ToAvcotiCodecFormat(u.video)),s?u.video&&u.audio?o._codecs=u.video+","+u.audio:u.video&&!u.audio?o._codecs=u.video:!u.video&&u.audio&&(o._codecs=u.audio):o._codecs=u.video}return e.attributes["FRAME-RATE"]&&(o._frameRate=parseFloat(e.attributes["FRAME-RATE"])),e.attributes.RESOLUTION&&(o._width=e.attributes.RESOLUTION.width,o._height=e.attributes.RESOLUTION.height,o._id+=e.attributes.RESOLUTION.height+"_"),o._id+=e.attributes.BANDWIDTH,o},t.prototype.extendToAudioRepresentation=function(e,n,i,r){var a=n;return a._id=e.NAME+" "+e["GROUP-ID"]||"",a._mimeType="audio/"+i,a._codecs=e.CODECS,a._name=e.NAME||"",a._groupId=e["GROUP-ID"]||"",a._label=a._name+" "+a._groupId,a.BaseURL=[{url:t.getBaseUrl(r,e.URI||e.uri)}],a},t.prototype.extendToSubtitleRepresentation=function(e,n,i,r){var a=n;return a._id=e.NAME,a._mimeType="application/"+i,a._codecs="wvtt",a._name=e.NAME||"",a.BaseURL=[{url:t.getBaseUrl(r,e.URI)}],a._hls.isForced="YES"===e.FORCED,a},t.prototype.getLabelForRepresentation=function(t){var e={id:t._id,mimeType:t._mimeType,width:t._width,height:t._height,bitrate:t._bandwidth},n=this.getLabelingFunctionForRepresentation();return n(e)},t.prototype.getLabelingFunctionForRepresentation=function(){var e=this.context.sourceContext,n=e&&e.source&&e.source.labeling;return n&&n.hls&&n.hls.qualities?"function"!=typeof n.hls.qualities?t.getDefaultLabelForRepresentation:n.hls.qualities:t.getDefaultLabelForRepresentation},t.getDefaultLabelForRepresentation=function(){return null},t.getBaseUrl=function(t,e){var n=t;return n=a.URLHelper.removeUrlParameters(n),e=a.URLHelper.removeLastPathPart(e),!e||e.indexOf("/")<0?t:a.URLHelper.concatUrlParts(n,e)},t}();e.M3u8RepresentationFactory=s},416:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i;!function(t){t[t.EmptyPlaylist=1]="EmptyPlaylist"}(i=e.M3u8ValidatorError||(e.M3u8ValidatorError={}));var r=function(){function t(){}return t.checkForError=function(e){for(var n=0,i=t.mediaPlaylistRules;n<i.length;n++){var r=i[n];if(!r.fn(e))return r.err}return null},t.mediaPlaylistRules=[{fn:function(t){return t.segments.length>0},err:i.EmptyPlaylist}],t}();e.M3u8Validator=r},417:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(115),r=n(0),a=n(225),s=n(226),o=n(227),u=n(64),c=n(127),l=n(228),d=n(85),p={initExpectedPlaybackTimes:c.initExpectedPlaybackTimes,initExpectedPlaybackTimesFromReferenceSegment:c.initExpectedPlaybackTimesFromReferenceSegment,setPresentationTimeOffset:c.setPresentationTimeOffset},f={getPresentationTimeOffset:d.getPresentationTimeOffset,getHlsState:d.getHlsState,getPlaylistType:d.getPlaylistType,getEndlist:d.getEndlist,getDefaultLanguages:d.getDefaultLanguages,getCustomTags:d.getCustomTags,hasPlaylist:d.hasPlaylist,getPlaylistStartTime:d.getPlaylistStartTime,getPlaylistSegments:d.getPlaylistSegments,getDiscoSequenceTiming:d.getDiscoSequenceTiming,getDiscoSequenceTimings:d.getDiscoSequenceTimings,getFirstDiscoSequenceTiming:d.getFirstDiscoSequenceTiming,hasExpectedPlaybackTimesForPlaylist:d.hasExpectedPlaybackTimesForPlaylist,getExpectedPlaybackTimeForSegment:d.getExpectedPlaybackTimeForSegment};e.HLSModuleDefinition={name:r.ModuleName.HLS,module:function(){return{HlsTimelineTracker:s.HlsTimelineTracker,M3u8Loader:o.M3u8Loader,HlsUtils:i.HlsUtils,PlaylistUtils:u.PlaylistUtils,DiscontinuitySequenceNumberTracker:a.DiscontinuitySequenceNumberTracker,HlsReducer:l.HlsReducer,actions:p,selectors:f}},dependencies:[r.ModuleName.EngineBitmovin]},e["default"]=e.HLSModuleDefinition},64:function(t,e,n){"use strict";function i(t,e){var n=u.compareValues(t.byterange,e.byterange);return u.compareValues(t,e,["uri","discontinuitySequenceNumber"])&&n}function r(t,e){if(!c.isLive(e))return 1/0;var n=e.segments[e.segments.length-1];return void 0!==n?Math.max(t.MINIMUM_ALLOWED_UPDATE_PERIOD,n.duration):t.MINIMUM_ALLOWED_UPDATE_PERIOD}var a=this&&this.__assign||function(){return a=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},a.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),o=n(11),u=n(110);e.isMasterPlaylist=function(t){return"playlists"in t},e.isMediaPlaylist=function(t){return!e.isMasterPlaylist(t)};var c=function(){function t(){}return t.createDiscontinuitySequences=function(e,n){var i=e.discontinuitySequence;return null==i&&(i=0!==n.length&&t.isLive(e)?this.findCurrentDiscontinuitySequenceNumber(e,n):0),e.segments.reduce(function(t,e,n){return void 0!==e.discontinuity&&(i++,0===n?t[t.length-1].id=i:t.push({id:i,segments:[],duration:0})),e.discontinuitySequenceNumber=i,e.duration>0&&(t[t.length-1].segments.push(e),t[t.length-1].duration+=e.duration),t},[{id:i,segments:[],duration:0}])},t.findCurrentDiscontinuitySequenceNumber=function(t,e){for(var n=[],i=0,r=0;r<e.length-1;r++)i+=e[r].segments.length,n.push(i);var a=[];return t.segments.forEach(function(t,e){void 0!==t.discontinuity&&a.push(e)}),0===n.length?e[0]?e[0].id:0:0===a.length?e[e.length-1].id:a.length!==n.length?a.length>n.length?e[0].id:e[1].id:this.findFirstPeriodByIndexTracking(n,a,e)},t.findFirstPeriodByIndexTracking=function(t,e,n){if(t[0]>e[0])return n[0].id;if(t[0]<e[0]){for(var i=t[0]-e[0],r=0,a=0;a<t.length;a++)t[a]+i<e[0]&&r++;return n[r].id}var s=function(){return t.every(function(t,n){return t===e[n]})};if(s())return n[0].id;for(var o=1;t.length>0;){t.shift();for(var a=0;a<t.length;a++)t[a]--;if(s())break;o++}return n[o].id},t.extrapolateProgramDateTime=function(t){var e=null;if(t.find(function(t,n){return t.dateTime&&(e=n),void 0!==t.dateTime}),null!==e){var n;for(n=e-1;n>=0;n--){var i=t[n+1].dateTime,r=Math.ceil(s.toMilliSeconds(t[n].duration));t[n].dateTime=new Date(i.getTime()-r)}for(n=e+1;n<t.length;n++){var a=t[n-1].dateTime,o=Math.ceil(s.toMilliSeconds(t[n-1].duration));t[n].dateTime=new Date(a.getTime()+o)}}},t.isLive=function(t){return t.endList!==!0},t.getProgramDateTimeFromSegmentUrl=function(t,e){if(t.indexOf("akamaihd.net")>-1){var n=t.match(/segment(\d{9})/);if(n&&2===n.length){var i=parseInt(n[1])*Math.round(s.toMilliSeconds(e));return new Date(i)}}return null},t.correctStartOffsetToBounds=function(t,e){return t>0&&t>e?e:t<0&&Math.abs(t)>e?-e:t},t.getImpreciseStartOffset=function(t,e){for(var n=0,i=0,r=e.segments;i<r.length;i++){var a=r[i];if(n+a.duration>t)break;n+=a.duration}return n},t.getStartOffset=function(e){var n=Number(e.start.timeOffset);return n=t.correctStartOffsetToBounds(n,e.totalDuration),n<0&&(n+=e.totalDuration),e.start.precise||(n=t.getImpreciseStartOffset(n,e)),n},t.addNewSegments=function(t,e,n){var r=o.URLHelper.getDomainUrl(n);if(t.length<1)return void e.forEach(function(e){e.uri=o.URLHelper.buildAbsoluteUrl(n,r,e.uri),t.push(e)});for(var s=t[t.length-1],u=[],c=e.length-1;c>=0;c--){var l=a({},e[c]);if(l.uri=o.URLHelper.buildAbsoluteUrl(n,r,l.uri),i(l,s))break;u.unshift(l)}u.forEach(function(e){return t.push(e)})},t.removeDroppedOutSegments=function(t,e,n){var r=o.URLHelper.getDomainUrl(n),s=a({},e[0]);s.uri=s.uri=o.URLHelper.buildAbsoluteUrl(n,r,s.uri);for(var u=0;u<t.length&&!i(s,t[u]);u++)t.splice(u,1),u--},t}();e.PlaylistUtils=c,e.isSameSegmentEntry=i,e.calculateUpdateIntervalInSeconds=r},85:function(t,e,n){"use strict";function i(t){return t.hls}var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.getHlsState=i,e.getPlaylistType=function(t){return t.playlistType},e.getEndlist=function(t){return t.endlist},e.getDefaultLanguages=function(t){return t.defaultLanguages},e.getCustomTags=function(t){return t.customTags},e.hasPlaylist=function(t,e){return Object.keys(t.playlists).includes(e)},e.getPlaylistSegments=function(t,e){return t.playlists[e]?t.playlists[e].segments:[]},e.getPlaylistStartTime=function(t,e){return t.playlists[e]?t.playlists[e].startTime:0},e.getDiscoSequenceTiming=function(t,e){return t.discontinuitySequenceTiming[e]?r({},t.discontinuitySequenceTiming[e]):null},e.getDiscoSequenceTimings=function(t){return t.discontinuitySequenceTiming},e.getFirstDiscoSequenceTiming=function(t){var e=Object.keys(t.discontinuitySequenceTiming)[0];return null!=e?t.discontinuitySequenceTiming[e]:{startTime:0,endTime:0}},e.getExpectedPlaybackTimeForSegment=function(t,e,n){var i=t.playlists[e];if(!i)return null;var r=i.segments.find(function(t){return n.url.includes(t.uri)&&t.discontinuitySequenceNumber===n.discontinuitySequenceNumber});return r&&null!=r.expectedPlaybackTime?r.expectedPlaybackTime:null},e.hasExpectedPlaybackTimesForPlaylist=function(t,e){var n=t.playlists[e];return Boolean(n)&&n.segments.length>0&&null!=n.segments[0].expectedPlaybackTime},e.getPresentationTimeOffset=function(t,e){return Object.keys(t.presentationTimeOffsets).includes(e)?t.presentationTimeOffsets[e]:null}}},[417])});
})();
