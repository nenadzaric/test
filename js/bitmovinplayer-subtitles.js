/**************************************************************************** 
 * Copyright (C) 2020, Bitmovin, Inc., All Rights Reserved 
 * 
 * This source code and its use and distribution, is subject to the terms 
 * and conditions of the applicable license agreement. 
 * 
 * Bitmovin Player Version 8.34.0 
 * 
 ****************************************************************************/
(function() {
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.subtitles=t():(e.bitmovin=e.bitmovin||{},e.bitmovin.player=e.bitmovin.player||{},e.bitmovin.player.subtitles=t())}(this,function(){return webpackJsonpbitmovin_player__name_([8],{111:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(97),a=function(){function e(t,n,i){var a=this;void 0===i&&(i=null),this.onCueEnter=function(t){a.context.eventHandler.dispatchEvent(r.PlayerEvent.CueEnter,e.prepareCueEvent(t,a.getSubtitle().id))},this.onCueExit=function(t){a.context.eventHandler&&a.context.eventHandler.dispatchEvent(r.PlayerEvent.CueExit,e.prepareCueEvent(t,a.getSubtitle().id))},this.context=t,this.subtitle=n,this.subtitle.enabled=this.subtitle.enabled||!1,this.timeline=new o.Timeline(t,{onCueEnter:this.onCueEnter,onCueExit:this.onCueExit}),this.timeline.stopListening(),this.periodId=i}return e.prototype.fireOnCueParsedEvents=function(e,t){var n=this;e&&this.context.eventHandler&&e.forEach(function(e){n.context.eventHandler.dispatchEvent(r.PlayerEvent.CueParsed,i(i({subtitleId:n.getSubtitle().id},e),{periodId:t}))})},e.prototype.isActive=function(){return this.subtitle.enabled},e.prototype.activate=function(){return this.subtitle.enabled=!0,this.timeline.startListening(),this.timeline.show(),Promise.resolve()},e.prototype.deactivate=function(){return this.subtitle.enabled=!1,this.timeline.stopListening(),this.timeline.hide(),Promise.resolve()},e.prototype.getSubtitle=function(){return this.subtitle},e.prototype.clearBuffersUntil=function(e){this.timeline.removeCuesUntil(e)},e.prototype.dispose=function(){this.deactivate(),this.timeline.dispose()},e.prepareCueEvent=function(e,t){var n=i({subtitleId:t,start:e.start,end:e.end},e.content);return n},e}();t.AbstractSubtitleHandler=a},253:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=function(){function e(){}return e.build=function(e){return new(function(){function t(){}return t.prototype.add=function(t){e.addSubtitle(t)},t.prototype.remove=function(t){e.removeSubtitle(t)},t.prototype.list=function(){return e.listSubtitles()},t.prototype.enable=function(t,n){void 0===n&&(n=!0),e.enableSubtitle(t,n)},t.prototype.disable=function(t){e.disableSubtitle(t)},t.prototype.cueEnter=function(t){e.fireEvent(r.PlayerEvent.CueEnter,i(i({},t),{type:r.PlayerEvent.CueEnter}))},t.prototype.cueExit=function(t){e.fireEvent(r.PlayerEvent.CueExit,i(i({},t),{type:r.PlayerEvent.CueExit}))},t}())},e}();t.PlayerSubtitlesApiFactory=o},254:function(e,t,n){"use strict";function i(e){return e.type===a.PlayerEvent.Seek}Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=n(19),a=n(1),s=n(7),u=n(2),l=n(0),c=n(494),d=n(495),f=n(501),p=n(502),h=n(503),b=n(78),v=function(){function e(e){var t=this;this.getTransmuxer=function(){return t.transmuxer},this.onDiscontinuitySequenceNumberChanged=function(){t.resetCaptionExtractor()},this.onSeek=function(e){t.resetCaptionExtractor();var n=e.position,r=i(e)?e.seekTarget:e.target;Object.keys(t.subtitleHandlers).forEach(function(e){return t.subtitleHandlers[e].onSeek(n,r)})},this.onPeriodSwitched=function(e){t.manifestService.isHlsManifest()||(t.context.logger.debug("Switching periods in subtitleService"),Object.keys(t.subtitleHandlers).forEach(function(n){var i=t.subtitleHandlers[n],r=i.getSubtitleType()===b.SubtitleType.FRAGMENTED&&i.periodId===e.sourcePeriod.periodId,o=i.getSubtitleType()===b.SubtitleType.EXTERNAL_FILE&&i.periodId&&i.periodId!==e.targetPeriod.periodId;(r||o)&&t.removeSubtitleHandler(n)}),t.reactivateAfterSwitched())},this.reset=function(){Object.keys(t.subtitleHandlers).forEach(function(e){return t.subtitleHandlers[e].dispose()}),t.subtitleHandlers={},t.cea608Extractor&&(t.cea608Extractor.dispose(),t.cea608Extractor=null),t.discontinuitySequenceNumberTracker&&t.discontinuitySequenceNumberTracker.reset()},this.context=e,this.subtitleHandlers={},this.eventHandler=e.eventHandler,this.manifestService=e.serviceManager.get(r.ServiceName.ManifestService),this.transmuxer=null,this.enabledSubtitlesTracker=new c.EnabledSubtitlesTracker,this.forcedSubtitleController=new d.ForcedSubtitleController,this.eventHandler.on(a.PlayerEvent.Seek,this.onSeek),this.eventHandler.on(a.PlayerEvent.TimeShift,this.onSeek),this.eventHandler.on(a.PlayerEvent.SourceUnloaded,this.reset),this.eventHandler.on(a.PlayerEvent.PeriodSwitched,this.onPeriodSwitched)}return e.prototype.setTransmuxer=function(e){this.transmuxer=e},e.prototype.hasSubtitle=function(e){return Boolean(this.subtitleHandlers[e])},e.prototype.enableSubtitle=function(e){var t=this,n=this.subtitleHandlers[e];return n&&!n.isActive()?n.activate().then(function(){return t.forcedSubtitleController.deactivate()}).then(function(){return t.enabledSubtitlesTracker.addSubtitle(n.getSubtitle()),!0})["catch"](function(){return!1}):Promise.resolve(!1)},e.prototype.addExternalSubtitle=function(e,t){void 0===t&&(t=null),e.id||(e.id=e.url);var n=new p.ExternalFileSubtitleHandler(this.context,e,t);return this.reactivateHandler(n),e},e.prototype.reactivateHandler=function(e){var t=e.getSubtitle(),n=this.context.config.playback.isForcedSubtitle,i="function"==typeof n?n(t):t.forced;if(i)return void this.forcedSubtitleController.addSubtitleHandler(e);var r=!1,o=t.id;this.subtitleHandlers[o]&&(r=this.subtitleHandlers[o].isActive(),this.removeSubtitleHandler(o)),this.addSubtitleHandler(e),r&&e.activate()},e.prototype.addSubtitleHandler=function(e){var t=e.getSubtitle();this.applyLabelFunctionForSubtitle(t),this.subtitleHandlers[t.id]=e,this.signalNewSubtitle(t)},e.prototype.applyLabelFunctionForSubtitle=function(e){var t=this.context.sourceContext.source.labeling;this.manifestService.isHlsManifest()?t&&t.hls&&t.hls.subtitles&&"function"==typeof t.hls.subtitles&&(e.label=t.hls.subtitles(e)):t&&t.dash&&t.dash.subtitles&&"function"==typeof t.dash.subtitles&&(e.label=t.dash.subtitles(e))},e.prototype.addFragmentSubtitle=function(e,t){if(!u.ModuleManager.has(l.ModuleName.EngineBitmovin))return this.context.logger.warn("Unable to add fragmented subtitles because MSE Module is missing"),null;var n=this.manifestService.toSubtitleTrack(t,e.mimeType);n.isFragmented=!0,n.url=null;var i=new h.FragmentedSubtitleHandler(this.context,e,n,this.getTransmuxer);return this.reactivateHandler(i),n},e.prototype.setupCea608CaptionExtractor=function(e){if(u.ModuleManager.has(l.ModuleName.SubtitlesCEA608)){this.cea608Extractor&&this.cea608Extractor.dispose();var t=u.ModuleManager.get(l.ModuleName.SubtitlesCEA608).Cea608Extractor;return this.cea608Extractor=new t(e),this.cea608Extractor}return this.context.logger.log("CEA Caption parsing is disabled, because the Cea680 module is not loaded"),null},e.prototype.resetCaptionExtractor=function(){this.cea608Extractor&&(this.context.logger.debug("Resetting CEA caption extractor..."),this.cea608Extractor.reset())},e.prototype.createDiscontinuitySequenceNumberTracker=function(){var e=u.ModuleManager.get(l.ModuleName.HLS);this.discontinuitySequenceNumberTracker=new e.DiscontinuitySequenceNumberTracker(s.MimeTypeHelper.isVideo),this.discontinuitySequenceNumberTracker.subscribe(this.onDiscontinuitySequenceNumberChanged)},e.prototype.trackDiscontinuitySequenceNumber=function(e){this.discontinuitySequenceNumberTracker||this.createDiscontinuitySequenceNumberTracker(),this.discontinuitySequenceNumberTracker.trackSegment(e)},e.prototype.shouldDiscontinuitySequenceNumberBeTracked=function(){return this.manifestService.getManifest()&&this.manifestService.isHlsManifest()&&u.ModuleManager.has(l.ModuleName.HLS)},e.prototype.extractCaptionsFromSegment=function(e,t){var n=this;if(this.cea608Extractor)return this.shouldDiscontinuitySequenceNumberBeTracked()&&this.trackDiscontinuitySequenceNumber(e),this.cea608Extractor.extract(e).then(function(i){var r=i.map(function(e){return{start:e.startTime-t,end:e.endTime-t,text:e.text,channel:e.channel,position:e.position}});r.length>0&&(n.context.logger.insane("Extracted Closed Captions from fMP4: "+JSON.stringify(r)),n.handleClosedCaptions(r,e.getPeriodId()))})["catch"](function(e){n.context.logger.debug("Error parsing CEA-608 Captions from fMP4: "+e)})},e.prototype.handleClosedCaptions=function(e,t){if(e&&Array.isArray(e)&&0!==e.length)for(var n=this.manifestService.getClosedCaptionLabels(t),i=function(i){var o={id:e[i].channel,kind:"captions",lang:"unknown",label:"Captions ("+e[i].channel+")",url:void 0},a=n.find(function(e){return e.id===o.id});a&&(o.label=a.label);var s=r.subtitleHandlers[o.id];s||r.addSubtitleHandler(new f.Cea608Handler(r.context,o)),r.subtitleHandlers[o.id].addCaption(e[i],t)},r=this,o=0;o<e.length;o++)i(o)},e.prototype.signalNewSubtitle=function(e){this.eventHandler.dispatchEvent(a.PlayerEvent.SubtitleAdded,{subtitle:e})},e.prototype.disableSubtitle=function(e){var t=this,n=this.subtitleHandlers[e];return n?n.deactivate().then(function(){return t.enabledSubtitlesTracker.removeSubtitle(e),0===t.getActiveSubtitles().length&&t.forcedSubtitleController.activate()["catch"](function(){}),!0})["catch"](function(){return!1}):Promise.resolve(!1)},e.prototype.removeSubtitle=function(e){this.removeSubtitleHandler(e),this.enabledSubtitlesTracker.removeSubtitle(e)},e.prototype.getActiveSubtitles=function(){var e=this;return Object.keys(this.subtitleHandlers).filter(function(t){return e.subtitleHandlers[t].isActive()}).map(function(t){return e.subtitleHandlers[t].getSubtitle()})},e.prototype.getAvailableSubtitles=function(e){return Object.values(this.subtitleHandlers).filter(function(t){var n=t.periodId;return!n||e===n}).map(function(e){return e.getSubtitle()})},e.prototype.enableForcedSubtitle=function(e){this.forcedSubtitleController.activate(e)["catch"](function(){})},e.prototype.reactivateAfterSwitched=function(){var e=this;Object.keys(this.subtitleHandlers).forEach(function(t){var n=e.subtitleHandlers[t];if(!n.isActive()){var i=e.enabledSubtitlesTracker.shouldEnableSubtitle(n.getSubtitle(),e.subtitleHandlers);if(i){var r={subtitle:n.getSubtitle()};e.eventHandler.dispatchEvent(a.PlayerEvent.SubtitleEnable,r),n.activate().then(function(){e.eventHandler.dispatchEvent(a.PlayerEvent.SubtitleEnabled,r)})}}})},e.prototype.removeSubtitleHandler=function(e){if(this.subtitleHandlers[e]){var t=this.subtitleHandlers[e].getSubtitle();this.subtitleHandlers[e].dispose(),delete this.subtitleHandlers[e],this.eventHandler&&this.eventHandler.dispatchEvent(a.PlayerEvent.SubtitleRemoved,{subtitle:t})}},e.prototype.clearBuffersUntil=function(e){var t=this;Object.keys(this.subtitleHandlers).forEach(function(n){return t.subtitleHandlers[n].clearBuffersUntil(e)})},e.prototype.dispose=function(){this.reset(),this.enabledSubtitlesTracker=o.dispose(this.enabledSubtitlesTracker),this.forcedSubtitleController=o.dispose(this.forcedSubtitleController),this.discontinuitySequenceNumberTracker=o.dispose(this.discontinuitySequenceNumberTracker),this.transmuxer=null,this.manifestService=null,this.eventHandler.off(a.PlayerEvent.Seek,this.onSeek),this.eventHandler.off(a.PlayerEvent.TimeShift,this.onSeek),this.eventHandler.off(a.PlayerEvent.SourceUnloaded,this.reset),this.eventHandler.off(a.PlayerEvent.PeriodSwitched,this.onPeriodSwitched),this.subtitleHandlers={},this.eventHandler=null,this.context=null},e}();t.SubtitleService=v,t.isSeekEvent=i},494:function(e,t,n){"use strict";function i(e,t){return Object.keys(t).find(function(n){var i=t[n].getSubtitle(),r=i.id,o=i.lang,a=i.isFragmented,s=i.kind,u=r===e.id,l=!e.isFragmented||a===e.isFragmented,c=o===e.lang;e.isPreferred&&e.lang&&(c=o.includes(e.lang)||e.lang.includes(o));var d=s===e.kind&&c&&l;return u||d})}var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.enabledSubtitles={},this.idCounter=0}return e.prototype.addSubtitle=function(e){this.removeSubtitle(e.id),this.enabledSubtitles[this.getNextId()]=r({isFragmented:!1},e)},e.prototype.removeSubtitle=function(e){var t=this;Object.keys(this.enabledSubtitles).forEach(function(n){t.enabledSubtitles[n].id===e&&delete t.enabledSubtitles[n]})},e.prototype.shouldEnableSubtitle=function(e,t){var n=this,i=Object.keys(this.enabledSubtitles).find(function(i){var r=n.getTargetSubtitleIdForPeriod(n.enabledSubtitles[i],t);return r===e.id});return Boolean(i)},e.prototype.getTargetSubtitleIdForPeriod=function(e,t){var n=e.id,r=e.kind,o=e.lang,a=e.isFragmented;return i({lang:o,kind:r,isFragmented:a,id:n},t)||i({lang:o,kind:r,isFragmented:a},t)||i({lang:o,kind:r},t)},e.prototype.getNextId=function(){return this.idCounter++,this.idCounter},e.prototype.dispose=function(){this.enabledSubtitles={},this.idCounter=0},e}();t.EnabledSubtitlesTracker=o},495:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.subtitleHandlers={}}return e.prototype.addSubtitleHandler=function(e){this.subtitleHandlers[e.getSubtitle().id]=e},e.prototype.deactivate=function(){return this.hasForcedSubtitles()?Promise.all(Object.values(this.subtitleHandlers).map(function(e){return e.deactivate()})).then(function(){}):Promise.resolve()},e.prototype.activate=function(e){var t=this;return void 0===e&&(e=this.currentLang),this.hasForcedSubtitles()?(this.currentLang=e,this.deactivate().then(function(){var e=Object.values(t.subtitleHandlers).find(function(e){return e.getSubtitle().lang===t.currentLang});if(e&&!e.isActive())return e.activate()["catch"](function(){})})):Promise.resolve()},e.prototype.dispose=function(){Object.values(this.subtitleHandlers).forEach(function(e){return e.dispose()}),this.subtitleHandlers=null},e.prototype.hasForcedSubtitles=function(){return Object.keys(this.subtitleHandlers).length>0},e}();t.ForcedSubtitleController=i},496:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(253),o=n(87),a=n(254);t.SubtitleModuleDefinition={name:i.ModuleName.Subtitles,module:function(){return{SubtitleService:a.SubtitleService,SubtitleParserFactory:o.SubtitleParserFactory,PlayerSubtitlesApiFactory:r.PlayerSubtitlesApiFactory}},dependencies:[i.ModuleName.EngineBitmovin]},t["default"]=t.SubtitleModuleDefinition},497:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(20),o=n(18),a=function(e){function t(t){var n=e.call(this,o.WarningCode.MODULE_MISSING)||this;return n.message=o.WarningCode[n.code]+t,n}return i(t,e),t}(r.PlayerWarning);t.ModuleMissingWarning=a},498:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(105),o=function(){function e(){}return e.parseSubtitles=function(e){var t=r.TextSegmentAnalyzer.detectEncoding(e.getData());return[{start:e.getPlaybackTime(),end:e.getPlaybackTime()+e.getDuration(),text:i.ArrayHelper.convertBufferSourceToUTF8(e.getData(),t)}]},e}();t.PlainTextSubtitleParser=o},501:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(111),o=n(78),a=function(e){function t(t,n,i){return void 0===i&&(i=null),e.call(this,t,n,i)||this}return i(t,e),t.prototype.onSeek=function(e,t){var n=t<e;n&&this.clearBuffersUntil(this.context.renderer.getDuration())},t.prototype.addCaption=function(e,t){e&&(this.fireOnCueParsedEvents([e],t),this.timeline.addCues([e],0))},t.prototype.getSubtitleType=function(){return o.SubtitleType.IN_STREAM},t}(r.AbstractSubtitleHandler);t.Cea608Handler=a},502:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(20),o=n(18),a=n(19),s=n(1),u=n(16),l=n(12),c=n(87),d=n(111),f=n(78),p=function(e){function t(n,i,r){var o=e.call(this,n,i,r&&r._internalId.periodId)||this;return o.onFileLoaded=function(e){if(o.timeline.removeCues(),e.body){o.isFileLoaded=!0;var t=o.parse(e.body.trim());o.fireOnCueParsedEvents(t,null),o.timeline.addCues(t)}},r&&(i.id=r.Representation[0]._id),i.url?(o.externalFileUrl=t.enforceHTTPSForSecureOrigins(i.url.trim()),o.isFileLoaded=!1,o.subtitleLoader=new u.DefaultContentLoader(o.context,{maxRetries:o.context.settings.MAX_RETRIES,retryDelay:o.context.settings.RETRY_DELAY,requestType:l.HttpRequestType.MEDIA_SUBTITLES})):(o.context.logger.log("No url was provided for an external subtitle, nothing will be loaded."),o.isFileLoaded=!0,o.loadPromise=Promise.resolve()),o}return i(t,e),t.prototype.activate=function(){var t=this;return e.prototype.activate.call(this),this.context.logger.debug("loading "+this.externalFileUrl),Promise.resolve().then(function(){return t.loadPromise?t.loadPromise:t.isFileLoaded?void 0:(t.loadPromise=t.subtitleLoader.load(t.externalFileUrl).then(t.onFileLoaded)["catch"](function(e){throw t.context.eventHandler&&t.context.eventHandler.dispatchEvent(s.PlayerEvent.Warning,new r.PlayerWarning(o.WarningCode.NETWORK_COULD_NOT_LOAD_SUBTITLE)),t.context.logger.debug("Could not load subtitles/captions, got HTTP status code \n              "+(e.status?e.status.toString():"")+"\n              "),t.deactivate(),t.loadPromise=null,"loading failed"}),t.loadPromise)})},t.prototype.parse=function(e){var t=c.SubtitleParserFactory.createInstance(this.context,e);return t.parse(e)},t.enforceHTTPSForSecureOrigins=function(e){var t=new RegExp("^(?:[a-z]+:)?//","i");return"https:"===location.protocol?e.replace(t,"//"):e},t.prototype.getSubtitleType=function(){return f.SubtitleType.EXTERNAL_FILE},t.prototype.clearBuffersUntil=function(){},t.prototype.onSeek=function(){},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.subtitleLoader=a.dispose(this.subtitleLoader)},t}(d.AbstractSubtitleHandler);t.ExternalFileSubtitleHandler=p},503:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=n(1),a=n(15),s=n(105),u=n(0),l=n(498),c=n(87),d=n(2),f=n(111),p=n(78),h=function(e){function t(t,n,i,c){var f=e.call(this,t,i,n.periodId)||this;f.onSegmentDataAvailable=function(e){var t=Promise.resolve();return f.isHls&&f.getTransmuxer()&&(t=f.getTransmuxer().initialized()),t.then(function(){f.updateBufferLevel(e);var t=e.getData(),n=e.getMetadata(),i="wvtt"===e.getCodec()&&s.TextSegmentAnalyzer.isPlainTextPayload(t);i&&(n.subtitles=l.PlainTextSubtitleParser.parseSubtitles(e));var r=-f.segmentController.getMPDHandler().getTimestampOffset();if(f.getTransmuxer&&f.getTransmuxer()&&(r+=f.getTransmuxer().getTimestampMappingOffset()),Array.isArray(n.subtitles)){var o="stpp"===e.getCodec()||i;f.addCues(e,n.subtitles,o,r)}})},f.onTimeUpdate=function(e){e&&(f.segmentBufferRange.start=e.time),f.segmentBufferRange.end-f.segmentBufferRange.start>=f.bufferSettings.getForwardTargetLevel()||f.segmentController.hasNext()&&(f.segmentController.getMPDHandler().resolvePendingSegmentInfoRequests(),f.segmentController.getNext())},f.onSeekFromEvent=function(e){var t=null!=e.seekTarget&&e.seekTarget||e.target;f.onSeek(0,t)},f.onSeeked=function(){f.targetTime=void 0},f.onMpdUpdated=function(){f.segmentController.updateMpd()},f.eventHandler=t.eventHandler,f.sourceStoreService=t.serviceManager.get(r.ServiceName.SourceStoreService,t.sourceContext.sourceIdentifier),f.manifestUpdateScheduler=t.serviceManager.get(r.ServiceName.ManifestUpdateSchedulingService),f.getTransmuxer=c,f.isHls=n.isHls,f.bufferSettings=t.bufferSettings,f.segmentBufferRange={start:0,end:0};var p=d.ModuleManager.get(u.ModuleName.EngineBitmovin).SegmentController;return f.segmentController=new p(t,f.onSegmentDataAvailable,n.mimeType,n.codec,n.isHls,n.manifestLoader,n.periodId),f.segmentController.setCurrentLangObj(i),f.eventHandler.on(o.PlayerEvent.Seek,f.onSeekFromEvent),f.eventHandler.on(o.PlayerEvent.Seeked,f.onSeeked),f.eventHandler.on(o.PlayerEvent.TimeShift,f.onSeekFromEvent),f.eventHandler.on(o.PlayerEvent.TimeShifted,f.onSeeked),f.eventHandler.on(a.InternalEvent.MPDUpdated,f.onMpdUpdated,!0),f}return i(t,e),t.prototype.updateBufferLevel=function(e){if(!e.isInit()){var t=this.getBufferdRange().end;e.getPlaybackTime()&&(t=e.getPlaybackTime()),e.getDuration()&&(this.segmentBufferRange.end=t+e.getDuration())}},t.prototype.addCues=function(e,n,i,r){if(n){var o=i?this.parseCues(n,r):n;o=t.ensureCueInSegmentRange(o,e.getPlaybackTime(),e.getDuration(),r),this.fireOnCueParsedEvents(o,this.periodId),this.timeline.addCues(o)}},t.prototype.parseCues=function(e,t){var n=this;return e.flatMap(function(e){return n.parse(e.text,t)})},t.ensureCueInSegmentRange=function(e,t,n,i){if(!t||t<0||!n)return e;if(e.length>0){var r=e.every(function(e){return e.start<n});r&&e.forEach(function(e){e.start+=t-i,e.end+=t-i})}return e},t.prototype.parse=function(e,t){var n=c.SubtitleParserFactory.createInstance(this.context,e);return t?n.parse(e,t):n.parse(e)},t.prototype.activate=function(){var t=this;return e.prototype.activate.call(this),this.prepareActivation().then(function(){if(t.isActive()){var e=t.segmentController.getMPDHandler();isNaN(e.getTimestampOffset())&&e.setTimestampOffset(0),t.segmentController.seekTo(t.targetTime||t.context.renderer.getCurrentTime(!0)),t.segmentController.getNext(),t.eventHandler.on(o.PlayerEvent.TimeChanged,t.onTimeUpdate)}})},t.prototype.prepareActivation=function(){var e=this.segmentController.getCurrentAdaptationSet().Representation[0]._internalId,t=d.ModuleManager.get(u.ModuleName.EngineBitmovin).actions.setRepresentationIdAction(e);return this.sourceStoreService.dispatch(t),this.manifestUpdateScheduler.waitForRepUpdate(e)},t.prototype.deactivate=function(){return this.timeline.removeCues(),this.segmentBufferRange={start:0,end:0},this.eventHandler.off(o.PlayerEvent.TimeChanged,this.onTimeUpdate),this.sourceStoreService.dispatch(d.ModuleManager.get(u.ModuleName.EngineBitmovin).actions.removeActiveTrackAction(this.segmentController.getCurrentAdaptationSet()._internalId)),e.prototype.deactivate.call(this)},t.prototype.getSubtitleType=function(){return p.SubtitleType.FRAGMENTED},t.prototype.getBufferdRange=function(){return this.segmentBufferRange},t.prototype.clearBuffersUntil=function(t){e.prototype.clearBuffersUntil.call(this,t),this.segmentBufferRange.end<=t?(this.segmentBufferRange.start=0,this.segmentBufferRange.end=0):this.segmentBufferRange.start<t&&(this.segmentBufferRange.start=t)},t.prototype.onSeek=function(e,t){if(this.isActive()){this.targetTime=t;var n=t>=this.segmentBufferRange.start&&t<=this.segmentBufferRange.end;n||(this.timeline.removeCues(),this.segmentBufferRange.start=0,this.segmentBufferRange.end=0,this.segmentController.seekTo(t))}},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.eventHandler.off(o.PlayerEvent.Seek,this.onSeekFromEvent),this.eventHandler.off(o.PlayerEvent.Seeked,this.onSeeked),this.eventHandler.off(o.PlayerEvent.TimeShift,this.onSeekFromEvent),this.eventHandler.off(o.PlayerEvent.TimeShifted,this.onSeeked),this.eventHandler.off(a.InternalEvent.MPDUpdated,this.onMpdUpdated),this.segmentController.dispose()},t}(f.AbstractSubtitleHandler);t.FragmentedSubtitleHandler=h},78:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i;!function(e){e[e.EXTERNAL_FILE=0]="EXTERNAL_FILE",e[e.FRAGMENTED=1]="FRAGMENTED",e[e.IN_STREAM=2]="IN_STREAM"}(i=t.SubtitleType||(t.SubtitleType={}))},87:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0),a=n(497),s=function(){function e(){}return e.createInstance=function(e,t){var n;if(t.indexOf("<?")>-1||t.indexOf("<tt")>-1)if(r.ModuleManager.has(o.ModuleName.SubtitlesTTML)){var s=r.ModuleManager.get(o.ModuleName.SubtitlesTTML).TTMLParser;n=new s(e)}else e.eventHandler.dispatchEvent(i.PlayerEvent.Warning,new a.ModuleMissingWarning(o.ModuleName.SubtitlesTTML));else if(r.ModuleManager.has(o.ModuleName.SubtitlesWebVTT)){var u=r.ModuleManager.get(o.ModuleName.SubtitlesWebVTT);n=new u.WebVttParser}else e.eventHandler.dispatchEvent(i.PlayerEvent.Warning,new a.ModuleMissingWarning(o.ModuleName.SubtitlesWebVTT));return n},e}();t.SubtitleParserFactory=s}},[496])});
})();
