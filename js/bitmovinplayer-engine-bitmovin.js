/**************************************************************************** 
 * Copyright (C) 2020, Bitmovin, Inc., All Rights Reserved 
 * 
 * This source code and its use and distribution, is subject to the terms 
 * and conditions of the applicable license agreement. 
 * 
 * Bitmovin Player Version 8.34.0 
 * 
 ****************************************************************************/
(function() {
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["engine-bitmovin"]=t():(e.bitmovin=e.bitmovin||{},e.bitmovin.player=e.bitmovin.player||{},e.bitmovin.player["engine-bitmovin"]=t())}(this,function(){return webpackJsonpbitmovin_player__name_([0],{107:function(e,t,i){"use strict";function n(e,t){for(var i=e[0].discontinuitySequenceNumber,n=1;n<e.length;n++){var o=e[n].discontinuitySequenceNumber;if(o!==i){var a=r(t,o);if(null!=a)return{index:n,discontinuityStartTime:a}}}return null}function r(e,t){var i=e[String(t)];return i&&i.startTime>0?i.startTime:(i=e[String(t-1)],i&&i.endTime>0?i.endTime:null)}var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},o.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=i(5),s=i(47),d=i(56),u=i(3),c=i(11),l=i(2),h=i(0),p=i(180),f=i(178),g=i(442),m=function(){function e(e){this.context=e,this.settings=e.settings,this.logger=e.logger,this.manifestService=e.serviceManager.get(a.ServiceName.ManifestService),this.distanceToListStartSeconds=0,this.segmentListMap={},this.timestampOffset=NaN}return e.prototype.createSegmentListEntry=function(e){if(!e)return null;var t={isInitSegment:!1,url:e._media,downloaded:!1,startTime:e._expectedPlaybackTime};return["_key","_duration","_dateTime","_metadata","_byteRange","_init","_discontinuitySequenceNumber"].filter(function(t){return e.hasOwnProperty(t)}).forEach(function(i){return t[i.substr(1)]=e[i]}),t},e.prototype.removeDroppedOutSegmentsFromList=function(e,t,i){if(t.SegmentURL.length<1)return e.entries=[],void(e.totalDuration=0);for(var n=this.createSegmentListEntry(t.SegmentURL[0]),r=0,o=0;o<e.entries.length;o++){var a=e.entries[o];if(p.isIdenticalSegmentEntry(a,n))break;r+=a.duration,e.entries.splice(o,1),o--,this.manifestService.isLive()&&this.currentRepresentationId.equals(i)&&this.rewindOneSegment()}e.totalDuration-=r},e.prototype.addNewSegmentsToList=function(e,t){for(var i=[],n=e.entries[e.entries.length-1],r=0,o=t.SegmentURL.length-1;o>=0;o--){var a=this.createSegmentListEntry(t.SegmentURL[o]);if(n&&p.isIdenticalSegmentEntry(n,a))break;isNaN(a.duration)&&(a.duration=e.maximumSegmentDuration),a.duration/=e.timescale,r+=a.duration,i.unshift(a)}e.totalDuration+=r,e.entries=e.entries.concat(i)},e.prototype.updateSegmentList=function(e,t){var i=t.SegmentList,n=t._internalId.representationId;e.init={isInitSegment:!0,url:"",presentationTimeOffset:this.getTimestampOffset()},e.timescale=1,e.maximumSegmentDuration=1,e.startNumber=1;for(var r=function(r){var a=i[r];a.hasOwnProperty("_duration")&&(e.maximumSegmentDuration=Number(a._duration)),["_timescale","_startNumber","_presentationTimeOffset"].filter(function(e){return a.hasOwnProperty(e)}).forEach(function(t){return e[t.substr(1)]=a[t]}),a.hasOwnProperty("Initialization")&&a.Initialization[0].hasOwnProperty("_sourceURL")?(e.init.url=a.Initialization[0]._sourceURL,e.init.byteRange=a.Initialization[0]._byteRange):delete e.init,a.hasOwnProperty("SegmentURL")&&(o.removeDroppedOutSegmentsFromList(e,a,t._internalId),o.addNewSegmentsToList(e,a),o.manifestService.isHlsManifest()?o.assignSegmentStartTimesFromHlsPlaylist(e,n):o.assignSegmentStartTimesForDash(e,t._internalId))},o=this,a=0;a<i.length;a++)r(a)},e.prototype.assignSegmentStartTimesForDash=function(e,t){var i=this.getMinStartTime(t),n=0;e.entries.forEach(function(e){e.startTime=i+n,n+=e.duration})},e.prototype.assignSegmentStartTimesFromHlsPlaylist=function(e,t){if(this.manifestService.hasExpectedPlaybackTimeForHlsRepresentation(t)){var i=e.entries;if(!(i.length<1)){var n,r=null!=i[0].startTime;if(r){for(n=i.length-1;n>=0&&null==i[n].startTime;n--);n++}else i[0].startTime=this.manifestService.getExpectedPlaybackTimeForHlsSegment(t,i[0]),n=1;this.extrapolateHlsStartTimes(i,n)}}},e.prototype.extrapolateHlsStartTimes=function(e,t){for(;t<e.length;t++){var i=e[t-1],n=e[t];n.startTime=i.startTime+i.duration}},e.prototype.extrapolateStartTimesFromDiscontinuityStarts=function(e){var t=this.getCurrentSegmentList().entries,i=l.ModuleManager.get(h.ModuleName.HLS).selectors,r=i.getHlsState,o=i.getDiscoSequenceTimings,a=i.getPlaylistStartTime,s=o(r(this.getSourceStateService().getState())),d=n(t,s);if(!d){var u=a(r(this.getSourceStateService().getState()),e.getRepresentationId().representationId);d={index:0,discontinuityStartTime:u},this.logger.debug("Could not find matching discontinuity start times for "+(e.getSegmentInfo().discontinuitySequenceNumber+" using playlist startTime: "+u))}this.logger.debug("Aligning segments of "+e.getRepresentationId().representationId+" to discontinuity start "+(d.discontinuityStartTime+" of "+e.getSegmentInfo().discontinuitySequenceNumber)),t[d.index].startTime=d.discontinuityStartTime;for(var c=d.index-1;c>=0;c--)t[c].startTime=t[c+1].startTime-t[c+1].duration;for(var c=d.index+1;c<t.length;c++)t[c].startTime=t[c-1].startTime+t[c-1].duration},e.prototype.getSourceStateService=function(){return this.context.serviceManager.get(a.ServiceName.SourceStoreService,this.context.sourceContext.sourceIdentifier)},e.prototype.getListIndexForSegmentByUrl=function(e,t){var i=-1,n=this.segmentListMap[t.key()];if(n)for(var r=n.entries,o=0;o<r.length;o++)if(p.isIdenticalSegmentEntry(r[o],e)){i=o;break}return i},e.prototype.populateSegmentListMap=function(e){var t=this,i=this.manifestService.getAdaptationSet(e);i.Representation.forEach(function(e){var i=t.segmentListMap[e._internalId.key()];i||(i=t.initializeSegmentList(e._internalId.key())),e.hasOwnProperty("SegmentList")&&(t.updateSegmentList(i,e),!i.hasOwnProperty("init")&&e.hasOwnProperty("SegmentBase")&&e.SegmentBase&&e.SegmentBase[0].hasOwnProperty("Initialization")&&e.SegmentBase[0].Initialization&&e.SegmentBase[0].Initialization[0].hasOwnProperty("_sourceURL")&&(i.init={url:e.SegmentBase[0].Initialization[0]._sourceURL}))})},e.prototype.setAdaptationSetId=function(e){var t=this;this.adaptationSetId=e,this.populateSegmentListMap(this.adaptationSetId);var i,n=this.manifestService.isLive(),r=0,o=this.adaptationSetId.equals(this.currentRepresentationId),a=!this.currentRepresentationId||Boolean(this.manifestService.getRepresentationById(this.currentRepresentationId));if(!this.currentRepresentationId||!o||!a){var s=void 0;this.currentRepresentationId&&(s=this.manifestService.getRepresentation(this.adaptationSetId,this.currentRepresentationId.representationId)),s||(s=this.manifestService.getMatchingRepresentationByBandwidth(this.adaptationSetId,this.getCurrentBandwidth(),function(e){return t.isSegmentInfoLoaded(e._internalId)})||this.manifestService.getMatchingRepresentationByBandwidth(this.adaptationSetId,this.getCurrentBandwidth())),this.currentRepresentationId=s._internalId}var d=this.segmentListMap[this.currentRepresentationId.key()];if(d||(d=this.initializeSegmentList(this.currentRepresentationId.key())),d&&n&&d.entries&&d.entries.length>0){var u=d.entries.length-1;this.listIndex>u&&(r=this.listIndex-u),this.listIndex=Math.min(u,this.listIndex||0),this.listIndex=Math.max(0,this.listIndex),i=d.entries[this.listIndex]}if(this.listIndex=this.listIndex||0,n&&(this.distanceToListStartSeconds=this.getSegmentDuration()*this.settings.LIVE_SEGMENT_LIST_START_INDEX_OFFSET),!n)return void this.resolvePendingSegmentInfoRequests();if(i&&d){var c=this.getListIndexForSegmentByUrl(i,this.currentRepresentationId);c>=0?this.listIndex=c+r:this.reset()}else this.reset();var l=this.checkForSegmentInfoError();l?this.rejectPendingSegmentInfoRequest(l):this.resolvePendingSegmentInfoRequests()},e.prototype.initializeSegmentList=function(e){var t={totalDuration:0,entries:[],startNumber:0,init:null,maximumSegmentDuration:1,timescale:1};return this.segmentListMap[e]=t,t},e.prototype.getCurrentBandwidth=function(){var e=0,t=this.getCurrentRepresentation();return t&&(e=t._bandwidth),e},e.prototype.checkForSegmentInfoError=function(){var e=this.manifestService.getPeriod(this.currentRepresentationId);if(Boolean(e)&&!this.hasNext()){if(e.droppedOut)return f.SegmentInfoErrors.PERIOD_DROPPED_OUT;if(!this.manifestService.isLastPeriod(this.currentRepresentationId.periodId))return f.SegmentInfoErrors.PERIOD_COMPLETE}return null},e.prototype.reset=function(){this.settings.ENABLE_SEEK_FOR_LIVE?this.listIndex=0:this.timeShift(0)},e.prototype.setRepresentationId=function(e){var t=this.manifestService.getRepresentationById(e);if(t){var i=void 0===this.currentRepresentationId,n=this.currentRepresentationId;if(this.currentRepresentationId=e,this.manifestService.isLive()&&t._hls)if(i)this.reset();else if(this.settings.HLS_SYNC_VIA_MEDIA_SEQUENCE){var r=this.manifestService.getRepresentationById(n),o=r._hls.mediaSequence+this.listIndex;this.listIndex=o-t._hls.mediaSequence,this.listIndex=Math.max(this.listIndex,0)}return!0}return!1},e.prototype.getInitSegmentInfo=function(){var e=this.getCurrentSegmentList();if(!e)return null;if(e.init)return e.init.presentationTimeOffset=this.getTimestampOffset(),e.init;if(this.listIndex<e.entries.length&&this.listIndex>-1){var t=o({},e.entries[this.listIndex]);if(t.init){var i=t.init;return i.isInitSegment=!0,i}}return null},e.prototype.getNextSegmentInfo_=function(){var e=this.getCurrentSegmentList();if(e&&this.listIndex<e.entries.length&&this.listIndex>-1){var t=e.entries[this.listIndex];return t.isInitSegment=!1,t.presentationTimeOffset=this.getTimestampOffset(),this.listIndex++,t}return null},e.prototype.getNextSegmentInfo=function(){var e=this.getNextSegmentInfo_();return e?Promise.resolve(e):this.queueSegmentInfoRequest()},e.prototype.getSegmentInfos=function(){var e=this,t=this.listIndex,i=this.manifestService.getTotalDuration(),n={},r=this.manifestService.getAdaptationSet(this.adaptationSetId);if(r){var o=this.getSeekableRange().end-this.getSeekableRange().start,a=r.Representation[0].BaseURL[0].url;r.Representation.forEach(function(r){var s,d,l=e.segmentListMap[r._internalId.key()],h=e.manifestService.isLive();h?(s=t-o/e.getSegmentDuration(),d=t):(s=0,d=parseInt(s+o/e.getSegmentDuration())-1);for(var p=0,f=[],g=s;g<=d;g++){var m=f.length;f[m]={};var y=void 0;if(l.entries.length&&(y=l.entries[m].url),"string"==typeof y){var S=c.URLHelper.concatBaseUrlWithPartial(a,y);f[m].url=c.URLHelper.appendQueryParametersToUrl(S,e.settings.QUERY_PARAMETERS)}f[m].duration=e.getSegmentDuration(),h?(p=e.settings.ENABLE_SEEK_FOR_LIVE?e.getExpectedPresentationTime(g):u.toSeconds(Date.now()-e.manifestService.getAvailabilityStartTime())-i,t++):(f[m].startTime=p,p+=f[m].duration),n[r._id]=f}})}return n},e.prototype.getSubtitleUrl=function(){return this.manifestService.getAvailableSubtitles(this.adaptationSetId.periodId)[0].url},e.prototype.getStartNumber=function(){var e=this.getCurrentSegmentList();return e?e.startNumber:1},e.prototype.getSegmentDuration=function(){var e=this,t=this.getCurrentSegmentList();if(t)return t&&t.entries.length>0?t.totalDuration/t.entries.length:t.maximumSegmentDuration;var i=this.manifestService.getAdaptationSet(this.adaptationSetId);if(i){var n=Object.keys(this.segmentListMap).map(function(t){return e.segmentListMap[t]}).find(function(e){return null!==e});if(n)return n.maximumSegmentDuration}return 1},e.prototype.seekTo=function(e){e>-1&&(this.listIndex=this.getIndexForTime(e))},e.prototype.isSegmentInfoLoadable=function(){var e=this.getCurrentPeriod();return!e.droppedOut},e.prototype.hasNext=function(){if(!this.isSegmentInfoLoaded(this.currentRepresentationId))return this.isSegmentInfoLoadable();if(this.currentRepresentationId){var e=this.listIndex<this.getCurrentSegmentList().entries.length;if(this.manifestService.isHlsManifest()){if(this.manifestService.isLastPeriod(this.currentRepresentationId.periodId)){var t=l.ModuleManager.get(h.ModuleName.HLS).selectors,i=t.getHlsState,n=t.getEndlist,r=n(i(this.getSourceStateService().getState()));return!r||e&&r}return e}return e}return!0},e.prototype.setTimestampOffset=function(e,t){void 0===t&&(t=1),this.timestampOffset=e/t},e.prototype.getTimestampOffset=function(){if(!isNaN(this.timestampOffset))return this.timestampOffset;var e=this.getCurrentPeriod(),t=0;if(this.currentRepresentationId){var i=this.getCurrentSegmentList();i&&!isNaN(i.presentationTimeOffset)&&(t=i.presentationTimeOffset/i.timescale)}return e&&!this.manifestService.isHlsManifest()&&(t-=e.start),t},e.prototype.getIndex=function(){return this.listIndex},e.prototype.setIndex=function(e){return"number"!=typeof e?void this.logger.debug("Tried to set index at MPDHandler with parameter not being a number!"):e<0?(this.logger.debug("Tried to set index at MPDHandler to value smaller 0. Setting to 0."),void(this.listIndex=0)):void(this.listIndex=e)},e.prototype.queueSegmentInfoRequest=function(){var e=this;return this.pendingSegmentInfoRequest?Promise.reject("fail"):new Promise(function(t,i){e.pendingSegmentInfoRequest={resolve:t,reject:i}})},e.prototype.resolvePendingSegmentInfoRequests=function(){if(this.pendingSegmentInfoRequest){var e=this.getNextSegmentInfo_();e?(this.pendingSegmentInfoRequest.resolve(e),this.pendingSegmentInfoRequest=null):this.manifestService.isLive()||this.hasNext()||this.pendingSegmentInfoRequest.reject("eos")}},e.prototype.rejectPendingSegmentInfoRequest=function(e){this.pendingSegmentInfoRequest&&(this.pendingSegmentInfoRequest.reject(e),this.pendingSegmentInfoRequest=null)},e.prototype.getLiveEdgeIndex=function(){var e=this.manifestService.isLastPeriod(this.currentRepresentationId.periodId),t=this.getCurrentSegmentList();if(!e)return t.entries.length-1;if(t){var i=t.entries.length,n=this.manifestService.getDesiredDistanceToLiveEdge(),r=void 0;for(r=i;n>0&&r>0;r--)n-=t.entries[r-1].duration||this.getSegmentDuration();return Math.max(0,r)}return 0},e.prototype.timeShift=function(e){if(this.manifestService.isLive()){var t=this.listIndex,i=this.getLiveEdgeIndex();0===e?(this.listIndex=i,this.logger.debug("timeShift changes index from "+t+" to "+this.listIndex+" [back to live edge]")):(this.listIndex=Math.max(0,i+Math.floor(e/this.getSegmentDuration())),this.logger.debug("timeShift changes index from "+t+" to "+this.listIndex))}},e.prototype.updateRepresentation=function(e){return Promise.resolve(e)},e.prototype.isSegmentInfoLoaded=function(e){if(void 0===e&&(e=this.currentRepresentationId),!e)return!1;var t=this.segmentListMap[e.key()],i=this.manifestService.getRepresentationById(e);return!(!t||!i)&&t.entries.length>0},e.prototype.rewindOneSegment=function(){return this.listIndex--,!(this.listIndex<0)||(this.logger.debug("List array index is smaller than 0, probably a discontinuity. Using 0."),this.listIndex=0,!1)},e.prototype.getCurrentPeriod=function(){return this.manifestService.getPeriod(this.currentRepresentationId)},e.prototype.getExpectedPresentationTime=function(e){var t=0,i=this.getCurrentPeriod().start;t=this.manifestService.hasSinglePeriod()?this.getSeekableRange().start:i;var n=this.getCurrentSegmentList(),r=n.entries.slice(0,e),o=r.reduce(function(e,t){return e+t.duration},0);return t+o},e.prototype.getCurrentRepresentation=function(){return this.manifestService.getRepresentationById(this.currentRepresentationId)},e.prototype.getCurrentSegmentList=function(){return this.currentRepresentationId?this.segmentListMap[this.currentRepresentationId.key()]:null},e.prototype.findListIndexWithoutSegmentStartTimes=function(e,t){if(!this.adaptationSetId)return 0;for(var i=this.manifestService.getPeriod(this.adaptationSetId),n=i?i.start:0,r=e.entries.length,o=0,a=n;a<=t&&o<r;o++)a+=e.entries[o].duration;return Math.max(o-1,0)},e.prototype.getIndexForTime=function(e){var t=this.getCurrentSegmentList();if(!t||0===t.entries.length)return 0;var i=this.getMinStartTime(),n=Math.max(i,e),r=t.totalDuration/t.entries.length,o=g.findSegmentInfoForTime(t.entries,n,r);return null!==o?o:this.findListIndexWithoutSegmentStartTimes(t,n)},e.prototype.getMinStartTime=function(e){void 0===e&&(e=this.currentRepresentationId);var t=this.manifestService.hasSinglePeriod()?this.getSeekableRange().start:this.manifestService.getPeriod(e).start;return this.manifestService.isFirstPeriod(e.periodId)&&(t+=this.distanceToListStartSeconds),t},e.prototype.getLiveEdgeTime=function(){var e=this.manifestService.getLastPeriod();return e?e.start+d.DurationConverter.getDurationInSec(e._duration):1/0},e.prototype.getActualTimeShiftBufferDepth=function(){return this.manifestService.getTimeShiftBufferDepthSeconds()},e.prototype.getSeekableRange=function(){var e={start:0,end:0},t=this.manifestService.getTotalDuration();if(!this.manifestService.isLive())return e.start=s.getStartTimeOffset(this.getSourceStateService().getState()),e.end=t,e;var i=this.manifestService.getTimeShiftBufferDepthSeconds(),n=u.toSeconds(this.manifestService.getRequestTimestamp()-this.manifestService.getAvailabilityStartTime());if(e.start=Math.max(n+i,0),e.end=Math.max(n,0),l.ModuleManager.has(h.ModuleName.HLS)&&this.manifestService.isHlsManifest()){var r=l.ModuleManager.get(h.ModuleName.HLS).selectors,o=r.getHlsState,a=r.getPlaylistType;"EVENT"===a(o(this.getSourceStateService().getState()))?(e.start=0,e.end=t):e.start+=this.distanceToListStartSeconds}return e.end-=this.manifestService.getDesiredDistanceToLiveEdge(),e},e.prototype.getPendingSegmentInfoRequest=function(){return this.pendingSegmentInfoRequest},e.prototype.setPendingSegmentInfoRequest=function(e){this.pendingSegmentInfoRequest=e},e.prototype.preProcessAvailableSegment=function(e,t,i){return null},e.prototype.dispose=function(){this.settings=null,this.manifestService=null,this.adaptationSetId=null,this.currentRepresentationId=null,this.manifestService=null,this.pendingSegmentInfoRequest=null,this.segmentListMap=null},e}();t.SegmentListMPDHandler=m},108:function(e,t,i){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r,o=i(42),a=i(4),s=i(6),d=i(1),u=i(15),c=i(34),l=i(12),h=i(24),p=i(23),f=i(17),g=i(28),m=i(7),y=i(3),S=i(2),v=i(0),T=i(109),P=i(437),I=i(438),M=i(439),b=i(65);!function(e){e.CANCEL="CANCEL",e.ERROR_LOADING="ERROR_LOADING",e.ERROR_DECRYPTING="ERROR_DECRYPTING",e.BUSY="BUSY",e.UNKNOWN="UNKNOWN"}(r=t.SegmentLoadingErrorReason||(t.SegmentLoadingErrorReason={}));var E;!function(e){e[e.IDLE=1]="IDLE",e[e.LOADING=2]="LOADING",e[e.CANCELLING=3]="CANCELLING",e[e.TERMINATED=4]="TERMINATED"}(E||(E={}));var R=408,C=function(){function e(e,t,i,n,r){var o=this;if(void 0===r&&(r=!1),this.cancelLoading=function(){clearTimeout(o.loadTimeoutID),o.loadTimeoutID=null,o.isLoading()&&(delete o.currentSegmentInfo[o.loadingUrl],o.state=E.CANCELLING,o.loader.cancel(),o.currentDownloadInfo&&(o.context.store.dispatch(h.addMetricsValue(o.mimeType,f.MetricType.DownloadInformation,{bytes:o.currentDownloadInfo.loadedBytes,time:o.currentDownloadInfo.elapsedTime,timeToFirstByte:o.currentDownloadInfo.timingInformation.headersReceivedTimestamp-o.currentDownloadInfo.timingInformation.openedTimestamp})),o.canceledSegmentRequestFinishedEvent={success:!1,httpStatus:R,downloadTime:o.currentDownloadInfo.elapsedTime,size:o.currentDownloadInfo.loadedBytes,duration:o.segmentDuration,isInit:o.isInit,mimeType:o.mimeType,uid:void 0}),o.currentDownloadInfo=null)},this.onQosRepresentationChanged=function(e){o.optimizedBitrate=e.optimizedBitrate,o.alternativeBitrate=e.originalBitrate},this.onQosDataAvailable=function(e){return o.qosData=e.r},this.context=e,this.logger=e.logger,this.eventHandler=e.eventHandler,this.customLoaderArgs=e.config.tweaks.segmentLoaderArgs||null,this.customLoader=e.config.tweaks.segmentLoader||null,this.segmentDuration=1,this.segmentNumber=0,this.state=E.IDLE,this.currentDownloadInfo=null,this.mimeType=t,this.codec=i,this.alternativeBitrate=0,this.optimizedBitrate=0,this.keyStore=new I.KeyStore,this.keyLoader=new P.KeyLoader(this.context),this.onDownloadShouldBeCancelledCallback=n,this.currentLoadPromise=null,this.currentSegmentInfo={},this.canceledSegmentRequestFinishedEvent=null,this.isFetchSupported="function"==typeof window.fetch,this.isPrefetchingLoader=r,S.ModuleManager.has(v.ModuleName.ContainerMP4)){var a=S.ModuleManager.get(v.ModuleName.ContainerMP4);this.cmafChunkParser=new a.CmafChunkParser(this.context)}this.setupContentLoader()}return e.prototype.isLoading=function(){var e=Boolean(this.keyLoader&&this.keyLoader.isLoading());return this.state===E.LOADING||this.state===E.CANCELLING||this.loader&&this.loader.isLoading()||e},e.prototype.isRetrying=function(){return this.loader&&this.loader.isRetrying()},e.prototype.load=function(e){var t=this;if(this.isLoading())return this.logger.debug("Error loading segment, loader is busy!"+this.loadingUrl),Promise.reject({reason:r.BUSY});this.loader&&this.loader.dispose(),this.canceledSegmentRequestFinishedEvent=null,this.loader=M.getLoader(this.context,this.defaultLoaderArgs),this.state=E.LOADING,this.currentSegmentInfo[e.url]=e,this.encryptionInfo=e.key;var i=Promise.resolve();if(this.encryptionInfo&&!this.encryptionInfo.buffer)if(this.encryptionInfo.method===o.HlsEncryptionMethod.AES_128)i=this.getKey(e).then(function(e){return t.encryptionInfo.buffer=e});else if(this.encryptionInfo.method===o.HlsEncryptionMethod.SAMPLE_AES)return this.eventHandler.fireError(new s.PlayerError(a.ErrorCode.SOURCE_ENCRYPTION_METHOD_NOT_SUPPORTED,{"encryption-method":this.encryptionInfo.method})),Promise.reject({reason:r.ERROR_DECRYPTING});return this.currentLoadPromise=i.then(function(){return t.loadSegment(e.duration,e,e.isInitSegment)["catch"](function(e){throw t.state=E.IDLE,t.currentLoadPromise=null,e})}),this.currentLoadPromise},e.prototype.getCurrentLoadPromise=function(){return this.currentLoadPromise},e.prototype.getKey=function(e){var t=this,i=e.key.uri,n=this.keyStore.get(i);return n?Promise.resolve(n):this.keyLoader.load(i).then(function(e){return t.keyStore.put(i,e),e})["catch"](function(){throw{reason:r.ERROR_DECRYPTING}})},e.prototype.getPreFetchedSegment=function(e,t){return this.isPrefetchingLoader||!this.context.adRestorationOptimizationService.hasPrefetchedSegment(t)?null:(this.currentSegmentInfo[e]&&(this.currentSegmentInfo[e].wasPrefetched=!0),this.context.adRestorationOptimizationService.getPrefetchedSegment(t,this.onDownloadShouldBeCancelledCallback))},e.prototype.loadSegment=function(e,t,i){var n=this,r={};this.isInit=i||!1,this.segmentDuration=t.duration||e,this.segmentNumber=t.segmentNumber,this.loadingUrl=t.url,this.loadingUid=btoa(this.loadingUrl),this.currentDownloadInfo=null,t.byteRange&&(r.Range=["bytes=",t.byteRange.start,"-",t.byteRange.end].join(""));var o=this.context.sourceContext.source&&this.context.sourceContext.source.hasOwnProperty("options"),a=o&&Boolean(this.context.sourceContext.source.options.withCredentials);clearTimeout(this.loadTimeoutID),this.loadTimeoutID=void 0,this.isInit||t.preventDownloadCanceling||(this.loadTimeoutID=setTimeout(this.cancelLoading,y.toMilliSeconds(this.context.settings.XHR_TIMEOUT-1)));var s=this.getPreFetchedSegment(this.loadingUrl,t);if(s)return this.context.logger.debug("return prefetched segment for",this.loadingUrl),s.then(function(e){var t=new b.Stream;return n.loadingFinished(),t.add(e),e.getSegmentInfo().wasPrefetched=!0,t})["catch"](function(e){throw e});var d=Boolean(this.encryptionInfo)||Boolean(this.decrypter),u=t.mimeType.includes("mp4")&&m.MimeTypeHelper.isAV(t.mimeType)&&!t.isTransmuxingRequired,c=this.context.settings.CHUNKED_CMAF_STREAMING&&this.cmafChunkParser&&this.isFetchSupported&&u&&!t.isInitSegment&&!d;return this.loader.load(this.loadingUrl,l.HttpRequestMethod.GET,l.HttpResponseType.ARRAYBUFFER,null,r,a,this.mimeType,c).then(function(e){return n.handleResponse(e.body)})["catch"](function(e){throw n.createLoadingError(e)})},e.prototype.createLoadingError=function(e){var t;return this.state===E.CANCELLING?(this.logger.debug("Cancelled "+this.mimeType+" download ["+this.loadingUrl+"]"),this.canceledSegmentRequestFinishedEvent&&this.eventHandler.dispatchEvent(d.PlayerEvent.SegmentRequestFinished,this.canceledSegmentRequestFinishedEvent),t={reason:r.CANCEL}):this.state===E.LOADING&&(t={reason:r.ERROR_LOADING,info:{response:e,isInit:this.isInit}}),t},e.prototype.getAllLoadingPeriodIds=function(){var e=this;return Object.keys(this.currentSegmentInfo).map(function(t){return e.currentSegmentInfo[t].periodId})},e.prototype.getCurrentLoadingSegmentInfo=function(){return this.isLoading()&&this.currentSegmentInfo&&this.currentSegmentInfo[this.loadingUrl]?this.currentSegmentInfo[this.loadingUrl]:null},e.prototype.attachDecrypter=function(e){this.decrypter=this.decrypter||e},e.prototype.terminate=function(){var e=this;this.isLoading()?(this.currentLoadPromise["catch"](function(){e.state=E.TERMINATED}),this.cancelLoading()):this.state=E.TERMINATED},e.prototype.createSegment=function(e){var t;t=this.isInit?T.SegmentInitType.INIT:T.SegmentInitType.NONE;var i=this.currentSegmentInfo[this.loadingUrl],n=new T.Segment(e,this.mimeType,this.codec,i.periodId,this.segmentDuration,t,(!0),e.byteLength,i.internalRepresentationId,i.startTime);return n.setUrl(this.loadingUrl),n.setSegmentInfo(i),n},e.prototype.decryptAes128=function(e){this.logger.debug("Decrypting AES-128-encryped segment "+this.loadingUrl+", KEY: 0x"+g.FormatHelper.bytesToHex(this.encryptionInfo.buffer)+", IV: 0x"+g.FormatHelper.bytesToHex(this.encryptionInfo.iv));var t=S.ModuleManager.get(v.ModuleName.Crypto).CryptoApi;return new t(this.context,"AES-CBC",this.encryptionInfo.buffer,this.encryptionInfo.iv,this.mimeType).decrypt(e).then(function(e){if(!e||0===e.byteLength)throw{reason:r.ERROR_DECRYPTING};return e})["catch"](function(){throw{reason:r.ERROR_DECRYPTING}})},e.prototype.decryptClearKey=function(e){this.logger.debug("Decrypting SAMPLE-AES-encrypted segment "+this.loadingUrl+", KEY: 0x"+g.FormatHelper.bytesToHex(this.decrypter.getKey()));var t=Promise.resolve(e);return this.isInit?t=this.decrypter.parseInitSegment(e):this.decrypter.isEncrypted()&&(t=this.decrypter.decryptDataSegment(e)),t["catch"](function(){throw{reason:r.ERROR_DECRYPTING}})},e.prototype.handleResponse=function(e,t){var i=this;if(void 0===t&&(t=!1),e instanceof ArrayBuffer){this.segmentStream=new b.Stream;var n=Promise.resolve(e);this.encryptionInfo&&this.encryptionInfo.method===o.HlsEncryptionMethod.AES_128&&!t?n=this.decryptAes128(e):this.decrypter&&(n=this.decryptClearKey(e)),n.then(function(e){i.state===E.TERMINATED||i.state===E.CANCELLING?i.segmentStream.abort(r.CANCEL):(i.segmentStream.add(i.createSegment(e)),i.segmentStream.end()),i.loadingFinished()})}else this.segmentStream=e.transform(function(e){return i.cmafChunkParser.appendData(e),i.cmafChunkParser.getCompleteChunks()}).transform(function(e){return i.createSegment(e)},function(){return i.loadingFinished()},function(e){return i.logger.debug("Error handling fetch segment request",e),i.loadingFinished(),e.message===c.RequestError.Canceled?r.CANCEL:r.ERROR_LOADING});return Promise.resolve(this.segmentStream)},e.prototype.loadingFinished=function(){this.state=E.IDLE,this.currentLoadPromise=null,this.cmafChunkParser&&this.cmafChunkParser.reset(),this.currentSegmentInfo&&delete this.currentSegmentInfo[this.loadingUrl]},e.prototype.getIndexByBitrate=function(e){for(var t=0;t<this.qosData.length;t++)if(parseInt(this.qosData[t].b,10)===e)return t;return 0},e.prototype.dispose=function(){this.terminate(),clearTimeout(this.loadTimeoutID),this.loader&&this.loader.dispose&&this.loader.dispose(),this.keyLoader&&this.keyLoader.dispose(),this.keyStore&&this.keyStore.dispose(),S.ModuleManager.has(v.ModuleName.Crypto)&&S.ModuleManager.get(v.ModuleName.Crypto).WebWorkerCrypto.dispose(),this.eventHandler.off(u.InternalEvent.QOSRepresentationChanged,this.onQosRepresentationChanged),this.eventHandler.off(u.InternalEvent.QOSDataAvailable,this.onQosDataAvailable),this.loader=null,this.customLoader=null,this.customLoaderArgs=null,this.keyLoader=null,this.loadingUrl=null,this.loadingUid=null,this.encryptionInfo=null,this.currentSegmentInfo=null,this.currentDownloadInfo=null,this.decrypter=null,this.keyStore=null,this.context=null,this.eventHandler=null},e.prototype.setupContentLoader=function(){var e=this;this.eventHandler.one(u.InternalEvent.QOSDataAvailable,this.onQosRepresentationChanged,!0),this.eventHandler.on(u.InternalEvent.QOSRepresentationChanged,this.onQosRepresentationChanged,!0),this.defaultLoaderArgs=n(n({},M.getLoaderConfig(this.context,this.mimeType)),{onSuccess:function(t,i){var n=p.getMetricsState(e.context.store.getState());!e.isInit&&e.mimeType in n&&(e.context.store.dispatch(h.addMetricsValue(e.mimeType,f.MetricType.DownloadTime,i)),e.context.store.dispatch(h.addMetricsValue(e.mimeType,f.MetricType.DownloadSuccess,!0)),e.context.store.dispatch(h.addMetricsValue(e.mimeType,f.MetricType.DownloadInformation,{bytes:t.length,time:t.elapsedTime,timeToFirstByte:t.timeToFirstByte}))),clearTimeout(e.loadTimeoutID),e.loadTimeoutID=void 0;var r={success:!0,httpStatus:t.status,downloadTime:t.elapsedTime,size:t.length,duration:e.segmentDuration,isInit:e.isInit,mimeType:e.mimeType,uid:e.loadingUid};if(e.qosData){var o=e.getIndexByBitrate(e.optimizedBitrate),a=e.getIndexByBitrate(e.alternativeBitrate);r.qualityInformation={segmentNumber:e.segmentNumber,optimizedBitrate:e.optimizedBitrate,alternativeBitrate:e.alternativeBitrate,optimizedSize:e.qosData[o].s[e.segmentNumber],alternativeSize:e.qosData[a].s[e.segmentNumber],offset:e.qosData[a].o[e.segmentNumber]/e.qosData[a].t}}e.eventHandler.dispatchEvent(d.PlayerEvent.SegmentRequestFinished,r)},onProgress:function(t){var i=.5;if(!(e.isInit||t.elapsedTime<=i||e.state!==E.LOADING)&&(e.currentDownloadInfo=t,e.currentDownloadInfo.segmentDuration=e.segmentDuration,e.currentDownloadInfo.url=e.loadingUrl,e.onDownloadShouldBeCancelledCallback(t))){var n=(8*t.loadedBytes/1e3/t.elapsedTime).toFixed(2);e.logger.debug("cancel download "+e.currentDownloadInfo.url+" (measured bandwidth: "+n+" kbps"),e.context.store.dispatch(h.addMetricsValue(e.mimeType,f.MetricType.DownloadInformation,{bytes:t.loadedBytes,time:t.elapsedTime,timeToFirstByte:t.timingInformation.headersReceivedTimestamp-t.timingInformation.openedTimestamp})),e.cancelLoading()}},onFailure:function(t,i){e.context.store.dispatch(h.addMetricsValue(e.mimeType,f.MetricType.DownloadSuccess,!1)),clearTimeout(e.loadTimeoutID),e.loadTimeoutID=void 0,delete e.currentSegmentInfo[e.loadingUrl],e.eventHandler.dispatchEvent(d.PlayerEvent.SegmentRequestFinished,{success:!1,httpStatus:t&&t.status||0,downloadTime:-1,size:-1,duration:e.segmentDuration,isInit:e.isInit,mimeType:e.mimeType,uid:void 0})}})},e}();t.SegmentLoader=C},109:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(9),r=i(7),o=function(){function e(e,t,i,r,o,s,d,u,c,l){void 0===s&&(s=a.NONE),this.inbandEvents=[],this.data=e,this.mimeType=t,this.codec=i,this.periodId=r,this.duration=o,this.timescale=1,this.initType=s,this.isSegmentIndependentlyDecodable=d,this.encrypted=!1,this.metadata={subtitles:[]},this.networkRequestSize=u,this.representationId=c,this.playbackTime=l,this._isDirty=!1,e instanceof ArrayBuffer||"string"==typeof e&&(this.data=n.ArrayHelper.stringToArrayWithoutEncoding(e).buffer)}return e.prototype.getMimeType=function(){return this.mimeType},e.prototype.isInit=function(){return this.initType===a.INIT},e.prototype.isSelfInit=function(){return this.initType===a.SELF_INIT},e.prototype.isEncrypted=function(){return this.encrypted},e.prototype.setEncrypted=function(e){this.encrypted=e},e.prototype.setUrl=function(e){this.loadedUrl=e},e.prototype.getUrl=function(){return this.loadedUrl},e.prototype.getData=function(){return this.data},e.prototype.setData=function(e){this.data=e},e.prototype.getMetadata=function(){return this.metadata;
},e.prototype.setMetadata=function(e){this.metadata=e},e.prototype.getPlaybackTime=function(){return this.playbackTime},e.prototype.setPlaybackTime=function(e){this.playbackTime=e},e.prototype.getPlaybackEndTime=function(){return this.playbackTime+this.duration},e.prototype.getBaseMediaDecodeTime=function(){return this.baseMediaDecodeTime},e.prototype.setBaseMediaDecodeTime=function(e){this.baseMediaDecodeTime=e},e.prototype.getPresentationTimeOffset=function(){return this.presentationTimeOffset},e.prototype.setPresentationTimeOffset=function(e){this.presentationTimeOffset=e},e.prototype.getTFDTBoxOffset=function(){return this.tfdtBoxOffset},e.prototype.setTFDTBoxOffset=function(e){this.tfdtBoxOffset=e},e.prototype.getTimescale=function(){return this.timescale},e.prototype.setTimescale=function(e){this.timescale=e},e.prototype.getPeriodId=function(){return this.periodId},e.prototype.getCodec=function(){return this.codec},e.prototype.setCodec=function(e){this.codec=e},e.prototype.getDuration=function(){return this.duration},e.prototype.setDuration=function(e){this.duration=e},e.prototype.getNetworkRequestSize=function(){return this.networkRequestSize},e.prototype.getRepresentationId=function(){return this.representationId},e.prototype.getParsedData=function(){return this.parsedData},e.prototype.setParsedData=function(e){this.parsedData=e},e.prototype.urlToUniqueId=function(e){return btoa(e)},e.prototype.getSegmentInfo=function(){return this.segmentInfo},e.prototype.getUid=function(){return this.segmentInfo?this.segmentInfo.uid:null},e.prototype.isIndependentlyDecodable=function(){return this.isSegmentIndependentlyDecodable},e.prototype.setSegmentInfo=function(e){this.segmentInfo=e,this.segmentInfo.uid=this.urlToUniqueId(this.segmentInfo.url)},e.prototype.getMediaInfo=function(){var e={};return this.segmentInfo&&this.segmentInfo.bitrate&&(e.bitrate=this.segmentInfo.bitrate),r.MimeTypeHelper.isAudio(this.mimeType)?this.segmentInfo&&this.segmentInfo.sampleRate&&(e.sampleRate=this.segmentInfo.sampleRate):r.MimeTypeHelper.isVideo(this.mimeType)&&(this.segmentInfo&&this.segmentInfo.width&&(e.width=this.segmentInfo.width),this.segmentInfo&&this.segmentInfo.height&&(e.height=this.segmentInfo.height),this.segmentInfo&&this.segmentInfo.frameRate&&(e.frameRate=this.segmentInfo.frameRate)),e},e.prototype.isDirty=function(){return this._isDirty},e.prototype.setDirty=function(e){this._isDirty=e},e.prototype.setInbandEvents=function(e){this.inbandEvents=e},e.prototype.getInbandEvents=function(){return this.inbandEvents},e.prototype.setLastSegment=function(e){this.lastSegment=e},e.prototype.isLastSegment=function(){return this.lastSegment},e.prototype.wasLoadedFrom=function(e){return this.getUrl().includes(e)},e.prototype.getParserMetadata=function(){return this.parserMetadata},e.prototype.setParserMetadata=function(e){this.parserMetadata=e},e.prototype.setBufferBlockId=function(e){this.bufferBlockId=e},e.prototype.getBufferBlockId=function(){return this.bufferBlockId},e}();t.Segment=o;var a;!function(e){e[e.NONE=0]="NONE",e[e.INIT=1]="INIT",e[e.SELF_INIT=2]="SELF_INIT"}(a=t.SegmentInitType||(t.SegmentInitType={}))},110:function(e,t,i){"use strict";function n(e,t,i){return!e&&!t||!(e&&!t||!e&&t)&&(i||Object.keys(e)).every(function(i){return e[i]===t[i]})}Object.defineProperty(t,"__esModule",{value:!0}),t.compareValues=n},129:function(e,t,i){"use strict";function n(e,t){var i=t.findIndex(function(t){return t===e});i>-1&&t.splice(i,1)}Object.defineProperty(t,"__esModule",{value:!0});var r,o=i(4),a=i(6),s=i(20),d=i(18),u=i(5),c=i(19),l=i(1),h=i(151),p=i(34),f=i(101),g=i(24),m=i(23),y=i(17),S=i(9),v=i(7),T=i(22),P=i(11),I=i(2),M=i(0),b=i(67),E=i(74),R=i(180),C=i(450),A=i(66),L=i(40),_=i(182),x=i(440),k=i(441),D=i(107),B=i(108);!function(e){e.Init="init",e.Data="data",e.Any="any"}(r=t.SegmentType||(t.SegmentType={}));var w=9e4,O=function(){function e(e,t,i,n,o,a,s){var d=this;this.context=e,this.onDataAvailableCallback=t,this.mimeType=i,this.codec=n,this.manifestLoader=a,this.HLSModule=I.ModuleManager.get(M.ModuleName.HLS,!1),this.downloadRepresentationId=null,this.loadedAdaptationSetIds={},this.loadingSegmentInfos=[],this.isFirstSegment=!0,this.periodSwitch=!1,this.discontinuityNumbers=new T.ObjectMap,this.isBackupStreamSwitchOngoing=!1,this.hasDownloadError=!1,this.invalidateOngoingSegmentInfoRequest=!1,this.disableDownloadCancelingForNextSegment=!1,this.currentLangObj={id:null,lang:null,label:"off"},this.isKeyframeRecoveryOngoing=!1,this.onSegmentInfoError=function(e){var t="Error obtaining "+d.mimeType+" segment info";Boolean(d.lastSegmentInfoError)&&d.lastSegmentInfoError.code===e.code?d.logger.insane(t,e):d.logger.debug(t,e),d.lastSegmentInfoError=e},this.handleCancelLoadingError=function(e){d.logger.debug("Error in cancelLoading of segmentLoaderPool ",e)},this.getNext=function(){d.currentAdaptationSetId&&!d.isBackupStreamSwitchOngoing&&(!d.segmentManager.canLoad()||d.hasActiveTransmuxingJobs()||d.pendingSegmentInfoRequest||(d.hasValidSeekTarget?(d.hasJustSwitched=!1,d.hasValidSeekTarget=!1,d.getNextSegmentInfoOfType(r.Init)):d.periodSwitch?(d.getNextSegmentInfoOfType(r.Init),d.periodSwitch=!1):d.getNextSegmentInfoOfType(r.Any)))},this.isSegmentOfMainStream=function(e){return!d.hls.isAvMuxedTogether||d.hls.isAvMuxedTogether&&v.MimeTypeHelper.isVideo(e.getMimeType())},this.onSegmentLoaded=function(e){var t,i=e.getData();if(i&&i.byteLength<1)return d.logger.debug("Warning: Loaded segment has size 0 bytes, skipping further processing! May cause gap!",e.getUrl()),void(d.hlsTimelineTracker&&d.hlsTimelineTracker.reset());if(d.isFirstSegment&&d.isTransmuxerRequired()){var n=I.ModuleManager.get(M.ModuleName.ContainerMP4,!1);if(n&&d.segmentParser instanceof n.MP4Parser&&d.segmentParser.isValidSegment(e)){d.logger.debug("Detected fMP4/CMAF container format for "+d.mimeType+", skipping transmuxing"),d.hls.isTransmuxingRequired=!1,d.hls.transmuxer.dispose();var r=d.context.serviceManager.get(u.ServiceName.SubtitleService);r&&r.setTransmuxer(void 0)}}if(d.isTransmuxerRequired()){if(isNaN(e.getSegmentInfo().presentationTimeOffset)&&(d.mpdHandler.setTimestampOffset(0),e.getSegmentInfo().presentationTimeOffset=0),!I.ModuleManager.has(M.ModuleName.ContainerTS))return void d.context.eventHandler.fireError(new b.PlayerModuleMissingError(M.ModuleName.ContainerTS));var o=null===(t=e.getSegmentInfo())||void 0===t?void 0:t.discontinuitySequenceNumber;void 0!==d.lastDiscoNumber&&o!==d.lastDiscoNumber&&d.resetTransmuxer(),d.lastDiscoNumber=o,d.transmux(e)}else{if(d.hls.isMpdTranslatedFromM3u8&&!e.isInit()&&!e.isSelfInit()&&e.getSegmentInfo().init){var a=e.getSegmentInfo(),s=d.segmentManager.getCachedSegment(a.init);s&&e.setData(S.ArrayHelper.concatBuffers(s.getData(),e.getData()))}d.onSegmentAvailable(e,null)}},this.onShouldDownloadBeCancelled=function(e,t){var i=d.adaptationHandler.shouldDownloadBeCancelled(e,t);return d.hls.isMpdTranslatedFromM3u8&&d.hls.possiblyDependentSegments&&i?(d.logger.debug("Download should be cancelled, but this is disabled for segments not starting with key frames"),!1):i},this.currentPeriodId=s,this.sourceStore=e.serviceManager.get(u.ServiceName.SourceStoreService,e.sourceContext.sourceIdentifier),this.isSubtitleSegmentController=i.indexOf("text")>-1||i.indexOf("application")>-1,this.manifestUpdateScheduler=e.serviceManager.get(u.ServiceName.ManifestUpdateSchedulingService),this.manifestService=this.context.serviceManager.get(u.ServiceName.ManifestService),this.playerStateService=this.context.serviceManager.get(u.ServiceName.PlayerStateService),this.segmentUnavailabilityHandler=new C.SegmentUnavailabilityHandler(this.context),this.subtitleService=this.context.serviceManager.get(u.ServiceName.SubtitleService),this.hls={isMpdTranslatedFromM3u8:this.manifestService.isHlsManifest(),isFragmentedSubtitleController:this.manifestService.isHlsManifest()&&this.isSubtitleSegmentController,isTransmuxingRequired:o&&!this.isSubtitleSegmentController,transmuxer:void 0,possiblyDependentSegments:this.manifestService.isHlsManifest()&&!this.manifestService.getManifest()._hasIndependentSegments,isAvMuxedTogether:!!n&&n.indexOf(",")>-1,discardNextSegment:!1,isLoading:!1,isSeekDuringLoad:!1,lastSeekTarget:-1,muxedAudioTrackIndex:0,hasInitializedExpectedPlaybackTimes:!1},this.areCodecsFinal=!this.hls.isMpdTranslatedFromM3u8,Boolean(n)||this.logger.debug("No codecs defined for mimeType "+i+". Will try try to probe from media segments"),e.settings.FORCE_KEY_FRAMES_ON_HLS_SEGMENT_START&&(this.hls.possiblyDependentSegments=!1),this.initSegmentsTracker=new H,this.init()}return Object.defineProperty(e.prototype,"logger",{get:function(){return this.context.logger},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"settings",{get:function(){return this.context.settings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return this.context.config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventHandler",{get:function(){return this.context.eventHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentManager",{get:function(){return this.context.serviceManager.get(u.ServiceName.SegmentService).add({mimeType:this.mimeType,codec:this.codec,shouldDownloadBeCancelledCallback:this.onShouldDownloadBeCancelled},this.segmentParser,this.currentLangObj)},enumerable:!0,configurable:!0}),e.prototype.getUserFeedbackForAdaptation=function(e){var t=function(){},i=null;if(v.MimeTypeHelper.isAudio(this.mimeType)&&(i=l.PlayerEvent.AudioAdaptation,"function"==typeof this.config.adaptation.onAudioAdaptation&&(t=this.config.adaptation.onAudioAdaptation)),v.MimeTypeHelper.isVideo(this.mimeType)&&(i=l.PlayerEvent.VideoAdaptation,"function"==typeof this.config.adaptation.onVideoAdaptation&&(t=this.config.adaptation.onVideoAdaptation)),!i)return null;var n=t({suggested:e.representationId}),r=this.manifestService.getRepresentation(this.currentAdaptationSetId,n);return r?(this.logger.debug("user has overridden adaptation suggestion! suggested: "+e.representationId+", user: "+n),this.eventHandler.dispatchEvent(i,{representationID:r._internalId.representationId}),r._internalId):(this.eventHandler.dispatchEvent(i,{representationID:e.representationId}),null)},e.prototype.selectRepresentation=function(e,t){var i,n;if(this.context.adRestorationOptimizationService.hasPrefetchedSegment(this.mimeType,this.lastSegmentInfo))return this.context.adRestorationOptimizationService.getRepresentationForPrefetchedSegment(this.mimeType);var r=f.getAdaptationState(this.sourceStore.getState()),o=f.getPreferredBitrate(r,this.mimeType);if(this.periodSwitch||!this.hasJustSwitched||void 0===this.currentRepresentationId){var a={hlsDependentSegments:this.hls.possiblyDependentSegments,segmentDuration:this.mpdHandler.getSegmentDuration(),segmentNumber:t};n=this.adaptationHandler.getRepresentationID(a)}else n=this.currentRepresentationId;var s=(null===(i=e)||void 0===i?void 0:i.periodId)===this.getCurrentPeriodId();s&&!o&&(n=e);var d;return this.lastChosenRepresentation?(d=this.lastChosenRepresentation,this.lastChosenRepresentation=null):(d=this.getUserFeedbackForAdaptation(n),d?this.disableDownloadCancelingForNextSegment=!0:d=n),!d&&this.getCurrentAdaptationSet().Representation.length>0&&(d=this.getCurrentAdaptationSet().Representation[0]._internalId),n=d},e.prototype.switchRepresentation=function(e){var t=this.currentRepresentationId?this.currentRepresentationId.representationId:null;this.logger.debug("switching representation from "+t+" to "+e.representationId+" ("+this.mimeType+")"),this.mpdHandler.setRepresentationId(e),this.currentRepresentationId=e},e.prototype.isInitSegmentNeeded=function(e,t){return e===r.Init||t||this.hls.isMpdTranslatedFromM3u8},e.prototype.invalidateOngoingRequests=function(){this.invalidateOngoingSegmentInfoRequest=!0},e.prototype.getSegmentInfo=function(e,t,i){var n=this;void 0===i&&(i=this.currentPeriodId);var r=this.lastSegmentInfo&&this.lastSegmentInfo.segmentNumber+1||0,o=this.selectRepresentation(t,r),a=!o.equals(this.currentRepresentationId);return a&&this.sourceStore.dispatch(A.setRepresentationIdAction(o)),this.invalidateOngoingSegmentInfoRequest=!1,this.pendingSegmentInfoRequest=this.loadRepresentationInfo(o).then(function(){return n.mpdHandler.setAdaptationSetId(n.currentAdaptationSetId,o),a&&(n.switchRepresentation(o),n.hasJustSwitched=!0),n.findNextSegmentInfo(e,a,o)}).then(function(e){if(n.invalidateOngoingSegmentInfoRequest)throw"ongoing segment info request was invalidated";return n.addSegmentInfos(e,r,i),n.lastSegmentInfo=e,e})["catch"](function(t){n.pendingSegmentInfoRequest=null;var r=n.manifestService.getRepresentationById(o);if(r&&n.context.store.dispatch(L.setRepresentationFailedDownloadAction(r._internalId)),t===h.M3u8Error.COULD_NOT_LOAD){n.logger.debug("HLS playlist loading failed for representation "+o.representationId+" ("+t+")");var a=n.manifestService.getAdaptationSet(n.currentAdaptationSetId),s=a.Representation.find(function(e){return!e.hasFailedToLoad});if(s)return n.getSegmentInfo(e,s._internalId,i)}throw t}),this.pendingSegmentInfoRequest},e.prototype.getInitSegmentInfo=function(){return this.currentRepresentationId&&this.currentRepresentationId.periodId===this.getCurrentPeriodId()?this.getSegmentInfo(r.Init,this.currentRepresentationId):this.getSegmentInfo(r.Init)},e.prototype.getDataSegmentInfo=function(){return this.currentRepresentationId&&this.currentRepresentationId.periodId===this.getCurrentPeriodId()?this.getSegmentInfo(r.Data,this.currentRepresentationId):this.getSegmentInfo(r.Data)},e.prototype.findNextSegmentInfo=function(e,t,i){var n=this.mpdHandler.getInitSegmentInfo(i),o=this.isTransmuxerRequired(),a=!o&&!this.manifestService.isSmoothManifest()&&!this.hls.isFragmentedSubtitleController;return n&&(a=this.isInitSegmentNeeded(e,t)||!this.initSegmentsTracker.isAlreadyDownloaded(i),a&&this.hls.isMpdTranslatedFromM3u8&&(a=!this.segmentManager.hasCachedSegment(n))),a=a&&e!==r.Data,a?Promise.resolve(n):this.mpdHandler.getNextSegmentInfo()},e.prototype.addSegmentInfos=function(e,t,i){if(e){var n=this.manifestService.getRepresentationById(this.currentRepresentationId);if(n)if(e.representationId=this.currentRepresentationId.representationId,e.internalRepresentationId=this.currentRepresentationId,e.mimeType=this.mimeType,e.bitrate=n._bandwidth,e.periodId=i,v.MimeTypeHelper.isAudio(this.mimeType))e.sampleRate=n._audioSamplingRate,e.width=void 0,e.height=void 0;else if(v.MimeTypeHelper.isVideo(this.mimeType)&&(e.width=n._width,e.height=n._height,e.frameRate=n._frameRate,!e.dateTime&&this.settings.AKAMAI_DATETIME_PARSING&&this.HLSModule)){var r=this.HLSModule.PlaylistUtils.getProgramDateTimeFromSegmentUrl(e.url,e.duration);r&&(e.dateTime=r)}var o=this.manifestService.getLowestBandwidthOfAdaptationSet(this.currentAdaptationSetId),a=e.bitrate;isFinite(a)&&a===o&&(e.preventDownloadCanceling=!0);var s=this.manifestService.getAvailableBaseURLsForRepresentation(this.currentRepresentationId);e.availableBaseURLs=s,e.firstUsedBaseURLIndex=0,this.lastSegmentInfo&&this.lastSegmentInfo.lastUsedBaseURLIndex&&(e.firstUsedBaseURLIndex=this.lastSegmentInfo.lastUsedBaseURLIndex),e.lastUsedBaseURLIndex=e.firstUsedBaseURLIndex,e.duration||e.isInitSegment||(e.duration=this.mpdHandler.getSegmentDuration()),e.hasOwnProperty("segmentNumber")&&!isNaN(e.segmentNumber)||(e.segmentNumber=t),this.hls.isMpdTranslatedFromM3u8?(e.baseURL="",e.mediaURL||(e.mediaURL=e.url)):(e.baseURL=s[e.firstUsedBaseURLIndex],e.mediaURL=e.url,delete e.url),e.url=P.URLHelper.concatBaseUrlWithPartial(e.baseURL,e.mediaURL),e.discardData=this.hls.discardNextSegment,this.hls.discardNextSegment=!1,this.disableDownloadCancelingForNextSegment&&(e.preventDownloadCanceling=!0,this.disableDownloadCancelingForNextSegment=!1),e.isTransmuxingRequired=this.isTransmuxerRequired()}},e.prototype.isRepresentationLoadingNeeded=function(e,t){var i=this.mpdHandler.isSegmentInfoLoaded(e),n=t&&!e.equals(this.currentRepresentationId);return!i||n},e.prototype.loadRepresentationInfo=function(e){var t=this;return this.manifestUpdateScheduler.waitForRepUpdate(e).then(function(){return t.mpdHandler.updateRepresentation(e)})},e.prototype.isTransmuxing=function(){return this.isTransmuxerRequired()&&this.hls.transmuxer&&this.hls.transmuxer.isTransmuxing()},e.prototype.hasActiveTransmuxingJobs=function(){return this.isTransmuxerRequired()&&this.hls.transmuxer&&this.hls.transmuxer.hasActiveJobs()},e.prototype.cancelLoading=function(){this.invalidateOngoingSegmentInfoRequest=!0,this.segmentManager.cancel()["catch"](this.handleCancelLoadingError)},e.prototype.seekTo=function(e){var t=this;null!==e&&this.currentAdaptationSetId&&(this.cancelLoading(),this.loadingSegmentInfos=[],this.hasDownloadError=!1,this.isLastSegment=!1,this.hls.isMpdTranslatedFromM3u8&&this.hls.isLoading&&(this.hls.isSeekDuringLoad=!0,this.hls.lastSeekTarget=e,this.hls.isLoading=!1,this.hls.transmuxer&&this.hls.transmuxer.discardCurrentJobs(),this.logger.debug("Seek during loading")),this.hlsTimelineTracker&&this.hlsTimelineTracker.reset(),this.isTransmuxerRequired()&&this.hls.transmuxer&&this.hls.transmuxer.resetCaptionParser(),e>=0&&(this.hasValidSeekTarget=!0,this.mpdHandler.seekTo(e))),this.pendingSegmentInfoRequest&&"number"==typeof e&&this.pendingSegmentInfoRequest["catch"](function(e){return t.logger.debug("Error during getting a segment info",e)}).then(function(){return t.seekTo(e)})},e.prototype.getNextSegmentInfoOfType=function(e){var t=this;this.getSegmentInfo(e,null,this.currentPeriodId).then(function(e){return t.loadFromSegmentInfo(e)})["catch"](this.onSegmentInfoError)},e.prototype.hasNextVod=function(){var e;if(this.hasDownloadError)return this.currentRepresentationId!==this.adaptationHandler.getRepresentationID()&&(this.mpdHandler.rewindOneSegment(),this.hasDownloadError=!1,this.hasJustSwitched=!1,!0);var t=this.manifestService.findPeriod(this.currentPeriodId),i=this.manifestService.getMediaPresentationDuration();if(t&&t.hasOwnProperty("_duration"))e=this.manifestService.getPeriodDuration(this.currentPeriodId);else{if(0===i)return!1;e=i}return this.mpdHandler.hasNext(e)},e.prototype.hasNextLive=function(){return this.manifestService.isAvailabilityEndTimeExceeded()?(this.logger.log("Stream ("+this.mimeType+") availability end time reached, stop downloading any further segments."),this.isLastSegment=!0,!1):(this.manifestService.isLastPeriod(this.currentPeriodId)&&this.mpdHandler.resolvePendingSegmentInfoRequests(),this.hasDownloadError&&this.currentRepresentationId!==this.adaptationHandler.getRepresentationID()&&(this.mpdHandler.rewindOneSegment(),this.hasDownloadError=!1,this.hasJustSwitched=!1),this.mpdHandler.hasNext(this.manifestService.getPeriodDuration(this.currentPeriodId)))},e.prototype.hasNext=function(){var e=this.isLastSegment&&this.manifestService.isLastPeriod(this.currentPeriodId);return!(e||!this.currentAdaptationSetId||!this.mpdHandler)&&(this.manifestService.isLive()?this.hasNextLive():this.hasNextVod())},e.prototype.handleParsedCodecs=function(e){this.isFirstSegment&&e&&(this.codec=e,this.codec.indexOf(",")>-1&&(this.hls.isAvMuxedTogether=!0),this.logger.debug("SegmentController["+this.mimeType+"]: parsed codecs from media "+this.codec),this.areCodecsFinal=!0)},e.prototype.handleClosedCaptionMetadata=function(e,t){this.subtitleService&&(this.isTransmuxerRequired()?t&&t.closedCaptions&&this.subtitleService.handleClosedCaptions(t.closedCaptions,e.getPeriodId()):v.MimeTypeHelper.isVideo(e.getMimeType())&&(this.getCodecs()||"").toLowerCase().includes("avc")&&this.subtitleService.extractCaptionsFromSegment(e,this.mpdHandler.getTimestampOffset()))},e.codecsToString=function(e){return e.video&&e.audio?e.video+","+e.audio:e.video?e.video:e.audio?e.audio:null},e.prototype.cacheOrCallOnSegmentAvailable=function(e,t){var i,n=this,r=this.hasHlsTimelineGap(t.find(this.isSegmentOfMainStream));r.hasGap?r.couldHandle?i=!1:r.couldHandle||(i=!0,this.hlsTimelineTracker.reset()):i=!0,i?t.forEach(function(t){var i=e.metadata[e.transmuxedSegments.indexOf(t)],r=n.onSegmentAvailable(t,i);r||n.segmentManager.cacheSegment(e.originalSegment)}):r.hasGap&&r.gapSizeSec>0&&this.segmentManager.cacheSegment(e.originalSegment)},e.prototype.onTransmuxed=function(t){var i=this,n=t.transmuxedSegments.every(function(e){return null!==e.getCodec()});if(!n){var r=t.originalSegment.getUrl();return void this.logger.debug("Discarding muxing because codecs were not available in the segment: "+r)}if(!this.areCodecsFinal){var o={};t.transmuxedSegments.forEach(function(e){var t=v.MimeTypeHelper.extractContentType(e.getMimeType());o[t]=e.getCodec()}),this.handleParsedCodecs(e.codecsToString(o))}var a=t.transmuxedSegments.find(function(e){return"video/mp4"===e.getMimeType()}),s=t.transmuxedSegments.filter(function(e){return"audio/mp4"===e.getMimeType()}),d=s[this.hls.muxedAudioTrackIndex]||s[0],u=[a,d].filter(function(e){return Boolean(e)});u.forEach(function(e){return i.maybeAdjustTimestampOffsetAtDiscontinuityChange(e)}),this.cacheOrCallOnSegmentAvailable(t,u),this.hls.isLoading=!1,this.logger.debug("Transmuxing done",t.originalSegment.getUrl())},e.prototype.hasHlsTimelineGap=function(e){var t={hasGap:!1};if(e&&this.hls.isMpdTranslatedFromM3u8&&!this.isSubtitleSegmentController&&!this.isFirstSegment&&this.isSegmentOfMainStream(e)&&this.hlsTimelineTracker&&!this.playerStateService.seekingOrTimeshifting){var i=k.SegmentInfoProvider.findHlsRepresentationForSegment(e,this.manifestService.getAdaptationSet(this.currentAdaptationSetId));if(i&&(t=this.hlsTimelineTracker.checkForTimelineGap(e,i.representation,i.index),t.hasGap)){this.logger.debug("Encountered timeline gap ("+t.gapSizeSec+"), just loaded "+e.getUrl());var n=this.mpdHandler instanceof D.SegmentListMPDHandler&&this.mpdHandler.getCurrentSegmentList().entries&&this.mpdHandler.getCurrentSegmentList().entries[t.correctedIndex];n&&n.hasDownloadFailed?t.couldHandle=!1:this.mpdHandler.setIndex(t.correctedIndex)}}return t},e.prototype.hasPendingSegments=function(e){var t=!1,i=!1;return e?(t=this.isTransmuxerRequired()&&this.hls.transmuxer&&this.hls.transmuxer.isTransmuxingSegmentsForPeriod(e),i=this.segmentManager.isLoading(e)):(t=this.isTransmuxing(),i=this.segmentManager.isLoading()),i||t||Boolean(this.pendingSegmentInfoRequest)},e.prototype.transmux=function(e){var t=this;if(!this.hls.transmuxer.isInitialBaseMediaDecodeTimeSet()){this.initializeHlsExpectedPlaybackTimes(e);var i=e.getSegmentInfo(),n=Math.round(i.startTime*w);this.logger.debug("Setting initial BaseMediaDecodeTime at transmuxer to "+n/w+(" ("+n+")")),this.hls.transmuxer.setBaseMediaDecodeTime(n)}this.hls.transmuxer.transmuxSegment(e).then(function(e){return t.onTransmuxed(e)})["catch"](function(i){t.logger.debug("Transmuxing failed ",e.getUrl(),i.reason)})},e.prototype.parseCodecs=function(t){var i,n=t.getMimeType().split("/"),r=n[0],o=n[1];if(!t.getCodec()&&t.getParsedData()&&"mp4"===o){var a=I.ModuleManager.get(M.ModuleName.ContainerMP4).MP4Parser;"video"===r?t.setCodec(a.getVideoCodec(t.getParsedData())):"audio"===r&&t.setCodec(a.getAudioCodec(t.getParsedData()))}var s=(i={},i[r]=t.getCodec(),i);this.handleParsedCodecs(e.codecsToString(s))},e.prototype.onSegmentAvailable=function(e,t){var i=this.mpdHandler.preProcessAvailableSegment(e,t,{codec:this.codec,periodId:this.currentPeriodId});i&&i.additionalSegment&&this.onSegmentAvailable(i.additionalSegment,null);var n=!0,r=e.getSegmentInfo(),o="onSegmentAvailable "+e.getMimeType();if(this.segmentUnavailabilityHandler.downloadSuccess(e.isInit()),e.isInit()&&(o+=" init",this.initSegmentsTracker.markAsDownloaded(e.getRepresentationId())),this.logger.debug(o+" segment ["+e.getUrl()+"]"),this.segmentParser&&!this.isTransmuxerRequired()){var a=isNaN(this.mpdHandler.getTimestampOffset())||0===this.mpdHandler.getTimestampOffset();if(this.manifestService.isHlsManifest()&&!e.isInit()&&a&&this.initializeHlsExpectedPlaybackTimes(e),e.isInit()&&!this.manifestService.isSmoothManifest()||(this.maybeAdjustTimestampOffsetAtDiscontinuityChange(e),this.segmentParser.parseSegment(e)),this.manifestService.isHlsManifest()&&!this.isCorrectSegment(e))return}if(this.hls.isFragmentedSubtitleController&&this.maybeAdjustTimestampOffsetAtDiscontinuityChange(e),this.manifestService.isHlsManifest()&&!e.isInit()&&this.manifestService.initExpectedPlaybackTimesFromReferenceSegment(e),this.manifestService.isHlsManifest()&&this.manifestService.markSegmentAsDownloaded(this.currentAdaptationSetId,e),this.areCodecsFinal||this.parseCodecs(e),!(this.hls.isSeekDuringLoad&&(this.hls.isSeekDuringLoad=!1,e.getPlaybackTime()+e.getDuration()<this.hls.lastSeekTarget))){if(this.isTransmuxerRequired()&&this.hls.possiblyDependentSegments&&this.hasJustSwitched&&!this.isFirstSegment&&n&&this.isSegmentOfMainStream(e)&&!this.isKeyframeRecoveryOngoing&&(this.logger.debug("Just switched playlists, isIndependentlyDecodable? "+e.isIndependentlyDecodable()+" ("+e.getMimeType()+", "+e.getUrl()+")"),!e.isIndependentlyDecodable()&&this.mpdHandler.getIndex()>0&&(this.logger.debug("Started keyframe recovery"),this.mpdHandler.setIndex(this.mpdHandler.getIndex()-2),n=!1,this.hls.discardNextSegment=!0,this.isKeyframeRecoveryOngoing=!0)),!n)return!1;this.context.serviceManager.get(u.ServiceName.TimedMetadataService).onSegmentAvailable({segment:e,extractedMetadata:t,isSegmentOfMainStream:this.isSegmentOfMainStream(e),presentationTimeOffset:this.mpdHandler.getTimestampOffset()}),this.handleClosedCaptionMetadata(e,t),e.isInit()?this.hasJustSwitched=!0:(this.hasJustSwitched&&this.isSegmentOfMainStream(e)&&(this.hasJustSwitched=!1),this.logger.debug("SegmentController["+this.mimeType+"]: playbackTimeForSegment="+e.getPlaybackTime()+" "+e.getUrl())),e.getMimeType().indexOf("mp4")>-1&&(this.isLastSegment=e.isLastSegment());var s=r&&!r.internalRepresentationId.equals(this.downloadRepresentationId);return this.isSegmentOfMainStream(e)&&s&&(this.triggerOnDownloadQualityChanged(this.mimeType,this.downloadRepresentationId,r.internalRepresentationId),this.updateDownloadedRepresentation(e),this.downloadRepresentationId=r.internalRepresentationId),this.isSegmentOfMainStream(e)&&(this.hlsTimelineTracker&&!e.isInit()&&this.hlsTimelineTracker.trackPlaybackTime(e),this.isKeyframeRecoveryOngoing&&(this.isKeyframeRecoveryOngoing=!1),this.isFirstSegment&&(this.isFirstSegment=!1)),this.onDataAvailableCallback(e),n}},e.prototype.calculateEncodedPlaybackTime=function(e){var t=Boolean(this.segmentParser&&this.segmentParser.parsePlaybackTime),i=!0,n=t?this.segmentParser.parsePlaybackTime(e):e.getBaseMediaDecodeTime()/e.getTimescale();return isNaN(n)&&(n=e.getPlaybackTime(),i=!1),{encodedPlaybackTime:n,shouldUpdatePlaybackTime:i}},e.prototype.calculatePresentationTimeOffset=function(e,t,i){var n=null;null==e.getSegmentInfo().startTime&&(this.logger.debug("["+e.getMimeType()+"] no startTime when trying to calculate the PTO for "+i),this.mpdHandler.extrapolateStartTimesFromDiscontinuityStarts(e)),n=t-e.getSegmentInfo().startTime;var r=I.ModuleManager.get(M.ModuleName.HLS);return this.sourceStore.dispatch(r.actions.setPresentationTimeOffset(String(i),n)),this.logger.debug("["+e.getMimeType()+"] set PTO for discontinuity "+i+" to "+n),n},e.prototype.adjustTimestampOffset=function(e,t){var i=I.ModuleManager.get(M.ModuleName.HLS),n=i.selectors,r=n.getHlsState,o=n.getPresentationTimeOffset,a=r(this.sourceStore.getState()),s=o(a,String(t)),d=this.calculateEncodedPlaybackTime(e),u=d.encodedPlaybackTime,c=d.shouldUpdatePlaybackTime;null==s&&(s=this.calculatePresentationTimeOffset(e,u,t)),this.logger.debug("["+this.getMimeType()+"], discontinuity: "+t+" adjusting PTO to "+s+" on segment "+e.getUrl()),this.mpdHandler.setTimestampOffset(s),e.getSegmentInfo().presentationTimeOffset=s,e.setPresentationTimeOffset(s),c&&e.setPlaybackTime(u-s)},e.prototype.maybeAdjustTimestampOffsetAtDiscontinuityChange=function(e){var t=e.getSegmentInfo().discontinuitySequenceNumber;if(null!=t&&!e.isInit()){var i=this.discontinuityNumbers.get(e.getMimeType())!==t,n=isNaN(this.mpdHandler.getTimestampOffset());(i||n)&&this.adjustTimestampOffset(e,t),this.discontinuityNumbers.set(e.getMimeType(),t)}},e.prototype.isCorrectSegment=function(e){var t=this.hasHlsTimelineGap(e);return!t.hasGap||(t.couldHandle?(this.isSegmentInTheFuture(t)&&this.segmentManager.cacheSegment(e),!1):(this.hlsTimelineTracker.reset(),!0))},e.prototype.isSegmentInTheFuture=function(e){return e.gapSizeSec>0},e.prototype.initializeHlsExpectedPlaybackTimes=function(e){if(!this.hls.hasInitializedExpectedPlaybackTimes){this.hls.hasInitializedExpectedPlaybackTimes=!0;var t=e.getRepresentationId().representationId;this.manifestService.initializeExpectedPlaybackTimesFromStart(t);var i=I.ModuleManager.get(M.ModuleName.HLS).selectors,n=i.getHlsState,r=i.getPlaylistSegments,o=n(this.sourceStore.getState()),a=r(o,t),s=this.mpdHandler.getCurrentSegmentList().entries,d=e.getSegmentInfo().discontinuitySequenceNumber,u=a.filter(function(t){var i=t.discontinuitySequenceNumber===d;return i&&R.matchesByteRange(t,e.getSegmentInfo())});u.forEach(function(e){var t=s.find(function(t){return t.url.includes(e.uri)});t&&(t.startTime=e.expectedPlaybackTime)})}},e.prototype.updateDownloadedRepresentation=function(e){var t=e.getSegmentInfo(),i={id:t.representationId,bitrate:t.bitrate,width:t.width,height:t.height};this.context.store.dispatch(g.addMetricsValue(this.mimeType,y.MetricType.DownloadedRepresentation,i))},e.prototype.triggerOnDownloadQualityChanged=function(e,t,i){var n;if(v.MimeTypeHelper.isVideo(e))n=l.PlayerEvent.VideoDownloadQualityChanged;else{if(!v.MimeTypeHelper.isAudio(e))return;n=l.PlayerEvent.AudioDownloadQualityChanged}var r=E.representationToQuality(this.manifestService.getRepresentationById(t),e),o=E.representationToQuality(this.manifestService.getRepresentationById(i),e);this.eventHandler.dispatchEvent(n,{targetQuality:o,targetQualityId:o.id,sourceQuality:r,sourceQualityId:r?r.id:null})},e.prototype.loadFromSegmentInfo=function(e){return this.pendingSegmentInfoRequest=null,e?(this.loadingSegmentInfos.push(e),this.lastSegmentInfoError=null,this.logger.debug("Loading "+JSON.stringify(e)),this.loadSegment(e)):Promise.resolve()},e.prototype.loadSegment=function(e){var t=this;return this.segmentManager.hasCachedSegment(e)||(this.hls.isLoading=this.isTransmuxerRequired()),this.segmentManager.getSegment(e).then(function(e){return t.extractSegmentFromStream(e)})["catch"](function(i){return t.handleSegmentLoadingError(i,e)})},e.prototype.extractSegmentFromStream=function(e){var t=this;e.transform(function(e){n(e.getSegmentInfo(),t.loadingSegmentInfos),t.onSegmentLoaded(e)},function(){},function(e){return t.logger.debug("Error loading segment",e),e.message})},e.prototype.handleSegmentLoadingError=function(e,t){if(e.reason===B.SegmentLoadingErrorReason.CANCEL)this.onDownloadCancelled(t);else if(e.reason===B.SegmentLoadingErrorReason.ERROR_LOADING){var i=Boolean(e.info)?e.info.response.status:0;this.handleDownloadError(i,t)}else e.reason===B.SegmentLoadingErrorReason.ERROR_DECRYPTING?(this.logger.debug("Could not decrypt segment",t.url),this.eventHandler.dispatchEvent(l.PlayerEvent.Warning,new s.PlayerWarning(d.WarningCode.DRM_COULD_NOT_DECRYPT_SEGMENT))):this.logger.debug("Unexpected ERROR occurred when loading segment!",t.url)},e.prototype.createPlayerError=function(e,t,i){if(0===t)return e&&e===p.RequestError.TimedOut?new a.PlayerError(o.ErrorCode.NETWORK_SEGMENT_DOWNLOAD_TIMEOUT):new a.PlayerError(o.ErrorCode.NETWORK_ERROR);this.logger.debug(e);var n={message:e};return i&&(n.segment={url:i,mimeType:this.mimeType,codec:this.codec}),new a.PlayerError(o.ErrorCode.NETWORK_ERROR,n)},e.prototype.throwDownloadError=function(e,t,i){void 0===i&&(i=null),this.manifestService.isLive()||this.eventHandler.dispatchEvent(l.PlayerEvent.Warning,new s.PlayerWarning(d.WarningCode.PLAYBACK_DECODE_RETRIES_EXCEEDED));var n=this.createPlayerError(e,t,i);n&&this.context.eventHandler.fireError(n);
},e.prototype.switchToHlsBackupStream=function(e){var t=this;return this.HLSModule&&this.manifestLoader instanceof this.HLSModule.M3u8Loader&&this.manifestLoader.hasBackupStreams(e)?this.manifestLoader.switchToBackupStream(e).then(function(){return!0})["catch"](function(e){return t.logger.debug("Switching to HLS backup stream failed",e),Promise.resolve(!1)}):Promise.resolve(!1)},e.prototype.getFailedSegmentIndex=function(){var e=this.settings.CHUNKED_CMAF_STREAMING?1:this.loadingSegmentInfos.length;return this.mpdHandler.getIndex()-e},e.prototype.handleDownloadError=function(e,t){this.segmentUnavailabilityHandler.shouldTryAlternatives(e)?this.tryToFindAValidSegment(t,e):this.hasDownloadError=!0},e.prototype.tryToFindAValidSegment=function(e,t){var i=this;if(!this.currentRepresentationId||!this.currentRepresentationId.equals(e.internalRepresentationId))return void this.logger.debug("Ignoring download error of previous representation.");var n=this.manifestService.getRepresentation(this.currentAdaptationSetId,this.currentRepresentationId.representationId),r=!1;this.isBackupStreamSwitchOngoing=!0;var o=this.switchToHlsBackupStream(n).then(function(e){return r=e})["finally"](function(){return i.isBackupStreamSwitchOngoing=!1});o.then(function(){return i.segmentManager.cancel()}).then(function(){return i.tryToRecoverWithValidSegment(r,e,t)})},e.prototype.tryToRecoverWithValidSegment=function(e,t,i){var n,o=this,a=this.getFailedSegmentIndex();if(this.loadingSegmentInfos=[],e)this.mpdHandler.setIndex(Math.max(0,a));else if(n=this.segmentUnavailabilityHandler.switchBaseURL(t))this.loadFromSegmentInfo(n);else{var s=null;if(this.adaptationHandler.isAuto()){var d=this.manifestService.getAdaptationSet(this.currentAdaptationSetId).Representation;s=this.segmentUnavailabilityHandler.switchQuality(d,this.currentRepresentationId)}s?this.getSegmentInfo(r.Any,s).then(function(e){return o.loadFromSegmentInfo(e)}):this.handleFailedSegmentDownload(t,i)}},e.prototype.handleFailedSegmentDownload=function(e,t){this.hasDownloadError=!0,this.manifestService.isLive()?this.continueWithNextSegment(e):this.throwDownloadError("Segment not available at any quality or location",t,e.url)},e.prototype.continueWithNextSegment=function(e){this.logger.debug("Could not load current segment of any quality from any CDN (all retries failed), skipping it..."),this.segmentUnavailabilityHandler.downloadSuccess(!1),e.hasDownloadFailed=!0,this.getNext()},e.prototype.onDownloadCancelled=function(e){var t=this;this.context&&(this.logger.debug("Download took too long, cancelled it."),this.hasJustSwitched=!1,!e.isInitSegment&&this.mpdHandler&&this.segmentManager.cancel().then(function(){if(t.mpdHandler){var e=t.getFailedSegmentIndex();t.loadingSegmentInfos=[],t.logger.debug("Trying to get the same segment with a lower bitrate."),t.mpdHandler.setIndex(Math.max(0,e))}}))},e.prototype.findAdaptationSetId=function(e,t,i){if(void 0===i&&(i=!1),this.isSubtitleSegmentController&&!e.id)return this.currentLangObj=e,this.segmentManager&&this.cancelLoading(),null;var n=this.manifestService.findAdaptationSet(t,this.mimeType,e,i);return n?(this.currentLangObj=this.manifestService.getLangObjectFromAdaptationSet(n,this.mimeType),n._internalId):null},e.prototype.getCurrentAdaptationSet=function(){return this.manifestService.getAdaptationSet(this.currentAdaptationSetId)},e.prototype.getAdaptationSetForPeriodId=function(e){var t=this.manifestService.getAdaptationSet(this.loadedAdaptationSetIds[e]);return t||this.getCurrentAdaptationSet()},e.prototype.updateMpd=function(){this.logger.debug("Caught a MPD update event");var e=!Boolean(this.manifestService.findPeriod(this.currentPeriodId));this.currentAdaptationSetId=this.findAdaptationSetId(this.currentLangObj,this.currentPeriodId,!1),!e&&this.currentAdaptationSetId&&(this.loadedAdaptationSetIds[this.currentPeriodId]=this.currentAdaptationSetId,this.adaptationHandler.setAdaptationSetId(this.currentAdaptationSetId),this.mpdHandler.setAdaptationSetId(this.currentAdaptationSetId,this.currentRepresentationId,{isPeriodSwitch:!1,isManifestUpdate:!0}));for(var t in this.loadedAdaptationSetIds){var i=this.manifestService.findPeriod(t);i||delete this.loadedAdaptationSetIds[t]}},e.prototype.setCurrentLangObj=function(e){if(this.hls.isAvMuxedTogether&&v.MimeTypeHelper.isVideo(this.mimeType)){var t=this.manifestService.getAdaptationSet(this.currentAdaptationSetId);if(t.ContentComponent){var i=t.ContentComponent.find(function(t){return"audio"===t._contentType&&t._id===e.id});if(i)return this.hls.muxedAudioTrackIndex=t.ContentComponent.filter(function(e){return"audio"===e._contentType}).indexOf(i),void(this.currentLangObj=e)}}e.id!==this.currentLangObj.id&&this.switchAdaptationSetId(e)},e.prototype.switchAdaptationSetId=function(e){var t=this.currentAdaptationSetId;this.currentAdaptationSetId&&this.sourceStore.dispatch(A.removeActiveTrackAction(this.currentAdaptationSetId)),this.currentAdaptationSetId=this.findAdaptationSetId(e,this.currentPeriodId),this.loadedAdaptationSetIds[this.currentPeriodId]=this.currentAdaptationSetId,this.currentAdaptationSetId&&!this.currentAdaptationSetId.equals(t)&&this.switchDependentToNewLanguageObject(e)},e.prototype.switchDependentToNewLanguageObject=function(e){this.currentLangObj=e,this.lastChosenRepresentation=null,this.previousExplicitlySetLangObj=e,this.logger.debug("SegmentController["+this.mimeType+"]: Trying to set language to ID "+this.currentLangObj.id+" (lang: "+this.currentLangObj.lang+") for mpd handler and adaption handler"),this.mpdHandler.setAdaptationSetId(this.currentAdaptationSetId),this.adaptationHandler.setAdaptationSetId(this.currentAdaptationSetId)},e.prototype.getCurrentLangObj=function(){return this.currentLangObj},e.prototype.setRepresentationId=function(e){this.adaptationHandler&&this.currentAdaptationSetId&&this.adaptationHandler.setFixedRepresentation(e)},e.prototype.getRepresentation=function(){if(this.adaptationHandler&&this.currentAdaptationSetId)return this.adaptationHandler.getFixedRepresentation()},e.prototype.stop=function(){this.cancelLoading(),this.segmentManager.clearCache(),this.adaptationHandler.shutdown()},e.prototype.createSegmentParser=function(e){if("mp4"===e&&I.ModuleManager.has(M.ModuleName.ContainerMP4)){var t=I.ModuleManager.get(M.ModuleName.ContainerMP4).MP4Parser;this.segmentParser=new t(this.context)}else if("webm"===e&&I.ModuleManager.has(M.ModuleName.ContainerWebM)){var i=I.ModuleManager.get(M.ModuleName.ContainerWebM).WebMParser;this.segmentParser=new i}else this.logger.debug("Could not create segment parser for container format: "+e)},e.prototype.init=function(){if(this.currentPeriodId=this.currentPeriodId||this.manifestService.getFirstPeriod()._id,this.mpdHandler=x.MPDHandlerFactory.createInstance(this.context,this.mimeType,this.manifestLoader,this.currentPeriodId),this.mpdHandler){if(!this.hls.isFragmentedSubtitleController){var e=this.mimeType.split("/")[1];this.createSegmentParser(e)}this.hasDownloadError=!1,this.currentAdaptationSetId=this.findAdaptationSetId(this.currentLangObj,this.currentPeriodId),this.loadedAdaptationSetIds[this.currentPeriodId]=this.currentAdaptationSetId;var t={minBitrate:0,maxBitrate:1/0,minHeight:0,maxHeight:1/0,minWidth:0,maxWidth:1/0};v.MimeTypeHelper.isVideo(this.mimeType)?(t.minBitrate=this.settings.MIN_SELECTABLE_VIDEO_BITRATE,t.maxBitrate=this.settings.MAX_SELECTABLE_VIDEO_BITRATE,t.minHeight=this.settings.MIN_SELECTABLE_VIDEO_HEIGHT,t.maxHeight=this.settings.MAX_SELECTABLE_VIDEO_HEIGHT,t.minWidth=this.settings.MIN_SELECTABLE_VIDEO_WIDTH,t.maxWidth=this.settings.MAX_SELECTABLE_VIDEO_WIDTH):v.MimeTypeHelper.isAudio(this.mimeType)&&(t.minBitrate=this.settings.MIN_SELECTABLE_AUDIO_BITRATE,t.maxBitrate=this.settings.MAX_SELECTABLE_AUDIO_BITRATE);var i=I.ModuleManager.get(M.ModuleName.ABR).AdaptationHandler;this.adaptationHandler=new i(this.context,this.mimeType,t),this.context.serviceManager.get(u.ServiceName.SegmentService).add({mimeType:this.mimeType,codec:this.codec,shouldDownloadBeCancelledCallback:this.onShouldDownloadBeCancelled},this.segmentParser,this.currentLangObj),this.manifestService.isHlsManifest()&&(this.hlsTimelineTracker=new this.HLSModule.HlsTimelineTracker(this.context,this.settings.GAP_TOLERANCE)),this.mimeType.includes("mp4")&&this.subtitleService&&this.subtitleService.setupCea608CaptionExtractor(this.segmentParser),this.hasJustSwitched=!1,this.currentAdaptationSetId&&(this.adaptationHandler.setAdaptationSetId(this.currentAdaptationSetId),this.mpdHandler.setAdaptationSetId(this.currentAdaptationSetId,null,{isPeriodSwitch:!0}),this.manifestService.isLive()&&!this.settings.ENABLE_SEEK_FOR_LIVE&&this.mpdHandler.timeShift(0,this.currentPeriodId)),this.hasValidSeekTarget=!1,this.isLastSegment=!1}},e.prototype.getSegmentInfos=function(){var e=this.manifestService.getAvailableBaseURLsForRepresentation(this.currentRepresentationId)[0];return this.mpdHandler.getSegmentInfos(e)},e.prototype.isRepresentationAutoSelected=function(){return!this.adaptationHandler||!this.currentAdaptationSetId||this.adaptationHandler.isAuto()},e.prototype.getCurrentPeriodId=function(){return this.currentPeriodId},e.prototype.getTargetLanguageObject=function(e){if(!Boolean(this.previousExplicitlySetLangObj))return this.currentLangObj;var t=this.manifestService.isLanguageAvailable(e,this.mimeType,this.previousExplicitlySetLangObj);return t?this.previousExplicitlySetLangObj:this.currentLangObj},e.prototype.switchPeriod=function(e){var t=this.getTargetLanguageObject(e);if(this.logger.debug("SegmentController["+this.mimeType+"]: switching period from "+this.currentPeriodId+" to "+e),this.initSegmentsTracker.clear(),this.removeCachedSegmentsOfPrecedingPeriods(),this.currentPeriodId=e,this.currentAdaptationSetId=this.findAdaptationSetId(t,e,!0),this.loadedAdaptationSetIds[e]=this.currentAdaptationSetId,this.manifestService.isHlsManifest()||(this.currentRepresentationId=void 0),this.currentAdaptationSetId){this.adaptationHandler.setAdaptationSetId(this.currentAdaptationSetId);var i=this.mpdHandler.getPendingSegmentInfoRequest();this.mpdHandler.dispose(),this.mpdHandler=x.MPDHandlerFactory.createInstance(this.context,this.mimeType,this.manifestLoader,e,t),this.mpdHandler.setPendingSegmentInfoRequest(i),this.mpdHandler.setAdaptationSetId(this.currentAdaptationSetId,null,{isPeriodSwitch:!0})}if(this.isTransmuxerRequired()){if(this.currentAdaptationSetId){var n=this.manifestService.findDownloadedHlsRepresentation(this.currentAdaptationSetId);n&&this.mpdHandler.setRepresentationId(n._internalId)}this.hlsTimelineTracker&&this.hlsTimelineTracker.reset(),this.segmentManager.clearCache(!1)}this.hasDownloadError=!1,this.isLastSegment=!1,this.isFirstSegment=!0,this.areCodecsFinal=!this.isTransmuxerRequired(),this.periodSwitch=!0},e.prototype.getMPDHandler=function(){return this.mpdHandler},e.prototype.getIndex=function(){return this.mpdHandler?this.mpdHandler.getIndex()||0:0},e.prototype.getSourceBufferTypes=function(){var e=[];return this.isTransmuxerRequired()&&this.hls.isAvMuxedTogether?(e.push("video/mp4"),e.push("audio/mp4")):e.push(this.mimeType),e},e.prototype.getCodecs=function(){return this.areCodecsFinal?this.codec:null},e.prototype.getLiveEdgeTime=function(){return this.manifestService.isLive()?this.mpdHandler.getLiveEdgeTime():-1},e.prototype.setAdaptionLogicStartupPhase=function(){this.adaptationHandler.setStartupPhase()},e.prototype.getMimeType=function(){return this.mimeType},e.prototype.timeShift=function(e){this.isTransmuxerRequired()&&this.manifestService.isHlsManifest()&&this.hlsTimelineTracker&&this.hlsTimelineTracker.reset(),this.cancelLoading(),this.loadingSegmentInfos=[],this.mpdHandler.timeShift(e,this.currentPeriodId),this.isTransmuxerRequired()||(this.currentRepresentationId=void 0),this.isLastSegment=!1,this.invalidateOngoingSegmentInfoRequest=!0},e.prototype.removeCachedSegmentsOfPrecedingPeriods=function(){var e=this,t=m.getMetricsState(this.context.store.getState());if(this.segmentManager&&t){var i=_.getPlayingPeriodId(this.sourceStore.getState());this.segmentManager.removeCachedInitSegments(function(t){return e.manifestService.isPrecedingPeriod(i,t.getPeriodId())}),(m.getMetricsHistory(t,this.mimeType,y.MetricType.CachedInitSegments)||[]).filter(function(t){var n=t.value.internalRepId.periodId;return e.manifestService.isPrecedingPeriod(i,n)}).forEach(function(t){return e.context.store.dispatch(g.removeMetricsValue(e.mimeType,y.MetricType.CachedInitSegments,t))})}},e.prototype.canLoad=function(){return this.segmentManager.canLoad()},e.prototype.isTransmuxerRequired=function(){return this.hls.isTransmuxingRequired},e.prototype.setTransmuxer=function(e){this.hls.transmuxer=e},e.prototype.getTransmuxer=function(){return this.hls.transmuxer},e.prototype.getAdaptationHandler=function(){return this.adaptationHandler},e.prototype.resetTransmuxer=function(){this.hls.transmuxer&&this.hls.transmuxer.reset()},e.prototype.resetLastChosenRepresentation=function(){this.lastChosenRepresentation=null},e.prototype.dispose=function(){this.mpdHandler=c.dispose(this.mpdHandler),this.adaptationHandler=c.dispose(this.adaptationHandler),this.context&&this.context.serviceManager.get(u.ServiceName.SegmentService).disposeOfType(this.mimeType,this.currentLangObj),this.manifestService=null,this.context=null,this.segmentUnavailabilityHandler=null,this.lastChosenRepresentation=null,this.lastSegmentInfo=null,this.currentLangObj=null,this.currentAdaptationSetId=null,this.loadedAdaptationSetIds=null,this.downloadRepresentationId=null,this.currentRepresentationId=null},e}();t.SegmentController=O;var H=function(){function e(){this.clear()}return e.prototype.isAlreadyDownloaded=function(e){return this.initializedRepresentationIds[e.key()]===!0},e.prototype.markAsDownloaded=function(e){this.initializedRepresentationIds[e.key()]=!0},e.prototype.clear=function(){this.initializedRepresentationIds={}},e}()},130:function(e,t,i){"use strict";function n(e,t){return e.getCurrentPeriodId()!==t.targetPeriodId&&e.switchPeriod(t.targetPeriodId),e.seekTo(t.startTime),e.getCurrentAdaptationSet()?r(e,t):Promise.resolve([])}function r(e,t){return e.getInitSegmentInfo().then(function(i){return i.isInitSegment||(t.duration-=i.duration),o(e,t.duration).then(function(e){return[i].concat(e)})})}function o(e,t,i){return void 0===i&&(i=[]),t<=0||!e.hasNext()?Promise.resolve(i):e.getDataSegmentInfo().then(function(n){return t-=n.duration,i.push(n),o(e,t,i)})}function a(e){return e.url+(e.byteRange?","+JSON.stringify(e.byteRange):"")}Object.defineProperty(t,"__esModule",{value:!0});var s=i(5),d=function(){function e(){this.segmentControllers=[]}return e.prototype.updatePlayerContext=function(e){this.context=e},e.prototype.setSegmentControllers=function(e){this.segmentControllers=e},e.prototype.getSegmentControllerMimeTypes=function(){return this.segmentControllers.map(function(e){return e.getMimeType()})},e.prototype.getSegmentInfos=function(e,t){if(!this.context)return Promise.resolve([]);var i=this.context.serviceManager.get(s.ServiceName.ManifestService),r=i.getPeriodIdForTime(e),o=this.segmentControllers.map(function(i){return n(i,{startTime:e,duration:t,targetPeriodId:r})});return Promise.all(o).then(function(e){return e.flatMap(function(e){return e})})},e.prototype.dispose=function(){this.context=null,this.segmentControllers=[]},e}();t.SegmentInfoService=d,t.getSegmentInfoId=a},175:function(e,t,i){"use strict";function n(e,t){return Object.keys(e).every(function(i){return t&&t[i]===e[i]})}function r(e){var t,i=null===(t=e.getSegmentInfo())||void 0===t?void 0:t.key;return!i||"object"!=typeof i&&"string"!=typeof i?e.isEncrypted()?"encrypted":"unecrypted":"encrypted"}function o(e,t,i){return i.every(function(i){var n,r,o,a,s=i.mimeType,d=e.getSegregationCriteria(s),u=t.getSegregationCriteria(s),c=(null===(n=d)||void 0===n?void 0:n.codec)===(null===(r=u)||void 0===r?void 0:r.codec),l=(null===(o=d)||void 0===o?void 0:o.encryption)===(null===(a=u)||void 0===a?void 0:a.encryption);return c&&l})}Object.defineProperty(t,"__esModule",{value:!0});var a=i(30),s=function(){function e(e){this.requiredMediaTypes=e,this.requiredMediaTypes=e}return e.prototype.isRequiredMimeType=function(e,t){return void 0===t.getPeriodId()||Boolean(this.requiredMediaTypes[t.getPeriodId()]&&this.requiredMediaTypes[t.getPeriodId()][e.getMimeType()])},e.prototype.getSegregationCriteria=function(e){var t=r(e),i=a.CodecStringHelper.extractCodec(e.getCodec()),n=e.getPeriodId();return{encryption:t,codec:i,periodId:n}},e.prototype.canAddSegmentToBufferBlock=function(e,t,i){var r=e.getMimeType(),o=e.isInit()||e.isSelfInit(),a=!o;if(o){var s=t.getSegregationCriteria(r),d=this.isRequiredMimeType(e,t);s?(a=n(i,s),t.setSegregationCriteria(i,r)):!s&&d?(a=!0,t.setSegregationCriteria(i,r)):a=!1}return a},e}();t.Segregation=s,t.areSegregationCriteriaEqual=n,t.hasSameCriteria=o},176:function(e,t,i){"use strict";function n(e,t){if(isNaN(t))return 0;var i=o.toSeconds(Date.now()-e);return i>=t?0:o.toMilliSeconds(t-i)}Object.defineProperty(t,"__esModule",{value:!0});var r=i(10),o=i(3);t.REPRESENTATION_UPDATE_CANCEL="CANCEL";var a=2147483647,s=function(){function e(e){var t=this;this.updateCallbacks=e,this.payloadUpdate=function(){t.update().then(t.processPayload)["catch"](t.handlePayloadUpdateError)},this.handlePayloadUpdateError=function(e){t.publishErrorResponse(e),t.clearTimeout()},this.processPayload=function(e){t.success(e),t.clearTimeout(),t._isStopped||t.scheduleUpdate()},this._isStopped=!1}return e.prototype.cancel=function(){this._updateDeferred&&(this._updateDeferred.reject(t.REPRESENTATION_UPDATE_CANCEL),this.updateCallbacks.error(t.REPRESENTATION_UPDATE_CANCEL)),this.clearTimeout()},e.prototype.clearTimeout=function(){window.clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null},e.prototype.stop=function(){null!==this.updateTimeoutId&&(this._isStopped=!0,this.cancel())},e.prototype.start=function(){this._isStopped=!1,this.scheduleUpdate()},e.prototype.scheduleUpdate=function(){this.updateTimeoutId||this._isStopped||this.initializeUpdate()},e.prototype.initializeUpdate=function(){this._updateDeferred=new r.Deferred,this._updateDeferred.promise["catch"](function(){});var e=n(this.getLastReloadTimestamp(),this.getReloadIntervalInSeconds());e>a||(this.updateTimeoutId=window.setTimeout(this.payloadUpdate,e))},e.prototype.publishErrorResponse=function(e){this._updateDeferred.reject(e),this.updateCallbacks.error(e)},e.prototype.success=function(e){this._updateDeferred.resolve(e),this.updateCallbacks.success(e)},Object.defineProperty(e.prototype,"isStopped",{get:function(){return this._isStopped},enumerable:!0,configurable:!0}),e.prototype.getPayload=function(){return this._updateDeferred.promise},e}();t.AbstractUpdater=s,t.calculateUpdateDelayInMillis=n},177:function(e,t,i){"use strict";function n(e){return null==e.Period?[]:e.Period.filter(function(e){return e.AdaptationSet&&e.AdaptationSet.length>0}).reduce(function(e,t){return e.concat(t.AdaptationSet)},[]).filter(function(e){return e.ContentProtection&&e.ContentProtection.length>0}).flatMap(function(e){return e.ContentProtection}).filter(function(e){return null!=e.laurl&&e.laurl.length>0}).flatMap(function(e){return e.laurl.map(function(t){return a(a({},t),{drmType:g.DRMSchemeIDURIs[e._schemeIdUri]})})}).filter(function(e){return null!=e.drmType}).map(function(e){var t;return t={},t[e.drmType]={LA_URL:e._licenseUrl},t})}function r(e,t,i){var n=e.find(function(e){return e._lang&&t.lang&&e._lang===t.lang}),r=e.find(function(e){return t.adaptationSetId&&e._internalId.equals(t.adaptationSetId)});return r=r||e.find(function(e){return t.id===e._internalId.adaptationSetId}),i?n||r:r||n}function o(e){var t;return e=a({},e),e.Period=null===(t=e.Period)||void 0===t?void 0:t.map(function(e){var t;return a(a({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(t,i){var n,r=new C.AdaptationSetId(e._id,t._mimeType+"-"+i);return a(a({},t),{_internalId:r,_periodId:e._id,Representation:null===(n=t.Representation)||void 0===n?void 0:n.map(function(e){return a(a({},e),{_internalId:new x.RepresentationId(r,e._id)})})})})})}),e}var a=this&&this.__assign||function(){return a=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},a.apply(this,arguments)},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var n=Array(e),r=0,t=0;t<i;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)n[r]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0});var d=i(4),u=i(6),c=i(5),l=i(1),h=i(95),p=i(15),f=i(94),g=i(72),m=i(164),y=i(102),S=i(9),v=i(30),T=i(56),P=i(7),I=i(3),M=i(2),b=i(0),E=i(40),R=i(76),C=i(57),A=i(75),L=i(74),_=i(49),x=i(58),k=function(){function e(e){var t=this;this.dispatchQualityRemovedEvent=function(e){var i=t.getAdaptationSet(e._internalId);if(i){var n=function(i){t.context.eventHandler.dispatchEvent(i,{quality:{id:e._id,bitrate:e._bandwidth}})};P.MimeTypeHelper.isAudio(i._mimeType)?n(l.PlayerEvent.AudioQualityRemoved):P.MimeTypeHelper.isVideo(i._mimeType)&&n(l.PlayerEvent.VideoQualityRemoved)}},this.copyRequiredPropertiesToRepresentations=function(e){(e.Representation||[]).forEach(function(t){e._codecs&&!t._codecs&&(t._codecs=e._codecs),e._width&&!t._width&&(t._width=e._width),e._height&&!t._height&&(t._height=e._height)}),delete e.SegmentTemplate},this.context=e,this.settings=e.settings,this.blacklistedRepresentations=[],this.synchronizedTimeService=e.serviceManager.get(c.ServiceName.SynchronizedTimeService),this.sourceStore=e.serviceManager.get(c.ServiceName.SourceStoreService,e.sourceContext.sourceIdentifier)}return Object.defineProperty(e.prototype,"manifest",{get:function(){return R.getManifest(this.sourceStore.getState())},enumerable:!0,configurable:!0}),e.prototype.setManifest=function(e){this.sourceStore.dispatch(E.setManifestAction(this.preProcessManifest(e)))},e.prototype.updateManifest=function(e){var t=this;return this.synchronizeWithTimeserver(e).then(function(){t.reinitializeAndUpdateManifest(e),t.context&&t.context.eventHandler&&t.context.eventHandler.dispatchEvent(p.InternalEvent.MPDUpdated,{manifest:e},!0)})},e.prototype.reinitializeAndUpdateManifest=function(e){if(this.dispose(),this.setManifest(e),this.mpdExtractor=new L.MPDExtractor(this.context),this.isLive()&&this.context){var t=this.isHlsManifest()?this.getFirstPeriod().start:I.toSeconds(this.getAvailabilityStartTime());this.sourceStore.dispatch(y.setStartTimeOffset(t))}this.mpdExtractor.adjustPeriodStartTimes();var i=this.parseStreamDuration();h.maybeFireDurationChangedEvent(this.parsedDuration,i,this.context.eventHandler),this.parsedDuration=i},e.prototype.blacklistRepresentations=function(e){var t=this,i=e.map(function(e){return t.getRepresentationById(e)}).filter(function(e){return Boolean(e)});return this.blacklistedRepresentations=S.ArrayHelper.union(this.blacklistedRepresentations,e),this.sourceStore.dispatch(E.removeRepresentationsAction(this.blacklistedRepresentations)),this.manifest.Period.length?(this.mpdExtractor=new L.MPDExtractor(this.context),this.context.eventHandler.dispatchEvent(p.InternalEvent.MPDAvailable,{manifest:this.manifest},!0),void i.forEach(this.dispatchQualityRemovedEvent)):void this.context.eventHandler.dispatchEvent(l.PlayerEvent.Error,new u.PlayerError(d.ErrorCode.SOURCE_ERROR,null,"No playable track left"))},e.prototype.resetBlacklistedRepresentations=function(){this.blacklistedRepresentations=[]},e.getSupplementalProperties=function(e,t){return!e.SupplementalProperty||e.SupplementalProperty.length<=0?null:e.SupplementalProperty.filter(function(e){return e._schemeIdUri===t})},e.getCodecOfAdaptationSet=function(e){var t=e._codecs,i=e._mimeType.split("/")[0];if(!t){var n=e.Representation.find(function(e){return Boolean(e._codecs)});if(!n)return null;t=n._codecs}var r=v.CodecStringHelper.extractCodecStrings(t);return r[i]?v.CodecStringHelper.extractCodec(r[i]):null},e.prototype.findMatchingSwitchableAdaptationSets=function(t,i,n){var r=n&&n.length>0;if(!r&&!this.settings.ADAPTATION_SET_SWITCHING_WITHOUT_SUPPLEMENTAL_PROPERTY)return null;var o=[],a=t._group,s=e.getCodecOfAdaptationSet(t);return r&&n.forEach(function(e){return o.push(e._value)}),this.settings.ADAPTATION_SET_SWITCHING_WITHOUT_SUPPLEMENTAL_PROPERTY&&i.forEach(function(e){o.includes(e._id)||o.push(e._id)}),i.filter(function(i){if(!o.includes(i._id)||i._id===t._id)return!1;var n=i._group===a,r=i._mimeType===t._mimeType,d=e.getCodecOfAdaptationSet(i)===s,u=i._lang===t._lang;return r&&d&&n&&u})},e.prototype.getSwitchableAdaptationSets=function(t){var i=this;return t.AdaptationSet?t.AdaptationSet.reduce(function(n,r){var o=e.getSupplementalProperties(r,"urn:mpeg:dash:adaptation-set-switching:2016"),a=i.findMatchingSwitchableAdaptationSets(r,t.AdaptationSet,o);return a&&0!==a.length?S.ArrayHelper.addAndMergeIntersects(n,s([r],a)):n},[]):[]},e.mergeAdaptationSetProperties=function(e,t,i){var n=e.hasOwnProperty(i),r=t.hasOwnProperty(i);(n||r)&&(n?r||(t[i]=[]):e[i]=[],e[i]=e[i].concat(t[i]))},e.prototype.getAdaptationSetPropertyValues=function(e,t){return e.filter(function(e){return e.hasOwnProperty(t)}).map(function(e){return e[t]})},e.prototype.updateAdaptationSetMinMaxValues=function(e,t){var i=[e].concat(t),n=this.getAdaptationSetPropertyValues(i,"_minWidth"),r=this.getAdaptationSetPropertyValues(i,"_maxWidth"),o=this.getAdaptationSetPropertyValues(i,"_minHeight"),a=this.getAdaptationSetPropertyValues(i,"_maxHeight"),s=this.getAdaptationSetPropertyValues(i,"_minBandwidth"),d=this.getAdaptationSetPropertyValues(i,"_maxBandwidth");n.length>0&&(e._minWidth=Math.min.apply(null,n)),r.length>0&&(e._maxWidth=Math.max.apply(null,r)),o.length>0&&(e._minHeight=Math.min.apply(null,o)),a.length>0&&(e._maxHeight=Math.max.apply(null,a)),s.length>0&&(e._minBandwidth=Math.min.apply(null,s)),d.length>0&&(e._maxBandwidth=Math.max.apply(null,d))},e.prototype.mergeAdaptationSets=function(t,i){i.forEach(this.copyRequiredPropertiesToRepresentations);var n=i.shift();i.forEach(function(t){["Representation","ContentComponent","ContentProtection","SupplementalProperty"].forEach(function(i){return e.mergeAdaptationSetProperties(n,t,i)})}),this.updateAdaptationSetMinMaxValues(n,i),t.AdaptationSet=t.AdaptationSet.filter(function(e){return!i.includes(e)})},e.prototype.mergeSwitchableAdaptationSets=function(e){var t=this;return e.Period.forEach(function(e){t.getSwitchableAdaptationSets(e).forEach(function(i){t.mergeAdaptationSets(e,i)})}),e},e.getFirstKeyId=function(e){if(!e||0===e.length)return null;var t=e.find(function(e){return"cenc"===e.name});if(t&&t.defaultKid)return t.defaultKid;var i=e.find(function(e){return e.kids&&e.kids.length>0});return i?i.kids[0]:null},e.prototype.setRepresentationDrmKid=function(e,t){this.context.store.dispatch(E.setRepresentationDrmKidAction(e,t))},e.prototype.addDrmKidsToRepresentations=function(t){var i;if(!t.Period||0===t.Period.length)return t;var n=function(t,i){var n=L.MPDExtractor.getContentProtectionForManifestElement(t),r=L.MPDExtractor.getContentProtectionForManifestElement(i);return e.getFirstKeyId(r)||e.getFirstKeyId(n)};return t=a({},t),t.Period=null===(i=t.Period)||void 0===i?void 0:i.map(function(e){var t;return a(a({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return a(a({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(t){return a(a({},t),{associatedKid:n(e,t)})})})})})}),t},e.prototype.setPlayerDRM=function(e){var t=this.context.sourceContext.source.drm,i=n(e),r={};i.length>0&&(r=a({},i[0])),null!=t&&Object.keys(t).length>0&&Object.keys(t).forEach(function(e){r[e]=null!=r[e]?a(a({},r[e]),t[e]):t[e]}),this.addDrmServiceAndSetDrmConfig(r);var o=Object.keys(r).length>0?m.setManifestDrm(r):m.resetManifestDrm();this.sourceStore.dispatch(o)},e.prototype.addDrmServiceAndSetDrmConfig=function(e){var t=M.ModuleManager.has(b.ModuleName.DRM)&&Object.keys(e).length>0&&!this.context.serviceManager.has(c.ServiceName.DrmService);if(t){var i=M.ModuleManager.get(b.ModuleName.DRM).DrmService;this.context.serviceManager.set(c.ServiceName.DrmService,new i(this.context))}this.context.serviceManager.maybeCall(c.ServiceName.DrmService,function(t){t.isDrmConfigSet()||t.setDrmConfig(e)})},e.prototype.getCodecPriorities=function(){return{video:this.getPreferredCodecOrder(this.context.config,this.context.sourceContext.source,!0),audio:this.getPreferredCodecOrder(this.context.config,this.context.sourceContext.source,!1)}},e.prototype.preProcessManifest=function(e){return e=A.removeRepresentations(e,this.blacklistedRepresentations),e.Period.length?(e=A.orderAdaptationSetsByCodec(e,this.getCodecPriorities()),e=this.addDrmKidsToRepresentations(e),e=this.mergeSwitchableAdaptationSets(e),e=this.removeIncompatibleAudioAdaptationSets(e),M.ModuleManager.has(b.ModuleName.Envivio)&&(e=M.ModuleManager.get(b.ModuleName.Envivio).fixSegmentTimelineLiveStream(e)),this.setPlayerDRM(e),e=o(e)):(this.context.eventHandler.dispatchEvent(l.PlayerEvent.Error,new u.PlayerError(d.ErrorCode.SOURCE_ERROR,null,"No playable track left")),null)},e.prototype.parseStreamDuration=function(){if(this.mpdExtractor){var e=NaN,t=this.mpdExtractor.getDuration();return t&&(this.cachedDurationString&&this.cachedDurationString===t?e=this.cachedDuration:(e=T.DurationConverter.getDurationInSec(t),this.cachedDurationString=t,this.cachedDuration=e)),isNaN(e)&&this.isLive()?1/0:e}return 0},e.prototype.getDuration=function(){return this.parsedDuration},e.prototype.isLive=function(){return!!this.manifest&&this.mpdExtractor.isLive()},e.prototype.getAvailabilityStartTime=function(){return this.mpdExtractor.getAvailabilityStartTime()},e.prototype.getAvailabilityEndTime=function(){return this.mpdExtractor.getAvailabilityEndTime()},e.prototype.isAvailabilityEndTimeExceeded=function(){var e=this.getAvailabilityEndTime();return e&&Date.now()>e.getTime()},e.prototype.findPeriod=function(e){return this.manifest&&e?this.manifest.Period.find(function(t){return t._id===e}):null},e.prototype.getAllPeriods=function(){return this.manifest&&this.manifest.Period?this.manifest.Period:[]},e.prototype.getPeriod=function(e){return e?this.findPeriod(e.periodId):null},e.prototype.isSmoothManifest=function(){return this.manifest.originalFormat&&"smooth"===this.manifest.originalFormat.format},e.prototype.isLanguageAvailable=function(e,t,i){return this.findAdaptationSetsForMimeType(e,t).some(function(e){var t=e._lang&&i.lang&&e._lang===i.lang,n=i.adaptationSetId&&e._internalId.equals(i.adaptationSetId);return t||n})},e.prototype.getHlsDefaultLanguage=function(e){if(!M.ModuleManager.has(b.ModuleName.HLS)||!this.isHlsManifest())return null;var t=M.ModuleManager.get(b.ModuleName.HLS).selectors,i=t.getHlsState,n=t.getDefaultLanguages,r=n(i(this.sourceStore.getState()));return r?P.MimeTypeHelper.isVideo(e)?r.VIDEO:P.MimeTypeHelper.isAudio(e)?r.AUDIO:P.MimeTypeHelper.isSubtitle(e)?r.SUBTITLES:null:null},e.prototype.getPreferredLanguage=function(e){return this.getHlsDefaultLanguage(e)||navigator.language||navigator.userLanguage},e.prototype.findAdaptationSet=function(e,t,i,n){void 0===n&&(n=!1);var o,a=this.findAdaptationSetsForMimeType(e,t);if(0===a.length)return this.context.logger.debug("No AdaptationSet found to match mime type "+t),null;if(i&&(o=r(a,i,n)),o)return o;var s=this.getPreferredLanguage(t),d=a.find(function(e){var t=Boolean(e._lang)&&Boolean(s);return!!t&&(e._lang.includes(s)||s.includes(e._lang))});return d?d:a[0]},e.prototype.findAdaptationSetsForMimeType=function(e,t){var i=this.findPeriod(e)||this.getFirstPeriod(),n=i?i.AdaptationSet:[];return n.filter(function(e){return e._mimeType===t||e.Representation.find(function(e){return e._mimeType===t})})},e.prototype.getManifest=function(){return this.manifest},e.prototype.getAvailableAudio=function(e,t){return this.mpdExtractor.getAvailableAudio(e,t);
},e.prototype.getAvailableVideo=function(e){return this.mpdExtractor.getAvailableVideo(e)},e.prototype.getAvailableSubtitles=function(e){return this.mpdExtractor.getAvailableSubtitles(e)},e.prototype.getClosedCaptionLabels=function(e){return this.mpdExtractor.getClosedCaptionLabels(e)},e.prototype.getVideoRepresentations=function(e){return this.mpdExtractor.getVideoQualities(e)},e.prototype.getAudioRepresentations=function(e){return this.mpdExtractor.getAudioQualities(e)},e.prototype.getPeriodDuration=function(e,t){return this.mpdExtractor.getPeriodDuration(e,t||this.getManifest().Period)},e.prototype.hasMultiplePeriods=function(){return this.manifest&&this.manifest.Period&&this.manifest.Period.length>1},e.prototype.hasSinglePeriod=function(){return this.manifest&&this.manifest.Period&&1===this.manifest.Period.length},e.prototype.getTimeShiftBufferDepthSeconds=function(){return this.mpdExtractor.getTimeShiftBufferDepthSeconds()},e.prototype.getRequestTimestamp=function(){return this.mpdExtractor.getRequestTimestamp()},e.prototype.getMediaPresentationDuration=function(){var e=T.DurationConverter.getDurationInSec(this.manifest._mediaPresentationDuration);return isNaN(e)?0:e},e.prototype.calculateCumulativePeriodDuration=function(e){for(var t=0,i=0,n=this.manifest.Period;i<n.length;i++){var r=n[i];if(r._id===e)break;t+=this.getPeriodDuration(r._id)}return this.isLive()?I.toSeconds(Date.now()-this.getAvailabilityStartTime())-t:t},e.prototype.getMinimumUpdatePeriod=function(){return L.getMinimumUpdatePeriodInSeconds(this.manifest)},e.prototype.getContentProtectionForAdaptationSet=function(e){return L.MPDExtractor.getContentProtectionForAdaptationSet(e)},e.prototype.getLangObjectFromAdaptationSet=function(e,t){return this.mpdExtractor.getLangObjectFromAdaptationSet(e,t)},e.prototype.toSubtitleTrack=function(e,t){return this.mpdExtractor.toSubtitleTrack(e,t)},e.prototype.getDRMCapabilitiesForPeriod=function(e){return this.mpdExtractor.getDRMCapabilitiesForPeriod(e)},e.prototype.hasManifestTypeChanged=function(e){return!(!this.manifest||this.manifest._type===e)&&(this.context.logger.log("Manifest has just changed from "+this.manifest._type+" to "+e),!0)},e.prototype.getPeriodIdForTime=function(e){var t=this.manifest.Period;if(1===t.length)return t[0]._id;for(var i=0;i<t.length;i++){var n=t[i].start,r=n+this.getPeriodDuration(t[i]._id,t);if(e>=n&&e<r)return t[i]._id}return this.getNearestPeriodForTime(t,e)},e.prototype.getNearestPeriodForTime=function(e,t){if(t<e[0].start)return e[0]._id;if(t>e[e.length-1].start)return e[e.length-1]._id;for(var i=0;i<e.length;i++){if(i===e.length-1)return e[i]._id;var n=e[i].start+e[i].duration;if(t>=n&&t<e[i+1].start)return e[i+1]._id}},e.prototype.dispose=function(){this.mpdExtractor&&(this.mpdExtractor.dispose(),this.mpdExtractor=null)},e.prototype.getTotalDuration=function(){var e=0;if(this.settings.ENABLE_SEEK_FOR_LIVE&&this.isLive())e=this.manifest.Period.reduce(function(e,t){return e+t.duration},0);else{var t=this.getLastPeriod(),i=t.start||T.DurationConverter.getDurationInSec(t._start)||0,n=this.mpdExtractor.getPeriodDuration(t._id);e=i+n}return 0===e&&this.isLive()&&(e=1/0),e},e.prototype.getFirstPeriod=function(){return this.manifest.Period&&this.manifest.Period.length>0?this.manifest.Period[0]:null},e.prototype.getLastPeriod=function(){return this.manifest.Period&&this.manifest.Period.length>0?this.manifest.Period[this.manifest.Period.length-1]:null},e.prototype.isLastPeriod=function(e){return e===this.getLastPeriod()._id},e.prototype.isManifestFinalized=function(){return!this.isLive()},e.prototype.isFirstPeriod=function(e){return this.getFirstPeriod()._id===e},e.prototype.isHlsManifest=function(){return this.getManifest()._isHls},e.prototype.getHlsTags=function(){if(!this.isHlsManifest())return null;var e=M.ModuleManager.get(b.ModuleName.HLS).selectors,t=e.getHlsState,i=e.getCustomTags,n=t(this.sourceStore.getState());return i(n)},e.prototype.isMimeTypePartOfPeriod=function(e,t){var i=this.getPeriod(new _.PeriodId(t)),n=i?i.AdaptationSet:[];return n.some(function(t){return t._mimeType===e})},e.prototype.getNextPeriod=function(e){if(this.manifest)for(var t=this.findPeriod(e),i=this.manifest.Period.indexOf(t),n=i+1;n<this.manifest.Period.length;n++){var r=this.manifest.Period[n];if(r&&!r.droppedOut)return r}return null},e.prototype.getEventStreamEvents=function(e){return this.mpdExtractor.getEventStreamEvents(e)},e.prototype.hasAdaptationSets=function(e){var t=this.manifest;if(t&&t.Period){var i=t.Period.find(function(t){return t._id===e});return Boolean(i&&i.AdaptationSet)}return!1},e.prototype.synchronizeWithTimeserver=function(e){var t=this,i=[],n=0;if(this.synchronizedTimeService){var r=this.context.config&&this.context.config.live;return r&&r.synchronization&&r.synchronization.length>0?i=r.synchronization.map(function(e){switch(e.method){case f.LiveSynchronizationMethod.HttpHead:return{schemeIdUri:"urn:mpeg:dash:utc:http-head:2014",value:e.serverUrl};case f.LiveSynchronizationMethod.HttpXsDate:return{schemeIdUri:"urn:mpeg:dash:utc:http-xsdate:2014",value:e.serverUrl};case f.LiveSynchronizationMethod.HttpIso:return{schemeIdUri:"urn:mpeg:dash:utc:http-iso:2014",value:e.serverUrl};default:return t.context.logger.debug("No valid time synchronization configuration entry provided"),null}}).filter(function(e){return null!==e}):e&&e.UTCTiming&&e.UTCTiming.length>0&&(i=i.concat(e.UTCTiming),n=e._downloadTime),this.synchronizedTimeService.synchronizeWithServer(i,n).then(function(e){t.context.logger.debug("successfully synchronized to server time - drift: "+I.toSeconds(e)+"s")})["catch"](function(){t.context.logger.debug("Player clock synchronization failed")})}return Promise.resolve()},e.prototype.getAdaptationSet=function(e){if(!e)return null;var t=this.getPeriod(e);return t&&t.AdaptationSet?t.AdaptationSet.find(function(t){return t._internalId.equals(e)}):null},e.prototype.getRepresentationById=function(e){var t=this.getAdaptationSet(e);return t?t.Representation.find(function(t){return t._internalId.equals(e)}):null},e.prototype.representationExists=function(e){return Boolean(this.getRepresentationById(e))},e.prototype.getLowestBandwidthOfAdaptationSet=function(e){return this.findLowestPossibleBandwidth(e,-(1/0))},e.prototype.findLowestPossibleBandwidth=function(e,t){void 0===t&&(t=-(1/0));var i=this.getAdaptationSet(e),n=1/0;return i&&i.Representation.forEach(function(e){e._bandwidth>=t&&(n=Math.min(n,e._bandwidth))}),n},e.prototype.getMatchingRepresentationByBandwidth=function(e,t,i){void 0===i&&(i=function(){return!0});var n=this.getAdaptationSet(e);if(!n)return null;var r=n.Representation.filter(i),o=null,a=-(1/0);return r.forEach(function(e){e._bandwidth>a&&e._bandwidth<=t&&(a=e._bandwidth,o=e)}),o||r[0]},e.prototype.getAllRepresentations=function(){return this.getAllPeriods().flatMap(function(e){return e.AdaptationSet.flatMap(function(e){return e.Representation})})},e.prototype.getRepresentation=function(e,t){return this.getRepresentationById(new x.RepresentationId(e,t))},e.prototype.getAllAdaptationSets=function(){return this.getAllPeriods().flatMap(function(e){return e.AdaptationSet})},e.prototype.getAllImageAdaptationSets=function(){return this.getAllAdaptationSets().filter(function(e){return e._mimeType.includes("image")&&"image"===e._contentType})},e.prototype.getAllDashThumbnailSources=function(){var e=this;return this.getAllImageAdaptationSets().map(function(t){var i=e.findPeriod(t._internalId.periodId),n=i.start,r=i.duration;return{adaptationSet:t,timing:{startTime:n,duration:r}}})},e.prototype.getAdaptationSetIndex=function(e){var t=this.findPeriod(e.periodId);return t&&t.AdaptationSet&&0!==t.AdaptationSet.length?t.AdaptationSet.findIndex(function(t){return t._internalId.equals(e)}):-1},e.prototype.markSegmentAsDownloaded=function(e,t){this.context.store.dispatch(E.markSegmentAsDownloadedAction(e,t))},e.prototype.getAvailableBaseURLsForRepresentation=function(e){var t=this.getAdaptationSet(e);if(void 0===e||!t)return[];for(var i=[],n=t.Representation,r=0;r<n.length;r++)if(n[r]._internalId.equals(e)&&n[r].BaseURL&&n[r].BaseURL.length>0){i=n[r].BaseURL;break}for(var o=[],r=0;r<i.length;r++)o.push(i[r].url);return o},e.prototype.findDownloadedHlsRepresentation=function(e){var t=this.getAdaptationSet(e);return t?t.Representation.find(function(e){return e._hls&&Boolean(e._hls.requestTimestamp)}):null},e.prototype.isManifestFetchRequired=function(e){if(!this.isHlsManifest())return!1;var t=Date.now(),i=this.getRepresentationById(e),n=Boolean(i.SegmentList)&&i.SegmentList.length>0,r=n&&Boolean(i.SegmentList[0].SegmentURL),o=r?i.SegmentList[0].SegmentURL.length:0,a=!r||o>0,s=i._requestTimestamp||t,d=t-s,u=this.isLive()&&d>=this.getMinimumUpdatePeriod();return!a||u},e.prototype.hasSelfInitialisingSegments=function(){var e=this.manifest.Period,t=e.map(function(e){return e.AdaptationSet}).reduce(function(e,t){return e.concat(t)},[]),i=t.map(function(e){return e.Representation}).reduce(function(e,t){return e.concat(t)},[]);return i.some(function(e){var t=Boolean(e.SegmentList)&&e.SegmentList.length>0,i=t?e.SegmentList:[],n=Boolean(e.SegmentBase)&&e.SegmentBase.length>0,r=Boolean(e.SegmentTemplate)&&e.SegmentTemplate.length>0,o=r?e.SegmentTemplate:[];return!(Boolean(e.init)||n||i.some(function(e){return Boolean(e.init)})||o.some(function(e){return Boolean(e._initialization)}))})},e.prototype.getAvailabilityTimeComplete=function(e){var t=this.getRepresentationById(e),i=t.SegmentList||t.SegmentBase||t.SegmentTemplate;return!(i&&i[0]&&i[0]._availabilityTimeComplete)||JSON.parse(i[0]._availabilityTimeComplete)},e.prototype.isSegmentInfoLoaded=function(e){var t=this.getRepresentationById(e);return!!t&&!(!t.segmentIndex&&!t.segmentIndexParsingError)},e.prototype.getPreferredCodecOrder=function(e,t,i){var n=i?"videoCodecPriority":"audioCodecPriority";return t&&t.options&&t.options[n]?t.options[n]:e.playback&&e.playback[n]?e.playback&&e.playback[n]:[]},e.prototype.removeIncompatibleAudioAdaptationSets=function(e){return e.Period.forEach(function(e){if(e.AdaptationSet){var t=e.AdaptationSet.find(function(e){return P.MimeTypeHelper.isAudio(A.getMimeTypeForAdaptationSet(e))});t&&(e.AdaptationSet=e.AdaptationSet.filter(function(e){return!P.MimeTypeHelper.isAudio(A.getMimeTypeForAdaptationSet(e))||v.CodecStringHelper.canSwitchBetweenAudioCodecs(A.getCodecsFromAdaptationSet(e),A.getCodecsFromAdaptationSet(t))}))}}),e},e.prototype.isPrecedingPeriod=function(e,t){if(!(e&&t&&this.manifest&&this.manifest.Period))return!1;var i=this.manifest.Period.findIndex(function(t){return t._id===e}),n=this.manifest.Period.findIndex(function(e){return e._id===t});return i>=0&&n>=0&&n<i},e.prototype.getMaxSegmentDuration=function(){var e=T.DurationConverter.getDurationInSec(this.manifest._maxSegmentDuration);return isNaN(e)?0:e},e.prototype.getDesiredDistanceToLiveEdge=function(){var e=Boolean(this.context.config.live&&this.context.config.live.lowLatency);return e?this.context.config.live.lowLatency.targetLatency:this.context.bufferSettings.getForwardTargetLevel()+this.settings.LIVE_EDGE_DISTANCE},e.prototype.hasSuggestedStartPosition=function(){return this.manifest.hasOwnProperty("_startOffset")},e.prototype.getVodStartOffset=function(){return Math.max(0,Math.min(this.manifest._startOffset,this.getDuration()-this.settings.SEEK_TO_END_OFFSET))},e.prototype.getLiveStartOffset=function(e){void 0===e&&(e=!0);var t=this.manifest._startOffset;return t-=Math.abs(this.getTimeShiftBufferDepthSeconds()),e&&(t+=this.getDesiredDistanceToLiveEdge(),t=Math.min(0,t)),t},e.prototype.getPublishTime=function(){return this.manifest._publishTime},e.prototype.initExpectedPlaybackTimesFromReferenceSegment=function(e){var t=M.ModuleManager.get(b.ModuleName.HLS);this.sourceStore.dispatch(t.actions.initExpectedPlaybackTimesFromReferenceSegment(e))},e.prototype.initializeExpectedPlaybackTimesFromStart=function(e){var t=M.ModuleManager.get(b.ModuleName.HLS),i=t.selectors,n=i.getHlsState,r=i.getPlaylistStartTime,o=i.hasPlaylist,a=n(this.sourceStore.getState()),s=o(a,e);if(s){var d=r(a,e);this.sourceStore.dispatch(t.actions.initExpectedPlaybackTimes(e,0,d))}},e.prototype.hasExpectedPlaybackTimeForHlsRepresentation=function(e){var t=M.ModuleManager.get(b.ModuleName.HLS).selectors,i=t.getHlsState,n=t.hasExpectedPlaybackTimesForPlaylist;return n(i(this.sourceStore.getState()),e)},e.prototype.getExpectedPlaybackTimeForHlsSegment=function(e,t){var i=M.ModuleManager.get(b.ModuleName.HLS).selectors,n=i.getHlsState,r=i.getExpectedPlaybackTimeForSegment;return r(n(this.sourceStore.getState()),e,t)},e.prototype.isTimeNearPeriodEnd=function(e,t){for(var i=this.getAllPeriods(),n=0,r=i;n<r.length;n++){var o=r[n],a=o.start,s=a+this.getPeriodDuration(o._id,i);if(e>=a&&e<=s)return s-e<=t}return!1},e}();t.ManifestService=k,t.initializeInternalIds=o},178:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.PERIOD_COMPLETE={code:"PERIOD_COMPLETE"},e.PERIOD_DROPPED_OUT={code:"PERIOD_DROPPED_OUT"},e}();t.SegmentInfoErrors=n},179:function(e,t,i){"use strict";function n(e,t){var i=e.isInitSegment?["url","periodId","byteRange"]:["url","periodId","byteRange","discontinuitySequenceNumber"];return i.every(function(i){return"object"==typeof e[i]?o.compareValues(e[i],t[i]):e[i]===t[i]})}Object.defineProperty(t,"__esModule",{value:!0});var r=i(9),o=i(110),a=function(){function e(e){this.maxSize=Math.max(0,e),this.cache=[]}return e.prototype.contains=function(e){return this.cache.some(function(t){return n(e.getSegmentInfo(),t.getSegmentInfo())})},e.prototype.maintainCacheSize=function(e){return 0===e?void(this.cache=[]):void(this.cache=this.cache.slice(-e))},e.prototype.add=function(e){this.contains(e)||(this.cache.push(e),this.maintainCacheSize(this.maxSize))},e.prototype.get=function(e){return this.cache.find(function(t){return n(e,t.getSegmentInfo())})},e.prototype.clear=function(){this.maintainCacheSize(0)},e.prototype.remove=function(e){this.cache=this.cache.filter(r.invert(e))},e.prototype.getCapacity=function(){return this.maxSize},e.prototype.getCachedCount=function(){return this.cache.length},e.prototype.getCachedSegments=function(){return this.cache.slice(0)},e}();t.SegmentCache=a},180:function(e,t,i){"use strict";function n(e,t){var i=r(e,t),n=a(e,t),o=e.discontinuitySequenceNumber===t.discontinuitySequenceNumber;return i&&n&&o}function r(e,t){var i=o(e),n=o(t);return i.some(function(e){return n.includes(e)})}function o(e){return[e.uri||e.url,e.mediaURL].filter(Boolean)}function a(e,t){var i=s(e),n=s(t);return null==i?null==n:i.start===n.start&&i.end===n.end}function s(e){var t=e.byterange;return t?{start:t.offset,end:t.offset+t.length}:e.byteRange}Object.defineProperty(t,"__esModule",{value:!0}),t.isIdenticalSegmentEntry=n,t.matchesByteRange=a},181:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e.SetSelectedRepresentationId="@instance/sources/@source/activetracks/setselectedrepresentationid",e.RemoveActiveTrack="@instance/sources/@source/activetracks/remove",e.ClearActiveTracks="@instance/sources/@source/activetracks/clear"}(n=t.ActiveTracksActionType||(t.ActiveTracksActionType={}))},182:function(e,t,i){"use strict";var n,r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=i(26),a=i(183),s={playingPeriodId:null};t.getPlayingPeriodId=function(e){return e.playingTracks.playingPeriodId},t.PlayingTracksReducer=o["default"](s,(n={},n[a.PlayingTracksActionKey.SetPlayingPeriodId]=function(e,t){var i=t.payload;return r(r({},e),{playingPeriodId:i})},n))},183:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e.SetPlayingPeriodId="@instance/sources/@source/playingTracks/setPlayingPeriodId"}(n=t.PlayingTracksActionKey||(t.PlayingTracksActionKey={}))},184:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e.SetManifest="@instance/manifest/setmanifest",e.RemoveRepresentations="@instance/manifest/removerepresentations",e.UpdateManifest="@instance/manifest/updatemanifest",e.UpdateRepresentation="@instance/manifest/updaterepresentation",e.UpdatePeriodTiming="@instance/manifest/updateperiodtiming",e.AdjustPeriodStartTimes="@instance/manifest/adjustperiodstarttimes",e.SetRepresentationDrmKid="@instance/manifest/setrepresentationdrmkid",e.MarkSegmentAsDownloaded="@instance/manifest/marksegmentasdownloaded",e.SetRepresentationFailedDownload="@instance/manifest/setrepresentationfaileddownload",e.SetRepresentationSegmentIndex="@instance/manifest/setrepresentationsegmentindex",e.SetRepresentationIsLoading="@instance/manifest/setrepresentationisloading",e.SetRepresentationSegmentIndexParsingError="@instance/manifest/setrepresentationsegmentindexparsingerror",e.SetRepresentationAnchorPoint="@instance/manifest/setrepresentationacnhorpoint"}(n=t.ManifestActionType||(t.ManifestActionType={}))},231:function(e,t,i){"use strict";function n(e){return Object.keys(k.MediaErrorCode).some(function(t){return t===""+e})}function r(e){var t,i=e.code||(null===(t=e.errorObject)||void 0===t?void 0:t.code),r=e.errorObject||{errorMessage:JSON.stringify(e),code:i},o=n(i),a=o?k.ErrorCodeMap[k.MediaErrorCode[i]]:u.ErrorCode.UNKNOWN;return new c.PlayerError(a,r)}function o(e,t){if(!R.ModuleManager.has(C.ModuleName.RendererMse))return!1;for(var i=R.ModuleManager.get(C.ModuleName.RendererMse).Ranges,n=i.findGaps(e.videoElement.buffered),r=.1,o=!1,a=0;a<n.length;a++){var s=n.end(a)+i.TIME_FUDGE_FACTOR,d=Math.abs(s-t);d<=r&&(o=!0)}return o}var a=this&&this.__assign||function(){return a=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},a.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s,d=i(33),u=i(4),c=i(6),l=i(155),h=i(5),p=i(1),f=i(15),g=i(39),m=i(8),y=i(24),S=i(23),v=i(17),T=i(45),P=i(36),I=i(30),M=i(7),b=i(3),E=i(14),R=i(2),C=i(0),A=i(429),L=i(177),_=i(430),x=i(432),k=i(420),D=i(421),B=i(445),w=i(423),O=i(451),H=i(66),N=i(453);!function(e){e.Unloaded="unloaded",e.Loading="loading",e.Loaded="loaded"}(s||(s={}));var F=function(){function e(e){var t=this;this.timeShiftJumpStart=-1,this.timeShiftEstimatedLiveEdge=-1,this.ignoreNextVideoError=!1,this.ended=!1,this.isDvrWindowExceeded=!1,this.controlPermitted=!0,this.lastPlayIssuer="api",this.lastPauseIssuer="api",this.isInitialSeek=!1,this.onPeriodSwitched=function(e,i){t.finishPeriodSwitch(),t.logger.debug("Successfully switched from Period "+e+" to Period "+i);var n={periodId:e},r={periodId:i};t.context.eventHandler.dispatchEvent(p.PlayerEvent.PeriodSwitched,{sourcePeriod:n,targetPeriod:r})},this.onSegmentAvailable=function(e){null!=t.relativeCurrentTimeOffset||e.isInit()||(t.relativeCurrentTimeOffset=t.isLive()?t.calcRelativeCurrentTimeOffsetForLive(e):0)},this.onPlaying=function(){t.isLive()&&t.canResumeLatencyControl()&&t.resumeLatencyControl()},this.videoErrorHandler=function(e){var i=t.isPlaying(),n=function(){i?t.play():t.preload(),t.eventHandler.off(p.PlayerEvent.Error,n)},o=e&&e.code&&6e3===e.code;t.ignoreNextVideoError?t.ignoreNextVideoError=!1:o?(t.eventHandler.on(p.PlayerEvent.Error,n,!0),t.load(t.currentSource).then(function(){return n()})):t.isLive()?t.playerStateService.isPlaying()&&(t.eventHandler.on(p.PlayerEvent.Error,n,!0),t.load(t.currentSource)):(t.unload(),t.eventHandler.fireError(r(e)))},this.controlLiveLatency=function(){var e=t.liveLatencyService.getStatus(t.liveLatencyMode,t.getCommonBufferLevel());t.liveLatencyMode!==e.mode&&(t.context.eventHandler.dispatchEvent(p.PlayerEvent.LatencyModeChanged,{from:t.liveLatencyMode,to:e.mode}),t.liveLatencyMode=e.mode);var i=t.playerStateService.isSeeking()||t.playerStateService.isTimeShifting();e.mode===p.LatencyMode.Suspended||i||(e.requiredAction===t.lowLatencyModule.LiveLatencyControlAction.Seek?t.goToLiveEdge():e.requiredAction===t.lowLatencyModule.LiveLatencyControlAction.PlaybackRate&&t.playbackSpeedTracker.setPlaybackSpeed(e.actionParam,!0))},this.onPlaybackStarted=function(){t.playerStateService.stallExit(),t.playerStateService.transitionToPlayingState(t.lastPlayIssuer),t.ended=!1},this.onRendererStallStarted=function(){t.logger.insane("Video element stall started in state: "+t.playerStateService.playbackState),t.playerStateService.stallEnter(),t.playerStateService.isPlaying()&&(t.ignoreNextVideoElementPauseEvent=!0,t.renderer.pause())},this.onRendererStallEnded=function(e){e.wasPlaying&&t.renderer.play()["catch"](function(e){t.logger.insane("play failed with reason: "+e)}),t.playerStateService.stallExit()},this.finishPeriodSwitch=function(){(t.playerController&&t.playerController.hasStreamEnded()||t.isReady()&&!t.isPlaying())&&t.playerController.start()},this.onVideoElementPlay=function(){t.playerStateService.transitionToPlayState(!0,t.lastPlayIssuer),t.playerController&&t.playerController.onPlay()},this.onVideoElementPaused=function(){t.logger.insane("video element signaled pause in state: "+t.playerStateService.playbackState),t.ignoreNextVideoElementPauseEvent&&!t.playerStateService.hasPendingTransitionToPausedState()||(t.playerStateService.transitionToPausedState(!0,t.lastPauseIssuer),t.playerController&&t.playerController.onPaused()),t.ignoreNextVideoElementPauseEvent=!1},this.onTimeChanged=function(e){t.lastCurrentTimeUpdate=e.time,t.isLive()&&t.liveLatencyService&&t.liveLatencyService.isConfigured()&&t.controlLiveLatency()},this.mapLangObjectToAudioTrack=function(e){return{id:e.id,lang:e.lang,label:e.label,role:e.role,getQualities:function(){return x.MediaPlayerManifestApiFactory.getAudioQualities(t.manifestService,t.playerController.getPeriodId(),e.id)}}},this.onVideoElementSeeking=function(e){var i=o(t.context,e.time);if(t.settings.GLOBAL_DISABLE_SEEKING&&!i){var n=Math.abs(e.time-t.lastCurrentTimeUpdate),r=.05;n>r&&(t.logger.debug("Seeking now allowed, seeking back to expected time"),t.context.videoElement.currentTime=t.lastCurrentTimeUpdate)}},this.onVideoTimeupdate=function(e){var i=e.time;if("number"==typeof t.streamEndTime){if(i>=t.streamEndTime)return;t.streamEndTime=null}var n=0===t.renderer.getCurrentTime(!0);!t.isPlaying()||t.playerStateService.isSeeking()||t.isStalled()||n||t.context.eventHandler.dispatchEvent(p.PlayerEvent.TimeChanged,{time:t.getCurrentTime()})},this.onContentPlaybackFinished=function(){t.streamEndTime=t.lastCurrentTimeUpdate,t.ended=!0},this.onDvrWindowExceeded=function(){t.playerStateService.isPlaying()?t.timeShift(0):t.isDvrWindowExceeded=!0},this.onError=function(e){3001===e.code&&t.unload()},this.onInternalError=function(e){6e3===e.code&&t.load(t.currentSource)},this.fireAudioTracksAdded=function(){for(var e=t.getCurrentTime(),i=0,n=t.getAvailableAudio();i<n.length;i++){var r=n[i];t.context.eventHandler.dispatchEvent(p.PlayerEvent.AudioAdded,{track:r,time:e})}},this.fireAudioTracksRemoved=function(e){for(var i=0,n=t.getAvailableAudio();i<n.length;i++){var r=n[i];t.context.eventHandler.dispatchEvent(p.PlayerEvent.AudioRemoved,{track:r,time:e})}},this.onPeriodSwitch=function(){t.fireAudioTracksRemoved(t.getCurrentTime())},this.onPlaybackSpeedChanged=function(e){t.isLive()&&(t.canResumeLatencyControl()?t.resumeLatencyControl():t.suspendLatencyControl(!1))},this.context=e,this.logger=e.logger,this.config=e.config,this.settings=e.settings,this.renderer=e.renderer,this.eventHandler=e.eventHandler,this.loadState=s.Unloaded,this.playbackSpeedTracker=new w.PlaybackSpeedTracker(e),this.context.store.dispatch(y.initializeMetricsForMimeType("default",this.context.settings)),this.playerController=new D.MediaPlayerController(e,this.onPeriodSwitched,this.onSegmentAvailable),R.ModuleManager.has(C.ModuleName.LowLatency)&&(this.lowLatencyModule=R.ModuleManager.get(C.ModuleName.LowLatency)),this.eventHandler.on(p.PlayerEvent.PeriodSwitch,this.onPeriodSwitch),this.eventHandler.on(p.PlayerEvent.PeriodSwitched,this.fireAudioTracksAdded),this.eventHandler.on(p.PlayerEvent.PlaybackSpeedChanged,this.onPlaybackSpeedChanged),this.eventHandler.on(f.InternalEvent.RendererStalled,this.onRendererStallStarted,!0),this.eventHandler.on(f.InternalEvent.RendererUnstalled,this.onRendererStallEnded,!0),this.unsubscribeStorePlayingListener=P.subscribe(this.context.store)(function(e){return T.getIsPlaying(T.getPlayerState(e))},this.onPlaying,function(e,t){return e&&!t})}return e.prototype.createServices=function(e,t){var i=t.serviceManager;if(R.ModuleManager.has(C.ModuleName.DASH)){var n=R.ModuleManager.get(C.ModuleName.DASH);i.set(h.ServiceName.SynchronizedTimeService,new n.SynchronizedTimeService(t))}if(i.set(h.ServiceName.ManifestService,new L.ManifestService(t)),this.manifestService=i.get(h.ServiceName.ManifestService),i.set(h.ServiceName.ManifestLoadingService,A.createManifestLoadingService(e,t)),i.set(h.ServiceName.ManifestUpdateSchedulingService,new _.ManifestUpdateScheduler(t)),i.set(h.ServiceName.TimedMetadataService,new O.TimedMetadataService(t)),i.set(h.ServiceName.SegmentService,new B.SegmentService(t)),R.ModuleManager.has(C.ModuleName.Subtitles)){var r=R.ModuleManager.get(C.ModuleName.Subtitles).SubtitleService;i.set(h.ServiceName.SubtitleService,new r(t)),this.subtitleService=i.get(h.ServiceName.SubtitleService)}R.ModuleManager.has(C.ModuleName.LowLatency)&&(i.set(h.ServiceName.LiveLatencyService,new this.lowLatencyModule.LiveLatencyService(t)),this.liveLatencyService=i.get(h.ServiceName.LiveLatencyService))},e.prototype.disposeServices=function(){var e=this.context.serviceManager;[h.ServiceName.ManifestLoadingService,h.ServiceName.LiveLatencyService,h.ServiceName.SynchronizedTimeService,h.ServiceName.SubtitleService,h.ServiceName.ManifestUpdateSchedulingService,h.ServiceName.ManifestService,h.ServiceName.TimedMetadataService].forEach(function(t){return l.disposeService(e,t)})},e.prototype.calcRelativeCurrentTimeOffsetForLive=function(e){var t=null!=e.getSegmentInfo().wallClockTime?e.getPlaybackTime()-b.toSeconds(e.getSegmentInfo().wallClockTime):0;return this.playerController.getSeekableRange().start+t},e.prototype.play=function(e){return this.lastPlayIssuer=e,this.controlPermitted?this.currentSource?this.playerStateService.isPlaying()?(this.logger.debug("Ignoring play call as play was already triggered or we're already playing"),Promise.resolve()):(this.ended=!1,this.isLive()&&(this.isDvrWindowExceeded||this.getMaxTimeShift()>=0)&&(this.goToLiveEdge(),this.isDvrWindowExceeded=!1),this.playerController.start(),this.playerStateService.transitionToPendingPlayState(!0,e),this.renderer.play()):Promise.resolve():Promise.reject("Play control not permitted")},e.prototype.goToLiveEdge=function(){var e=this;this.settings.ENABLE_SEEK_FOR_LIVE?this.playerStateService.isSeeking()||this.playerController.seek(this.getSeekableRange().end,!0,null,!0):this.playerController.timeShift(0,function(){return e.onTimeShifted()})},e.prototype.canResumeLatencyControl=function(){return Boolean(this.liveLatencyService)&&!this.isPaused()&&0===this.getTimeShift()&&1===this.getPlaybackSpeed()&&!this.playerStateService.isTimeShifting()&&!this.playerStateService.isSeeking()},e.prototype.resumeLatencyControl=function(){this.liveLatencyService.resumeControl()},e.prototype.suspendLatencyControl=function(e){void 0===e&&(e=!0);var t=this.liveLatencyMode===p.LatencyMode.Suspended;this.liveLatencyService&&!t&&(this.liveLatencyService.suspendControl(),e&&this.playbackSpeedTracker.setPlaybackSpeed(1,!0))},e.prototype.getCommonBufferLevel=function(){var e=[this.getBufferLevel(m.BufferType.ForwardDuration,m.MediaType.Audio),this.getBufferLevel(m.BufferType.ForwardDuration,m.MediaType.Video)].map(function(e){return e.level}).filter(function(e){return null!==e});return 0===e.length?0:Math.min.apply(Math,e)},e.prototype.preload=function(){this.loadState!==s.Unloaded&&this.playerController&&this.playerController.start()},e.prototype.pause=function(e){this.controlPermitted&&(this.logger.insane("Pause was called via the API"),this.playerStateService.isInitial()||(this.lastPauseIssuer=e,this.isLive()&&this.liveLatencyService&&this.liveLatencyService.isConfigured()&&(this.suspendLatencyControl(),this.controlLiveLatency()),this.playerStateService.isPaused()||this.playerStateService.isStopped()||(this.renderer.pause(),this.playerController.onPaused()),this.playerStateService.transitionToPausedState(this.renderer.isPaused(),e)))},e.prototype.mute=function(e){this.isMuted()||(this.renderer.mute(),this.context.eventHandler.dispatchEvent(p.PlayerEvent.Muted,{issuer:e||"api"}))},e.prototype.unmute=function(e){this.isMuted()&&(this.renderer.unmute(),this.context.eventHandler.dispatchEvent(p.PlayerEvent.Unmuted,{issuer:e||"api"}))},e.prototype.seek=function(e,t){var i=this,n=this.config&&this.config.hasOwnProperty("playback"),r=n?this.config.playback:{},o=r.hasOwnProperty("seeking"),a=!o||r.seeking,s=this.isInitialSeek||!this.settings.GLOBAL_DISABLE_SEEKING&&a;if(!s||!this.controlPermitted)return!1;this.ended=!1,this.playerStateService.transitionToSeekingState(e,t,t!==g.STARTUP_ISSUER_NAME);var d=t===g.STARTUP_ISSUER_NAME;return this.playerController.seek(e,d,function(){return i.onSeeked(t)},d),!0},e.prototype.onSeeked=function(e){this.playerStateService.transitionToSeekedState(e!==g.STARTUP_ISSUER_NAME),this.isInitialSeek=!1},e.prototype.setVolume=function(e,t){var i=this.renderer.getVolume();this.renderer.setVolume(e),i!==e&&this.context.eventHandler.dispatchEvent(p.PlayerEvent.VolumeChanged,{targetVolume:e,sourceVolume:i,issuer:t||"api"})},e.prototype.setAudioQuality=function(e){var t,i=this.getAvailableAudioQualities(),n=this.getAudioQuality();t="auto"===e?{id:"auto",bitrate:null}:i.find(function(t){return t.id===e}),t&&n.id!==t.id&&(this.context.eventHandler.dispatchEvent(p.PlayerEvent.AudioQualityChanged,{sourceQuality:n,sourceQualityId:n.id,targetQuality:t,targetQualityId:t.id}),this.playerController.setAudioRepresentation(e))},e.prototype.getAudioQuality=function(){var e=this.getMimeTypeFromMediaType("audio"),t=this.playerController.isRepresentationAutoSelected(e),i=this.playerController.getCurrentAudioRepresentation();return t||null===i?{id:"auto",bitrate:null}:this.getAvailableAudioQualities().find(function(e){return e.id===i.representationId})},e.prototype.setVideoQuality=function(e){var t,i=this.getAvailableVideoQualities(),n=this.getVideoQuality();t="auto"===e?{id:"auto",bitrate:null,width:null,height:null}:i.find(function(t){return t.id===e}),t&&n.id!==t.id&&(this.context.eventHandler.dispatchEvent(p.PlayerEvent.VideoQualityChanged,{sourceQuality:n,sourceQualityId:n.id,targetQuality:t,targetQualityId:t.id}),this.playerController.setVideoRepresentation(e))},e.prototype.getVideoQuality=function(){var e=this.getMimeTypeFromMediaType("video"),t=this.playerController.isRepresentationAutoSelected(e),i=this.playerController.getCurrentVideoRepresentation();return t||null===i?{id:"auto",bitrate:null,width:null,height:null}:this.getAvailableVideoQualities().find(function(e){return e.id===i.representationId})},e.prototype.processSourceContext=function(){var e=this.context.sourceContext;e.source&&e.source.options&&e.source.options.headers&&(this.settings.HTTP_HEADERS=e.source.options.headers)},e.prototype.load=function(e,t,i){var n=this;if("dash"!==e.type&&"hls"!==e.type&&"smooth"!==e.type)return Promise.reject("invalid source");var r=this.getSourceStoreService();if(e.type===m.StreamType.Hls&&R.ModuleManager.has(C.ModuleName.HLS)&&!r.hasReducer("hls")){var o=R.ModuleManager.get(C.ModuleName.HLS);r.addReducer("hls",o.HlsReducer)}Object.keys(N.engineBitmovinSourceReducers).forEach(function(e){r.addReducer(e,N.engineBitmovinSourceReducers[e])}),this.playerStateService=this.context.serviceManager.get(h.ServiceName.PlayerStateService),
this.processSourceContext();var a=function(){n.createServices(e,n.context),n.context.sourceContext.source=e.config,n.context.videoElement.eventHandler&&n.context.videoElement.eventHandler.reset(),n.currentSource=e,n.ended=!1,n.isDvrWindowExceeded=!1,n.isInitialSeek=!0,n.streamEndTime=null,n.logger.debug("setting bitrate boundaries for audio to "+n.settings.MIN_SELECTABLE_AUDIO_BITRATE+" - "+n.settings.MAX_SELECTABLE_AUDIO_BITRATE),n.logger.debug("setting bitrate boundaries for video to "+n.settings.MIN_SELECTABLE_VIDEO_BITRATE+" - "+n.settings.MAX_SELECTABLE_VIDEO_BITRATE),n.liveLatencyService&&(n.liveLatencyMode=p.LatencyMode.Suspended,n.liveLatencyService.reset()),n.renderer.on(E.MediaElementEvent.error,n.videoErrorHandler),n.renderer.on(E.MediaElementEvent.timeupdate,n.onVideoTimeupdate),n.renderer.on(E.MediaElementEvent.seeking,n.onVideoElementSeeking),n.renderer.on(E.MediaElementEvent.playing,n.onPlaybackStarted),n.renderer.on(E.MediaElementEvent.play,n.onVideoElementPlay),n.renderer.on(E.MediaElementEvent.pause,n.onVideoElementPaused),i?n.settings.GLOBAL_DISABLE_SEEKING=i:n.settings.GLOBAL_DISABLE_SEEKING=!1,n.loadState=s.Loading;var t=n.playerController.init(e);return t.then(function(){n.loadState=s.Loaded})},d=Promise.resolve();return this.loadState===s.Loading&&(d=this.unload()),this.playerStateService.reset(),this.unsubscribeFromStoreStoppedListener=P.subscribe(this.context.store)(function(e){return T.getIsStopped(T.getPlayerState(e))},this.onContentPlaybackFinished,function(e){return e===!0}),this.eventHandler.on(p.PlayerEvent.DVRWindowExceeded,this.onDvrWindowExceeded,!0),this.eventHandler.on(p.PlayerEvent.Error,this.onError,!0),this.eventHandler.on(p.PlayerEvent.TimeChanged,this.onTimeChanged,!0),this.eventHandler.on(f.InternalEvent.InternalError,this.onInternalError,!0),d.then(function(){return n.renderer.ready()}).then(a)},e.prototype.getSourceStoreService=function(){return this.context.serviceManager.get(h.ServiceName.SourceStoreService,this.context.sourceContext.sourceIdentifier)},e.prototype.unload=function(e){var t=this;if(this.loadState===s.Unloaded)return Promise.resolve();var i=this.loadState===s.Loaded;this.ended=!1,this.loadState=s.Unloaded,this.ignoreNextVideoError=!0,this.relativeCurrentTimeOffset=null,this.renderer.off(E.MediaElementEvent.error,this.videoErrorHandler),this.renderer.off(E.MediaElementEvent.timeupdate,this.onVideoTimeupdate),this.renderer.off(E.MediaElementEvent.seeking,this.onVideoElementSeeking),this.renderer.off(E.MediaElementEvent.playing,this.onPlaybackStarted),this.renderer.off(E.MediaElementEvent.play,this.onVideoElementPlay),this.renderer.off(E.MediaElementEvent.pause,this.onVideoElementPaused),this.unsubscribeFromStoreStoppedListener(),this.eventHandler.off(p.PlayerEvent.TimeChanged,this.onTimeChanged),this.eventHandler.off(p.PlayerEvent.DVRWindowExceeded,this.onDvrWindowExceeded),this.eventHandler.off(p.PlayerEvent.Error,this.onError),this.eventHandler.off(f.InternalEvent.InternalError,this.onInternalError),this.playerStateService.isPlaying()&&this.renderer.pause(),this.playerStateService.reset(),this.context.serviceManager.get(h.ServiceName.SynchronizedTimeService)&&this.context.serviceManager.get(h.ServiceName.SynchronizedTimeService).reset();var n=this.playerController?this.playerController.terminate():Promise.resolve();return n.then(function(){t.currentSource=void 0,t.disposeServices(),t.getSourceStoreService().dispatch(H.clearActiveTracksAction()),i&&t.eventHandler.dispatchEvent(p.PlayerEvent.SourceUnloaded)})},e.prototype.isReady=function(){return this.playerController.isInitialized()},e.prototype.isPlaying=function(){return this.playerStateService.isPlaying()},e.prototype.isPaused=function(){return this.playerStateService.isPaused()},e.prototype.hasEnded=function(){return this.ended},e.prototype.isMuted=function(){return this.renderer.isMuted()},e.prototype.isStalled=function(){return this.playerStateService.isStalled},e.prototype.isLive=function(){return this.manifestService.isLive()},e.prototype.getVolume=function(){return this.renderer.getVolume()},e.prototype.getCurrentTime=function(e){return void 0===e&&(e=m.TimeMode.AbsoluteTime),!this.isLive()&&this.hasEnded()?this.getDuration():e===m.TimeMode.RelativeTime?Math.max(0,this.playerController.getCurrentTime()-this.relativeCurrentTimeOffset):this.playerController.getCurrentTime()},e.prototype.getDuration=function(){return this.manifestService.getDuration()},e.prototype.getAvailableVideoQualities=function(){return this.isReady()?this.manifestService.getVideoRepresentations(this.playerController.getPeriodId()):[]},e.prototype.getAvailableSegments=function(){return this.isReady()?this.playerController.getAvailableSegments():{}},e.prototype.getAvailableAudioQualities=function(){var e=this.getAudio();if(!this.isReady()||!e)return[];var t=this.manifestService.getAudioRepresentations(this.playerController.getPeriodId());return t[e.id]?t[e.id]:[]},e.prototype.getDroppedVideoFrames=function(){return this.renderer.getDroppedVideoFrames()},e.prototype.setTargetBufferLevel=function(e,t,i){this.context.bufferSettings.setTargetLevel(e,t,i)},e.prototype.getBufferLevel=function(e,t){var i=this.context.bufferSettings.getTargetLevel(e,t),n={level:null,targetLevel:i,type:e,media:t},r=this.renderer.getCurrentTime(),o=S.getMetricsState(this.context.store.getState()),a=Object.keys(o).find(function(e){return M.MimeTypeHelper.isVideo(e)}),s=Object.keys(o).find(function(e){return M.MimeTypeHelper.isAudio(e)});return t===m.MediaType.Video&&a?n.level=this.playerController.getBufferLevel(a,r,e):t===m.MediaType.Audio&&s&&(n.level=this.playerController.getBufferLevel(s,r,e)),n},e.prototype.getTotalStalledTime=function(){var e=S.getMetricsState(this.context.store.getState());for(var t in e)if(e[t]){var i=S.getMetricsLastEntry(e,t,v.MetricType.StalledSeconds);if(i&&i.value&&!isNaN(i.value))return Math.round(100*i.value)/100}return 0},e.prototype.getMimeTypeFromMediaType=function(e){var t=S.getMetricsState(this.context.store.getState());for(var i in t)if(t[i]&&i.indexOf(e)>-1)return i;return null},e.prototype.getDownloadedData=function(e){var t=this.getMimeTypeFromMediaType(e),i=a({},this.getCurrentAdaptationSet(t)),n=a({},this.getCurrentRepresentation(t));return n.id&&(n.id=""+n.id),void 0===n.width&&void 0!==i.width&&(n.width=i.width),n.width=parseInt(""+n.width),void 0===n.height&&void 0!==i.height&&(n.height=i.height),n.height=parseInt(""+n.height),void 0===n.bitrate&&void 0!==i.bitrate&&(n.bitrate=i.bitrate),n.bitrate=parseInt(""+n.bitrate),n.isAuto=this.playerController.isRepresentationAutoSelected(t),n},e.prototype.getCurrentRepresentation=function(e){if(this.playerController.hasStarted()){var t=S.getMetricsState(this.context.store.getState());if(t[e]){var i=S.getMetricsLastEntry(t,e,v.MetricType.DownloadedRepresentation);return i.value}}return{}},e.prototype.getCurrentAdaptationSet=function(e){if(this.playerController.hasStarted()){var t=S.getMetricsState(this.context.store.getState());if(t[e]){var i=S.getMetricsLastEntry(t,e,v.MetricType.DownloadedAdaptationSet);return i.value}}return{}},e.prototype.getDownloadedVideoData=function(){var e=this.getDownloadedData("video"),t=!0;return e.hasOwnProperty("isAuto")&&(t=e.isAuto),e&&(e.bitrate||e.id)?{id:e.id,bitrate:e.bitrate,height:e.height,width:e.width,isAuto:t}:{id:"",bitrate:0,height:0,width:0,isAuto:!0}},e.prototype.getDownloadedAudioData=function(){var e=this.getDownloadedData("audio"),t=!0;return e.hasOwnProperty("isAuto")&&(t=e.isAuto),e&&(e.bitrate||e.id)?{id:e.id,bitrate:e.bitrate,isAuto:t}:{id:"",bitrate:0,isAuto:!0}},e.prototype.getPlaybackVideoData=function(){var e,t,i=this.playerController.getPlaybackRepresentation("video");i&&(i._bandwidth||i._id)||(i={_id:"",_bandwidth:0}),e=i.hasOwnProperty("_height")&&!isNaN(i._height)?parseInt(i._height):i.videoHeight||0,t=i.hasOwnProperty("_width")&&!isNaN(i._width)?parseInt(i._width):i.videoWidth||0;var n={id:i._id+"",bitrate:parseInt(i._bandwidth),height:e,width:t,uid:i.uid};return i.hasOwnProperty("_codecs")&&(n.codec=I.CodecStringHelper.extractCodecStrings(i._codecs).video),n},e.prototype.getPlaybackAudioData=function(){var e=this.playerController.getPlaybackRepresentation("audio");e&&(e._bandwidth||e._id)||(e={_id:"",_bandwidth:0});var t={id:e._id+"",bitrate:Number(e._bandwidth)};return e.hasOwnProperty("_codecs")&&(t.codec=I.CodecStringHelper.extractCodecStrings(e._codecs).audio),t},e.prototype.setQueryParameters=function(e){this.settings.QUERY_PARAMETERS=e},e.prototype.clearQueryParameters=function(){this.settings.QUERY_PARAMETERS=void 0},e.prototype.onTimeShifted=function(e){this.playerStateService.isTimeShifting()&&(this.playerStateService.transitionToTimeShiftedState(e!==g.STARTUP_ISSUER_NAME),this.timeShiftEstimatedLiveEdge=-1,this.timeShiftJumpStart=-1),this.isLive()&&(this.canResumeLatencyControl()?this.resumeLatencyControl():this.suspendLatencyControl())},e.prototype.getMaxTimeShift=function(){if(this.isLive()&&this.isReady()){var e=this.config.playback&&this.config.playback.timeShift===!1;return e?0:this.playerController.getMaxTimeShift()}},e.prototype.timeShift=function(e,t){var i=this;this.isReady()&&this.getMaxTimeShift()<=0&&(this.playerController.timeShift(e,function(){return i.onTimeShifted(t)}),this.timeShiftJumpStart===-1&&(this.timeShiftJumpStart=this.getCurrentTime(),0===this.timeShiftJumpStart&&(this.timeShiftJumpStart=this.playerController.getTimeShiftLiveEdge())),this.timeShiftEstimatedLiveEdge===-1&&(this.timeShiftEstimatedLiveEdge=this.playerController.getTimeShiftLiveEdge()),this.playerStateService.transitionToTimeShiftingState(this.timeShiftJumpStart,this.timeShiftEstimatedLiveEdge+e,t||"api",t!==g.STARTUP_ISSUER_NAME))},e.prototype.getTimeShift=function(){return this.isReady()?this.playerController.getTimeShift():0},e.prototype.addSubtitle=function(e){var t=this;return this.isReady()&&this.subtitleService?Promise.resolve(void 0).then(function(){t.subtitleService.addExternalSubtitle(e)}):Promise.reject(void 0)},e.prototype.removeSubtitle=function(e){this.isReady()&&this.subtitleService&&this.subtitleService.removeSubtitle(e)},e.prototype.enableSubtitle=function(e){return this.isReady()&&this.subtitleService?this.subtitleService.enableSubtitle(e):Promise.resolve(!1)},e.prototype.disableSubtitle=function(e){return this.isReady()&&this.subtitleService?this.subtitleService.disableSubtitle(e):Promise.resolve(!1)},e.prototype.listSubtitles=function(){return this.isReady()&&this.subtitleService&&this.playerController?this.subtitleService.getAvailableSubtitles(this.playerController.getPeriodId()):[]},e.prototype.setAudio=function(e){var t=this;if(this.isReady()&&this.playerController&&"string"==typeof e){var i=this.getAudio();if(i&&i.id===String(e))return;this.playerController.setAudio(e).then(function(){var e=t.getAudio();e.id!==i.id&&t.context.eventHandler.dispatchEvent(p.PlayerEvent.AudioChanged,{targetAudio:e,sourceAudio:i,time:t.renderer.getCurrentTime()})})["catch"](function(e){t.logger.debug("setAudio failed for lang ",e)})}},e.prototype.getAvailableAudio=function(){return this.isReady()&&this.playerController?this.playerController.getAvailableAudio(this.playerController.getPeriodId()).map(this.mapLangObjectToAudioTrack):[]},e.prototype.getAudio=function(){if(this.isReady()&&this.playerController){var e=this.playerController.getAudio();if(e)return this.mapLangObjectToAudioTrack(e)}return null},e.prototype.getManifest=function(){var e=this.manifestService.getManifest();if(e)return e._isHls?this.getHlsManifest():e.originalDashManifest},e.prototype.getHlsManifest=function(){return R.ModuleManager.get(C.ModuleName.HLS).selectors.getHlsState(this.getSourceStoreService().getState()).masterPlaylist.string},e.prototype.getBufferedRanges=function(){var e=this.playerController.getBufferedRanges(!0),t=d.BufferRangeHelper.getCommonBufferedRanges(e);return t.map(function(e){return{start:e.getStart(),end:e.getEnd()}})},e.prototype.getSnapshot=function(e,t){if(this.isPlaying()||this.isPaused())return this.renderer.getSnapshotData(e,t)},e.prototype.setPlaybackSpeed=function(e){this.playbackSpeedTracker.setPlaybackSpeed(e)},e.prototype.getPlaybackSpeed=function(){return this.playbackSpeedTracker.getPlaybackSpeed()},e.prototype.permitControl=function(e){this.controlPermitted=e},e.prototype.setLogLevel=function(e){this.logger.setLogLevel(e)},e.prototype.getSeekableRange=function(){return this.isLive()&&!this.settings.ENABLE_SEEK_FOR_LIVE||!this.playerController?{start:-1,end:-1}:this.playerController.getSeekableRange()},e.prototype.createManifestApi=function(){return x.MediaPlayerManifestApiFactory.create(this,this.context)},e.prototype.getLatency=function(){return this.liveLatencyService.getLatency()},e.prototype.setTargetLatency=function(e){var t=Math.abs(this.manifestService.getTimeShiftBufferDepthSeconds());e>t&&(e=t,this.logger.debug("Tried to set target latency outside DVR window, corrected to lower bound",t)),this.context.eventHandler.dispatchEvent(p.PlayerEvent.TargetLatencyChanged,{from:this.liveLatencyService.getTargetLatency(),to:e}),this.liveLatencyService.setTargetLatency(e)},e.prototype.getTargetLatency=function(){return this.liveLatencyService.getTargetLatency()},e.prototype.setCatchupConfig=function(e){this.liveLatencyService.setCatchupConfig(e)},e.prototype.getCatchupConfig=function(){return this.liveLatencyService.getCatchupConfig()},e.prototype.setFallbackConfig=function(e){this.liveLatencyService.setFallbackConfig(e)},e.prototype.getFallbackConfig=function(){return this.liveLatencyService.getFallbackConfig()},e.prototype.release=function(){var e=this;return this.eventHandler.off(p.PlayerEvent.PeriodSwitch,this.onPeriodSwitch),this.eventHandler.off(p.PlayerEvent.PeriodSwitched,this.fireAudioTracksAdded),this.eventHandler.off(p.PlayerEvent.PlaybackSpeedChanged,this.onPlaybackSpeedChanged),this.eventHandler.off(f.InternalEvent.RendererStalled,this.onRendererStallStarted),this.eventHandler.off(f.InternalEvent.RendererUnstalled,this.onRendererStallEnded),this.playbackSpeedTracker.dispose(),this.unsubscribeStorePlayingListener(),this.unload().then(function(){return e.playerStateService=null,e.playerController.dispose(),e.playerController=null,e.disposeServices(),e.renderer.release().then(function(){return e.renderer=null})})},e.prototype.updateCallback=function(e){},e.prototype.onFullscreenEnter=function(){},e.prototype.onFullscreenExit=function(){},e.prototype.isAirplayAvailable=function(){return!1},e.prototype.isAirplayActive=function(){return!1},e.prototype.showAirplayTargetPicker=function(){},e}();t.MediaPlayer=F,t.checkIfGapSkip=o},232:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2),r=i(0),o=function(){function e(){}return e.prototype.getSupportedTechnologies=function(){var e=n.ModuleManager.has(r.ModuleName.RendererFlash)?n.ModuleManager.get(r.ModuleName.RendererFlash).technologyChecker.getSupportedTechnologies():[],t=n.ModuleManager.has(r.ModuleName.RendererMse)?n.ModuleManager.get(r.ModuleName.RendererMse).technologyChecker.getSupportedTechnologies():[];return[].concat(e,t)},e}();t.TechnologyChecker=o},233:function(e,t,i){"use strict";function n(e,t){t[e]||(t[e]={})}function r(e){return e>=Date.now()}Object.defineProperty(t,"__esModule",{value:!0});var o=i(11),a=function(){function e(){this.cache={}}return e.prototype.set=function(e,t,i){var r=o.URLHelper.toFullUrl(e);n(r,this.cache),this.cache[r][t]=i},e.prototype.setExpire=function(e,t){var i=o.URLHelper.toFullUrl(e);n(i,this.cache),this.cache[i].expire=t},e.prototype.get=function(e,t){var i=o.URLHelper.toFullUrl(t),n=this.cache[i];return n&&r(n.expire)?n[e]:void delete this.cache[i]},e.prototype.cacheHttpResponse=function(e,t,i){void 0===i&&(i=1/0),this.set(t,"httpResponse",e),this.setExpire(t,i)},e.prototype.cacheParsedManifest=function(e,t,i){void 0===i&&(i=1/0),this.set(t,"parsedManifest",e),this.setExpire(t,i)},e.prototype.cacheSegmentList=function(e,t,i){void 0===i&&(i=1/0),this.set(t,"segmentList",e),this.setExpire(t,i)},e.prototype.getHttpResponse=function(e){return this.get("httpResponse",e)},e.prototype.getParsedManifest=function(e){return this.get("parsedManifest",e)},e.prototype.getSegmentList=function(e){return this.get("segmentList",e)},e.prototype.clear=function(){this.cache={}},e.prototype.dispose=function(){this.cache=null},e}();t.ManifestCachingService=a},234:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(5),r=i(1),o=i(24),a=i(23),s=i(75),d=function(){function e(){var e=this;this.startOptimization=function(){e.context&&e.context.eventHandler.off(r.PlayerEvent.AdStarted,e.startOptimization),e.prefetchContentSegments(e.segmentInfosToPrefetch),e.segmentInfosToPrefetch=[]}}return e.prototype.updatePlayerContext=function(e){this.mimeTypes=[],this.context=e,this.segmentInfoService=e.segmentInfoService,this.segmentPrefetchingService=e.segmentPrefetchingService},e.prototype.optimizeRestorationAfterUpcomingAdBreak=function(e){var t=this;return this.segmentInfoService.getSegmentInfos(e,this.context.settings.AD_RESTORATION_SEGMENT_PREFETCHING_DURATION).then(function(e){t.addCodecInfo(e),t.segmentInfosToPrefetch=e,t.context&&t.context.eventHandler&&t.context.eventHandler.on(r.PlayerEvent.AdStarted,t.startOptimization)})},e.prototype.addCodecInfo=function(e){var t=this.context&&this.context.serviceManager;if(t&&this.context.serviceManager.get(n.ServiceName.ManifestService)){var i=this.context.serviceManager.get(n.ServiceName.ManifestService);e.forEach(function(e){var t=i.getAdaptationSet(e.internalRepresentationId);t&&(e.codec=s.getCodecsFromAdaptationSet(t))})}},e.prototype.prefetchContentSegments=function(e){this.mimeTypes=e.reduce(function(e,t){return e.includes(t.mimeType)||e.push(t.mimeType),e},[]),this.maybeCreateMetrics(),this.segmentPrefetchingService.fetchAll(e)},e.prototype.findMatchingSegmentInfo=function(e,t){var i=this.segmentPrefetchingService.getPrefetchedSegments().get(e);return i?i.values.map(function(e){return e.segmentInfo}).find(function(e){if(!Boolean(t))return!0;var i=t.segmentNumber+1,n=Math.round(t.startTime+t.duration),r=e.segmentNumber===i,o=Math.round(e.startTime)===n;return r||o}):null},e.prototype.hasPrefetchedSegment=function(e,t){return!this.context.sourceContext.isAd&&("string"==typeof e&&(e=this.findMatchingSegmentInfo(e,t)),!!e&&Boolean(this.segmentPrefetchingService.getPrefetchedSegment(e)))},e.prototype.getPrefetchedSegment=function(e,t){var i=this,n=this.segmentPrefetchingService.getPrefetchedSegment(e);return this.segmentPrefetchingService.clearPrefetchingQueue(e.mimeType),n&&(this.segmentPrefetchingService.removePrefetchedSegment(e),this.segmentPrefetchingService.setShouldDownloadBeCancelledCallback(e.mimeType,t),n["finally"](function(){i.segmentPrefetchingService&&i.segmentPrefetchingService.removeShouldDownloadBeCancelledCallback(e.mimeType)})),n},e.prototype.getRepresentationForPrefetchedSegment=function(e){var t=this.segmentPrefetchingService.getPrefetchedSegments().get(e);return t?t.values.map(function(e){return e.segmentInfo.internalRepresentationId}).find(Boolean)||null:null},e.prototype.maybeCreateMetrics=function(){var e=this;if(0!==this.mimeTypes.length&&this.context){var t=a.getMetricsState(this.context.store.getState());this.mimeTypes.forEach(function(i){t[i]||e.context.store.dispatch(o.initializeMetricsForMimeType(i,e.context.settings))})}},e.prototype.dispose=function(){this.context&&this.context.eventHandler.off(r.PlayerEvent.AdStarted,this.startOptimization),this.segmentInfosToPrefetch=[],this.context=null,this.segmentInfoService=null,this.segmentPrefetchingService=null},e}();t.AdRestorationOptimizationService=d},235:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=i(34),o=i(99),a=i(12),s=i(10),d=i(65);!function(e){e.User="user",e.Timeout="timeout"}(n||(n={}));var u=function(){function e(e,t,i){var n=this;this.setProgressListener=function(e){n.progressListener=e},this.onProgress=function(e,t){n.progressListener&&(n.timing.progressTimestamp=o.TimingUtil.getHiResTimestamp(),n.progressListener({totalBytes:e,loadedBytes:t,responseTiming:n.timing}))},this.onSuccess=function(){clearTimeout(n.cancelTimeout)},this.logger=e.logger,this.timeout=i,this.request=t,this.fetching=new s.Deferred,this.bytesReceivedCount=0,this.timing={},this.abortController=new AbortController}return e.prototype.getResponse=function(){return this.load(this.request),this.fetching.promise},e.prototype.cancel=function(e){void 0===e&&(e=n.User),clearTimeout(this.cancelTimeout),this.cancellationReason=e,this.abortController.abort()},e.prototype.load=function(e){var t=this,i={method:e.method,headers:new Headers(e.headers),credentials:e.credentials,signal:this.abortController?this.abortController.signal:void 0};fetch(e.url,i).then(function(e){if(t.timing.headersReceivedTimestamp=o.TimingUtil.getHiResTimestamp(),!e.ok)return void t.onError({error:r.RequestError.Failed,response:t.createHttpResponse(e)});var i=t.createHttpResponse(e);i.body=t.readResponse(e),t.fetching.resolve(i)})["catch"](function(e){t.onError({error:t.getRequestError(e),response:null})}),this.timing.openedTimestamp=o.TimingUtil.getHiResTimestamp(),this.cancelTimeout=setTimeout(function(){return t.cancel(n.Timeout)},this.timeout)},e.prototype.getResponseHeaders=function(e){var t={};return e.headers.forEach(function(e,i){return t[i]=e}),t},e.prototype.createHttpResponse=function(e){return{request:this.request,url:e.url,headers:this.getResponseHeaders(e),status:e.status,statusText:e.statusText}},e.prototype.getRequestError=function(e){return e instanceof DOMException&&e.code===e.ABORT_ERR?this.cancellationReason===n.User?r.RequestError.Canceled:r.RequestError.TimedOut:r.RequestError.Failed},e.prototype.readResponse=function(e){var t=this,i=new d.Stream(this.request.responseType);if(e.body){var n=e.body.getReader(),r=function(){return n.read().then(function(e){var n=e.done,a=e.value;if(n)return t.timing.doneTimestamp=o.TimingUtil.getHiResTimestamp(),void t.onProgress(t.bytesReceivedCount,0);t.bytesReceivedCount+=a.length,t.onProgress(t.bytesReceivedCount,a.length);var s;return s=a instanceof Uint8Array?a.buffer:a,i.add(s),r()})};r().then(function(){i.end(),t.onSuccess()})["catch"](function(e){t.logger.debug("Error reading ReadableStream of fetch request:",e),i.abort(t.getRequestError(e))})}else this.request.responseType===a.HttpResponseType.ARRAYBUFFER&&e.arrayBuffer().then(function(e){i.add(e),i.end(),t.onSuccess()});return i},e.prototype.onError=function(e){clearTimeout(this.cancelTimeout),this.logger.debug("Error performing fetch:",e.error),this.fetching.reject(e)},e}();t.FetchController=u},236:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(22),r=i(130),o=i(444),a=function(){function e(){this.segmentPrefetcher=new o.SegmentPrefetcher(this),this.prefetchedSegments=new n.ObjectMap}return e.prototype.updatePlayerContext=function(e){this.context=e,this.segmentPrefetcher.updateContext(this.context)},e.prototype.setDecrypter=function(e,t){this.segmentPrefetcher.setDecrypter(e,t)},e.prototype.removeDecrypter=function(e){this.segmentPrefetcher.removeDecrypter(e)},e.prototype.getDecrypter=function(e){return this.segmentPrefetcher.getDecrypter(e)},e.prototype.hasMp4Decrypter=function(e){return Boolean(this.getDecrypter(e))},e.prototype.setShouldDownloadBeCancelledCallback=function(e,t){this.segmentPrefetcher.setShouldDownloadBeCancelledCallback(e,t)},e.prototype.removeShouldDownloadBeCancelledCallback=function(e){this.segmentPrefetcher.removeShouldDownloadBeCancelledCallback(e)},e.prototype.fetch=function(e){var t=this;return this.segmentPrefetcher.prefetchSegment(e).then(function(){var i=t.prefetchedSegments.get(e.mimeType).get(r.getSegmentInfoId(e));return i?Promise.resolve(i.loadingPromise):Promise.reject()})},e.prototype.fetchAll=function(e){this.segmentPrefetcher.prefetchSegments(e)},e.prototype.onPrefetch=function(e){var t=e.segmentInfo.mimeType;this.prefetchedSegments.has(t)||this.prefetchedSegments.set(t,new n.ObjectMap),this.prefetchedSegments.get(t).set(r.getSegmentInfoId(e.segmentInfo),e)},e.prototype.hasPrefetchedSegment=function(e){return Boolean(this.findPrefetchedSegment(e))},e.prototype.getPrefetchedSegment=function(e){var t=this.findPrefetchedSegment(e);return t?t.loadingPromise:null},e.prototype.findPrefetchedSegment=function(e){return this.prefetchedSegments.has(e.mimeType)?this.prefetchedSegments.get(e.mimeType).get(r.getSegmentInfoId(e))||null:null},e.prototype.getPrefetchedSegments=function(){return this.prefetchedSegments},e.prototype.removePrefetchedSegment=function(e){this.prefetchedSegments.has(e.mimeType)&&this.prefetchedSegments.get(e.mimeType)["delete"](r.getSegmentInfoId(e))},e.prototype.clearPrefetchingQueue=function(e){this.segmentPrefetcher.clearPrefetchingQueue(e)},e.prototype.reset=function(){this.segmentPrefetcher.reset(),this.prefetchedSegments.clear()},e.prototype.dispose=function(){this.reset(),this.segmentPrefetcher.dispose(),this.segmentPrefetcher=null,this.prefetchedSegments=null},e}();t.SegmentPrefetchingService=a},40:function(e,t,i){"use strict";function n(e){return m.createAction(y.ManifestActionType.SetManifest,{manifest:e})}function r(e){return m.createAction(y.ManifestActionType.RemoveRepresentations,{representationIds:e})}function o(e){return m.createAction(y.ManifestActionType.UpdateManifest,e)}function a(e){return m.createAction(y.ManifestActionType.UpdateRepresentation,e)}function s(e,t){return m.createAction(y.ManifestActionType.UpdatePeriodTiming,{periodId:e,timing:t})}function d(e){return m.createAction(y.ManifestActionType.AdjustPeriodStartTimes,{offset:e})}function u(e,t){return m.createAction(y.ManifestActionType.SetRepresentationDrmKid,{representationId:e,associatedKid:t})}function c(e,t){return m.createAction(y.ManifestActionType.MarkSegmentAsDownloaded,{adaptationSetId:e,segment:t})}function l(e){return m.createAction(y.ManifestActionType.SetRepresentationFailedDownload,{representationId:e})}function h(e,t){return m.createAction(y.ManifestActionType.SetRepresentationSegmentIndex,{representationId:e,segmentIndex:t})}function p(e,t){return m.createAction(y.ManifestActionType.SetRepresentationIsLoading,{representationId:e,isLoading:t})}function f(e,t){return m.createAction(y.ManifestActionType.SetRepresentationSegmentIndexParsingError,{representationId:e,segmentIndexParsingError:t})}function g(e,t){return m.createAction(y.ManifestActionType.SetRepresentationAnchorPoint,{representationId:e,anchorPoint:t})}Object.defineProperty(t,"__esModule",{value:!0});var m=i(25),y=i(184);t.setManifestAction=n,t.removeRepresentationsAction=r,t.updateManifestAction=o,t.updateRepresentationAction=a,t.updatePeriodTimingAction=s,t.adjustPeriodStartTimes=d,t.setRepresentationDrmKidAction=u,t.markSegmentAsDownloadedAction=c,t.setRepresentationFailedDownloadAction=l,t.setRepresentationSegmentIndexAction=h,t.setRepresentationIsLoadingAction=p,t.setRepresentationSegmentIndexParsingErrorAction=f,t.setRepresentationAnchorPointAction=g},420:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e[e.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK",e[e.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE",e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=4]="MEDIA_ERR_SRC_NOT_SUPPORTED"}(n=t.MediaErrorCode||(t.MediaErrorCode={}));var r;!function(e){e[e.MEDIA_ERR_DECODE=1301]="MEDIA_ERR_DECODE",e[e.MEDIA_ERR_NETWORK=1400]="MEDIA_ERR_NETWORK",e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=1204]="MEDIA_ERR_SRC_NOT_SUPPORTED"}(r=t.ErrorCodeMap||(t.ErrorCodeMap={}))},421:function(e,t,i){"use strict";function n(e,t){return Object.keys(e).some(function(e){return m.MimeTypeHelper.isVideo(e)})&&m.MimeTypeHelper.isVideo(t)}function r(e,t){return void 0!==t&&!e.hasOwnProperty(t)&&!n(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var o=i(5),a=i(1),s=i(15),d=i(8),u=i(35),c=i(24),l=i(23),h=i(17),p=i(47),f=i(30),g=i(10),m=i(7),y=i(3),S=i(14),v=i(2),T=i(0),P=i(426),I=i(75),M=i(49),b=i(129),E=i(66),R=i(454),C=i(424),A=250,L=function(){function e(e,t,i){var n=this;this.onSegmentAvailable=function(e){if(!n.clearBuffersPromise){var t=p.getStartTimeOffset(n.getSourceStore().getState()),i=t+n.manifestService.getDuration(),r=n.context.sourceContext.technology.streaming===d.StreamType.Hls,o=e.getMimeType();if(!m.MimeTypeHelper.isSubtitle(o)&&!r&&(n.eosSignaled||n.isVod()&&e.getPlaybackTime()>=i))return void n.logger.debug("Drop segment ["+e.getUrl()+"] after EOS signaled");if(!e.isInit()){n.bufferController.areMediaTypesFinal(e.getPeriodId())||n.tryToFinalizeMediaTypes(e);var a=n.segmentControllerMap[o],s=a?a.getMPDHandler().getTimestampOffset():0;n.bufferController.updateMediaType(e.getPeriodId(),{mimeType:o,timestampOffset:s,codec:e.getCodec()})}n.bufferController.addSegment(e).then(n.onTimerTick),n.segmentAvailableCallback(e)}},this.onDrmKidError=function(e){var t=n.manifestService.getAllRepresentations().filter(function(t){return e.affectedKid&&t.associatedKid===e.affectedKid}).map(function(e){return e._internalId});n.context.logger.debug("encountered a DRM KID error for",e.affectedKid),n.manifestService.blacklistRepresentations(t),n.mustBuffersBeCleared(t)&&(n.getAllSegmentControllers().forEach(function(e){return e.resetLastChosenRepresentation()}),n.context.store.dispatch(c.clearMetricsHistory("default",h.MetricType.RequestedRepresentations)),n.manifestUpdateDeferred&&n.manifestUpdateDeferred.reject(),n.manifestUpdateDeferred=new g.Deferred,n.manifestUpdateDeferred.promise.then(function(){n.manifestService.isLive()?n.timeShift(n.getTimeShift()):n.seek(n.renderer.getCurrentTime(),!1,null,!1,!1,!0)})["catch"](function(){return n.context.logger.debug("manifest update interrupted by DRM key status change")}))},this.finishPeriodSwitch=function(e){n.previousPlayingPeriodId=n._currentPlayingPeriodId,n._currentPlayingPeriodId=e.targetPeriodId;var t=n.manifestService.getPeriod(new M.PeriodId(n._currentPlayingPeriodId));if(t){var i=t.AdaptationSet.filter(function(e){var t=I.getMimeTypeForAdaptationSet(e);return!n.segmentControllerMap.hasOwnProperty(t)&&m.MimeTypeHelper.isSubtitle(t)});i.forEach(function(e){return n.setupControllerForAdaptationSet(e)}),t.AdaptationSet.forEach(function(e){return n.storeDrmInitDataFromManifest(e)})}n.getAllSegmentControllers().filter(function(e){return n.manifestService.isMimeTypePartOfPeriod(e.getMimeType(),n._currentPlayingPeriodId)}).forEach(function(e){m.MimeTypeHelper.isAV(e.getMimeType())||e.getCurrentPeriodId()!==n._currentPlayingPeriodId&&e.switchPeriod(n._currentPlayingPeriodId)}),n.periodSwitchedCallback(n.previousPlayingPeriodId,n._currentPlayingPeriodId),n.getSourceStore().dispatch(R.setPlayingPeriodId(e.targetPeriodId))},this.endStallAtGapHandler=function(){var e=n.bufferController.getBufferedRangesMap(),t=Math.max.apply(Math,Object.values(e).filter(function(e){return e.length>0}).map(function(e){return e[e.length-1].start}));n.seek(t,!1,null,!1,!0)},this.mpdAvailableHandler=function(){n.applyManifestTimings(),n.initialized&&n.updatePeriodInformation(),n.handleDroppedOutPeriods(),n.initializeThumbnails(),n.initialized?n.getAllSegmentControllers().forEach(function(e){return e.updateMpd()}):n.finishInit(),n.context.serviceManager.get(o.ServiceName.TimedMetadataService).parseEventStream(),n.manifestUpdateDeferred&&(n.manifestUpdateDeferred.resolve(),n.manifestUpdateDeferred=null)},this.onTimerTick=function(){if(clearTimeout(n.mainTimerID),n.mainTimerID=window.setTimeout(n.onTimerTick,A),n.isOneLoaderReady()&&!n.shouldStopDownloadWhenPaused()&&!n.clearBuffersPromise){var e=n.getAllSegmentControllers().filter(function(e){var t=n.shouldWaitForOtherMimeTypeDownload(e.getMimeType());return e.canLoad()&&!t&&!n.isLoadingPeriodFinished(e)});if(e.forEach(function(e){return n.getNextSegment(e)}),n.areAllLoadersReady()){if(0===e.length&&n.shouldSwitchLoadingPeriod)return void n.switchLoadingPeriod();if(0===e.length&&n.bufferController.areBufferBlockMediaTypesFinal(n._currentPlayingPeriodId)){
var t=n.manifestService.isManifestFinalized(),i=n.manifestService.isLastPeriod(n.currentLoadingPeriodId);t&&i&&(n.bufferController.stop(!1),n.shouldEndOfStreamBeSignaled()&&(n.signalEndOfStream(),n.stop()))}else n.isAVCompletelyLoaded(e)&&n.signalEndOfStream();n.subtitleService&&!n.playerStateService.seekingOrTimeshifting&&n.subtitleService.clearBuffersUntil(n.renderer.getCurrentTime()-10)}}},this.onSegmentRequestFinished=function(e){var t=408;if(e){if(e.success||e.httpStatus===t){var i=n.segmentControllerMap[e.mimeType];i&&n.updateAdaptationLogicData(e,i)}e.success||n.onTimerTick()}},this.onPeriodSwitchHandler=function(){n.isPeriodSwitchHappeningNow=!0},this.onPeriodSwitchedHandler=function(){n.isPeriodSwitchHappeningNow=!1},this.eventHandlerFunctionTimeChanged=function(e){if(n.initialized){var t=1.1,i=n.manifestService.getDuration(),r=n.context.sourceContext.technology.player===d.PlayerType.Flash,o=!isNaN(i)&&e.time>=i-t;!n.eosSignaled&&o&&r&&n.signalEndOfStream()}},this.firePlaybackFinishedEvent=function(){return n.manifestService.isLastPeriod(n._currentPlayingPeriodId)?void(n.bufferController.hasNextBufferBlock()||(n.stop(),n.logger.debug("Stopping buffer controller"),n.bufferController.stop(!0),n.playerStateService.transitionToStoppedState())):void n.logger.debug("ignoring ended event in firePlaybackFinishedEvent as there is a future period")},this.onPaused=function(){n.bufferController?n.bufferController.onPaused():n.initialWasPlayingBeforeStall=!1},this.onPlay=function(){n.bufferController?n.bufferController.onPlay():n.initialWasPlayingBeforeStall=!0},this.onSeekedHandler=function(){n.lastSeekTarget=n.renderer.getCurrentTime()},this.context=e,this.logger=e.logger,this.settings=e.settings,this.bufferSettings=e.bufferSettings,this.eventHandler=e.eventHandler,this.renderer=e.renderer,this.periodSwitchedCallback=t,this.segmentAvailableCallback=i,this.initialized=!1,this.initPromise=null,this.started=!1,this.isPeriodSwitchHappeningNow=!1,this.shouldSwitchLoadingPeriod=!1,this.mimeTypes={},this.queuedMediaTypeInfo={},this.mainTimerID=-1,this.lastCurrentTime=0,this.seekCounter=0,this.initialWasPlayingBeforeStall=!1,this.eosSignaled=!1}return e.prototype.getSourceStore=function(){return this.context.serviceManager.get(o.ServiceName.SourceStoreService,this.context.sourceContext.sourceIdentifier)},e.prototype.areAllCodecsKnown=function(){for(var e in this.mimeTypes)if(this.segmentControllerMap.hasOwnProperty(e)&&m.MimeTypeHelper.isAV(e)&&(this.mimeTypes[e]=this.segmentControllerMap[e].getCodecs(),!this.mimeTypes[e]))return!1;return!0},e.prototype.areMimeTypesValid=function(){for(var e in this.mimeTypes)if(this.segmentControllerMap.hasOwnProperty(e)&&m.MimeTypeHelper.isAV(e)&&!this.mimeTypes[e])return;return!0},e.prototype.tryToFinalizeMediaTypes=function(e){var t=this;this.areAllCodecsKnown()&&this.areMimeTypesValid()?(this.queuedMediaTypeInfo[e.getMimeType()]={periodId:e.getPeriodId(),codec:e.getCodec()},Object.keys(this.queuedMediaTypeInfo).forEach(function(e){var i=t.queuedMediaTypeInfo[e].periodId,n=t.queuedMediaTypeInfo[e].codec;t.finalizeMediaType(i,e,n),delete t.queuedMediaTypeInfo[e]})):this.queuedMediaTypeInfo[e.getMimeType()]={periodId:e.getPeriodId(),codec:e.getCodec()}},e.prototype.finalizeMediaType=function(e,t,i){var n=this;this.getAllSegmentControllers().forEach(function(t){n.isAVMultiplexed(t)&&(n.bufferController.addRequiredMediaType(e,"video/mp4"),n.bufferController.addRequiredMediaType(e,"audio/mp4"),n.bufferController.updateMediaType(e,{mimeType:"audio/mp4",timestampOffset:t.getMPDHandler().getTimestampOffset()}))}),this.segmentControllerMap.hasOwnProperty(t)?(this.bufferController.addRequiredMediaType(e,t),this.bufferController.updateMediaType(e,{mimeType:t,codec:i})):this.bufferController.updateMediaType(e,{mimeType:t,codec:i})},e.prototype.isAVMultiplexed=function(e){var t=f.CodecStringHelper.extractCodecStrings(e.getCodecs());return Boolean(t.video&&t.audio)},e.prototype.getMaxTimeShift=function(){return this.getTimeShiftHandler().getMaxTimeShift()},e.prototype.storeDrmInitDataFromManifest=function(e){var t=this;if(e){for(var i=this.manifestService.getContentProtectionForAdaptationSet(e),n=[],r=0;r<i.length;r++){var o=i[r];if(o.pssh&&o.pssh.length>0)for(var a=0;a<o.pssh.length;a++)this.logger.debug("adding pssh for "+o.name+": "+o.pssh[a]),n.push({initData:o.psshData[a],initDataStr:o.pssh[a],systemID:o.schemeIdUri,systemIDraw:o.schemeIdUri.replace("urn:uuid:","").replace(/-/g,""),systemName:u.KeySystemKind[o.name.toUpperCase()],kid:[]})}n.length>0&&n.forEach(function(e){t.renderer.addDrmInitData(e)})}},e.prototype.mustBuffersBeCleared=function(e){var t=l.getMetricsHistoryFromInstanceState(this.context.store.getState(),"default",h.MetricType.RequestedRepresentations);if(t&&0!==t.length){var i=t.map(function(e){return e.value});return e.some(function(e){return i.some(function(t){return t.equals(e)})})}},e.prototype.setupEventHandlers=function(){this.eventHandler.on(a.PlayerEvent.PeriodSwitch,this.onPeriodSwitchHandler),this.eventHandler.on(a.PlayerEvent.PeriodSwitched,this.onPeriodSwitchedHandler),this.eventHandler.on(a.PlayerEvent.Seeked,this.onSeekedHandler,!0),this.eventHandler.on(s.InternalEvent.EndStallAtGap,this.endStallAtGapHandler,!0),this.eventHandler.on(s.InternalEvent.DrmKidInternalError,this.onDrmKidError,!0)},e.prototype.removeEventHandlers=function(){this.eventHandler.off(a.PlayerEvent.PeriodSwitch,this.onPeriodSwitchHandler),this.eventHandler.off(a.PlayerEvent.PeriodSwitched,this.onPeriodSwitchedHandler),this.eventHandler.off(a.PlayerEvent.Seeked,this.onSeekedHandler),this.eventHandler.off(s.InternalEvent.MPDAvailable,this.mpdAvailableHandler),this.eventHandler.off(a.PlayerEvent.SegmentRequestFinished,this.onSegmentRequestFinished),this.eventHandler.off(a.PlayerEvent.TimeChanged,this.eventHandlerFunctionTimeChanged),this.eventHandler.off(s.InternalEvent.EndStallAtGap,this.endStallAtGapHandler,!0),this.eventHandler.off(s.InternalEvent.FinishPeriodSwitch,this.finishPeriodSwitch,!0),this.eventHandler.off(s.InternalEvent.DrmKidInternalError,this.onDrmKidError,!0)},e.prototype.setupControllerForAdaptationSet=function(e){var t=I.getMimeTypeForAdaptationSet(e),i=e.isTransmuxingRequired;m.MimeTypeHelper.isImage(t)||((t.includes("text")||t.includes("ttml+xml"))&&"hls"!==this.sourceType?this.addExternalSubtitleTrack(e,t):(this.context.store.dispatch(c.initializeMetricsForMimeType(t,this.context.settings)),t.includes("application")?this.addFragmentedSubtitleTrack(e,t):(this.mimeTypes[t]=I.getCodecsFromAdaptationSet(e),this.segmentControllerMap[t]=new b.SegmentController(this.context,this.onSegmentAvailable,t,this.mimeTypes[t],i,this.manifestLoader,this._currentPlayingPeriodId),this._currentPlayingPeriodId&&this.storeDrmInitDataFromManifest(e))),this.context.segmentInfoService&&this.context.segmentInfoService.setSegmentControllers(Object.values(this.segmentControllerMap)))},e.prototype.addExternalSubtitleTrack=function(e,t){if(v.ModuleManager.has(T.ModuleName.DASH)&&this.subtitleService){var i=v.ModuleManager.get(T.ModuleName.DASH),n=new i.SegmentTemplateMPDHandler(this.context),r=this.manifestService.toSubtitleTrack(e,t);n.setAdaptationSetId(e._internalId),r.url=n.getSubtitleUrl().toString(),this.subtitleService.addExternalSubtitle(r,e)}},e.prototype.addFragmentedSubtitleTrack=function(e,t){if(this.subtitleService){var i={mimeType:t,codec:I.getCodecsFromAdaptationSet(e),isHls:this.manifestService.isHlsManifest(),manifestLoader:this.manifestLoader,periodId:this._currentPlayingPeriodId};this.subtitleService.addFragmentSubtitle(i,e)}},e.prototype.setInitialPeriod=function(){this.manifestService.isLive()?this.setInitialPeriodForLive():(this.currentLoadingPeriodId=this.manifestService.getFirstPeriod()._id,this._currentPlayingPeriodId=this.currentLoadingPeriodId)},e.prototype.setInitialPeriodForLive=function(){if(this.manifestService.isLive()){var e=y.toSeconds(Date.now())-this.manifestService.getDesiredDistanceToLiveEdge();this.currentLoadingPeriodId=this.manifestService.getPeriodIdForTime(e),this._currentPlayingPeriodId=this.currentLoadingPeriodId,this.logger.debug("setting current period to "+this._currentPlayingPeriodId)}},e.prototype.getCurrentPlayingPeriod=function(){return this.manifestService.findPeriod(this._currentPlayingPeriodId)},e.prototype.getCurrentLoadingPeriodId=function(){return this.currentLoadingPeriodId},e.prototype.updateVideoAndAudioMediaTypes=function(e){var t=e.AdaptationSet.find(function(e){return m.MimeTypeHelper.isVideo(e._mimeType)});t&&this.bufferController.addRequiredMediaType(e._id,t._mimeType);var i=e.AdaptationSet.find(function(e){return m.MimeTypeHelper.isAudio(e._mimeType)});i&&this.bufferController.addRequiredMediaType(e._id,i._mimeType)},e.prototype.updateSubtitleMediaTypes=function(e){var t=this;e.AdaptationSet.filter(function(e){return m.MimeTypeHelper.isSubtitle(e._mimeType)}).forEach(function(i){t.bufferController.addRequiredMediaType(e._id,i._mimeType)})},e.prototype.updateMediaTypes=function(e){this.updateVideoAndAudioMediaTypes(e),this.updateSubtitleMediaTypes(e)},e.prototype.updatePeriodInformation=function(){var e=this;this.manifestService.getAllPeriods().forEach(function(t){e.updateMediaTypes(t),e.bufferController.checkIfEndOfBufferReached(e.settings.END_OF_BUFFER_TOLERANCE)})},e.prototype.finishInit=function(){var e=this;return this.initPromise?this.initPromise:this.initialized===!0||null===this.manifestService.getManifest()?this.initPromise=Promise.resolve():(this.disposeSegmentControllers(),this.segmentControllerMap={},this.mimeTypes={},this.initPromise=this.renderer.ready().then(function(){return e.initializeDependents()}))},e.prototype.disposeSegmentControllers=function(){var e=this;this.segmentControllerMap&&Object.keys(this.segmentControllerMap).forEach(function(t){return e.segmentControllerMap[t].dispose()})},e.prototype.createTransmuxer=function(){var e=this;if(v.ModuleManager.has(T.ModuleName.ContainerTS)){var t=v.ModuleManager.get(T.ModuleName.ContainerTS);this.getAllSegmentControllers().filter(function(e){return e.isTransmuxerRequired()}).forEach(function(i){e.transmuxer=e.transmuxer||new t.WebWorkerTransmuxer(e.context),i.setTransmuxer(e.transmuxer)}),this.subtitleService&&this.subtitleService.setTransmuxer(this.transmuxer)}},e.prototype.initializeDependents=function(){this.setupEventHandlers(),this.setInitialPeriod(),this.initializeBufferController(),this.updatePeriodInformation();var e=this.getCurrentPlayingPeriod()||this.manifestService.getFirstPeriod();e&&this.initializeSegmentController(e),this.updateAudioTrackOnSubtitleService(),this.createTransmuxer(),this.initialized=!0},e.prototype.updateAudioTrackOnSubtitleService=function(){var e=this.getAudioSegmentController();if(this.subtitleService&&e){var t=e.getCurrentLangObj().lang;this.subtitleService.enableForcedSubtitle(t)}},e.prototype.initializeSegmentController=function(e){var t,i,n=this,r=(i=null===(t=e)||void 0===t?void 0:t.AdaptationSet,null!==i&&void 0!==i?i:[]);r.forEach(function(e){return n.createSegmentController(e)})},e.prototype.createSegmentController=function(e){var t=I.getMimeTypeForAdaptationSet(e);r(this.mimeTypes,t)&&(this.setupControllerForAdaptationSet(e),m.MimeTypeHelper.isAV(e._mimeType)&&this.getSourceStore().dispatch(E.setRepresentationIdAction(e.Representation[0]._internalId)))},e.prototype.initializeBufferController=function(){this.bufferController=new P.BufferController(this.context,this.manifestService.getTotalDuration(),this.initialWasPlayingBeforeStall,this._currentPlayingPeriodId)},e.prototype.getBufferLevel=function(e,t,i,n){return void 0===n&&(n=!0),this.bufferController?this.bufferController.getOverallBufferLevel(e,t,i,n):0},e.prototype.handleDroppedOutPeriods=function(){var e=this;if(null!=this._currentPlayingPeriodId||null!=this.currentLoadingPeriodId){var t=!0,i=!0;this.manifestService.getAllPeriods().forEach(function(n){n._id===e._currentPlayingPeriodId&&(t=!1),n._id===e.currentLoadingPeriodId&&(i=!1)}),t?(this.logger.debug("Playing period dropped out of the manifest, timeshifting to current position"),this.switchLoadingPeriodForAllMedia(this.manifestService.getPeriodIdForTime(this.getCurrentTime())),this.timeShift(this.getTimeShift())):i&&(this.logger.debug("Current loading period ("+this.currentLoadingPeriodId+") dropped out of the manifest, switching to first available one"),this.getAllSegmentControllers().forEach(function(e){return e.invalidateOngoingRequests()}),this.switchLoadingPeriodForAllMedia(this.manifestService.getFirstPeriod()._id))}},e.prototype.initializeThumbnails=function(){var e=this;this.context.serviceManager.maybeCall(o.ServiceName.ThumbnailService,function(t){e.context.sourceContext.source&&e.context.sourceContext.source.thumbnailTrack||t.addThumbnails(e.manifestService.getAllDashThumbnailSources())})},e.prototype.applyManifestTimings=function(){var e=this.manifestService.isLive(),t=this.context.serviceManager.get(o.ServiceName.StartOffsetService),i=this.manifestService.hasSuggestedStartPosition();if(e){var n=this.manifestService.getTimeShiftBufferDepthSeconds();0!==n&&(this.metadataParsedService.expirationTimeInSeconds=n),i&&(t.manifestStartOffset=this.manifestService.getLiveStartOffset(),this.adjustMaximumBufferLevel())}else i&&(t.manifestStartOffset=this.manifestService.getVodStartOffset())},e.prototype.adjustMaximumBufferLevel=function(){var e=Math.abs(this.manifestService.getLiveStartOffset(!1));e=e>0?e:this.manifestService.getMaxSegmentDuration();var t=Math.min(e,this.bufferSettings.getForwardTargetLevel(d.MediaType.Video)),i=Math.min(e,this.bufferSettings.getForwardTargetLevel(d.MediaType.Audio));this.bufferSettings.setMaximumBufferLevel(d.BufferType.ForwardDuration,t,d.MediaType.Video),this.bufferSettings.setMaximumBufferLevel(d.BufferType.ForwardDuration,i,d.MediaType.Audio)},e.prototype.terminate=function(){this.logger.debug("stopping playback"),this.stop(),this.getAllSegmentControllers().forEach(function(e){return e.stop()}),this.bufferController&&this.bufferController.stop(!0),this.transmuxer&&(this.transmuxer.dispose(),this.transmuxer=null),this.timeshiftHandler&&(this.timeshiftHandler.dispose(),this.timeshiftHandler=null),this.renderer.off(S.MediaElementEvent.ended,this.firePlaybackFinishedEvent);var e=this.renderer.shutdown()["catch"](function(){return Promise.resolve()});return this.removeEventHandlers(),this.initialized=!1,this.started=!1,this._currentPlayingPeriodId=null,this.mimeTypes=null,this.manifestService.resetBlacklistedRepresentations(),this.disposeSegmentControllers(),e},e.prototype.dispose=function(){clearTimeout(this.mainTimerID),this.timeshiftHandler&&(this.timeshiftHandler.dispose(),this.timeshiftHandler=null);try{this.removeEventHandlers()}catch(e){}this.bufferController&&(this.bufferController.dispose(),this.bufferController=null);for(var t in this.segmentControllerMap)this.segmentControllerMap.hasOwnProperty(t)&&(this.segmentControllerMap[t].dispose(),this.segmentControllerMap[t]=null);this.subtitleService=null,this.segmentControllerMap=null,this.settings=null,this.bufferSettings=null,this.eventHandler=null,this.renderer=null,this.mimeTypes=null,this.queuedMediaTypeInfo=null,this.sourceType=null},e.prototype.acquireServices=function(){this.manifestService=this.context.serviceManager.get(o.ServiceName.ManifestService),this.playerStateService=this.context.serviceManager.get(o.ServiceName.PlayerStateService),this.subtitleService=this.context.serviceManager.get(o.ServiceName.SubtitleService),this.metadataParsedService=this.context.serviceManager.get(o.ServiceName.MetadataParsedService),this.manifestLoader=this.context.serviceManager.get(o.ServiceName.ManifestLoadingService),this.manifestUpdateScheduler=this.context.serviceManager.get(o.ServiceName.ManifestUpdateSchedulingService)},e.prototype.init=function(e){var t=this;return this._currentPlayingPeriodId=void 0,this.currentLoadingPeriodId=void 0,this.lastCurrentTime=0,this.initialWasPlayingBeforeStall=!1,this.isAudioCatchingUp=!1,this.acquireServices(),this.eventHandler.on(s.InternalEvent.FinishPeriodSwitch,this.finishPeriodSwitch,!0),this.sourceType=e.type,this.eventHandler.on(a.PlayerEvent.TimeChanged,this.eventHandlerFunctionTimeChanged),this.renderer.on(S.MediaElementEvent.ended,this.firePlaybackFinishedEvent),this.manifestUpdateScheduler.init(e.url.toString()).then(function(){return t.eventHandler.on(s.InternalEvent.MPDAvailable,t.mpdAvailableHandler,!0),t.mpdAvailableHandler()})},e.prototype.stop=function(){clearTimeout(this.mainTimerID),this.initPromise=null,this.started=!1,this.mainTimerID=-1,this.logger.debug("Stopping main timer."),this.eventHandler.off(a.PlayerEvent.SegmentRequestFinished,this.onSegmentRequestFinished),this.eventHandler.off(s.InternalEvent.MPDAvailable,this.mpdAvailableHandler)},e.prototype.isOneLoaderReady=function(){return this.getAllSegmentControllers().some(function(e){return e.canLoad()})},e.prototype.areAllLoadersReady=function(){return this.getAllSegmentControllers().every(function(e){return e.canLoad()})},e.prototype.isVod=function(){return!this.manifestService.isLive()},e.prototype.shouldStopDownloadWhenPaused=function(){return this.playerStateService.isPaused()&&this.settings.STOP_DOWNLOAD_ON_PAUSE&&this.manifestService.isLive()},e.prototype.shouldWaitForOtherMimeTypeDownload=function(e){var t=Object.keys(this.segmentControllerMap).find(function(t){return m.MimeTypeHelper.isAV(t)&&e!==t});if(this.isAudioCatchingUp)return m.MimeTypeHelper.isAudio(t);var i=this.segmentControllerMap[t];if(t&&!i.hasDownloadError&&i.hasNext()){var n=this.getBufferRelevantTime(),r=this.getCurrentForwardBuffer(e,n),o=this.getCurrentForwardBuffer(t,n),a=this.hasReachedTargetBufferLevel(t,o);return r>o&&!a}return!1},e.prototype.hasReachedTargetBufferLevel=function(e,t){var i=m.MimeTypeHelper.getMediaType(e),n=this.bufferSettings.getForwardTargetLevel(i);return t>=n},e.prototype.shouldEndOfStreamBeSignaled=function(){var e=this,t=this.getAllSegmentControllers(),i=this.bufferController.hasPendingSegments(),n=t.map(function(e){return e.getMimeType()}),r=t.some(function(e){return e.hasPendingSegments()}),o=n.some(function(t){return e.renderer.isDataBeingAppended(t)});return!r&&!i&&!o},e.prototype.isPeriodSwitchNecessary=function(e){return this.isAudioCatchingUp&&m.MimeTypeHelper.isAudio(e.getMimeType())?!this.manifestService.isLastPeriod(e.getCurrentPeriodId()):!this.manifestService.isLastPeriod(this.currentLoadingPeriodId)},e.prototype.isLoadingPeriodFinished=function(e){return!e.hasNext()&&(this.shouldSwitchLoadingPeriod=this.shouldSwitchLoadingPeriod||this.isPeriodSwitchNecessary(e),!e.hasPendingSegments(this.currentLoadingPeriodId))},e.prototype.getNextSegment=function(e){if(e.canLoad()){var t=m.MimeTypeHelper.getMediaType(e.getMimeType()),i=this.bufferSettings.getForwardTargetLevel(t),n=this.getCurrentForwardBuffer(e.getMimeType(),this.getBufferRelevantTime());n>=i||(e.getAdaptationHandler().addSample({bufferTargetLevel:i,bufferLevel:n}),e.hasNext()&&e.getNext())}},e.prototype.getBufferRelevantTime=function(){return this.playerStateService.seekingOrTimeshifting?this.playerStateService.targetPlaybackTime:this.renderer.getCurrentTime()},e.prototype.getCurrentForwardBuffer=function(e,t){return this.getBufferLevel(e,t,d.BufferType.ForwardDuration)},e.prototype.switchLoadingPeriod=function(){if(this.shouldSwitchLoadingPeriod=!1,this.isAudioCatchingUp){var e=this.getAudioSegmentController(),t=e.getCurrentPeriodId(),i=this.manifestService.getNextPeriod(t)._id;this.switchLoadingPeriodForAudio(i),e.getCurrentPeriodId()===this.currentLoadingPeriodId&&(e.isTransmuxerRequired()&&e.getTransmuxer()&&(e.getTransmuxer().dispose(),e.setTransmuxer(this.transmuxer)),this.isAudioCatchingUp=!1,this.logger.debug("The audio SegmentController caught up to the overall loading period again."))}else{var n=this.manifestService.getNextPeriod(this.currentLoadingPeriodId);n&&this.switchLoadingPeriodForAllMedia(n._id)}},e.prototype.switchLoadingPeriodForAllMedia=function(e){var t=this;e!==this.currentLoadingPeriodId&&(this.isAudioCatchingUp=!1,this.prepareLoadingPeriodSwitch(e),this.getAllSegmentControllers().filter(function(t){return t.getCurrentPeriodId()!==e}).forEach(function(i){i.switchPeriod(e),t.storeDrmInitDataFromManifest(i.getAdaptationSetForPeriodId(e))}),this.currentLoadingPeriodId=e)},e.prototype.prepareLoadingPeriodSwitch=function(e){var t=this,i=this.manifestService.getPeriod(new M.PeriodId(e)).AdaptationSet;i=i.filter(function(e){var t=I.getMimeTypeForAdaptationSet(e);return m.MimeTypeHelper.isAV(t)}),i.forEach(function(e){var i=I.getMimeTypeForAdaptationSet(e);t.segmentControllerMap.hasOwnProperty(i)||t.setupControllerForAdaptationSet(e)}),this.resetTransmuxer()},e.prototype.switchLoadingPeriodForAudio=function(e){var t=this.getAudioSegmentController(),i=t.getCurrentPeriodId();t.resetTransmuxer(),t.switchPeriod(e),this.logger.debug("Switched audio loading period from "+i+" to "+e)},e.prototype.isAVCompletelyLoaded=function(e){var t=this,i=this.getAllSegmentControllers().some(function(e){return e.hasPendingSegments()}),n=e.every(function(e){return!t.getAllSegmentControllers().includes(e)}),r=i||this.bufferController.hasPendingSegments();return this.manifestService.isManifestFinalized()&&n&&!r},e.prototype.getBufferedRanges=function(e){return void 0===e&&(e=!1),this.bufferController.getBufferedRangesMap(this._currentPlayingPeriodId,e)},e.prototype.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.dispose(),this.transmuxer=null),this.createTransmuxer()},e.prototype.restartBufferAndSegmentControllers=function(){this.bufferController.hasStopped()&&this.bufferController.restart()},e.prototype.seek=function(e,t,i,n,r,o){var a=this;if(void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),this.bufferController){this.restartBufferAndSegmentControllers(),this.seekCounter++;var s=this.seekCounter;this.shouldSwitchLoadingPeriod=!1;var d=null;(this.isVod()||this.settings.ENABLE_SEEK_FOR_LIVE||r)&&(d=this.manifestService.getPeriodIdForTime(e)),void 0===this._currentPlayingPeriodId&&(this.logger.debug("current period is undefined, using seek target period "+d),this._currentPlayingPeriodId=d,this.resetTransmuxer(),this.getAllSegmentControllers().forEach(function(e){e.switchPeriod(a._currentPlayingPeriodId),m.MimeTypeHelper.isAV(e.getMimeType())&&a.storeDrmInitDataFromManifest(e.getCurrentAdaptationSet())}),this.currentLoadingPeriodId=this._currentPlayingPeriodId,this.bufferController.setInitialPeriod(d)),this.logger.debug("seek from current period ("+this._currentPlayingPeriodId+") to target period ("+d+") - seek time in period is: "+e);var u=this.bufferController.isInBufferedRange(e),c=e<this.renderer.getCurrentTime(),l=!r&&(!u||c)||o,h=this.currentLoadingPeriodId!==d&&l;this.clearBuffersPromise=Promise.resolve(),l&&(this.eosSignaled=!1,this.clearBuffersPromise=this.bufferController.setEndOfStream(!1).then(function(){return a.bufferController.clearBuffers()}),this.getAllSegmentControllers().forEach(function(e){return e.cancelLoading()})),this.clearBuffersPromise["catch"](function(){a.logger.debug("Failed to clear buffers on seek, carrying on regardless")}).then(function(){return a.clearBuffersPromise=null,a.initialized?(a.getAllSegmentControllers().forEach(function(e){return e.setAdaptionLogicStartupPhase()}),h&&a.switchLoadingPeriodForAllMedia(d),l&&a.getAllSegmentControllers().forEach(function(t){return t.seekTo(e)}),a.bufferController.setCurrentTime(e).then(function(t){a.logger.debug("successfully seeked to "+t),a.seekCounter===s&&i?i():i&&a.context.logger.debug("Seek to "+e+" has finished but a newer operation has been started")})["catch"](function(e){a.logger.debug("Failed to set currentTime on seek",e)}),void(t||(a.start(),a.mainTimerID<0&&a.onTimerTick()))):void a.logger.debug("Aborting seek as MediaPlayerController has been terminated!")})}},e.prototype.getAllSegmentControllers=function(){return Object.values(this.segmentControllerMap||{})},e.prototype.getAudioSegmentController=function(){return this.getAllSegmentControllers().find(function(e){return m.MimeTypeHelper.isAudio(e.getMimeType())})},e.prototype.updateAdaptationLogicData=function(e,t){var i=m.MimeTypeHelper.getMediaType(t.getMimeType()),n=this.getBufferLevel(t.getMimeType(),this.renderer.getCurrentTime(),d.BufferType.ForwardDuration),r=this.bufferSettings.getForwardTargetLevel(i),o=e.duration/e.downloadTime;e.isInit||t.getAdaptationHandler().addSample({bufferTargetLevel:r,bufferLevel:n,downloadRate:o})},e.prototype.signalEndOfStream=function(e){void 0===e&&(e=!0),this.isVod()&&(this.eosSignaled||(this.eosSignaled=!0,this.bufferController.setEndOfStream(!0),e&&this.stop()),this.bufferController.isStarted()&&this.bufferController.stop(),this.eventHandler.off(a.PlayerEvent.TimeChanged,this.eventHandlerFunctionTimeChanged))},e.prototype.start=function(){var e=this;return this.finishInit().then(function(){e.bufferController.hasStreamEnded()&&(e.seek(p.getStartTimeOffset(e.getSourceStore().getState())),e.eventHandler.on(a.PlayerEvent.TimeChanged,e.eventHandlerFunctionTimeChanged),e.getAllSegmentControllers().forEach(function(e){return e.resetTransmuxer()})),e.bufferController.isStarted()||e.bufferController.restart(),e.getAllSegmentControllers().filter(function(e){return m.MimeTypeHelper.isAV(e.getMimeType())}).forEach(function(t){e.storeDrmInitDataFromManifest(t.getCurrentAdaptationSet())}),e.mainTimerID<0&&(e.eosSignaled=!1,e.started=!0,e.onTimerTick(),e.eventHandler.on(s.InternalEvent.MPDAvailable,e.mpdAvailableHandler,!0),e.eventHandler.on(a.PlayerEvent.SegmentRequestFinished,e.onSegmentRequestFinished))})},e.prototype.setRepresentation=function(e,t){if(this.segmentControllerMap)for(var i in this.segmentControllerMap)this.segmentControllerMap.hasOwnProperty(i)&&i.indexOf(t)>-1&&this.segmentControllerMap[i].setRepresentationId(e)},e.prototype.getRepresentation=function(e){if(this.segmentControllerMap)for(var t in this.segmentControllerMap)if(this.segmentControllerMap.hasOwnProperty(t)&&t.indexOf(e)>-1)return this.segmentControllerMap[t].getRepresentation();return null},e.prototype.clearBuffers=function(e){var t=this;return Promise.all(e.map(function(e){return t.bufferController.clearCache(e),t.bufferController.clearBuffer(e)})).then(function(){})},e.prototype.recoverFromImpreciseTimeShiftAfterAudioTrackSwitch=function(e){var t=this;this.manifestService.isLive()&&!this.settings.ENABLE_SEEK_FOR_LIVE&&this.renderer.setCurrentTime(e)["catch"](function(){return t.logger.debug("Could not set currentTime")})},e.prototype.restorePlaybackPositionAfterAudioTrackSwitch=function(e,t){var i=this;return this.bufferController.setEndOfStream(!1).then(function(){var n=i.clearBuffers(e.getSourceBufferTypes());return e.getCurrentPeriodId()!==i._currentPlayingPeriodId&&i.prepareControllerForAudioTrackChange(e),e.setAdaptionLogicStartupPhase(),e.seekTo(t),i.mainTimerID<0&&i.start()["catch"](function(){return i.logger.debug("Could not restart stopped MPC after audio track switch")}),n.then(function(){return i.recoverFromImpreciseTimeShiftAfterAudioTrackSwitch(t)})["catch"](function(e){return i.logger.debug("Failed to set currentTime on audio track switch",e)})})},e.prototype.isHlsManifestLoader=function(e){return"hls"===this.sourceType},e.prototype.setAudio=function(e){var t=this,i=this.getAvailableAudio(this._currentPlayingPeriodId),n=i.find(function(t){return t.id===e}),r=this.getAudio();if(!this.initialized||!n)return Promise.reject(null);if(r&&r.id===e)return Promise.reject(r);var o=Object.keys(this.segmentControllerMap),a=o.find(m.MimeTypeHelper.isAudio)||o.find(m.MimeTypeHelper.isVideo),s=this.segmentControllerMap[a],d=this.getBufferRelevantTime(),u=m.MimeTypeHelper.isAudio(a)&&this.isHlsManifestLoader(this.manifestLoader)?this.manifestLoader.updateAdaptationSet(e):Promise.resolve();return u.then(function(){if(s.setCurrentLangObj(n),s.cancelLoading(),t.subtitleService&&t.subtitleService.enableForcedSubtitle(n.lang),!t.hasNotStartedYet())return t.restorePlaybackPositionAfterAudioTrackSwitch(s,d)})},e.prototype.hasNotStartedYet=function(){return!this.started&&!this.eosSignaled},e.prototype.getAudio=function(){if(this.initialized){var e=void 0,t=Object.keys(this.segmentControllerMap).find(function(e){return m.MimeTypeHelper.isAudio(e)});if(t&&(e=this.segmentControllerMap[t].getCurrentLangObj()),!e){var i=Object.keys(this.segmentControllerMap).find(function(e){return m.MimeTypeHelper.isVideo(e)});if(i&&this.segmentControllerMap[i].getSourceBufferTypes()){var n=this.segmentControllerMap[i].getSourceBufferTypes().some(function(e){return m.MimeTypeHelper.isAudio(e)});n&&(e=this.segmentControllerMap[i].getCurrentLangObj())}}return e||null}return null},e.prototype.prepareControllerForAudioTrackChange=function(e){if(this.isAVMultiplexed(e))this.switchLoadingPeriodForAllMedia(this._currentPlayingPeriodId);else{if(this.logger.debug("audio needs to load previous period(s) and catch up to the overall loading period"),e.isTransmuxerRequired()){var t=v.ModuleManager.get(T.ModuleName.ContainerTS);e.setTransmuxer(new t.WebWorkerTransmuxer(this.context))}this.isAudioCatchingUp=!0,this.switchLoadingPeriodForAudio(this._currentPlayingPeriodId)}},e.prototype.getPlaybackRepresentation=function(e){for(var t in this.segmentControllerMap)if(this.segmentControllerMap.hasOwnProperty(t)&&t.indexOf(e)>-1)return this.context.serviceManager.get(o.ServiceName.TimedMetadataService).getPlaybackRepresentation(t)},e.prototype.isRepresentationAutoSelected=function(e){for(var t in this.segmentControllerMap)if(this.segmentControllerMap.hasOwnProperty(t)&&t.indexOf(e)>-1)return this.segmentControllerMap[t].isRepresentationAutoSelected();return!1},e.prototype.getTimeShift=function(){return this.getTimeShiftHandler().getTimeShift()},e.prototype.getTimeShiftLiveEdge=function(){return this.manifestService.isLive()?this.getTimeShiftHandler().getTimeShiftLiveEdge():0},e.prototype.getTimeShiftHandler=function(){return this.timeshiftHandler||(this.timeshiftHandler=new C.TimeShiftHandler(this.context,this,this.bufferController,this.segmentControllerMap)),this.timeshiftHandler},e.prototype.timeShift=function(e,t){this.getTimeShiftHandler().timeShift(e,t)},e.prototype.getAvailableAudio=function(e){return this.manifestService.getAvailableAudio(e)},e.prototype.hasStreamEnded=function(){return!!this.bufferController&&this.bufferController.hasStreamEnded()},e.prototype.getCurrentTime=function(){return this.isPeriodSwitchHappeningNow?this.lastSeekTarget>-1&&(this.lastCurrentTime=this.lastSeekTarget):this.lastCurrentTime=this.renderer.getCurrentTime(),this.lastSeekTarget=-1,this.lastCurrentTime},e.prototype.getSeekableRange=function(){if(this.manifestService.isLive()){if(this.playerStateService.seekingOrTimeshifting&&this.cachedSeekableRange)return this.cachedSeekableRange;var e=this.getTimeShiftLiveEdge(),t=e+this.getMaxTimeShift();return this.cachedSeekableRange={start:t,end:e}}var i=this.getAllSegmentControllers().find(function(e){return m.MimeTypeHelper.isAV(e.getMimeType())});return i?i.getMPDHandler().getSeekableRange():{start:-1,end:-1}},e.prototype.getAvailableSegments=function(){var e=this,t={};return Object.keys(this.segmentControllerMap).forEach(function(i){t[i]=e.segmentControllerMap[i].getSegmentInfos()}),t},e.prototype.getPeriodId=function(){return this._currentPlayingPeriodId},e.prototype.getCurrentVideoRepresentation=function(){return this.getRepresentation("video")},e.prototype.getCurrentAudioRepresentation=function(){return this.getRepresentation("audio")},e.prototype.setVideoRepresentation=function(e){this.setRepresentation(e,"video")},e.prototype.setAudioRepresentation=function(e){this.setRepresentation(e,"audio")},e.prototype.isInitialized=function(){return this.initialized},e.prototype.hasStarted=function(){return this.started},Object.defineProperty(e.prototype,"currentPlayingPeriodId",{get:function(){return this._currentPlayingPeriodId},set:function(e){this._currentPlayingPeriodId=e;
},enumerable:!0,configurable:!0}),e}();t.MediaPlayerController=L},422:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),r=i(233),o=i(231),a=i(234),s=i(235),d=i(129),u=i(130),c=i(236),l=i(65),h=i(66),p=i(232),f={removeActiveTrackAction:h.removeActiveTrackAction,setRepresentationIdAction:h.setRepresentationIdAction};t.MseModuleDefinition={name:n.ModuleName.EngineBitmovin,module:{MediaPlayer:o.MediaPlayer,SegmentController:d.SegmentController,technologyChecker:new p.TechnologyChecker,Stream:l.Stream,FetchController:s.FetchController,SegmentInfoService:u.SegmentInfoService,SegmentPrefetchingService:c.SegmentPrefetchingService,AdRestorationOptimizationService:a.AdRestorationOptimizationService,ManifestCachingService:r.ManifestCachingService,actions:f}},t["default"]=t.MseModuleDefinition},423:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1),r=i(15),o=function(){function e(e){var t=this;this.onInternalPlaybackSpeedChanged=function(e){var i=t.playbackSpeedChangedEventsToSuppress[0];i&&e.from===i.from&&e.to===i.to?t.playbackSpeedChangedEventsToSuppress.shift():(t.context.eventHandler.dispatchEvent(n.PlayerEvent.PlaybackSpeedChanged,{from:e.from,to:e.to}),t.exposedPlaybackSpeed=e.to)},this.context=e,this.renderer=e.renderer,this.playbackSpeedChangedEventsToSuppress=[],this.exposedPlaybackSpeed=this.renderer.getPlaybackSpeed(),this.context.eventHandler.on(r.InternalEvent.PlaybackSpeedChanged,this.onInternalPlaybackSpeedChanged,!0)}return e.prototype.getPlaybackSpeed=function(){return this.exposedPlaybackSpeed},e.prototype.setPlaybackSpeed=function(e,t){void 0===t&&(t=!1),t?this.renderer.getPlaybackSpeed()!==e&&this.playbackSpeedChangedEventsToSuppress.push({from:this.renderer.getPlaybackSpeed(),to:e}):this.exposedPlaybackSpeed=e,this.renderer.setPlaybackSpeed(e)},e.prototype.dispose=function(){this.context.eventHandler.off(r.InternalEvent.PlaybackSpeedChanged,this.onInternalPlaybackSpeedChanged,!0)},e}();t.PlaybackSpeedTracker=o},424:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(33),r=i(5),o=i(1),a=i(15),s=i(3),d=i(107),u=function(){function e(e,t,i,n){var a=this;this.onManifestUpdateListener=function(){if(a.manifestService.isLive()){var e=a.getActualTimeShift(),t=a.calculateAvailableBufferLength();a.adjustTargetBufferLevel(t),e<-t.bufferDepth&&e<a.getMaxTimeShift()&&a.context.eventHandler.dispatchEvent(o.PlayerEvent.DVRWindowExceeded)}},this.onSeek=function(){a.updateInitialTimeShiftContext(!0)},this.onSeeked=function(){var e=a.context.renderer.getCurrentTime(!0),t=e-a.getTimeShiftLiveEdge();a.updateTimeShiftStateAfterSeek(t,e)},this.context=e,this.mediaPlayerController=t,this.bufferController=i,this.segmentControllers=Object.keys(n).map(function(e){return n[e]}),this.manifestService=e.serviceManager.get(r.ServiceName.ManifestService),this.logger=e.logger,this.eventHandler=e.eventHandler,this.timeShiftCounter=0,this.isDisposed=!1,this.setupEventHandlers()}return e.prototype.calculateLiveEdgeInVideoTime=function(){var e;if(this.initialTimeShiftContext&&!this.initialTimeShiftContext.isOngoing){var t=s.toSeconds(Date.now()-this.initialTimeShiftContext.timestamp);e=this.initialTimeShiftContext.liveEdge+t}else e=this.calculateMpdHandlerLiveEdge();return isFinite(e)||(e=s.toSeconds(Date.now()-this.manifestService.getAvailabilityStartTime())),e},e.prototype.calculateMpdHandlerLiveEdge=function(){var e=this.segmentControllers.filter(function(e){var t=e.getCurrentLangObj();return t&&null!==t.id}).map(function(e){return e.getLiveEdgeTime()});return e.reduce(function(e,t){return t<e&&t>=0?t:e},1/0)},e.prototype.getMaxTimeShift=function(){if(this.manifestService.getManifest()){var e=this.manifestService.getTimeShiftBufferDepthSeconds();return Math.min(e+this.manifestService.getDesiredDistanceToLiveEdge(),0)}return 0},e.prototype.getTimeShiftLiveEdge=function(){return this.calculateLiveEdgeInVideoTime()-this.manifestService.getDesiredDistanceToLiveEdge()},e.prototype.getTimeShift=function(){var e=this.getActualTimeShift();if(this.lastTimeShiftStatus){var t=s.toSeconds(Date.now()-this.lastTimeShiftStatus.completionDate),i=this.mediaPlayerController.getCurrentTime()-this.lastTimeShiftStatus.reachedTime,n=t-i;if(Math.abs(n)<this.context.settings.ACCEPTABLE_TIMESHIFT_INACCURACY)return this.lastTimeShiftStatus.offset}var r=this.getMaxTimeShift();return e<r&&(e=r),e>0&&(e=0),e},e.prototype.getActualTimeShift=function(){return!this.initialTimeShiftContext||this.initialTimeShiftContext.isOngoing?0:this.mediaPlayerController.getCurrentTime()-this.getTimeShiftLiveEdge()},e.prototype.adjustTargetTime=function(e){var t=this.manifestService.getPeriodIdForTime(e),i=!this.manifestService.isLastPeriod(t),n=this.manifestService.isTimeNearPeriodEnd(e,this.context.settings.END_OF_BUFFER_TOLERANCE);if(i&&n){var r=this.manifestService.getNextPeriod(t);this.logger.debug("Timeshift target too close to end of period "+t+", adjusting target from "+e+(" to "+r.start+", i.e. next period's start.")),e=r.start}return e},e.prototype.timeShift=function(e,t){var i=this,r=this.calculateTargetTime(e),o=this.manifestService.getPeriodIdForTime(r);this.timeShiftCounter++;var a=this.timeShiftCounter;this.mediaPlayerController.currentPlayingPeriodId||(this.mediaPlayerController.currentPlayingPeriodId=o,this.bufferController.setInitialPeriod(o));var s=!this.initialTimeShiftContext,d=this.mediaPlayerController.getCurrentTime();s&&this.adjustTargetBufferLevel(this.calculateAvailableBufferLength()),e=Math.max(this.getMaxTimeShift(),e);var u;this.manifestService.hasMultiplePeriods()&&(u=this.getTimeShiftOffsetWithinPeriod(r,this.manifestService.getManifest().Period),this.logger.debug("timeShift, targetPeriod "+o+",  offsetWithinTargetPeriod "+u),this.mediaPlayerController.getCurrentLoadingPeriodId()!==o&&this.mediaPlayerController.switchLoadingPeriodForAllMedia(o)),this.segmentControllers.forEach(function(t){i.manifestService.hasMultiplePeriods()?t.timeShift(u):t.timeShift(e)}),this.logger.debug("shifting time... from "+this.mediaPlayerController.getCurrentTime()+" to "+r);var c=this.mediaPlayerController.getBufferedRanges(!1),l=!n.BufferRangeHelper.isInBufferedRange(c,r);l=l||r<d;var h=Promise.resolve();l&&(h=this.bufferController.clearBuffers()),this.updateInitialTimeShiftContext(!0),h["catch"](function(){i.logger.debug("Failed to clear buffers on timeShift, carrying on regardless")}).then(function(){return i.isDisposed?void i.logger.debug("Aborting timeShift as TimeShiftHandler has been terminated!"):void i.bufferController.setCurrentTime(r,o).then(function(n){i.logger.debug("successfully timeshifted to "+n),i.updateInitialTimeShiftContext(!1),i.lastTimeShiftStatus={offset:e,completionDate:Date.now(),reachedTime:n},i.timeShiftCounter===a&&t?t():t&&i.context.logger.debug("Timeshift to "+e+" has finished but a newer operation has been started")})["catch"](function(e){i.logger.debug("Failed to set currentTime on timeShift",e)})})},e.prototype.calculateTargetTime=function(e){var t=this.manifestService.getDesiredDistanceToLiveEdge(),i=this.calculateLiveEdgeInVideoTime(),n=i+(e-t);return this.manifestService.hasMultiplePeriods()&&(n=this.adjustTargetTime(n)),n},e.prototype.getTimeShiftOffsetWithinPeriod=function(e,t){for(var i=0,n=this.manifestService.getFirstPeriod(),r=n?n.start:0,o=0;o<t.length;o++){var a=this.manifestService.getPeriodDuration(t[o]._id,t);if(i+=a,i===1/0)return 0;var s=r+i;if(s>e){if(o<t.length-1)return e-s;for(var d=0,u=0;u<o;u++)d+=this.manifestService.getPeriodDuration(t[u]._id,t);return Math.min(-(a-(e-(r+d))),0)}}return 0},e.prototype.calculateAvailableBufferLength=function(){var e=this,t=this.segmentControllers.map(function(e){return e.getMPDHandler()}),i=1/0,n=Math.max.apply(Math,t.map(function(t){return i=Math.min(i,t.getSegmentDuration()),t instanceof d.SegmentListMPDHandler?t.getSegmentDuration()*e.context.settings.LIVE_SEGMENT_LIST_START_INDEX_OFFSET:0})),r=Math.min.apply(Math,t.map(function(e){return Math.abs(e.getActualTimeShiftBufferDepth())})),o=r-n;return{minSegmentDuration:i,bufferDepth:o}},e.prototype.adjustTargetBufferLevel=function(e){this.context.bufferSettings.setStreamBoundary({minimumBufferLength:e.minSegmentDuration,streamDuration:e.bufferDepth})},e.prototype.updateTimeShiftStateAfterSeek=function(e,t){this.lastTimeShiftStatus={completionDate:Date.now(),reachedTime:t,offset:e},this.updateInitialTimeShiftContext(!1)},e.prototype.updateInitialTimeShiftContext=function(e){(!this.initialTimeShiftContext||!e&&this.initialTimeShiftContext.isOngoing)&&(this.initialTimeShiftContext={timestamp:Date.now(),liveEdge:this.calculateLiveEdgeInVideoTime(),isOngoing:e})},e.prototype.setupEventHandlers=function(){this.eventHandler.on(o.PlayerEvent.Seek,this.onSeek,!0),this.eventHandler.on(o.PlayerEvent.Seeked,this.onSeeked,!0),this.eventHandler.on(a.InternalEvent.MPDUpdated,this.onManifestUpdateListener,!0)},e.prototype.removeEventHandlers=function(){this.eventHandler.off(o.PlayerEvent.Seek,this.onSeek),this.eventHandler.off(o.PlayerEvent.Seeked,this.onSeeked),this.eventHandler.off(a.InternalEvent.MPDUpdated,this.onManifestUpdateListener)},e.prototype.dispose=function(){this.removeEventHandlers(),this.isDisposed=!0},e}();t.TimeShiftHandler=u},425:function(e,t,i){"use strict";function n(e,t,i){e.hasOwnProperty(t)&&i(e[t])}Object.defineProperty(t,"__esModule",{value:!0});var r=i(33),o=i(7),a=i(22),s=.1,d=function(){function e(e){this.id=e,this.cachedSegments=[],this.mediaTypes={},this.bufferedRanges={},this.playbackTimeRange={},this.maxSegmentDurationMap=new a.ObjectMap,this.segregationCriteria={}}return e.prototype.addSegments=function(e){var t=this;e.forEach(function(e){return t.addSegment(e)})},e.prototype.addSegment=function(e){var t=e.getMimeType();e.isInit()&&this.removeLastInitSegment(t),void 0===this.periodId&&(this.periodId=e.getPeriodId());var i=e.isInit()?0:e.getDuration();this.cachedSegments.push({segment:e}),e.isInit()||(this.setMaxSegmentDuration(t,Math.max(i,this.getMaxSegmentDuration(t))),this.updateBufferedRanges(t),this.updatePlaybackTimeRange(e,t)),e.setBufferBlockId(this.id),this.updateMediaTypes(e)},e.prototype.setSegregationCriteria=function(e,t){this.getSegregationCriteria(t)||(this.segregationCriteria[t]=e)},e.prototype.updateMediaTypeForMimeType=function(e){n(this.mediaTypes,e.mimeType,function(t){n(e,"codec",function(e){t.codec=e}),n(e,"timestampOffset",function(e){t.timestampOffset=e})})},e.prototype.getSegregationCriteria=function(e){return this.segregationCriteria[e]},e.prototype.updateMediaTypes=function(e){var t=e.getMimeType();this.mediaTypes[t]?null===this.mediaTypes[t].codec&&(this.mediaTypes[t].codec=e.getCodec()):this.mediaTypes[t]={mimeType:e.getMimeType(),codec:e.getCodec(),timestampOffset:0}},e.prototype.addMediaType=function(e){!this.mediaTypes[e.mimeType]&&o.MimeTypeHelper.isAV(e.mimeType)&&(this.mediaTypes[e.mimeType]=e)},e.prototype.getMediaTypes=function(){return Object.values(this.mediaTypes)},e.prototype.removeSegment=function(e){var t=this.cachedSegments.findIndex(function(t){return t.segment===e});if(t>-1){var i=this.cachedSegments[t];this.cachedSegments.splice(t,1),this.updateBufferedRanges(i.segment.getMimeType())}},e.prototype.clearSegments=function(e){var t=this;e?(this.cachedSegments=this.cachedSegments.filter(function(t){return t.segment.getMimeType()!==e}),this.updateBufferedRanges(e)):(this.cachedSegments=[],Object.keys(this.mediaTypes).forEach(function(e){return t.updateBufferedRanges(e)}))},e.prototype.removeOldSegments=function(e,t){this.cachedSegments=this.cachedSegments.filter(function(i){var n=i.segment,r=n.isInit(),o=n.getMimeType()!==e;return r||o||n.getPlaybackTime()+n.getDuration()>=t}),this.updateBufferedRanges(e)},e.prototype.getBufferedRanges=function(){return this.bufferedRanges},e.prototype.updateBufferedRanges=function(e){var t=this.getAllSegments().filter(function(t){return t.getMimeType()===e&&!t.isInit()});this.bufferedRanges[e]=r.BufferRangeHelper.getRangesFromQueue(t,s)},e.prototype.updatePlaybackTimeRange=function(e,t){var i=this.playbackTimeRange[t],n=e.getPlaybackTime(),r=n+e.getDuration();return i?(n<i.start&&(i.start=n),void(r>i.end&&(i.end=r))):void(this.playbackTimeRange[t]={start:n,end:r})},e.prototype.getPlaybackTimeRange=function(e){return this.playbackTimeRange[e]},e.prototype.getId=function(){return this.id},e.prototype.getPeriodId=function(){return this.periodId},e.prototype.getMinCommonStartTime=function(){var e=this;return Object.keys(this.playbackTimeRange).reduce(function(t,i){return Math.max(e.playbackTimeRange[i].start,t)},-(1/0))},e.prototype.setMaxSegmentDuration=function(e,t){this.maxSegmentDurationMap.set(e,t)},e.prototype.getMaxSegmentDuration=function(e){return this.maxSegmentDurationMap.get(e)||0},e.prototype.hasMaxSegmentDuration=function(e){return this.maxSegmentDurationMap.has(e)},e.prototype.hasMaxSegmentDurations=function(){return this.maxSegmentDurationMap.size>0},e.prototype.getMinMaxSegmentDuration=function(){return Math.min.apply(null,this.maxSegmentDurationMap.values)},e.prototype.clearMaxSegmentDurations=function(){this.maxSegmentDurationMap.clear()},e.prototype.getAllSegmentsForMimeType=function(e){return this.getAllSegments().filter(function(t){return t.getMimeType()===e})},e.prototype.getAllSegments=function(){return this.cachedSegments.map(function(e){return e.segment})},e.prototype.hasDataSegments=function(e){return this.cachedSegments.some(function(t){return!t.segment.isInit()&&t.segment.getMimeType()===e})},e.prototype.hasSegments=function(){return this.getAllSegments().length>0},e.prototype.getNextSegment=function(){var e=this.cachedSegments.filter(function(e){return!e.pendingRemoval});if(0===e.length)return null;var t=e.find(function(t){return e.filter(function(e){return t.segment.getMimeType()===e.segment.getMimeType()}).some(function(e){return!e.segment.isInit()})});return t?(t.pendingRemoval=!0,t.segment):null},e.prototype.removeLastInitSegment=function(e){var t=this.getAllSegmentsForMimeType(e);if(t.length>0){var i=t[t.length-1];i.isInit()&&this.removeSegment(i)}},e}();t.BufferBlock=d},426:function(e,t,i){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},n.apply(this,arguments)},r=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var n=Array(e),r=0,t=0;t<i;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)n[r]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0});var o=i(33),a=i(4),s=i(6),d=i(5),u=i(1),c=i(15),l=i(8),h=i(35),p=i(24),f=i(23),g=i(17),m=i(103),y=i(10),S=i(7),v=i(22),T=i(3),P=i(14),I=i(2),M=i(0),b=i(456),E=i(427),R=i(428),C=i(175),A=function(){function e(e,t,i,n){var r=this;this.currentBufferBlockSwitchPromise=null,this.startupPlaybackTime=null,this.smallestSegmentDuration=null,this.isAlreadyStarted=!1,this.isStartup=!0,this.isCurrentlyStalled=!1,this.finishPlayback=!1,this.hasStreamEndedInternal=!1,this.onRendererReady=function(){r.finishPlayback||r.renderer.setDuration(r.totalDuration),r.eventHandler.on(u.PlayerEvent.PlaybackFinished,r.onPlaybackFinished),r.shouldSendLicenseRequestsImmediately()&&r.setupDRM()},this.onRendererSetupFailed=function(e){r.context.logger.debug("Renderer setup failed with",e)},this.onBufferChanged=function(e){var t=e.mimeType,i=r.renderer.getBufferedRanges(t),n=i[0];n&&r.bufferStartTimes.set(e.mimeType,n.start)},this.onQuotaExceeded=function(e){r.logger.debug("Exceeded quota for "+e.mimeType+" with "+e.bufferSize+" seconds of data in the buffers"),r.context.settings.NO_QUOTA_EXCEEDED_ADJUSTMENT||(r.logger.debug("Adjusting target buffer levels..."),r.adjustMaxBufferLevels(e.mimeType,e.bufferSize))},this.onVideoElementTimeUpdate=function(){var e=r.context.serviceManager.get(d.ServiceName.PlayerStateService),t=Date.now()-r.lastBufferClearingTimestamp>r.minimalBackwardBufferClearingInterval;!t&&e.isPlaying()||r.checkBackwardBufferLevel(),r.checkIfEndOfBufferReached(r.settings.END_OF_BUFFER_TOLERANCE)},this.onVideoElementEnded=function(){if(!r.isSwitchingBufferBlock){var e=Boolean(r.segmentStore.getNextBufferBlock(r.currentBufferBlockId));if(e){var t=r.renderer.getCurrentTime(!0);r.tryToSwitchBufferBlock(t)}}},this.onVideoElementStalled=function(){r.checkIfEndOfBufferReached(r.settings.END_OF_BUFFER_RECOVERY_TOLERANCE)},this.getTargetBufferBlock=function(e,t){return r.segmentStore.getBufferBlockForPlaybackTime(e)||r.segmentStore.getBufferBlockByPeriodId(t)},this.onPaused=function(){r.wasPlayingBeforeStall=!1},this.onPlay=function(){r.wasPlayingBeforeStall=!0},this.onPlaybackFinished=function(){r.wasPlayingBeforeStall=!1},this.context=e,this.logger=e.logger,this.settings=e.settings,this.bufferSettings=e.bufferSettings,this.eventHandler=e.eventHandler,this.renderer=e.renderer,this.manifestService=e.serviceManager.get(d.ServiceName.ManifestService),this.segmentStore=new R.SegmentStore,this.currentPlayingPeriodId=n,this.lastPlayingPeriodId=null,this.totalDuration=t,this.seekTarget=null,this.wasPlayingBeforeStall=i,this.delayedBufferBlockSwitchContext=null,this.currentBufferBlockId=R.INITIAL_BUFFER_BLOCK_ID,this.isSwitchingBufferBlock=!1,this.bufferStartTimes=new v.ObjectMap,this.isEndOfStreamReached=!1,this.lastBufferClearingTimestamp=0,this.minimalBackwardBufferClearingInterval=T.toMilliSeconds(this.context.settings.MINIMAL_BACKWARD_BUFFER_CLEARING_INTERVAL),this.discontinuitySequenceNumbers=new v.ObjectMap,this.periodSwitchMonitor=E.createPeriodSwitchMonitor(e),this.drmConfigValidPromise=Promise.resolve(null),this.renderer.ready().then(this.onRendererReady)["catch"](this.onRendererSetupFailed)}return e.prototype.getDrmConfig=function(){return b.getDrmState(this.getSourceStore().getState())},e.prototype.shouldSendLicenseRequestsImmediately=function(){var e=this.getDrmConfig();return null!=e&&e.immediateLicenseRequest},e.prototype.createSourceBuffers=function(e){var t=this,i=Promise.resolve();return this.bufferCreationDeferred=new y.Deferred,this.isStartup||(i=this.renderer.shutdown(!0)),this.bufferCreationDeferred.resolve(i.then(function(){return t.renderer.ready()}).then(function(){return e.forEach(function(e){var i=t.addMimeTypeAndCodec(e.mimeType,e.codec);i||(t.logger.debug("Could not create source buffer for "+e.mimeType),t.context.store.dispatch(p.removeMetricsForMimeType(e.mimeType)))}),t.currentRendererMediaTypes=e.filter(function(e){return S.MimeTypeHelper.isAV(e.mimeType)}),t.setupDRM(),Promise.resolve(t.currentRendererMediaTypes.length)})),this.bufferCreationDeferred.promise["catch"](function(e){return t.logger.warn(e)}).then(function(){t.bufferCreationDeferred=null}),this.bufferCreationDeferred.promise},e.prototype.setupDRM=function(){var e=this,t=this.getDrmConfig(),i=null!=t&&Object.keys(t).length>0;if(i){var r=n(n({},this.context.sourceContext.source),{drm:t}),o=this.manifestService.getDRMCapabilitiesForPeriod(this.currentPlayingPeriodId),a=Object.keys(h.KeySystemMap).some(function(e){return r.drm.hasOwnProperty(e)});a&&(this.drmConfigValidPromise=this.renderer.setDrmConfig(t,o),this.drmConfigValidPromise["catch"](function(){e.logger.warn("Could not initialize renderer with given DRM config")}))}},e.prototype.getSourceStore=function(){return this.context.serviceManager.get(d.ServiceName.SourceStoreService,this.context.sourceContext.sourceIdentifier)},e.prototype.addSegment=function(e){var t=this;this.logger.insane("adding segment to cache for period "+e.getPeriodId()+" with playback time "+e.getPlaybackTime()+"\n      and mime type "+e.getMimeType()),this.segmentStore.addSegment(e),this.cachedBufferedRanges=null;var i;if(this.delayedBufferBlockSwitchContext&&(i=this.manifestService.getPeriodIdForTime(this.delayedBufferBlockSwitchContext.time)),this.segmentStore.areBufferBlockMediaTypesFinal(e.getPeriodId())){if(this.delayedBufferBlockSwitchContext&&!this.segmentStore.canSwitchToBufferBlock(this.delayedBufferBlockSwitchContext.time,i))return Promise.resolve();var n=Promise.resolve();if(this.delayedBufferBlockSwitchContext)n=this.tryToSwitchBufferBlock(this.delayedBufferBlockSwitchContext.time);else if(this.isSwitchingBufferBlock||this.currentRendererMediaTypes||this.bufferCreationDeferred)this.bufferCreationDeferred&&(n=this.bufferCreationDeferred.promise);else{var r=this.segmentStore.getBufferBlockForSegment(e).getMediaTypes();n=this.createSourceBuffers(r)}return n.then(function(){return t.renderer.ready().then(function(){return t.processSegmentCache()})})}return Promise.resolve()},e.prototype.clearBackwardBuffer=function(e,t){var i=this,n=S.MimeTypeHelper.isAudio(e)?l.MediaType.Audio:l.MediaType.Video,r=this.bufferSettings.getBackwardTargetLevel(n),o=this.segmentStore.getBufferBlock(this.currentBufferBlockId);if(this.segmentStore.removeOldSegments(e,t-r),this.cachedBufferedRanges=null,!o||!o.hasMaxSegmentDuration(e))return Promise.resolve();var a=o.getMaxSegmentDuration(e)+1,s=t-Math.max(a,r);return s<this.bufferStartTimes.get(e)?Promise.resolve():(this.lastBufferClearingTimestamp=Date.now(),this.renderer.removeData(e,0,s)["catch"](function(t){return i.logger.debug("Error clearing "+e+" backward buffer:",t)}).then(function(){i.cachedRendererRanges=null,i.cachedBufferedRanges=null}))},e.prototype.checkBackwardBufferLevel=function(){var e=this;if(!this.isEndOfStreamReached&&!this.isSwitchingBufferBlock){var t=this.renderer.getCurrentTime(),i=this.segmentStore.getBufferBlock(this.currentBufferBlockId),n=this.segmentStore.getSmallestMaxSegmentDuration(i);n>0&&(this.minimalBackwardBufferClearingInterval=T.toMilliSeconds(n/2)),this.bufferStartTimes.forEach(function(i,n){var r=S.MimeTypeHelper.isAudio(i)?l.MediaType.Audio:l.MediaType.Video,o=e.bufferSettings.getBackwardTargetLevel(r);t-o>n&&e.clearBackwardBuffer(i,t)["catch"](function(t){e.context.logger.debug("Could not clear backward buffer",t)})})}},e.prototype.setEndOfStream=function(e){return this.isEndOfStreamReached=e,this.renderer.setEndOfStream(e)},e.prototype.getTargetBufferLevels=function(e){var t,i=S.MimeTypeHelper.isAudio(e)?l.MediaType.Audio:l.MediaType.Video;return t={},t[l.BufferType.BackwardDuration]=this.bufferSettings.getBackwardTargetLevel(i),t[l.BufferType.ForwardDuration]=this.bufferSettings.getForwardTargetLevel(i),t},e.prototype.calculateNewTargetBufferLevels=function(e,t,i){var n,r,o,a=this.getTargetBufferLevels(e),s=a[l.BufferType.ForwardDuration],d=a[l.BufferType.BackwardDuration],u=i>=2*t,c=s/(s+d);if(!isFinite(d)&&isFinite(s)?(r=t,o=i-t):isFinite(d)&&!isFinite(s)?(r=i-t,o=t):isFinite(d)&&isFinite(s)?(r=i*c,o=i*(1-c)):(r=i/2,o=i/2),r<t&&u){var h=t-r;r+=h,o-=h}return n={},n[l.BufferType.BackwardDuration]=o,n[l.BufferType.ForwardDuration]=r,n},e.prototype.adjustMaxBufferLevels=function(e,t){var i=this.renderer.getCurrentTime(),n=this.segmentStore.getSmallestSafeBufferSize(i,e),r=this.calculateNewTargetBufferLevels(e,n,t-n),o=r[l.BufferType.ForwardDuration],a=r[l.BufferType.BackwardDuration];this.logger.debug("Setting new target buffer levels to "+o+" (forward) and "+a+" (backward)"),this.bufferSettings.setMaximumBufferLevel(l.BufferType.ForwardDuration,o,l.MediaType.Audio),this.bufferSettings.setMaximumBufferLevel(l.BufferType.ForwardDuration,o,l.MediaType.Video),this.bufferSettings.setMaximumBufferLevel(l.BufferType.BackwardDuration,a,l.MediaType.Audio),this.bufferSettings.setMaximumBufferLevel(l.BufferType.BackwardDuration,a,l.MediaType.Video)},e.prototype.processSegmentCache=function(){var e=this;return this.isStartup?this.isStartupThresholdReached()?(this.updateTimestampOffsets(),this.pushSegmentsToRenderer(1/0).then(function(){return e.endStartupPhase()})):Promise.resolve():this.pushSegmentsToRenderer(1/0)},e.prototype.addSegmentsFromCacheToRenderer=function(e,t){var i=this;if(!this.segmentStore)return Promise.resolve();var n=this.segmentStore.getAllSegmentsFromBufferBlock(e),r=n.hasNext(),a=r&&n.next();return a?(a.getPeriodId()!==this.currentPlayingPeriodId&&this.eventHandler.dispatchEvent(u.PlayerEvent.PeriodSwitch,{sourcePeriod:{periodId:this.currentPlayingPeriodId},targetPeriod:{periodId:a.getPeriodId()}}),this.addPsshToRenderer(a),this.addSegmentToRenderer(a)["catch"](function(){i.logger.warn("Could not add segment to renderer mimeType: "+a.getMimeType()+",\n        playbackTime: "+a.getPlaybackTime())}).then(function(){var n=o.BufferRangeHelper.getTotalCommonBufferLength(i.getOverallBufferedRangesMap(i.currentPlayingPeriodId));return i.currentPlayingPeriodId=a.getPeriodId(),i.segmentStore&&i.segmentStore.removeSegment(a),i.cachedRendererRanges=null,i.cachedBufferedRanges=null,!i.isSwitchingBufferBlock||n<t?i.addSegmentsFromCacheToRenderer(e,t):Promise.resolve()})):Promise.resolve()},e.prototype.dispatchFinishPeriodSwitchEvent=function(){this.lastPlayingPeriodId&&this.currentPlayingPeriodId!==this.lastPlayingPeriodId&&this.eventHandler.dispatchEvent(c.InternalEvent.FinishPeriodSwitch,{targetPeriodId:this.currentPlayingPeriodId},!0)},e.prototype.pushSegmentsToRenderer=function(e){var t=this,i=this.segmentStore.getBufferBlock(this.currentBufferBlockId);return this.addSegmentsFromCacheToRenderer(i,e).then(function(){t.isRestartThresholdReached()&&t.endStalling(),t.dispatchFinishPeriodSwitchEvent(),t.lastPlayingPeriodId=t.currentPlayingPeriodId,t.isLoadingNextBufferBlock(t.currentBufferBlockId)&&!t.segmentStore.hasSegmentsForBufferBlock(i)&&(t.logger.debug("Finished loading Period: "+t.currentPlayingPeriodId+", signaling EOS"),t.currentBufferBlockSwitchPromise?(t.logger.debug("delaying EOS signal until ongoing period switch is completed"),t.currentBufferBlockSwitchPromise.then(function(){t.setEndOfStream(!0)})):t.setEndOfStream(!0))})},e.prototype.updateTimestampOffsets=function(){var e=this;this.currentRendererMediaTypes.forEach(function(t){e.renderer.setTimestampOffset(t.mimeType,-t.timestampOffset)})},e.prototype.checkIfEndOfBufferReached=function(e){var t=this.renderer.getEndOfBufferTime();if(null===t)this.renderer.isPaused()||this.startStalling();else{var i=t-e,n=this.renderer.getCurrentTime(!0);i<=n?this.handleEndOfBuffer(e):this.manifestService.isLive()&&0===n&&!this.isSwitchingBufferBlock&&this.handleEndOfBuffer(e)}},e.prototype.handleEndOfBuffer=function(e){if(!this.isSwitchingBufferBlock){var t=this.isAtEndOfBufferBlock(e),i=this.segmentStore.getNextBufferBlock(this.currentBufferBlockId),n=Boolean(i);if(t&&n){var r=this.renderer.getCurrentTime(!0),o=i.getMinCommonStartTime(),a=isFinite(o)?o:r;this.tryToSwitchBufferBlock(a)}else this.getRemainingTime()>0&&!this.finishPlayback&&this.startStalling()}},e.prototype.isAtEndOfBufferBlock=function(e){var t=this.segmentStore.getBufferBlock(this.currentBufferBlockId);if(!t.getNextSegment())return!0;var i=this.isLoadingNextBufferBlock(t.getId());return!!i},e.prototype.isLoadingNextBufferBlock=function(e){if(!this.segmentStore)return!1;var t=this.segmentStore.getNextBufferBlock(e);return t&&this.segmentStore.hasDataSegmentsForBufferBlock(t)},e.prototype.setCurrentTime=function(e,t){var i=this,n=t||this.manifestService.getPeriodIdForTime(e),r=this.getTargetBufferBlock(e,n),o=this.segmentStore.getBufferBlock(this.currentBufferBlockId),a=Boolean(!r||r.getId()!==o.getId());return this.isStartup&&(this.currentPlayingPeriodId=n),this.seekTarget=e,this.isStartup||this.isInBufferedRange(e,n)||this.startStalling(),a?this.tryToSwitchBufferBlock(e):this.renderer.setCurrentTime(e).then(function(e){return i.seekTarget=null,i.isRestartThresholdReached()&&i.endStalling(),Promise.resolve(e)})},e.prototype.tryToSwitchBufferBlock=function(e){var t=this,i=function(){};return this.isSwitchingBufferBlock=!0,null!==this.delayedBufferBlockSwitchContext&&(e=e||this.delayedBufferBlockSwitchContext.time,i=this.delayedBufferBlockSwitchContext.resolve),this.currentBufferBlockSwitchPromise=this.setEndOfStream(!1).then(function(){return t.delayedBufferBlockSwitchContext=null,t.clearRendererBuffers().then(function(){var n,r=t.manifestService.getPeriodIdForTime(e);return(null===(n=t.segmentStore)||void 0===n?void 0:n.canSwitchToBufferBlock(e,r))?t.switchBufferBlock(e,r).then(function(e){return i(e),Promise.resolve(e)}):new Promise(function(i){return t.delayedBufferBlockSwitchContext={time:e,resolve:i}})})}).then(function(e){return t.currentBufferBlockSwitchPromise=null,e})},e.prototype.shouldRecreateSourceBuffers=function(e,t){var i=this.segmentStore.getBufferBlock(this.currentBufferBlockId);return this.currentRendererMediaTypes.length!==t.length||!C.hasSameCriteria(i,e,t)},e.prototype.switchBufferBlock=function(e,t){var i=this,n=Promise.resolve(0),r=this.getTargetBufferBlock(e,t),o=r.getMediaTypes().filter(function(e){return S.MimeTypeHelper.isAV(e.mimeType)});return this.shouldRecreateSourceBuffers(r,o)&&(this.logger.debug("recreating the buffers with types",o),n=this.createSourceBuffers(o)),this.currentRendererMediaTypes=o,n.then(function(){return i.updateTimestampOffsets(),i.isEndOfStreamReached=!1,i.currentBufferBlockId=r.getId(),i.segmentStore.deleteOldBufferBlocks(r.getId()),i.pushSegmentsToRenderer(1/0).then(function(){return e})}).then(this.setCurrentTimeOnRenderer.bind(this)).then(function(e){return i.seekTarget=null,i.isSwitchingBufferBlock=!1,i.isCurrentlyStalled?i.isRestartThresholdReached()&&i.endStalling():i.renderer.play()["catch"](function(e){i.logger.debug("play call failed with reason: "+e)}),i.pushSegmentsToRenderer(1/0)["catch"](function(){return i.context.logger.debug("Could not push segment into renderer")}),e})},e.prototype.setCurrentTimeOnRenderer=function(e){var t=this.delayedBufferBlockSwitchContext;return this.delayedBufferBlockSwitchContext=null,this.renderer.setCurrentTime(e).then(function(e){return t&&t.resolve&&t.resolve(e),e})},e.prototype.addMimeTypeAndCodec=function(e,t,i){if(void 0===i&&(i=!1),!S.MimeTypeHelper.isAV(e))return!0;var n=this.renderer.addBuffer(e,t);if(n){var r=f.getMetricsState(this.context.store.getState());r[e]||this.context.store.dispatch(p.initializeMetricsForMimeType(e,this.context.settings)),i||this.context.store.dispatch(p.addMetricsValue(e,g.MetricType.StalledSeconds,0))}return n},e.prototype.setInitialPeriod=function(e){this.currentPlayingPeriodId=e},e.prototype.getLowestBufferLevel=function(e,t){var i=this;if(!this.currentRendererMediaTypes)return 0;var n=this.currentRendererMediaTypes.map(function(e){return e.mimeType}),r=n.map(function(n){return i.getOverallBufferLevel(n,e,l.BufferType.ForwardDuration,t)});return r.length>0?Math.min.apply(Math,r):0},e.prototype.addPsshToRenderer=function(e){var t=this;if(I.ModuleManager.has(M.ModuleName.ContainerMP4)){var i=I.ModuleManager.get(M.ModuleName.ContainerMP4).MP4EncryptionParser,n=new i(this.context),r=n.parsePsshBox(e);r&&r.length&&(this.periodSwitchMonitor.psshPushedToRenderer(e.getPeriodId()),r.forEach(function(i){t.logger.debug("initData found: "+i.initDataStr),i.kid&&i.kid.length>0&&t.manifestService.setRepresentationDrmKid(e.getRepresentationId(),i.kid[0]),t.renderer.addDrmInitData(i)}))}},e.prototype.isStartupThresholdReached=function(){var e=Math.abs(this.manifestService.getTimeShiftBufferDepthSeconds()),t=this.bufferSettings.getForwardTargetLevel();0!==e&&(t=Math.min(t,e));var i=Math.min(this.settings.STARTUP_THRESHOLD,t-this.settings.STARTUP_THRESHOLD_DELTA),n=this.getLowestBufferLevel();return n>=i||n>=this.getRemainingTime()},e.prototype.getInitialPlaybackTime=function(){if(this.startupPlaybackTime)return this.startupPlaybackTime;var e=this.getCurrentTimeRespectingTarget();if(!this.currentRendererMediaTypes)return e;if(this.isInBufferedRange(e))return this.startupPlaybackTime=e;var t=this.getPlaybackTimesFromSegments();return t.some(function(e){return null===e})?e:this.startupPlaybackTime=Math.max.apply(Math,t)},e.prototype.getPlaybackTimesFromSegments=function(){var e=this,t=this.currentRendererMediaTypes.map(function(e){return e.mimeType});return t.map(function(t){var i=e.segmentStore.getBufferBlock(e.currentBufferBlockId),n=new m.FilterIterator(e.segmentStore.getAllSegmentsFromBufferBlock(i,t),function(e){
return!e.isInit()});return n.hasNext()?n.next().getPlaybackTime():null})},e.prototype.getRemainingTime=function(){return this.manifestService.isLive()?1/0:this.renderer.getDuration()-this.getCurrentTimeRespectingTarget()},e.prototype.endStartupPhase=function(){if(this.isStartup){var e=Date.now(),t=f.getMetricsState(this.context.store.getState()),i=f.getMetricsLastEntry(t,"default",g.MetricType.StartTime).value,n=T.toSeconds(e-i);this.context.store.dispatch(p.addMetricsValue("default",g.MetricType.StartupTimeSeconds,n)),isNaN(n)||this.logger.debug("start up time: "+n),this.isStartup=!1,this.endStalling()}},e.prototype.addSegmentToRenderer=function(e){var t=this;return this.drmConfigValidPromise["catch"](function(){if(e.isEncrypted())return t.context.eventHandler.fireError(new s.PlayerError(a.ErrorCode.DRM_NO_KEY_SYSTEM)),Promise.reject("DRMConfig failure")}).then(function(){return!e.isInit()&&(null===t.smallestSegmentDuration||e.getDuration()<t.smallestSegmentDuration)&&(t.smallestSegmentDuration=e.getDuration()),t.maybeSetTimestampOffsetOnDiscontinuity(e),t.periodSwitchMonitor.segmentPushedToRenderer(e.getPeriodId()),t.renderer.appendData(e)["catch"](function(e){t.logger.debug("could not append data to renderer",e)})})},e.prototype.maybeSetTimestampOffsetOnDiscontinuity=function(e){if(!e.isInit()){var t=e.getSegmentInfo().discontinuitySequenceNumber,i=e.getMimeType(),n=this.discontinuitySequenceNumbers.get(i),r=t!==n;r&&(isFinite(e.getPresentationTimeOffset())&&this.renderer.setTimestampOffset(i,-e.getPresentationTimeOffset()),this.discontinuitySequenceNumbers.set(i,t))}},e.prototype.isRestartThresholdReached=function(){if(!this.bufferSettings)return!1;var e=this.bufferSettings.getForwardTargetLevel(),t=Math.min(this.settings.RESTART_THRESHOLD,e-this.settings.RESTART_THRESHOLD_DELTA,this.getRemainingTime());return this.getLowestBufferLevel()>=t},e.prototype.isAllowedToStall=function(){return!this.isStartup&&!this.isSwitchingBufferBlock},e.prototype.startStalling=function(){!this.isCurrentlyStalled&&this.isAllowedToStall()&&(this.logger.insane("internal stalling playback"),this.logger.debug("stalling playback"),this.isCurrentlyStalled=!0,this.eventHandler.dispatchEvent(c.InternalEvent.RendererStalled,{},!0))},e.prototype.endStalling=function(){if(this.isCurrentlyStalled&&!this.isSwitchingBufferBlock){var e=this.getCurrentTimeRespectingTarget(),t=this.getLowestBufferLevel(e,!1),i=t>=this.settings.RESTART_THRESHOLD,n=t<this.getRemainingTime()&&!this.finishPlayback,r=this.context.serviceManager.get(d.ServiceName.PlayerStateService).seekingOrTimeshifting;if(!i&&n&&!r){var o=this.getLowestBufferLevel(e,!0);if(o>t)return void this.eventHandler.dispatchEvent(c.InternalEvent.EndStallAtGap,{},!0)}this.logger.debug("unstalling playback"),this.isCurrentlyStalled=!1,this.eventHandler.dispatchEvent(c.InternalEvent.RendererUnstalled,{wasPlaying:this.wasPlayingBeforeStall},!0)}},e.prototype.getCurrentTimeRespectingTarget=function(){return null!=this.seekTarget?this.seekTarget:this.renderer.getCurrentTime()},e.prototype.getCurrentPlayingBufferBlockId=function(){return this.segmentStore.getAllBufferBlocks()[0].getId()},e.prototype.hasPendingSegments=function(e){return e=e||this.getCurrentPlayingBufferBlockId(),this.segmentStore.getFutureBufferBlocks(e).some(function(e){return e.hasSegments()})},e.prototype.getOverallBufferLevel=function(e,t,i,n){void 0===t&&(t=this.renderer.getCurrentTime()),void 0===i&&(i=l.BufferType.ForwardDuration),void 0===n&&(n=!0),this.isStartup&&(t=this.getInitialPlaybackTime());var r=this.getBufferedRangesMap()[e];return r&&0!==r.length?(r=n?o.BufferRangeHelper.mergeRanges(r.concat(o.BufferRangeHelper.findGapsInRanges(r)),this.settings.GAP_TOLERANCE):r.filter(function(e){return e.start<=t&&t<=e.end}),o.BufferRangeHelper.getBufferLevel(r,t,i)):0},e.prototype.hasFutureCommonBuffer=function(e){return void 0===e&&(e=this.renderer.getCurrentTime()),o.BufferRangeHelper.getCommonBufferedRanges(this.getBufferedRangesMap()).some(function(t){return t.getEnd()>e})},e.prototype.getBufferedRangesMap=function(e,t){return void 0===e&&(e=this.currentPlayingPeriodId),void 0===t&&(t=!0),e?t?this.cachedBufferedRanges&&this.cachedBufferedRanges.periodId===e?this.cachedBufferedRanges.ranges:this.getOverallBufferedRangesMap(e):this.cachedRendererRanges&&this.cachedRendererRanges.periodId===e?this.cachedRendererRanges.ranges:this.getRendererRangesMap(e):{}},e.prototype.getRendererRangesMap=function(e){var t=this,i=this.segmentStore.getMediaTypes(e).map(function(e){return e.mimeType}).filter(function(e){return S.MimeTypeHelper.isAV(e)}).reduce(function(e,i){return e[i]=t.getRendererRanges(i),e},{});return this.cachedRendererRanges={periodId:e,ranges:i},i},e.prototype.getOverallBufferedRangesMap=function(e){var t=this,i=this.segmentStore.getBufferBlock(this.currentBufferBlockId),n={};if(i){var a=this.segmentStore.getBufferedRangesFromBufferBlocks();Object.keys(a).forEach(function(e){n[e]=r(a[e]);var i=t.renderer.getBufferedRanges(e);n[e]=o.BufferRangeHelper.mergeRanges((n[e]||[]).concat(i),t.settings.GAP_TOLERANCE)})}return this.cachedBufferedRanges={periodId:e,ranges:n},n},e.prototype.hasNextBufferBlock=function(){return Boolean(this.segmentStore.getNextBufferBlock(this.currentBufferBlockId))},e.prototype.getRendererRanges=function(e){var t=this.renderer.getBufferedRanges(e);return o.BufferRangeHelper.mergeRanges(t,this.settings.GAP_TOLERANCE)},e.prototype.isInBufferedRange=function(e,t){var i=t||this.manifestService.getPeriodIdForTime(e);return o.BufferRangeHelper.isInBufferedRange(this.getBufferedRangesMap(i),e)},e.prototype.isStarted=function(){return this.isAlreadyStarted},e.prototype.hasStreamEnded=function(){return this.hasStreamEndedInternal},e.prototype.stop=function(e){void 0===e&&(e=!1),this.smallestSegmentDuration=null,this.finishPlayback=!0,this.isAlreadyStarted=!1,this.isStartup=!1,e?(this.renderer.end(),this.hasStreamEndedInternal=!0,this.logger.debug("stopped playback"),this.renderer.off(P.MediaElementEvent.stalled,this.onVideoElementStalled),this.renderer.off(P.MediaElementEvent.waiting,this.onVideoElementStalled),this.renderer.off(P.MediaElementEvent.ended,this.onVideoElementEnded),this.renderer.off(P.MediaElementEvent.timeupdate,this.onVideoElementTimeUpdate),this.eventHandler.off(c.InternalEvent.BufferChanged,this.onBufferChanged),this.eventHandler.off(c.InternalEvent.QuotaExceeded,this.onQuotaExceeded),this.eventHandler.off(c.InternalEvent.CurrentTimeNotAdvancing,this.onVideoElementStalled)):this.endStalling()},e.prototype.hasStopped=function(){return this.finishPlayback},e.prototype.restart=function(){this.eventHandler.off(u.PlayerEvent.PlaybackFinished,this.onPlaybackFinished),this.finishPlayback=!1,this.isAlreadyStarted||(this.isAlreadyStarted=!0,this.renderer.on(P.MediaElementEvent.stalled,this.onVideoElementStalled),this.renderer.on(P.MediaElementEvent.waiting,this.onVideoElementStalled),this.renderer.on(P.MediaElementEvent.ended,this.onVideoElementEnded),this.renderer.on(P.MediaElementEvent.timeupdate,this.onVideoElementTimeUpdate),this.eventHandler.on(c.InternalEvent.BufferChanged,this.onBufferChanged,!0),this.eventHandler.on(c.InternalEvent.QuotaExceeded,this.onQuotaExceeded,!0),this.eventHandler.on(c.InternalEvent.CurrentTimeNotAdvancing,this.onVideoElementStalled,!0)),this.smallestSegmentDuration=null,this.hasStreamEndedInternal=!1},e.prototype.dispose=function(){this.eventHandler.off(u.PlayerEvent.PlaybackFinished,this.onPlaybackFinished),this.stop(!0),this.renderer=null,this.eventHandler=null,this.settings=null,this.bufferSettings=null,this.eventHandler=null,this.segmentStore=null,this.currentRendererMediaTypes=null,this.drmConfigValidPromise=null},e.prototype.addRequiredMediaType=function(e,t){this.segmentStore.addRequiredMediaType(e,t)},e.prototype.updateMediaType=function(e,t){this.segmentStore.updateMediaType(e,t)},e.prototype.areMediaTypesFinal=function(e){return this.segmentStore.areBufferBlockMediaTypesFinal(e)},e.prototype.areBufferBlockMediaTypesFinal=function(e){return this.segmentStore.areBufferBlockMediaTypesFinal(e)},e.prototype.clearCache=function(e){this.segmentStore.clearSegments(e),this.cachedBufferedRanges=null},e.prototype.clearBuffers=function(){return this.clearCache(),this.clearRendererBuffers()},e.prototype.clearRendererBuffers=function(){var e=this;if(!this.currentRendererMediaTypes)return Promise.resolve();var t=this.currentRendererMediaTypes.map(function(t){return e.clearBuffer(t.mimeType)});return Promise.all(t).then(function(){})},e.prototype.clearBuffer=function(e){var t=this;return this.renderer.removeData(e)["catch"](function(i){return t.logger.debug("Error clearing "+e+" buffer:",i)}).then(function(){t.cachedRendererRanges=null,t.cachedBufferedRanges=null})},e}();t.BufferController=A},427:function(e,t,i){"use strict";function n(e){var t=s.getCapabilities();return t[a.CapabilityKey.isTizen]||t[a.CapabilityKey.isWebOS]?new l(e):t[a.CapabilityKey.isChrome]?new h(e):{isPeriodSwitchSafe:function(){return!0},psshPushedToRenderer:function(){},segmentPushedToRenderer:function(){}}}var r=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=i(5),a=i(100),s=i(21),d=i(433),u=i(49);t.createPeriodSwitchMonitor=n;var c=function(){function e(e){this.context=e,this.periodList={}}return e.prototype.psshPushedToRenderer=function(e){this.periodList[e]=!0},e.prototype.segmentPushedToRenderer=function(e){null!=this.periodList[e]&&(this.periodList[e]=!1)},e.prototype.isPeriodProtected=function(e){if(null==this.periodList[e]){var t=this.context.serviceManager.get(o.ServiceName.ManifestService).getPeriod(new u.PeriodId(e));this.periodList[e]=d.isPeriodEncrypted(t)}return this.periodList[e]},e}(),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isPeriodSwitchSafe=function(){return!1},t}(c),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasPlayedInEncryptedPeriod=!1,t}return r(t,e),t.prototype.psshPushedToRenderer=function(t){this.hasPlayedInEncryptedPeriod=!0,e.prototype.psshPushedToRenderer.call(this,t)},t.prototype.isPeriodSwitchSafe=function(e){return!!this.hasPlayedInEncryptedPeriod||!this.isPeriodProtected(e)},t}(c)},428:function(e,t,i){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},n.apply(this,arguments)},r=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var n=Array(e),r=0,t=0;t<i;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)n[r]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0});var o=i(103),a=i(7),s=i(425),d=i(175);t.INITIAL_BUFFER_BLOCK_ID=0;var u=.01,c=function(){function e(){this.requiredMediaTypes={},this.delayedMediaTypeToUpdate={},this.delayedMediaTypeToSet={};var e=new s.BufferBlock(t.INITIAL_BUFFER_BLOCK_ID);this.requiredMediaTypes={},this.segregation=new d.Segregation(this.requiredMediaTypes),this.bufferBlocks=[e],this.currentBufferBlock=e}return e.prototype.getBufferedRangesFromBufferBlocks=function(){var e=this.getCurrentBufferBlockId(),t=this.getFutureBufferBlocks(e),i={};return t.forEach(function(e){var t=e.getBufferedRanges();Object.keys(t).forEach(function(e){i[e]?i[e]=r(i[e],t[e]):i[e]=t[e]})}),i},e.prototype.getBufferBlockByPeriodId=function(e){return this.bufferBlocks.find(function(t){return t.getPeriodId()===e})},e.prototype.hasSegmentsForBufferBlock=function(e){return this.getAllSegmentsFromBufferBlock(e).hasNext()},e.prototype.hasDataSegmentsForBufferBlock=function(e){var t=Object.keys(e.mediaTypes).filter(function(e){return a.MimeTypeHelper.isAV(e)});return t.every(function(t){return e.hasDataSegments(t)})},e.prototype.isBufferBlockWithPlaybackTime=function(e){var t=this.bufferBlocks.filter(function(t){var i=Object.keys(t.mediaTypes);return i.every(function(i){var n,r;return(null===(n=t.getPlaybackTimeRange(i))||void 0===n?void 0:n.start)>=e&&(null===(r=t.getPlaybackTimeRange(i))||void 0===r?void 0:r.start)-t.getMaxSegmentDuration(i)<e})});return Boolean(t.length)},e.prototype.getRelatedBufferBlock=function(e,t){var i=this.getBufferBlockForPlaybackTime(e);return!i&&this.isBufferBlockWithPlaybackTime(e)&&t&&(i=this.getBufferBlockByPeriodId(t)),i},e.prototype.canSwitchToBufferBlock=function(e,t){var i=this.getRelatedBufferBlock(e,t);if(!i)return!1;var n=this.areBufferBlockMediaTypesFinal(i.getPeriodId(),e),r=this.hasDataSegmentsForBufferBlock(i);return r&&n},e.prototype.areBufferBlockMediaTypesFinal=function(e,t){var i,n=this;if(void 0!==t&&(i=this.getBufferBlockForPlaybackTime(t)),i||(i=this.getBufferBlockByPeriodId(e)),!i||!i.mediaTypes||0===Object.keys(i.mediaTypes).length)return!1;if(void 0===this.requiredMediaTypes[e])return!1;var r=Object.keys(i.mediaTypes),o=Object.keys(this.requiredMediaTypes[e]).filter(function(e){return a.MimeTypeHelper.isAV(e)});return o.every(function(t){var i;return r.includes(t)&&(null===(i=n.requiredMediaTypes[e][t])||void 0===i?void 0:i.codec)})},e.prototype.addRequiredMediaType=function(e,t){var i=this.getBufferBlockByPeriodId(e);if(this.requiredMediaTypes[e]||(this.requiredMediaTypes[e]={}),this.requiredMediaTypes[e][t]||(this.requiredMediaTypes[e][t]={mimeType:t,codec:null,timestampOffset:0}),i){var n=i.mediaTypes[t];n||i.addMediaType({mimeType:t,codec:null,timestampOffset:0})}else this.delayedMediaTypeToSet[e]||(this.delayedMediaTypeToSet[e]={}),this.delayedMediaTypeToSet[e][t]={mimeType:t,codec:null,timestampOffset:0}},e.prototype.updateRequiredMediaTypes=function(e,t){var i;if(this.requiredMediaTypes[e]){var r=this.requiredMediaTypes[e][t.mimeType];this.requiredMediaTypes[e][t.mimeType]=n(n({},r),t)}else this.requiredMediaTypes[e]=(i={},i[t.mimeType]=t,i)},e.prototype.updateMediaType=function(e,t){var i;this.updateRequiredMediaTypes(e,t);var r=this.getBufferBlockByPeriodId(e);r?r.updateMediaTypeForMimeType(t):this.delayedMediaTypeToUpdate[e]=n(n({},this.delayedMediaTypeToUpdate[e]||{}),(i={},i[t.mimeType]=t,i))},e.prototype.addSegment=function(e){var t=this.segregation.getSegregationCriteria(e),i=this.segregation.canAddSegmentToBufferBlock(e,this.currentBufferBlock,t),n=this.bufferBlocks.find(function(i){var n=i.getSegregationCriteria(e.getMimeType());return d.areSegregationCriteriaEqual(t,n)});i?this.currentBufferBlock.addSegment(e):n?(n.addSegment(e),this.currentBufferBlock=n):this.createNewBufferBlock(e,t);var r=e.getPeriodId(),o=e.getMimeType();this.delayedMediaTypeToSet[r]&&this.delayedMediaTypeToSet[r][o]&&(this.addRequiredMediaType(r,o),delete this.delayedMediaTypeToSet[r][o]),this.delayedMediaTypeToUpdate[r]&&this.delayedMediaTypeToUpdate[r][o]&&(this.updateMediaType(r,this.delayedMediaTypeToUpdate[r][o]),delete this.delayedMediaTypeToUpdate[r][o])},e.prototype.createNewBufferBlock=function(e,t){var i=this.bufferBlocks[this.bufferBlocks.length-1].getId()+1,n=new s.BufferBlock(i);n.addSegment(e),this.bufferBlocks.push(n),this.currentBufferBlock=n,n.setSegregationCriteria(t,e.getMimeType())},e.prototype.getMediaTypes=function(e){var t=this;return e&&this.requiredMediaTypes[e]?Object.keys(this.requiredMediaTypes[e]).map(function(i){return t.requiredMediaTypes[e][i]}):[]},e.prototype.getAllBufferBlocks=function(){return this.bufferBlocks},e.prototype.getCurrentBufferBlockId=function(){return this.bufferBlocks[0].getId()},e.prototype.deleteOldBufferBlocks=function(e){this.bufferBlocks=this.bufferBlocks.filter(function(t){return t.getId()>=e&&t.getAllSegments().length>0})},e.prototype.getActiveBufferBlock=function(){return this.getBufferBlock(this.getCurrentBufferBlockId())},e.prototype.getBufferBlock=function(e){return this.bufferBlocks.find(function(t){return t.getId()===e})},e.prototype.getBufferBlockForSegment=function(e){return this.getBufferBlock(e.getBufferBlockId())},e.prototype.getBufferBlockForPlaybackTime=function(e){var t=this.bufferBlocks.filter(function(t){var i=Object.keys(t.mediaTypes);return i.every(function(i){var n,r;return(null===(n=t.getPlaybackTimeRange(i))||void 0===n?void 0:n.start)<=e+u&&(null===(r=t.getPlaybackTimeRange(i))||void 0===r?void 0:r.end)>e})});return t[t.length-1]},e.prototype.getNextSegment=function(){return this.getActiveBufferBlock().getNextSegment()},e.prototype.removeSegment=function(e){var t=this.getBufferBlockForSegment(e);t&&t.removeSegment(e)},e.prototype.getAllSegmentsFromBufferBlock=function(e,t){if(!e)return o.EmptyIterator.getInstance();var i=e.getAllSegments();return t?new o.FilterIterator(new o.ArrayIterator(i),function(e){return e.getMimeType()===t}):new o.ArrayIterator(i)},e.prototype.getNextBufferBlock=function(e){var t=this.bufferBlocks.find(function(t){return t.getId()>e});return t||null},e.prototype.getFutureBufferBlocks=function(e){return this.bufferBlocks.filter(function(t){return t.getId()>=e})},e.prototype.removeOldSegments=function(e,t){this.bufferBlocks.forEach(function(i){return i.removeOldSegments(e,t)})},e.prototype.clearSegments=function(e){this.bufferBlocks.forEach(function(t){return t.clearSegments(e)})},e.prototype.getSmallestMaxSegmentDuration=function(e){var t=Boolean(e)&&e.hasMaxSegmentDurations();return t?e.getMinMaxSegmentDuration():-1},e.prototype.getSmallestSafeBufferSize=function(e,t){var i=this.getBufferBlockForPlaybackTime(e);return i.hasMaxSegmentDuration(t)?i.getMaxSegmentDuration(t)+1:1},e}();t.SegmentStore=c},429:function(e,t,i){"use strict";function n(e,t){switch(e.type){case a.StreamType.Dash:var i=s.ModuleManager.get(d.ModuleName.DASH).MPDLoader;return new i(t);case a.StreamType.Hls:var n=s.ModuleManager.get(d.ModuleName.HLS).M3u8Loader;return new n(t);case a.StreamType.Smooth:var u=s.ModuleManager.get(d.ModuleName.Smooth).SmoothStreamingLoader;return new u(t);default:throw new o.PlayerError(r.ErrorCode.SOURCE_INVALID)}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(4),o=i(6),a=i(8),s=i(2),d=i(0);t.createManifestLoadingService=n},430:function(e,t,i){"use strict";function n(e){var t;return e._requestTimestamp+d.toMilliSeconds((t=e._updateInterval,null!==t&&void 0!==t?t:1/0))>Date.now()}Object.defineProperty(t,"__esModule",{value:!0});var r=i(5),o=i(15),a=i(46),s=i(36),d=i(3),u=i(40),c=i(431),l=i(434),h=function(){function e(e){var t=this;this.trackUpdaters={},this.selectActiveTracks=function(e){var t;return null===(t=e)||void 0===t?void 0:t.activeTracks},this.handleActiveTracksChange=function(e){e&&t.manifestService.isHlsManifest()&&t.updateTracks(e)},this.selectPlaybackState=function(e){return e.player&&e.player.playbackState},this.handlePlaybackStateChange=function(e){e&&(e===a.PlaybackState.Paused?t.stop():e===a.PlaybackState.Playing&&t.start())},this.updatedRepresentation=function(e){t.updateAdaptationSetInManifest(e),t.updateManifest(t.manifestService.getManifest())["catch"](function(){t.logger.debug("Updating the manifest failed")})},this.representationUpdateError=function(e){t.logger.debug("Rejection while updating the representation",e)},this.updateManifest=function(e){return t.manifestService.updateManifest(e).then(function(){return t.publishUpdatedManifest(e)})},this.manifestDownloadError=function(){t.logger.debug("Error while loading manifest")},this.manifestService=e.serviceManager.get(r.ServiceName.ManifestService),this.manifestLoader=e.serviceManager.get(r.ServiceName.ManifestLoadingService),this.store=e.store,this.sourceStore=e.serviceManager.get(r.ServiceName.SourceStoreService,e.sourceContext.sourceIdentifier),this.eventHandler=e.eventHandler,this.logger=e.logger,this.activeTrackUnsubscribe=this.subscribeToActiveTrackChanges(),this.pausePlayingUnsubscribe=this.subscribeToPausePlayingChanges(e)}return e.prototype.subscribeToActiveTrackChanges=function(){var e=this;return s.subscribe(this.sourceStore)(function(t){return e.selectActiveTracks(t)},this.handleActiveTracksChange)},e.prototype.updateTracks=function(e){this.processNewActiveTrack(e),this.removeDeactivatedTrackUpdaters(e)},e.prototype.processNewActiveTrack=function(e){var t=this;Object.keys(e).forEach(function(i){t.updateTrackUpdater(e[i].selectedRepresentationId)})},e.prototype.removeDeactivatedTrackUpdaters=function(e){var t=this;Object.keys(this.trackUpdaters).filter(function(t){return!Object.keys(e).includes(t)}).forEach(function(e){t.trackUpdaters[e].stop(),delete t.trackUpdaters[e]})},e.prototype.subscribeToPausePlayingChanges=function(e){return s.subscribe(this.store)(this.selectPlaybackState,this.handlePlaybackStateChange,function(){return e.settings.STOP_DOWNLOAD_ON_PAUSE})},e.prototype.updateTrackUpdater=function(e){var t=this.manifestService.getRepresentationById(e),i=e.adaptationSetId;if(this.trackUpdaters[i]){if(!this.trackUpdaters[i].getRepresentation()._internalId.equals(e)){var n=this.trackUpdaters[i];n.setRepresentation(t)}}else this.trackUpdaters[t._internalId.adaptationSetId]=this.initializeTrackUpdater(t)},e.prototype.initializeTrackUpdater=function(e){var t=new l.RepresentationUpdater(e,this.manifestLoader,{success:this.updatedRepresentation,error:this.representationUpdateError});return t.start(),t},e.prototype.updateAdaptationSetInManifest=function(e){this.sourceStore.dispatch(u.updateRepresentationAction(e))},e.prototype.init=function(e){var t=this;return this.manifestLoader.load(e).then(function(e){return t.updateManifest(e).then(function(){t.manifestService.isLive()&&!t.manifestService.isHlsManifest()&&t.scheduleManifestReloading(e)})})},e.prototype.scheduleManifestReloading=function(e){this.manifestUpdater=new c.ManifestUpdater(this.manifestLoader,e,{success:this.updateManifest,error:this.manifestDownloadError}),this.manifestUpdater.start()},e.prototype.publishUpdatedManifest=function(e){this.eventHandler.dispatchEvent(o.InternalEvent.MPDAvailable,{manifest:e},!0),this.eventHandler.dispatchEvent(o.InternalEvent.MPDUpdated,{manifest:e},!0)},e.prototype.waitForRepUpdate=function(e){if(0===Object.keys(this.trackUpdaters).length)return Promise.resolve();var t=this.manifestService.getRepresentationById(e);return n(t)?Promise.resolve():this.trackUpdaters[e.adaptationSetId].updateRepresentation().then(function(){})},e.prototype.stop=function(){Object.values(this.trackUpdaters).forEach(function(e){return e.stop()}),this.manifestUpdater&&this.manifestUpdater.stop()},e.prototype.start=function(){Object.values(this.trackUpdaters).filter(function(e){return e.isStopped}).forEach(function(e){e.start()}),this.manifestUpdater&&this.manifestUpdater.isStopped&&this.manifestUpdater.start()},e.prototype.dispose=function(){this.activeTrackUnsubscribe(),this.pausePlayingUnsubscribe(),this.stop(),this.manifestUpdater=null,this.trackUpdaters=null},e}();t.ManifestUpdateScheduler=h},431:function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=i(176),o=i(74),a=function(e){function t(t,i,n){var r=e.call(this,n)||this;return r.manifestLoader=t,r.manifest=i,r}return n(t,e),t.prototype.getUpdatedManifest=function(){return this.getPayload()},t.prototype.update=function(){var e=this;return this.manifestLoader.load(this.manifest._currentLoadingUrl).then(function(t){return e.manifest=t,t})},t.prototype.getReloadIntervalInSeconds=function(){return o.getMinimumUpdatePeriodInSeconds(this.manifest)},t.prototype.getLastReloadTimestamp=function(){return this.manifest._requestTimestamp},t}(r.AbstractUpdater);t.ManifestUpdater=a},432:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(5),r=i(1),o=i(49),a=function(){function e(){}return e.create=function(t,i){var r=i.serviceManager.get(n.ServiceName.ManifestService);return new(function(){function i(){r.isHlsManifest()?this.hls=e.createHlsApi(r):r.isSmoothManifest()||(this.dash=e.createDashApi(t,r))}return i}())},e.createDashApi=function(t,i){return new(function(){function n(){}return n.prototype.getPeriod=function(){var n=i.getPeriodIdForTime(t.getCurrentTime()),r=i.getPeriod(new o.PeriodId(n));return r?e.createPeriodApi(i,r):null},n.prototype.listPeriods=function(){return i.getAllPeriods().map(function(t){return e.createPeriodApi(i,t)})},n}())},e.createHlsApi=function(t){return new(function(){function i(){this.properties=t.getHlsTags()}return i.prototype.getVideoTracks=function(){return e.getVideoTracks(t,t.getFirstPeriod()._id)},i.prototype.getAudioTracks=function(){return e.getAudioTracks(t,t.getFirstPeriod()._id)},i.prototype.getTextTracks=function(){return e.getTextTracks(t,t.getFirstPeriod()._id)},i}())},e.createPeriodApi=function(t,i){return new(function(){function n(){this.id=i._id,this.properties={},i._id&&(this.properties.id=i._id),i._start&&(this.properties.start=i._start),i._duration&&(this.properties.duration=i._duration)}return n.prototype.getVideoTracks=function(){return e.getVideoTracks(t,this.id)},n.prototype.getAudioTracks=function(){return e.getAudioTracks(t,this.id)},n.prototype.getTextTracks=function(){return e.getTextTracks(t,this.id)},n.prototype.getMetadata=function(){return e.getMetadata(t,this.id)},n}())},e.getAudioTracks=function(t,i){return t.getAvailableAudio(i,!1).map(function(n){var r={id:n.id,label:n.label,lang:n.lang,getQualities:function(){return e.getAudioQualities(t,i,n.id)}};return n.role&&(r.role=n.role),r})},e.getVideoTracks=function(t,i){return t.getAvailableVideo(i).map(function(n){var r={id:n.id,label:n.label,getQualities:function(){return e.getVideoQualities(t,i)}};return n.role&&(r.role=n.role),r})},e.getTextTracks=function(e,t){return e.getAvailableSubtitles(t)},e.getMetadata=function(e,t){return e.getEventStreamEvents(e.findPeriod(t)).map(function(e){return{type:r.MetadataType.EVENT_STREAM,payload:e.data,start:e.startTime,end:e.endTime}})},e.getAudioQualities=function(e,t,i){var n=e.getAudioRepresentations(t);return n[i]||[]},e.getVideoQualities=function(e,t){return e.getVideoRepresentations(t)},e}();t.MediaPlayerManifestApiFactory=a},433:function(e,t,i){"use strict";function n(e){return!!e&&(!!o(e)||e.AdaptationSet.some(r))}function r(e){return!!a.MimeTypeHelper.isAV(e._mimeType)&&(!!o(e)||e.Representation.some(o))}function o(e){return e.ContentProtection&&e.ContentProtection.length>0}Object.defineProperty(t,"__esModule",{value:!0});var a=i(7);t.isPeriodEncrypted=n},434:function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=i(176),o=function(e){function t(t,i,n){var r=e.call(this,n)||this;return r.representation=t,r.manifestLoader=i,r}return n(t,e),t.prototype.getRepresentation=function(){return this.representation},t.prototype.setRepresentation=function(e){this.representation._internalId.equals(e._internalId)||this.cancel(),this.representation=e,this.scheduleUpdate()},t.prototype.updateRepresentation=function(){return this.getPayload()},t.prototype.update=function(){var e=this;return this.manifestLoader.updateRepresentation(this.representation).then(function(t){return e.representation=t,t})},t.prototype.getReloadIntervalInSeconds=function(){var e;return this.representation._requestTimestamp?(e=this.representation._updateInterval,null!==e&&void 0!==e?e:1/0):0},t.prototype.getLastReloadTimestamp=function(){return this.representation._requestTimestamp?this.representation._requestTimestamp:0},t}(r.AbstractUpdater);t.RepresentationUpdater=o},435:function(e,t,i){"use strict";function n(e,t,i){return new r.UrlInitSegmentProvider(e,t,i)}Object.defineProperty(t,"__esModule",{value:!0});var r=i(446);t.createInitSegmentProvider=n},436:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(19),r=i(435),o=function(){function e(e,t,i){this.context=e,this.provider=r.createInitSegmentProvider(e,t,i)}return e.prototype.getSegment=function(e){return this.provider.getSegment(e)},e.prototype.hasCachedSegment=function(e){return Boolean(this.getCachedSegment(e))},e.prototype.getCachedSegment=function(e){return this.provider.getCachedSegment(e)},e.prototype.removeCachedSegments=function(e){this.provider.removeCachedSegments(e)},e.prototype.dispose=function(){this.provider=n.dispose(this.provider)},e}();t.InitSegmentService=o},437:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(4),r=i(6),o=i(16),a=i(12),s=function(){function e(e){this.context=e,this.settings=e.settings,this.loader=new o.DefaultContentLoader(this.context,{maxRetries:this.settings.MAX_RETRIES,retryDelay:this.settings.RETRY_DELAY,requestType:a.HttpRequestType.KEY_HLS_AES})}return e.prototype.hasWithCredentials=function(){var e=this.context.sourceContext.source&&this.context.sourceContext.source.hasOwnProperty("options"),t=e&&this.context.sourceContext.source.options,i=t&&t.hasOwnProperty("withCredentials")&&t.withCredentials,n=t&&t.hasOwnProperty("hlsWithCredentials")&&t.hlsWithCredentials;return Boolean(i)||Boolean(n)},e.prototype.load=function(e){var t=this;return this.loader.load(e,a.HttpRequestMethod.GET,a.HttpResponseType.ARRAYBUFFER,null,null,this.hasWithCredentials()).then(function(e){return e.body})["catch"](function(e){return t.context.eventHandler.fireError(new r.PlayerError(n.ErrorCode.DRM_FAILED_LICENSE_REQUEST,{statusCode:e.status,statusText:e.statusText})),Promise.reject(e)})},e.prototype.isLoading=function(){return this.loader.isLoading()},e.prototype.dispose=function(){this.loader&&"function"==typeof this.loader.dispose&&this.loader.dispose(),this.loader=null,this.settings=null},e}();t.KeyLoader=s},438:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=20,r=function(){function e(e){void 0===e&&(e=n),this.CAPACITY=e,this.keys=[]}return e.prototype.get=function(e){var t=this.keys.find(function(t){return t.uri===e});return t?t.buffer:null},e.prototype.put=function(e,t){this.keys.push({uri:e,buffer:t}),this.keys.length>this.CAPACITY&&this.keys.shift()},e.prototype.dispose=function(){this.keys=null},e}();t.KeyStore=r},439:function(e,t,i){"use strict";function n(e,t){return e.config.tweaks.segmentLoaderArgs?e.config.tweaks.segmentLoaderArgs:{maxRetries:e.settings.MAX_CDN_RETRIES,requestType:r(t),disableDownloadTimeout:!0,resetRetriesWhenOffline:!0}}function r(e){return d.MimeTypeHelper.isVideo(e)?s.HttpRequestType.MEDIA_VIDEO:d.MimeTypeHelper.isAudio(e)?s.HttpRequestType.MEDIA_AUDIO:d.MimeTypeHelper.isSubtitle(e)?s.HttpRequestType.MEDIA_SUBTITLES:d.MimeTypeHelper.isUnknown(e)?s.HttpRequestType.INTERNAL:s.HttpRequestType.UNKNOWN}function o(e,t){var i=e.config.tweaks.segmentLoader;return i&&"function"==typeof i?new i(t):new a.DefaultContentLoader(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(16),s=i(12),d=i(7);t.getLoaderConfig=n,t.getLoader=o},440:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(4),r=i(5),o=i(1),a=i(2),s=i(0),d=i(107),u=function(){function e(){}return e.createInstance=function(e,t,i,u,c){void 0===u&&(u="0");var l=e.serviceManager.get(r.ServiceName.ManifestService),h=null;if(l.hasAdaptationSets(u)){var p=l.findAdaptationSet(u,t,c);if(!p)return e.logger.debug("Did not find adaptation set for mime type ["+t+"] in period "+u),
null;var f=p.Representation&&p.Representation[0],g=f&&f.SegmentTemplate?f.SegmentTemplate:p.SegmentTemplate;if(g)if(l.isSmoothManifest()){var m=a.ModuleManager.get(s.ModuleName.Smooth),y=m.createSmoothSegmentTemplateMPDHandler();h=new y(e,t,i)}else if(g[0].SegmentTimeline){var S=a.ModuleManager.get(s.ModuleName.DASH);h=new S.SegmentTimelineMPDHandler(e)}else{var S=a.ModuleManager.get(s.ModuleName.DASH);h=new S.SegmentTemplateMPDHandler(e)}else if(f.SegmentList)h=new d.SegmentListMPDHandler(e);else if(f.SegmentBase){var v=a.ModuleManager.get(s.ModuleName.DASH);h=new v.SegmentBaseMPDHandler(e)}else h=null,e.eventHandler.fireEvent(o.PlayerEvent.Error,{code:n.ErrorCode.SOURCE_MANIFEST_INVALID})}return h},e}();t.MPDHandlerFactory=u},441:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(11),r=function(){function e(){}return e.findSegmentInfoOfRepresentation=function(t,i){if(i.SegmentList){var n=i.SegmentList[0].SegmentURL,r=t.getUrl(),o=n.find(function(t){var n=e.getSegmentInfoUrl(t,i);return n===r});if(o)return o}return null},e.findHlsRepresentationForSegment=function(t,i){for(var n=!1,r=0;r<i.Representation.length;r++){var o=i.Representation[r],a=o.SegmentList[0].SegmentURL,s=void 0;for(s=0;s<a.length;s++){var d=a[s],u=e.getSegmentInfoUrl(d,o);if(u===t.getUrl()){n=!0;break}}if(n)return{representation:o,index:s}}return null},e.getSegmentInfoUrl=function(e,t){var i=e._media;return n.URLHelper.isUrlAbsolute(i)||(i=n.URLHelper.concatUrlParts(t.BaseURL[0],i)),i},e}();t.SegmentInfoProvider=r},442:function(e,t,i){"use strict";function n(e,t,i){var n=!e||!e.length,a=t<e[0].startTime+e[0].duration;if(n||a)return 0;var s=e.length-1,d=e[s];if(t>=d.startTime)return s;var u=Math.max(t-e[0].startTime,0),c=Math.floor(u/i);return r(e[0])&&r(e[c])?o(e,t,c):null}function r(e){return e&&"number"==typeof e.startTime}function o(e,t,i){for(var n=e.length-1;e[i].startTime>t||t>=e[i].startTime+e[i].duration;){if(t<e[i].startTime?i--:i++,i<=0)return 0;if(i>=n)return n;if(!r(e[i]))return null}return i}Object.defineProperty(t,"__esModule",{value:!0}),t.findSegmentInfoForTime=n},443:function(e,t,i){"use strict";function n(e,t){var i=d.MimeTypeHelper.extractContentType(e);return t&&"number"==typeof t[i]?Math.max(h,t[i]):h}function r(e){return e&&e.drm&&e.drm.clearkey&&e.drm.clearkey.length>0}Object.defineProperty(t,"__esModule",{value:!0});var o=i(24),a=i(23),s=i(17),d=i(7),u=i(2),c=i(0),l=i(108),h=1,p=function(){function e(e,t){this.context=e,this.mimeType=t.mimeType,this.codec=t.codec,this.loaders=[],this.shouldDownloadBeCancelledCallback=t.shouldDownloadBeCancelledCallback,this.createLoaders(n(this.mimeType,e.settings.SEGMENT_LOADER_POOL_SIZE)),this.attachDecrypter()}return e.prototype.createLoaders=function(e){for(var t=0;t<e;t++)this.loaders.push(new l.SegmentLoader(this.context,this.mimeType,this.codec,this.shouldDownloadBeCancelledCallback))},e.prototype.getDecrypter=function(e){if(this.context.segmentPrefetchingService&&this.context.segmentPrefetchingService.hasMp4Decrypter(this.mimeType))return this.context.segmentPrefetchingService.getDecrypter(this.mimeType);var t=u.ModuleManager.get(c.ModuleName.Crypto).createDecrypter;return t(this.context,this.mimeType,e.drm.clearkey)},e.prototype.attachDecrypter=function(){var e=this.context.sourceContext.source,t=r(e)?this.getDecrypter(e):null;t&&(this.loaders.forEach(function(e){return e.attachDecrypter(t)}),this.context.segmentPrefetchingService&&this.context.segmentPrefetchingService.setDecrypter(t,this.mimeType))},e.prototype.isLoading=function(){return this.loaders.some(function(e){return e.isLoading()})},e.prototype.isFreeLoaderAvailable=function(){return this.loaders.some(function(e){return!e.isLoading()})},e.prototype.updateRequestedRepresentationMetric=function(e){var t=a.getMetricsHistoryFromInstanceState(this.context.store.getState(),"default",s.MetricType.RequestedRepresentations),i=t?t.map(function(e){return e.value}):[];i.includes(e)||this.context.store.dispatch(o.addMetricsValue("default",s.MetricType.RequestedRepresentations,e))},e.prototype.load=function(e){var t=this.loaders.find(function(e){return!e.isLoading()});return t?(this.updateRequestedRepresentationMetric(e.internalRepresentationId),this.context.logger.debug("Loading "+e.url+" with loader "+this.loaders.indexOf(t)),t.load(e)):(this.context.logger.debug("Failed to load segment. No free loader!",e.url),Promise.reject(null))},e.prototype.cancelLoading=function(){var e=this;return Promise.all(this.loaders.map(function(e){return e.isLoading()&&e.cancelLoading(),Promise.resolve(e.getCurrentLoadPromise())})).then(function(){})["catch"](function(t){e.context&&e.context.logger.debug("Error while loading a segment ",t)})},e.prototype.getLoadingPeriodIds=function(){return this.loaders.flatMap(function(e){return e.getAllLoadingPeriodIds()})},e.prototype.dispose=function(){this.cancelLoading(),this.loaders.forEach(function(e){return e.dispose()}),this.loaders=null,this.context=null},e}();t.SegmentLoaderPool=p,t.getLoaderPoolSize=n},444:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(37),r=i(22),o=i(108),a=function(){function e(e){var t=this;this.processSegmentInfoQueue=function(e){var i=t.segmentInfoQueue.get(e);i&&0!==i.length&&t.chainSegmentPrefetch(i.shift()).then(function(){return t.processSegmentInfoQueue(e)})},this.segmentInfoQueue=new n.ArrayMap,this.prefetchPromiseChainMap=new r.ObjectMap,this.decrypterMap=new r.ObjectMap,this.segmentLoaderMap=new r.ObjectMap,this.segmentPrefetchHandler=e,this.shouldDownloadBeCancelledCallbackMap=new r.ObjectMap}return e.prototype.updateContext=function(e){this.context=e},e.prototype.setShouldDownloadBeCancelledCallback=function(e,t){this.shouldDownloadBeCancelledCallbackMap.set(e,t)},e.prototype.removeShouldDownloadBeCancelledCallback=function(e){this.shouldDownloadBeCancelledCallbackMap["delete"](e)},e.prototype.setDecrypter=function(e,t){this.decrypterMap.set(t,e),this.segmentLoaderMap.has(t)&&this.segmentLoaderMap.get(t).attachDecrypter(e)},e.prototype.removeDecrypter=function(e){this.decrypterMap["delete"](e)},e.prototype.getDecrypter=function(e){return this.decrypterMap.get(e)},e.prototype.prefetchSegment=function(e){return this.chainSegmentPrefetch(e)},e.prototype.prefetchSegments=function(e){var t=this;e.forEach(function(e){return t.segmentInfoQueue.add(e.mimeType,e)}),this.segmentInfoQueue.keys.forEach(function(e){return t.processSegmentInfoQueue(e)})},e.prototype.chainSegmentPrefetch=function(e){var t=this,i=this.getPrefetchPromiseChain(e.mimeType).then(function(){return t.fetchSegment(e)}).then(function(){})["catch"](function(){});return this.prefetchPromiseChainMap.set(e.mimeType,i),i},e.prototype.fetchSegment=function(e){var t=this,i=this.getLoader(e),n=i.load(e).then(function(e){return e.read()}).then(function(e){return e.value});return this.segmentPrefetchHandler.onPrefetch({segmentInfo:e,loadingPromise:n}),n["catch"](function(i){t.context&&t.context.logger.debug("segment prefetching failed for",e,"with",i)}),n},e.prototype.getPrefetchPromiseChain=function(e){return this.prefetchPromiseChainMap.has(e)||this.prefetchPromiseChainMap.set(e,Promise.resolve()),this.prefetchPromiseChainMap.get(e)},e.prototype.getLoader=function(e){return this.segmentLoaderMap.has(e.mimeType)||this.segmentLoaderMap.set(e.mimeType,this.createLoader(e)),this.segmentLoaderMap.get(e.mimeType)},e.prototype.createLoader=function(e){this.prefetchPromiseChainMap.set(e.mimeType,Promise.resolve());var t=new o.SegmentLoader(this.context,e.mimeType,e.codec,this.createDownloadCancelCallbackFunction(e),(!0));return t.attachDecrypter(this.decrypterMap.get(e.mimeType)),t},e.prototype.createDownloadCancelCallbackFunction=function(e){var t=this;return function(i){var n=e.mimeType,r=t.segmentLoaderMap.get(n),o=r?r.getCurrentLoadingSegmentInfo():null,a=o?o.internalRepresentationId:e.internalRepresentationId;return!(!t.shouldDownloadBeCancelledCallbackMap||!t.shouldDownloadBeCancelledCallbackMap.has(n))&&t.shouldDownloadBeCancelledCallbackMap.get(n)(i,a)}},e.prototype.clearPrefetchingQueue=function(e){this.segmentInfoQueue["delete"](e)},e.prototype.reset=function(){this.segmentLoaderMap.values.forEach(function(e){return e.dispose()}),this.shouldDownloadBeCancelledCallbackMap.clear(),this.segmentLoaderMap.clear(),this.decrypterMap.clear()},e.prototype.dispose=function(){this.reset(),this.context=null,this.segmentLoaderMap=null,this.shouldDownloadBeCancelledCallbackMap=null},e}();t.SegmentPrefetcher=a},445:function(e,t,i){"use strict";function n(e){var t=new c.Stream;return t.add(e),t.end(),t}Object.defineProperty(t,"__esModule",{value:!0});var r=i(19),o=i(7),a=i(22),s=i(436),d=i(179),u=i(443),c=i(65),l=function(){function e(e){var t=this;this.context=e,this.disposeSegmentManager=function(e){t.segmentManagerMap["delete"](e)},this.segmentManagerMap=new a.ObjectMap}return e.prototype.getSegmentManagerKey=function(e,t){var i=void 0===t?{}:t,n=i.id,r=i.lang;return o.MimeTypeHelper.isSubtitle(e)?[e,n,r].filter(Boolean).join("-"):e},e.prototype.add=function(e,t,i){var n=this.get(e.mimeType,i);return n||(n=new h(this.context,e,t),this.segmentManagerMap.set(this.getSegmentManagerKey(e.mimeType,i),n)),n},e.prototype.get=function(e,t){return this.segmentManagerMap.get(this.getSegmentManagerKey(e,t))},e.prototype.disposeOfType=function(e,t){this.disposeSegmentManager(this.getSegmentManagerKey(e,t))},e.prototype.dispose=function(){this.segmentManagerMap.keys.forEach(this.disposeSegmentManager)},e}();t.SegmentService=l;var h=function(){function e(e,t,i){this.context=e,this.loaderPool=new u.SegmentLoaderPool(e,t),this.initSegmentService=new s.InitSegmentService(e,this.loaderPool,i),this.cache=new d.SegmentCache(e.settings.MAX_NUM_CACHED_SEGMENTS),this.sequence=Promise.resolve(null)}return e.prototype.getSegment=function(e){var t=e.isInitSegment?this.getInitSegment(e):this.getDataSegment(e);return this.sequence=this.sequence["catch"](function(){}).then(function(){return t}),this.sequence},e.prototype.getInitSegment=function(e){return this.initSegmentService.getSegment(e).then(n)},e.prototype.getDataSegment=function(e){return this.hasCachedSegment(e)?(this.context.logger.debug("Returning segment from cache for URL: "+e.url),Promise.resolve(n(this.getCachedSegment(e)))):this.loaderPool.load(e)},e.prototype.isLoading=function(e){return e?this.loaderPool.getLoadingPeriodIds().includes(e):this.loaderPool.getLoadingPeriodIds().length>0},e.prototype.canLoad=function(){return this.loaderPool.isFreeLoaderAvailable()},e.prototype.cacheSegment=function(e){this.cache.add(e)},e.prototype.hasCachedSegment=function(e){return Boolean(this.getCachedSegment(e))},e.prototype.getCachedSegment=function(e){return e.isInitSegment?this.initSegmentService.getCachedSegment(e):this.cache.get(e)},e.prototype.removeCachedInitSegments=function(e){this.initSegmentService.removeCachedSegments(e)},e.prototype.clearCache=function(e){void 0===e&&(e=!0),e&&this.initSegmentService.removeCachedSegments(function(){return!0}),this.cache.clear()},e.prototype.cancel=function(){return this.loaderPool.cancelLoading()},e.prototype.dispose=function(){this.cancel(),this.clearCache(!1),this.loaderPool=r.dispose(this.loaderPool),this.initSegmentService=r.dispose(this.initSegmentService)},e}();t.SegmentManager=h},446:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(24),r=i(17),o=i(179),a=function(){function e(e,t,i){this.context=e,this.loaderPool=t,this.cache=new o.SegmentCache(1/0),this.parser=i}return e.prototype.getSegment=function(e){var t=this,i=this.cache.get(e);return i?Promise.resolve(i):this.loadSegment(e).then(function(e){return t.parser.parseSegment(e),t.cacheSegment(e),e})},e.prototype.loadSegment=function(e){return this.loaderPool.load(e).then(function(e){return e.read()}).then(function(t){if(!t.value)throw new Error("SegmentStream error "+e.url);return t.value})},e.prototype.cacheSegment=function(e){this.cache.add(e),this.context.store.dispatch(n.addMetricsValue(e.getMimeType(),r.MetricType.CachedInitSegments,{internalRepId:e.getSegmentInfo().internalRepresentationId}))},e.prototype.getCachedSegment=function(e){return this.cache.get(e)},e.prototype.removeCachedSegments=function(e){this.cache.remove(e)},e.prototype.dispose=function(){this.cache.clear()},e}();t.UrlInitSegmentProvider=a},447:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e.Aborted="aborted",e.ParallelRead="parallelread"}(n=t.StreamReadError||(t.StreamReadError={}))},448:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e.Open="open",e.Ended="ended",e.Aborted="aborted"}(n=t.StreamState||(t.StreamState={}))},449:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1),r=function(){function e(e){var t=this;this.context=e,this.onSeek=function(){t.seekStarted=!0},this.onSeeked=function(){var e=t.context.internalPlayer.getCurrentTime();Object.values(t.delayedSegmentPlaybackData).forEach(function(i){e>=i.playbackTime&&i.playbackTime+i.duration>=e&&t.maybeFirePeriodSwitchEvents(i)}),t.delayedSegmentPlaybackData={}},this.currentDiscontinuityNumbers={},this.delayedSegmentPlaybackData={},this.seekStarted=!1,this.context.eventHandler.on(n.PlayerEvent.Seek,this.onSeek,!0),this.context.eventHandler.on(n.PlayerEvent.Seeked,this.onSeeked,!0)}return e.prototype.onSegmentAvailable=function(e){if(!e.isInit()){var t=e.getMimeType(),i=e.getSegmentInfo();this.currentDiscontinuityNumbers[t]?this.seekStarted&&(this.delayedSegmentPlaybackData[e.getMimeType()]={mimeType:e.getMimeType(),discontinuitySequenceNumber:i.discontinuitySequenceNumber,playbackTime:i.startTime,duration:e.getDuration()},this.seekStarted=!1):this.currentDiscontinuityNumbers[t]={discontinuitySequenceNumber:i.discontinuitySequenceNumber,startTime:i.startTime||0}}},e.prototype.maybeFirePeriodSwitchEvents=function(e){var t=e.mimeType,i=e.discontinuitySequenceNumber,r=e.playbackTime;if(null!=i&&this.currentDiscontinuityNumbers[t]){var o=this.currentDiscontinuityNumbers[t].discontinuitySequenceNumber;o!==i&&(this.shouldFirePeriodSwitchEvent(t,i,r)&&(this.context.eventHandler.dispatchEvent(n.PlayerEvent.PeriodSwitch),this.context.eventHandler.dispatchEvent(n.PlayerEvent.PeriodSwitched,{sourcePeriod:{periodId:String(o)},targetPeriod:{periodId:String(i)}})),this.currentDiscontinuityNumbers[t]={discontinuitySequenceNumber:i,startTime:r})}},e.prototype.shouldFirePeriodSwitchEvent=function(e,t,i){var n=this,r=Object.keys(this.currentDiscontinuityNumbers).filter(function(t){return t!==e}),o=!0;return r.forEach(function(e){var r=n.currentDiscontinuityNumbers[e];if(r.discontinuitySequenceNumber===t){var a=Math.abs(i-r.startTime);a<1&&(o=!1)}}),o},e.prototype.dispose=function(){this.context.eventHandler.off(n.PlayerEvent.Seek,this.onSeek),this.context.eventHandler.off(n.PlayerEvent.Seeked,this.onSeeked)},e}();t.DiscontinuityMonitor=r},450:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(11),r=function(){function e(e){this.triedRepsForCurrentSegment={},this.wasQualitySwitched=!1,this.context=e}return e.prototype.downloadSuccess=function(e){return this.wasQualitySwitched&&e?void(this.wasQualitySwitched=!1):void(this.triedRepsForCurrentSegment={})},e.prototype.getNextLowerNotTriedQuality=function(e,t){for(var i=[],n=0;n<e.length&&!e[n]._internalId.equals(t);n++)this.triedRepsForCurrentSegment[e[n]._id]||i.push(e[n]);return i.length>0?i[i.length-1]._internalId:null},e.prototype.getNextHigherNotTriedQuality=function(e,t){for(var i=!1,n=0;n<e.length;n++)if(e[n]._internalId.equals(t))i=!0;else if(i&&!this.triedRepsForCurrentSegment[e[n]._id])return e[n]._internalId;return null},e.prototype.switchQuality=function(e,t){this.triedRepsForCurrentSegment[t.representationId]=!0;var i=this.getNextLowerNotTriedQuality(e,t);return i||(i=this.getNextHigherNotTriedQuality(e,t)),i?(this.wasQualitySwitched=!0,i):(this.context.logger.log("no quality left, all tried"),null)},e.prototype.switchBaseURL=function(e){var t=e.availableBaseURLs,i=e.lastUsedBaseURLIndex+1;return i%=t.length,i===e.firstUsedBaseURLIndex?(this.context.logger.log("no base url left, all tried"),null):(e.lastUsedBaseURLIndex=i,e.baseURL=t[i],e.url=n.URLHelper.concatBaseUrlWithPartial(e.baseURL,e.mediaURL),e)},e.prototype.shouldTryAlternatives=function(e){return e>=400&&e<=599||0===e},e}();t.SegmentUnavailabilityHandler=r},451:function(e,t,i){"use strict";function n(e,t,i){for(var n=t,r=i;n>=0;)e[n]._playbackTime=r,r-=e[n]._duration,n--;for(n=t+1,r=i+e[t]._duration;n<e.length;)e[n]._playbackTime=r,r+=e[n]._duration,n++}function r(e){return e.metadata&&e.metadata.length>0&&e.metadata[0].type===c.MetadataType.CUSTOM}function o(e){var t=e.getSegmentInfo();return{uid:e.getUid(),url:e.getUrl(),mimeType:e.getMimeType(),playbackTime:e.getPlaybackTime(),presentationTimestamp:e.getBaseMediaDecodeTime()/e.getTimescale(),duration:e.getDuration(),mediaInfo:e.getMediaInfo(),wallClockTime:t.wallClockTime,discontinuitySequenceNumber:t.discontinuitySequenceNumber}}function a(e){var t=o(e),i=e.getSegmentInfo();return i.dateTime&&(t.dateTime=i.dateTime),i.representationId&&(t.representationId=i.representationId),t}var s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},s.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var d=i(5),u=i(19),c=i(1),l=i(157),h=i(96),p=i(24),f=i(23),g=i(17),m=i(7),y=i(58),S=i(449),v=function(){function e(e){var t,i=this;this.context=e,this.onGenericMetadataAvailable=function(e){if(e.hasOwnProperty("metadata")){var t={metadataType:e.metadataType.toUpperCase(),metadata:e.metadata};(e.start||0===e.start)&&(t.start=e.start),e.end&&(t.end=e.end),i.context.eventHandler.dispatchEvent(c.PlayerEvent.Metadata,t)}},this.inbandMetadataCallback=function(e){e&&e.hasOwnProperty("metadataType")&&i.context.eventHandler.dispatchEvent(c.PlayerEvent.Metadata,{metadataType:e.metadataType,metadata:e.metadata})},this.onSegmentPlayback=function(e){var t=e.metadata.event;i.currentlyPlayedSegment[t.mimeType]=t,i.discontinuityMonitor.maybeFirePeriodSwitchEvents(t),i.previousRepresentationIds[t.mimeType]&&i.previousRepresentationIds[t.mimeType].id===t.representationId||i.handlePlaybackInfo(t),i.playbackRepresentationId[t.mimeType]=y.RepresentationId.from(e.metadata.representationId),i.context.eventHandler.dispatchEvent(c.PlayerEvent.SegmentPlayback,t)},this.previousRepresentationIds={},this.playbackRepresentationId={},this.currentlyPlayedSegment={},this.manifestService=this.context.serviceManager.get(d.ServiceName.ManifestService);var n=(t={},t[h.TimedMetadataType.InBand]=this.inbandMetadataCallback,t[h.TimedMetadataType.SegmentPlayback]=this.onSegmentPlayback,t[h.TimedMetadataType.Manifest]=this.onGenericMetadataAvailable,t[h.TimedMetadataType.EventStream]=this.onGenericMetadataAvailable,t[h.TimedMetadataType.DateRange]=this.onGenericMetadataAvailable,t[h.TimedMetadataType.CustomTag]=this.onGenericMetadataAvailable,t);this.metadataService=new l.MetadataService(e,n),this.discontinuityMonitor=new S.DiscontinuityMonitor(e)}return e.prototype.onSegmentAvailable=function(e){var t,i=this,n=e.segment,s=e.extractedMetadata,d=e.isSegmentOfMainStream,u=e.presentationTimeOffset;if(d){t=a(n);var c=n.getSegmentInfo();c.metadata&&c.metadata.forEach(function(e){i.processSegmentInfoMetadata(e,t,n.getPeriodId())}),r(c)&&this.handleCustomMetadata(c),this.handleId3Metadata(s,u,n.getPeriodId())}else t=o(n);this.registerSegmentPlaybackEvent(n,t),n.getInbandEvents().forEach(function(e){i.processInbandEvent(e,n.getPeriodId())}),this.discontinuityMonitor.onSegmentAvailable(n)},e.prototype.registerSegmentPlaybackEvent=function(e,t){if(!e.isInit()){var i=e.getSegmentInfo(),n=e.getMimeType(),r={_periodId:i.internalRepresentationId.periodId,_adaptationSetId:i.internalRepresentationId.adaptationSetId,_representationId:i.internalRepresentationId.representationId},o={metadata:{event:t,representationId:r,mimeType:n}};this.metadataService.addToTimeline(h.TimedMetadataType.SegmentPlayback,t.playbackTime,o);var a=f.getMetricsState(this.context.store.getState());a[n]||this.context.store.dispatch(p.initializeMetricsForMimeType(n,this.context.settings)),this.context.store.dispatch(p.addMetricsValue(n,g.MetricType.SegmentInformation,{bitrate:8*e.getNetworkRequestSize()/e.getDuration(),duration:e.getDuration(),playbackTime:i.startTime||e.getPlaybackTime(),representationId:e.getRepresentationId()}))}},e.prototype.parseEventStream=function(){var e=this;this.manifestService.getAllPeriods().forEach(function(t){e.manifestService.getEventStreamEvents(t).forEach(function(i){e.processEventStreamEvent(i,t)})})},e.prototype.processEventStreamEvent=function(e,t){var i={metadataType:c.MetadataType.EVENT_STREAM,metadata:e.data,start:e.startTime,end:e.endTime},n=this.metadataService.addToMetadataParsedService(h.TimedMetadataType.EventStream,e.startTime,s(s({},i),{data:e.data}),t._id);n&&this.metadataService.addToTimeline(h.TimedMetadataType.EventStream,e.startTime,i)},e.prototype.getPlaybackRepresentation=function(e){var t=this.context.serviceManager.get(d.ServiceName.ManifestService),i=s({},t.getRepresentationById(this.playbackRepresentationId[e]));return i&&this.currentlyPlayedSegment[e]&&(i.uid=this.currentlyPlayedSegment[e].uid),i},e.prototype.handlePlaybackInfo=function(e){var t,i;m.MimeTypeHelper.isAudio(e.mimeType)?(t=c.PlayerEvent.AudioPlaybackQualityChanged,i={id:e.representationId,bitrate:parseFloat(e.mediaInfo.bitrate)}):m.MimeTypeHelper.isVideo(e.mimeType)&&(t=c.PlayerEvent.VideoPlaybackQualityChanged,i={id:e.representationId,bitrate:parseFloat(e.mediaInfo.bitrate),width:parseFloat(e.mediaInfo.width),height:parseFloat(e.mediaInfo.height)}),t&&this.context.eventHandler.dispatchEvent(t,{targetQuality:i,sourceQuality:this.previousRepresentationIds[e.mimeType]||null}),this.previousRepresentationIds[e.mimeType]=i},e.prototype.processDateRangeEvent=function(e,t){var i={metadataType:c.MetadataType.DATERANGE,metadata:e.data,start:e.startTime,end:e.endTime},n=this.metadataService.addToMetadataParsedService(h.TimedMetadataType.DateRange,e.startTime,s(s({},i),{data:e.data}),t);n&&this.metadataService.addToTimeline(h.TimedMetadataType.DateRange,e.startTime,i)},e.prototype.addSegmentToMetadataParsedService=function(e,t){var i=this;e.forEach(function(e){if(e._metadata&&e._playbackTime){var n={metadataType:c.MetadataType.CUSTOM,metadata:e._metadata,data:e._metadata,start:e._playbackTime,end:e._playbackTime+e._duration};i.metadataService.addToMetadataParsedService(h.TimedMetadataType.CustomTag,e._playbackTime,n,t)}})},e.prototype.handleId3Metadata=function(e,t,i){var n=this;e&&Array.isArray(e.id3)&&e.id3.length>0&&e.id3.forEach(function(e){n.publishId3Metadata(e,t,i)})},e.prototype.publishId3Metadata=function(e,t,i){var n=e.presentationTime-t,r={metadataType:c.MetadataType.ID3,metadata:e.data,start:n},o=this.metadataService.addToMetadataParsedService(h.TimedMetadataType.InBand,n,s(s({},r),{data:e.data}),i);o&&this.metadataService.addToTimeline(h.TimedMetadataType.InBand,n,r)},e.prototype.handleCustomMetadata=function(e){var t=this,i=this.manifestService.getRepresentationById(e.internalRepresentationId);i.SegmentList[0].SegmentURL.forEach(function(r,o){r._media===e.url&&(r._playbackTime||n(i.SegmentList[0].SegmentURL,o,e.startTime),t.metadataService.addToTimeline(h.TimedMetadataType.CustomTag,e.startTime,{metadataType:c.MetadataType.CUSTOM,metadata:r._metadata,start:e.startTime,end:e.startTime+e.duration}))}),this.addSegmentToMetadataParsedService(i.SegmentList[0].SegmentURL,e.periodId)},e.prototype.processInbandEvent=function(e,t){var i=e.presentationTime,n={metadataType:c.MetadataType.EMSG,metadata:e,start:i},r=this.metadataService.addToMetadataParsedService(h.TimedMetadataType.InBand,i,s(s({},n),{data:e}),t);r&&this.metadataService.addToTimeline(h.TimedMetadataType.InBand,i,n)},e.prototype.processSegmentInfoMetadata=function(e,t,i){var n=e.type;if(n===c.MetadataType.CUSTOM)t.EXPERIMENTAL=t.EXPERIMENTAL||{},t.EXPERIMENTAL.hlsAttributes=t.EXPERIMENTAL.hlsAttributes||[],t.EXPERIMENTAL.hlsAttributes=t.EXPERIMENTAL.hlsAttributes.concat(e.attributes);else{var r=void 0;r=/^CUE-(IN|OUT(-CONT)?)$/.test(n)?c.MetadataType.CUETAG:c.MetadataType[e.type];var o={metadataType:r,metadata:e,start:t.playbackTime},a=this.metadataService.addToMetadataParsedService(h.TimedMetadataType.Manifest,t.playbackTime,s(s({},o),{data:e}),i);a&&this.metadataService.addToTimeline(h.TimedMetadataType.Manifest,t.playbackTime,o)}},e.prototype.dispose=function(){this.metadataService=u.dispose(this.metadataService),this.manifestService=null,this.discontinuityMonitor=u.dispose(this.discontinuityMonitor),this.context=null},e}();t.TimedMetadataService=v},452:function(e,t,i){"use strict";var n,r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},r.apply(this,arguments)},o=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]]);return i};Object.defineProperty(t,"__esModule",{value:!0});var a=i(26),s=i(181),d={},u=function(e,t){return r(r({},e),t)},c=function(e,t){var i=t.adaptationSetId.adaptationSetId,n=(e[i],o(e,["symbol"==typeof i?i:i+""]));return r({},n)};t.ActiveTracksReducer=a["default"]({},(n={},n[s.ActiveTracksActionType.SetSelectedRepresentationId]=function(e,t){var i=t.payload;return u(e,i)},n[s.ActiveTracksActionType.RemoveActiveTrack]=function(e,t){var i=t.payload;return c(e,i)},n[s.ActiveTracksActionType.ClearActiveTracks]=function(){return d},n))},453:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(452),r=i(455),o=i(182);t.engineBitmovinSourceReducers={manifest:r.ManifestReducer,activeTracks:n.ActiveTracksReducer,playingTracks:o.PlayingTracksReducer}},454:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(25),r=i(183);t.setPlayingPeriodId=function(e){return n.createAction(r.PlayingTracksActionKey.SetPlayingPeriodId,e)}},455:function(e,t,i){"use strict";function n(e,t){return t.payload.manifest||e}function r(e,t){return 0===t.payload.representationIds.length?e:P.removeRepresentations(e,t.payload.representationIds)}function o(e,t){return t.payload.offset?y(y({},e),{Period:e.Period.map(function(e){return y(y({},e),{start:e.start+t.payload.offset})})}):e}function a(e,t){if(!e.Period)return e;var i=t.periodId,n=t.timing,r=e.Period.findIndex(function(e){return e._id===i});if(r<0)return e;var o=S(e.Period);return o[r]=y(y({},o[r]),n),y(y({},e),{Period:o})}function s(e,t){return y(y({},e),t)}function d(e,t){var i,n,r,o=t,a=o._internalId;if(!e.Period)return e;var s=e.Period.findIndex(function(e){return e._id===a.periodId}),d=null===(i=e.Period[s])||void 0===i?void 0:i.AdaptationSet.findIndex(function(e){return e._internalId.equals(a)}),u=null===(r=null===(n=e.Period[s])||void 0===n?void 0:n.AdaptationSet[d])||void 0===r?void 0:r.Representation.findIndex(function(e){return e._internalId.equals(a)}),c=y({},e);c.Period=S(c.Period),c.Period[s]=y({},c.Period[s]);var l=c.Period[s];l.AdaptationSet=S(l.AdaptationSet),l.AdaptationSet[d]=y({},l.AdaptationSet[d]);var h=l.AdaptationSet[d];return h.Representation=S(h.Representation),h.Representation[u]=o,c}function u(e,t){var i,n=t.payload,r=n.representationId,o=n.associatedKid,a=function(e){return e._internalId.equals(r)&&!e.associatedKid?o:e.associatedKid};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){return y(y({},e),{associatedKid:a(e)})})})})})})})}function c(e,t){var i,n=t.payload,r=n.adaptationSetId,o=n.segment,a=function(e,t){var i=e._media;return T.URLHelper.isUrlAbsolute(i)||(i=T.URLHelper.concatUrlParts(t.BaseURL[0],i)),i===o.getUrl()};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return e._internalId.equals(r)?y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{SegmentList:null===(t=e.SegmentList)||void 0===t?void 0:t.map(function(t){var i;return y(y({},t),{SegmentURL:null===(i=t.SegmentURL)||void 0===i?void 0:i.map(function(t){return y(y({},t),{downloaded:a(t,e)})})})})})})}):y({},e)})})})})}function l(e,t){var i,n=t.payload.representationId,r=function(e){return!!e._internalId.equals(n)||e.hasFailedToLoad};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){return y(y({},e),{hasFailedToLoad:r(e)})})})})})})})}function h(e,t){var i,n=t.payload,r=n.representationId,o=n.isLoading,a=function(e){return e._internalId.equals(r)?o:e.isLoading};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){return y(y({},e),{isLoading:a(e)})})})})})})})}function p(e,t){var i,n=t.payload,r=n.representationId,o=n.segmentIndex,a=function(e){return e._internalId.equals(r)?o:e.segmentIndex};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){return y(y({},e),{segmentIndex:a(e)})})})})})})})}function f(e,t){var i,n=t.payload,r=n.representationId,o=n.segmentIndexParsingError,a=function(e){return e._internalId.equals(r)?o:e.segmentIndexParsingError};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){return y(y({},e),{segmentIndexParsingError:a(e)})})})})})})})}function g(e,t){var i,n=t.payload,r=n.representationId,o=n.anchorPoint,a=function(e){return e._internalId.equals(r)?o:e.anchorPoint};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){return y(y({},e),{anchorPoint:a(e)})})})})})})})}var m,y=this&&this.__assign||function(){return y=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},y.apply(this,arguments)},S=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var n=Array(e),r=0,t=0;t<i;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)n[r]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0});var v=i(26),T=i(11),P=i(75),I=i(184);t.ManifestReducer=v["default"]({},(m={},
m[I.ManifestActionType.SetManifest]=n,m[I.ManifestActionType.RemoveRepresentations]=r,m[I.ManifestActionType.UpdateManifest]=function(e,t){var i=t.payload;return s(e,i)},m[I.ManifestActionType.UpdateRepresentation]=function(e,t){var i=t.payload;return d(e,i)},m[I.ManifestActionType.AdjustPeriodStartTimes]=o,m[I.ManifestActionType.UpdatePeriodTiming]=function(e,t){var i=t.payload;return a(e,i)},m[I.ManifestActionType.SetRepresentationDrmKid]=u,m[I.ManifestActionType.MarkSegmentAsDownloaded]=c,m[I.ManifestActionType.SetRepresentationFailedDownload]=l,m[I.ManifestActionType.SetRepresentationIsLoading]=h,m[I.ManifestActionType.SetRepresentationSegmentIndex]=p,m[I.ManifestActionType.SetRepresentationSegmentIndexParsingError]=f,m[I.ManifestActionType.SetRepresentationAnchorPoint]=g,m))},456:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDrmState=function(e){return e.drm}},49:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._periodId=e}return Object.defineProperty(e.prototype,"periodId",{get:function(){return this._periodId},enumerable:!0,configurable:!0}),e.prototype.equals=function(e){return e&&this.periodId===e.periodId},e.prototype.key=function(){return this.periodId},e}();t.PeriodId=n},57:function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=i(49),o=function(e){function t(t,i){var n=e.call(this,t)||this;return n._adaptationSetId=i,n}return n(t,e),Object.defineProperty(t.prototype,"adaptationSetId",{get:function(){return this._adaptationSetId},enumerable:!0,configurable:!0}),t.prototype.equals=function(t){return e.prototype.equals.call(this,t)&&this.adaptationSetId===t.adaptationSetId},t.prototype.key=function(){return e.prototype.key.call(this)+"-"+this.adaptationSetId},t}(r.PeriodId);t.AdaptationSetId=o},58:function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=i(57),o=function(e){function t(t,i){var n=e.call(this,t.periodId,t.adaptationSetId)||this;return n._representationId=i,n}return n(t,e),Object.defineProperty(t.prototype,"representationId",{get:function(){return this._representationId},enumerable:!0,configurable:!0}),t.prototype.equals=function(t){return e.prototype.equals.call(this,t)&&this.representationId===t.representationId},t.prototype.key=function(){return e.prototype.key.call(this)+"-"+this.representationId},t.from=function(e){return e._representationId&&e._adaptationSetId&&e._periodId?new t(new r.AdaptationSetId(e._periodId,e._adaptationSetId),e._representationId):null},t}(r.AdaptationSetId);t.RepresentationId=o},65:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(10),r=i(447),o=i(448),a=function(){function e(e){var t=this;this.resolveDeferredRead=function(){t.deferredRead&&!t.isEmpty()&&(t.deferredRead.resolve({done:!1,value:t.chunks.shift()}),t.deferredRead=null)},this.state=o.StreamState.Open,this.chunks=[],this.dataType=e,this.deferredEnded=new n.Deferred,this.deferredEnded.promise["catch"](function(){})}return e.prototype.getType=function(){return this.dataType},e.prototype.add=function(e){this.state===o.StreamState.Open&&(this.chunks.push(e),this.resolveDeferredRead())},e.prototype.read=function(){if(this.deferredRead)return Promise.reject({name:r.StreamReadError.ParallelRead});if(this.state===o.StreamState.Ended&&this.isEmpty())return Promise.resolve({done:!0});if(this.state===o.StreamState.Aborted)return Promise.reject({name:r.StreamReadError.Aborted,message:this.getError()});this.deferredRead=new n.Deferred;var e=this.deferredRead.promise;return this.resolveDeferredRead(),e},e.prototype.end=function(){this.state===o.StreamState.Open&&(this.state=o.StreamState.Ended,this.deferredRead&&this.isEmpty()&&(this.deferredRead.resolve({done:!0}),this.deferredRead=null),this.deferredEnded.resolve())},e.prototype.abort=function(e){if(this.state===o.StreamState.Open){this.state=o.StreamState.Aborted,this.error=e;var t={name:o.StreamState.Aborted,message:this.getError()};this.deferredRead&&(this.deferredRead.reject(t),this.deferredRead=null),this.deferredEnded.reject(t)}},e.prototype.transform=function(t,i,n){var r=this,o=new e(this.dataType),a=function(){r.read().then(function(e){var n=e.done,r=e.value;if(n)i&&i(),o.end();else{var s=t(r);s&&o.add(s),a()}})["catch"](function(e){n?o.abort(n(e)):o.abort(e)})};return a(),o},e.prototype.isEmpty=function(){return 0===this.chunks.length},e.prototype.getError=function(){return this.error||null},e}();t.Stream=a},66:function(e,t,i){"use strict";function n(e){var t;return a.createAction(s.ActiveTracksActionType.SetSelectedRepresentationId,(t={},t[e.adaptationSetId]={selectedRepresentationId:e},t))}function r(e){return a.createAction(s.ActiveTracksActionType.RemoveActiveTrack,{adaptationSetId:e})}function o(){return a.createAction(s.ActiveTracksActionType.ClearActiveTracks)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(25),s=i(181);t.setRepresentationIdAction=n,t.removeActiveTrackAction=r,t.clearActiveTracksAction=o},74:function(e,t,i){"use strict";function n(e){return 0===e.indexOf("_")?e.substring(1):e}function r(e,t,i){return void 0===i&&(i=[]),Object.keys(e).filter(function(e){return 0===i.length||i.indexOf(e)>-1}).forEach(function(i){t[n(i)]=e[i]}),t}function o(e,t,i){if(!e)return null;var n={id:e._id?String(e._id):null,bitrate:e._bandwidth||0},r=m.CodecStringHelper.extractCodecStrings(e._codecs||i);return d(e,t)?a(n,e,r):s(e,t)?u(n,e,r):(n.label=e._label||c(n.bitrate),n)}function a(e,t,i){return i.audio&&(e.codec=i.audio),e.label=t._label||c(e.bitrate),e}function s(e,t){return S.MimeTypeHelper.isVideo(t)}function d(e,t){return S.MimeTypeHelper.isAudio(t)}function u(e,t,i){e.width=t._width||0,e.height=t._height||0,i.video&&(e.codec=i.video),t.hasOwnProperty("_frameRate")&&(e.frameRate=t._frameRate);var n=c(e.bitrate);return e.width&&e.height&&(n=e.width+"x"+e.height+", "+n),e.label=t._label||n,e}function c(e){return Math.round(e/1e3)+"kbps"}function l(e,t){return Boolean(e.role&&e.role.some(function(e){return["forced_subtitle"].includes(e.value)}))||Boolean(t._hls&&t._hls.isForced)}function h(e){return null==e._minimumUpdatePeriod?1/0:y.DurationConverter.getDurationInSec(e._minimumUpdatePeriod)}Object.defineProperty(t,"__esModule",{value:!0});var p=i(5),f=i(8),g=i(47),m=i(30),y=i(56),S=i(7),v=i(3),T=i(13),P=i(2),I=i(0),M=i(40),b=i(76),E=function(){function e(e){var t=this;this.isLive=function(){return"dynamic"===t.getMpd()._type},this.context=e,this.settings=e.settings,this.adjustedPeriodStartTimes=!1,this.synchronizedTimeService=e.serviceManager.get(p.ServiceName.SynchronizedTimeService),this.sourceStore=e.serviceManager.get(p.ServiceName.SourceStoreService,e.sourceContext.sourceIdentifier)}return e.prototype.getMpd=function(){return b.getManifest(this.sourceStore.getState())},e.prototype.getPeriods=function(){return this.getMpd().Period},e.prototype.getAdaptationSets=function(e){var t=this.getPeriods().find(function(t){return t._id===e});return t?t.AdaptationSet:[]},e.prototype.adjustPeriodStartTimes=function(){if(!this.adjustedPeriodStartTimes&&!this.getMpd()._isHls){var e=this.isLive()?v.toSeconds(this.getAvailabilityStartTime()):g.getStartTimeOffset(this.sourceStore.getState());this.sourceStore.dispatch(M.adjustPeriodStartTimes(e)),this.adjustedPeriodStartTimes=!0}},e.prototype.getAvailabilityStartTime=function(){return this.isLive()&&this.getMpd()._availabilityStartTime?T.Util.getUtcDate(this.getMpd()._availabilityStartTime).getTime()-this.getTimeDifference():0},e.prototype.getAvailabilityEndTime=function(){if(this.getMpd().hasOwnProperty("_availabilityEndTime")){var e=T.Util.getUtcDate(this.getMpd()._availabilityEndTime).getTime();return new Date(e-this.getTimeDifference())}return null},e.prototype.getTimeDifference=function(){return this.synchronizedTimeService?this.synchronizedTimeService.getTimeDifference():0},e.prototype.getType=function(){return this.getMpd()._type},e.prototype.getDuration=function(){return this.getMpd()._mediaPresentationDuration},e.prototype.getRequestTimestamp=function(){return this.getMpd()._requestTimestamp},e.isValueWithinBounds=function(e,t,i){return!e||e>=t&&e<=i},e.prototype.isAllowedVideoQuality=function(t){var i=e.isValueWithinBounds(t.width,this.settings.MIN_SELECTABLE_VIDEO_WIDTH,this.settings.MAX_SELECTABLE_VIDEO_WIDTH),n=e.isValueWithinBounds(t.height,this.settings.MIN_SELECTABLE_VIDEO_HEIGHT,this.settings.MAX_SELECTABLE_VIDEO_HEIGHT),r=e.isValueWithinBounds(t.bitrate,this.settings.MIN_SELECTABLE_VIDEO_BITRATE,this.settings.MAX_SELECTABLE_VIDEO_BITRATE);return i&&n&&r},e.prototype.isAllowedAudioQuality=function(t){return e.isValueWithinBounds(t.bitrate,this.settings.MIN_SELECTABLE_AUDIO_BITRATE,this.settings.MAX_SELECTABLE_AUDIO_BITRATE)},e.prototype.getAllowedQualities=function(e,t){var i=this;if(!e)return[];var n=t.filter(function(t){return S.MimeTypeHelper.isVideo(e)&&i.isAllowedVideoQuality(t)||S.MimeTypeHelper.isAudio(e)&&i.isAllowedAudioQuality(t)});return n.length<1&&t.length>0?t:n},e.prototype.getQualityForAdaptationSet=function(e){if(!e)return[];var t=e.Representation.map(function(t){return o(t,e._mimeType,e._codecs)});return this.settings.EXCLUDE_DISALLOWED_REPRESENTATIONS&&(t=this.getAllowedQualities(e._mimeType,t)),t},e.prototype.getAudioQualities=function(e){var t=this,i=this.getValidPeriodId(e),n=this.getAdaptationSets(i);return n.reduce(function(e,i){return i._mimeType&&S.MimeTypeHelper.isAudio(i._mimeType)&&(e[i._internalId.adaptationSetId]=t.getQualityForAdaptationSet(i)),e},{})},e.prototype.getVideoQualities=function(e){var t=this.getValidPeriodId(e),i=this.getAdaptationSets(t).find(function(e){return e._mimeType&&S.MimeTypeHelper.isVideo(e._mimeType)});return i?this.getQualityForAdaptationSet(i):[]},e.prototype.getLangObjectFromAdaptationSet=function(e,t,i){var n={id:null,lang:null,adaptationSetId:null,kind:null,label:"off",url:null},o=e._mimeType&&e._mimeType.indexOf(t)>-1,a=i&&e._mimeType.indexOf(i)>-1;return S.MimeTypeHelper.isSubtitle(t)&&(n.kind="subtitle"),e.Role&&e.Role.length>0&&(n.role=e.Role.map(function(e){return r(e,{})})),(o||a)&&(r(e,n,["_lang","_isFragmented"]),n.lang=n.lang||"und",n.label=e._label||n.lang,n.adaptationSetId=e._internalId,n.id=e._internalId.adaptationSetId),n},e.prototype.toSubtitleTrack=function(e,t,i){var n=this.getLangObjectFromAdaptationSet(e,t,i),r={id:n.id,lang:n.lang,kind:n.kind,isFragmented:n.isFragmented,enabled:!1,label:n.label};return null!=n.role&&(r.role=n.role),r.forced=l(r,e.Representation[0]),r},e.prototype.getAvailableSubtitles=function(e){var t=this,i=0;return e=this.getValidPeriodId(e),this.getAdaptationSets(e).filter(function(e){return S.MimeTypeHelper.isSubtitle(e._mimeType)}).map(function(e){var n=t.toSubtitleTrack(e,"application","text"),r=n.id;return r||(i++,n.id="sub_"+i),n})},e.prototype.getClosedCaptionLabels=function(e){var t=[];return e=this.getValidPeriodId(e),this.getAdaptationSets(e).forEach(function(e){for(var i in e.ClosedCaptionLabels)if(e.ClosedCaptionLabels.hasOwnProperty(i)){var n=e.ClosedCaptionLabels[i],r={id:i,kind:"caption",lang:n.lang||"unknown",label:n.label};r.label="Captions ("+i+")",t.push(r)}}),t},e.prototype.getAvailableAudio=function(e,t){var i=this;void 0===t&&(t=!0);var n=this.getValidPeriodId(e),r=this.getAdaptationSets(n),o=0,a=r.filter(function(e){return S.MimeTypeHelper.isAudio(e._mimeType)}).map(function(e){var t=i.getLangObjectFromAdaptationSet(e,f.MediaType.Audio);return t&&"off"!==t.label?(t.id||(t.id="audio_"+o,o++),t):null});if(t){var s=r.find(function(e){return S.MimeTypeHelper.isVideo(e._mimeType)});if(s&&s.ContentComponent){var d=s.ContentComponent.filter(function(e){return e._contentType===f.MediaType.Audio}).map(function(e){return{id:e._id,lang:e._lang,label:e._id}});a=a.concat(d)}}return a.filter(function(e){return e})},e.prototype.getAvailableVideo=function(e){var t=this.getValidPeriodId(e),i=this.getAdaptationSets(t),n=i.find(function(e){return S.MimeTypeHelper.isVideo(e._mimeType)});return n?[this.getLangObjectFromAdaptationSet(n,f.MediaType.Video)]:[]},e.getContentProtectionForManifestElement=function(e){var t,i;return(null===(i=null===(t=e)||void 0===t?void 0:t.ContentProtection)||void 0===i?void 0:i.length)&&P.ModuleManager.has(I.ModuleName.DRM)?P.ModuleManager.get(I.ModuleName.DRM).ContentProtectionHelper.parseContentProtectionDescriptors(e.ContentProtection):[]},e.getContentProtectionForAdaptationSet=function(t){for(var i=[],n=0;n<t.Representation.length;n++)i=i.concat(e.getContentProtectionForManifestElement(t.Representation[n]));return i=i.concat(e.getContentProtectionForManifestElement(t))},e.prototype.getTimeShiftBufferDepthSeconds=function(){if(this.isLive()){var e=this.getMpd()._timeShiftBufferDepth,t=v.toSeconds(Date.now()-this.getAvailabilityStartTime());return e===Number.NEGATIVE_INFINITY?-t:Math.max(e,-t)}return 0},e.getCurrentAndSuccessorPeriod=function(e,t){for(var i=[null,0,null],n=i[0],r=i[1],o=i[2];r<e.length;r++)if(e[r]._id===t){n=e[r],o=e[r+1]||null;break}return[n,o]},e.prototype.getPeriodDuration=function(t,i){i=i||this.getMpd().Period;var n=e.getCurrentAndSuccessorPeriod(i,t),r=n[0],o=n[1];if(r&&r._duration)return y.DurationConverter.getDurationInSec(r._duration);if(r&&r.start&&o&&o.start)return o.start-r.start;if(this.getMpd()._mediaPresentationDuration){var a=y.DurationConverter.getDurationInSec(this.getMpd()._mediaPresentationDuration);if(!isNaN(a))return a}return Number.POSITIVE_INFINITY},e.prototype.getDRMCapabilitiesForPeriod=function(t){var i=[],n=[];t=this.getValidPeriodId(t);for(var r=this.getMpd().Period.find(function(e){return e._id===t}),o=0,a=r.AdaptationSet;o<a.length;o++){var s=a[o],d=s._mimeType,u=e.getMimeTypeCodecStringForAdaptationSet(s);S.MimeTypeHelper.isVideo(d)?n=n.concat(u):S.MimeTypeHelper.isAudio(d)&&(i=i.concat(u))}return[i,n]},e.prototype.dispose=function(){this.settings=null},e.getMimeTypeCodecStringForAdaptationSet=function(t){for(var i=[],n=0,r=t.Representation;n<r.length;n++){var o=r[n],a=e.getAttributeFromRepresentationOrAdaptationSet("_codecs",o,t),s=t._mimeType;t._mimeType&&a&&i.push({contentType:s+'; codecs="'+a+'"'})}return i},e.getAttributeFromRepresentationOrAdaptationSet=function(e,t,i){return t.hasOwnProperty(e)&&t[e]?t[e]:i.hasOwnProperty(e)&&i[e]?i[e]:null},e.prototype.getValidPeriodId=function(e){var t=this.getPeriods();if(t.find(function(t){return t._id===e}))return e;var i=t[t.length-1]._id;return this.context.logger.debug("Period "+e+" not available - return last period ("+i+")"),i},e.prototype.getEventStreamEvents=function(e){var t=this;return e&&e.EventStream?e.EventStream.filter(function(e){return null!==e.Event}).flatMap(function(i){var n=Number(i._timescale)||1;return t.mapToEventStreamEvent(e.start,i,n)}):[]},e.prototype.mapToEventStreamEvent=function(e,t,i){var n=this;return t.Event.map(function(t){var r={},o=t._presentationTime||0;if(r.startTime=o/i+e,t._duration){var a=t._duration/i;r.endTime=r.startTime+a}else r.endTime=r.startTime;return r.data=n.getEventData(t),r})},e.prototype.getEventData=function(e){var t,i=/<event[^>]*>(.*)(<\/event>|\/>)/g.exec(e.rawXmlRepresentation);i&&i.length>1&&(t=i[1]);var n={};return Object.getOwnPropertyNames(e).filter(function(e){var t=["_presentationTime","_duration","__text"].some(function(t){return t===e});return!t&&0===e.lastIndexOf("_",0)}).forEach(function(t){n[t.substring(1,t.length)]=e[t]}),{properties:n,content:t}},e.prototype.getPeriodById=function(e){return this.getMpd().Period.find(function(t){return t._id===e})},e}();t.MPDExtractor=E,t.stripUnderscorePrefix=n,t.applyProperties=r,t.representationToQuality=o,t.getMinimumUpdatePeriodInSeconds=h},75:function(e,t,i){"use strict";function n(e,t){return e=l({},e),e.Period=e.Period.map(function(e){if(!e.AdaptationSet)return l({},e);var i=r(e.AdaptationSet),n=i.videoSets,a=i.audioSets,s=i.otherSets,d=o(n,t.video),u={};return a.forEach(function(e){var t=e._lang||"none";u[t]=u[t]||[],u[t].push(e)}),Object.keys(u).forEach(function(e){d=d.concat(o(u[e],t.audio))}),l(l({},e),{AdaptationSet:d.concat(s)})}),e}function r(e){return e.reduce(function(e,t){var i=s(t);return h.MimeTypeHelper.isVideo(i)?e.videoSets.push(t):h.MimeTypeHelper.isAudio(i)?e.audioSets.push(t):e.otherSets.push(t),e},{videoSets:[],audioSets:[],otherSets:[]})}function o(e,t){var i=function(e){for(var i=0;i<t.length;i++)if(0===e.indexOf(t[i]))return i;return t.length+1};return e.sort(function(e,t){var n=i(a(e)),r=i(a(t));return n-r})}function a(e){if(e._codecs)return e._codecs;if(e.Representation&&e.Representation.length>0){var t=e.Representation[e.Representation.length-1];if(t._codecs)return t._codecs}return""}function s(e){if(e._mimeType)return e._mimeType;if(Array.isArray(e.Representation)){var t=e.Representation.find(function(e){return e._mimeType});if(t)return t._mimeType}return""}function d(e,t){var i=e.Period&&e.Period.length>0;if(!i||0===t.length)return e;var n=e.Period.map(function(e){return u(e,t)}).filter(function(e){return e.AdaptationSet.length>0});return l(l({},e),{Period:n})}function u(e,t){var i=e.AdaptationSet.map(function(e){return c(e,t)}).filter(function(e){return e.Representation.length>0});return l(l({},e),{AdaptationSet:i})}function c(e,t){var i=e.Representation.filter(function(e){return!t.some(function(t){return t.equals(e._internalId)})});return l(l({},e),{Representation:i})}var l=this&&this.__assign||function(){return l=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},l.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var h=i(7);t.orderAdaptationSetsByCodec=n,t.sortAdaptationSetsByBestCodec=o,t.getCodecsFromAdaptationSet=a,t.getMimeTypeForAdaptationSet=s,t.removeRepresentations=d},76:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getManifest=function(e){var t;return null===(t=e)||void 0===t?void 0:t.manifest}}},[422])});
})();
