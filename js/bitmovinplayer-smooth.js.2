/**************************************************************************** 
 * Copyright (C) 2020, Bitmovin, Inc., All Rights Reserved 
 * 
 * This source code and its use and distribution, is subject to the terms 
 * and conditions of the applicable license agreement. 
 * 
 * Bitmovin Player Version 8.34.0 
 * 
 ****************************************************************************/
(function() {
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.smooth=e():(t.bitmovin=t.bitmovin||{},t.bitmovin.player=t.bitmovin.player||{},t.bitmovin.player.smooth=e())}(this,function(){return webpackJsonpbitmovin_player__name_([16],{190:function(t,e,r){"use strict";function i(t){return 0===t.length?null:t[0]}function o(t,e){var r=e.indexOf("."),i=[];if(r===-1)i=t.filter(function(t){return t.type===e});else{var o=e.substr(0,r),n=e.substr(r+1);i=t.filter(function(t){return t.type===o}).map(function(t){return t.list(n)}).reduce(function(t,e){return t.concat(e)},i)}return i}Object.defineProperty(e,"__esModule",{value:!0});var n=r(270),s=n.createBox("dummy"),a=Object.getPrototypeOf(s).constructor,c=n.createFile(),h=Object.getPrototypeOf(c).constructor;h.prototype.get=function(t){return i(this.list(t))},h.prototype.list=function(t){return o(this.boxes,t)},a.prototype.list=function(t){return o(this.boxes||this.entries||[],t)},a.prototype.get=function(t){return i(this.list(t))},e.ISOBoxer=n},191:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(4),o=r(6),n=r(20),s=r(18),a=r(1),c=r(11);e.DEFAULT_TIMESCALE_FACTOR=1e7;var h=function(){function t(t,r,i){this.timescaleFactor=e.DEFAULT_TIMESCALE_FACTOR,this.context=t,this.updateManifest(r,i)}return t.prototype.getParsedManifest=function(){return this.isManifestParsed||this.parseRawManifest(),this.parsedManifest},t.prototype.updateManifest=function(t,e){this.rawManifest=t,this.manifestUrl=e,this.isManifestParsed=!1,this.parsedManifest=null},t.prototype.parseRawManifest=function(){var t=this;this.parsedManifest=this.parseSmoothStreamingInformation(this.rawManifest.SmoothStreamingMedia),this.ensureClipArray(),this.parsedManifest.startTime=1/0,this.parsedManifest.duration=0,this.rawManifest.SmoothStreamingMedia.Clip.forEach(function(e){var r=e.StreamIndex;Array.isArray(r)||(r=[r]);var i=-1,o=1/0;r.forEach(function(r){var n=t.parseStreamIndex(r,e);n&&(n.totalTime>i&&(i=n.totalTime),n.startTime<o&&(o=n.startTime))}),e.ClipBegin===-1&&(e.ClipBegin=o*t.timescaleFactor,e.ClipEnd=(o+i)*t.timescaleFactor),t.parsedManifest.startTime=Math.min(t.parsedManifest.startTime,o),t.parsedManifest.duration+=i,t.parsedManifest.clips.push(e)}),this.parseProtectionElement(this.rawManifest.SmoothStreamingMedia)},t.prototype.ensureClipArray=function(){if(this.rawManifest.SmoothStreamingMedia.Clip)Array.isArray(this.rawManifest.SmoothStreamingMedia.Clip)||(this.rawManifest.SmoothStreamingMedia.Clip=[this.rawManifest.SmoothStreamingMedia.Clip]);else{var t={_ClipBegin:-1,_ClipEnd:-1,_Url:this.manifestUrl,streamIndexes:[],StreamIndex:this.rawManifest.SmoothStreamingMedia.StreamIndex};this.rawManifest.SmoothStreamingMedia.Clip=[t],delete this.rawManifest.SmoothStreamingMedia.StreamIndex}this.rawManifest.SmoothStreamingMedia.Clip.forEach(function(t){t.streamIndexes=t.streamIndexes||[],t.ClipBegin=Number(t._ClipBegin),t.ClipEnd=Number(t._ClipEnd),t.Url=String(t._Url)})},t.prototype.parseSmoothStreamingInformation=function(r){var i={lookaheadCount:r._LookaheadCount,dvrWindowLength:Number(r._DVRWindowLength)||0,location:this.manifestUrl,duration:-1,startTime:-1,timeScale:Number(r._TimeScale||e.DEFAULT_TIMESCALE_FACTOR),isLive:t.parseBoolean(r._IsLive,!1),canPause:t.parseBoolean(r._CanPause,!0),canSeek:t.parseBoolean(r._CanSeek,!0),minorVersion:Number(r._MinorVersion)||2,majorVersion:Number(r._MajorVersion)||2,clips:[]};return this.timescaleFactor=i.timeScale,i.isLive?i.dvrWindowLength=i.dvrWindowLength/this.timescaleFactor:i.dvrWindowLength=0,this.isManifestParsed=!0,i},t.prototype.parseProtectionElement=function(t){if(t.Protection&&t.Protection.ProtectionHeader){var e=t.Protection.ProtectionHeader;Array.isArray(e)||(e=[e]),this.parsedManifest.protection=e.map(function(t){return{systemId:t.SystemID,content:t.__text}})}},t.prototype.parseStreamIndex=function(t,e){var r=this.parseCommonStreamIndexInformation(t,e.Url);return r=this.parseQualityLevels(t,r),0===r.qualityInformation.length?(this.context.eventHandler.dispatchEvent(a.PlayerEvent.Warning,new n.PlayerWarning(s.WarningCode.SOURCE_SMOOTH_EMPTY_QUALITY_LEVEL,"StreamIndex does not contain any QualityLevel, will be filtered out")),null):(e.streamIndexes.push(r),r)},t.prototype.parseCommonStreamIndexInformation=function(e,r){var i={name:e._Name||"unnamed"+t.unnamedStreamIndexCounter++,parentStream:e._ParentStream,numberOfChunks:Number(e._Chunks),timeScale:Number(e._TimeScale||e._StreamTimeScale||this.timescaleFactor),type:e._Type,templateUrl:this.convertUrlToAbsolute(e._Url,r),totalTime:0,startTime:0,fragmentInfos:[]};return e._Subtype&&""!==e._Subtype&&(i.subType=e._Subtype),e._Language&&(i.language=e._Language),t.parseCustomAttributes(e,i),this.parseFragmentInformation(e,i),i},t.prototype.convertUrlToAbsolute=function(t,e){var r;return c.URLHelper.isUrlAbsolute(t)?r=t:(r=c.URLHelper.removeLastPathPart(e),r+=t),r},t.parseCustomAttributes=function(t,e){if(t&&t.CustomAttributes){e.customAttributes||(e.customAttributes={});var r=t.CustomAttributes;Array.isArray(r)||(r=[r]),r.forEach(function(t){Object.keys(t).forEach(function(r){e.customAttributes[r]=t[r]})})}},t.prototype.parseFragmentInformation=function(t,e){if(!t||!t.c||t.c.length<1)return void this.context.eventHandler.fireError(new o.PlayerError(i.ErrorCode.SOURCE_MANIFEST_INVALID,(void 0),"StreamIndex must contain StreamFragmentElements"));for(var r=[].concat(t.c),n=e.timeScale||this.timescaleFactor,s=0,a=0,c=0,h=0;h<r.length;h++){var p=r[h],u=1;p._r&&(u=Number(p._r));for(var l=Number(p._t||s),d=0,f=1;f<=u;f++){var _=p._d;_=_?Number(_):this.calcualteMissingFragmentDuration(h,r,s)/u;var m={duration:_,startTime:l+d,index:c};e.fragmentInfos.push(m),0===h&&1===f&&(e.startTime=s,s=l),d+=_,a+=_,s+=_,c++}}e.totalTime=a/n},t.prototype.calcualteMissingFragmentDuration=function(t,e,r){var n,s=e[t]._t||r;if(t+1<e.length){var a=e[t+1];s&&a._t&&(n=Number(a._t)-Number(s))}if(t>0&&t-1>0){var c=e[t-1];if(s&&c._t){var h=Number(s)-Number(c._t);n?h!==n&&this.context.logger.debug("To avoid gaps in the timeline returning calculated duration of: "+(n+" instead of: "+h+" for fragment at startTime: "+s)):n=Number(s)-Number(c._t)}}return n?n:void this.context.eventHandler.fireError(new o.PlayerError(i.ErrorCode.SOURCE_MANIFEST_INVALID))},t.prototype.parseQualityLevels=function(e,r){var i=this,o=e.QualityLevel;Array.isArray(o)||(o=[o]);var c=r;return c.qualityInformation=o.map(function(e){var o;if("video"===r.type)o=t.parseVideoQualityInformation(e);else if("audio"===r.type){var c=t.parseAudioQualityInformation(e);o=t.validateAudioQualityInformation(c)}else{if("text"!==r.type)return i.context.eventHandler.dispatchEvent(a.PlayerEvent.Warning,new n.PlayerWarning(s.WarningCode.SOURCE_SMOOTH_UNKNOWN_STREAM_INDEX_TYPE,'Unknown StreamIndex.type: "'+r.type+'", it will be ignored')),null;o=t.parseTextQualityInformation(e)}return t.parseCustomAttributes(e,o),o}).filter(function(t){return null!=t}),c},t.parseVideoQualityInformation=function(t){return{codec:t._FourCC,codecPrivateData:t._CodecPrivateData,maxHeight:parseInt(t._MaxHeight),maxWidth:parseInt(t._MaxWidth),bitrate:parseInt(t._Bitrate),index:parseInt(t._Index)}},t.parseAudioQualityInformation=function(t){return{codec:t._FourCC,codecPrivateData:t._CodecPrivateData,bitrate:parseInt(t._Bitrate),index:parseInt(t._Index),noChannels:parseInt(t._Channels),samplingRate:parseInt(t._SamplingRate,10),audioTag:parseInt(t._AudioTag)}},t.parseTextQualityInformation=function(t){return{codec:t._FourCC,codecPrivateData:t._CodecPrivateData,bitrate:parseInt(t._Bitrate),index:parseInt(t._Index)}},t.validateAudioQualityInformation=function(e){if(null!==e.codecPrivateData&&""!==e.codecPrivateData)return e;var r,i=t.SAMPLING_FREQUENCY_INDEXES[String(e.samplingRate)];if("AACH"===e.codec){var o=5,n=new Uint8Array(4),s=t.SAMPLING_FREQUENCY_INDEXES[2*e.samplingRate];n[0]=o<<3|i>>1,n[1]=i<<7|e.noChannels<<3|s>>1,n[2]=s<<7|8,n[3]=0;var a=new Uint16Array(2);a[0]=(n[0]<<8)+n[1],a[1]=(n[2]<<8)+n[3],r=a[0].toString(16)+a[1].toString(16)}else{var c=new Uint8Array(2),o=2;c[0]=o<<3|i>>1,c[1]=i<<7|e.noChannels<<3;var a=new Uint16Array(1);a[0]=(c[0]<<8)+c[1],r=a[0].toString(16)}var h=""+r;return h=h.toUpperCase(),e.codecPrivateData=h,e},t.parseBoolean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),t?"string"==typeof t?"true"===t.toLowerCase():Boolean(t):e},t.prototype.dispose=function(){this.parsedManifest=null,this.rawManifest=null},t.unnamedStreamIndexCounter=0,t.SAMPLING_FREQUENCY_INDEXES={96000:0,88200:1,64000:2,48000:3,44100:4,32000:5,24000:6,22050:7,16000:8,12000:9,11025:10,8000:11,7350:12},t}();e.SmoothStreamingParser=h},250:function(t,e,r){"use strict";function i(){var t,e=n.ModuleManager.get(s.ModuleName.DASH);return t=function(t){function e(r,i,o){var a=t.call(this,r)||this;a.lastRepesentationId=null,a.mimeType=i,a.smoothLoader=o,a.trackId=e.trackIDs[i],e.trackIDs[i]=Math.max(e.trackIDs.audioMp4,e.trackIDs.videoMp4)+1;var p=n.ModuleManager.get(s.ModuleName.ContainerMP4).MP4Parser;return a.parser=new p(r,c.ISOBoxer),c.ISOBoxer.addBoxProcessor("uuid",h.uuidProcessor),c.ISOBoxer.addBoxProcessor("saio",h.saioProcessor),c.ISOBoxer.addBoxProcessor("saiz",h.saizProcessor),c.ISOBoxer.addBoxProcessor("senc",h.sencProcessor),a}return o(e,t),e.prototype.checkIfSegmentAvailable=function(t){return!0},e.prototype.isExpectedSegmentPlaybackTimeExceedingPeriodDuration=function(t){return!1},e.prototype.preProcessAvailableSegment=function(t,e,r){if(this.rewriteHeaderInfoIfNecessary(t),this.currentRepresentationId&&!this.currentRepresentationId.equals(this.lastRepesentationId)){this.lastRepesentationId=this.currentRepresentationId;var i=this.manifestService.findAdaptationSet(this.manifestService.getFirstPeriod()._id,this.mimeType),o=c.ISOBoxer.parseBuffer(t.getData());t.setParsedData(o);var h=n.ModuleManager.get(s.ModuleName.ContainerMP4).MP4Parser.getTrackId(this.context.logger,o),p=this.manifestService.getRepresentationById(this.currentRepresentationId),u=this.smoothLoader.createInitSegmentForRepresentation(p,i,h),l=u[0],d=u[1],f=new a.Segment(d,this.mimeType,r.codec,t.getPeriodId(),null,a.SegmentInitType.INIT,(!0),(-1),t.getRepresentationId());return f.setParsedData(l),f.setUrl(p.BaseURL[0].url),f.setLastSegment(!1),t.getSegmentInfo()&&f.setSegmentInfo({internalRepresentationId:t.getSegmentInfo().internalRepresentationId,representationId:t.getSegmentInfo().representationId}),this.parser.parseSegment(f),{additionalSegment:f}}},e.prototype.rewriteHeaderInfoIfNecessary=function(t){if(t&&!t.isInit()){if(!t.getParsedData())try{this.parser.parseSegment(t)}catch(e){this.context.logger.log("Error during parsing of segment: ",e)}this.rewriteDataSegmentBoxes(t)}},e.prototype.rewriteDataSegmentBoxes=function(t){var r=t.getParsedData(),i=r.fetch("tfhd"),o=this.manifestService.getAdaptationSetIndex(t.getRepresentationId())+1;o>0?this.trackId=o:this.trackId<1&&(this.trackId=1),i.track_ID=this.trackId;var n=r.fetch("tfdt"),s=r.fetch("traf");null===n&&(n=c.ISOBoxer.createFullBox("tfdt",s,i),n.version=1,n.flags=0,n.baseMediaDecodeTime=Math.floor(t.getSegmentInfo().mediaPresentationTime));var a=r.fetch("trun"),h=r.fetch("tfxd");h&&(h._parent.boxes.splice(h._parent.boxes.indexOf(h),1),h=null);var p=r.fetch("sepiff");if(null!==p){p.type="senc",p.usertype=void 0;var u=r.fetch("saio");if(null===u){u=c.ISOBoxer.createFullBox("saio",s),u.version=0,u.flags=0,u.entry_count=1,u.offset=[0];var l=c.ISOBoxer.createFullBox("saiz",s);if(l.version=0,l.flags=0,l.sample_count=p.sample_count,l.default_sample_info_size=0,l.sample_info_size=[],2&p.flags)for(var d=0;d<p.sample_count;d+=1)l.sample_info_size[d]=10+6*p.entry[d].NumberOfEntries;else l.default_sample_info_size=8}}i.flags&=16777214,i.flags|=131072,a.flags|=1;var f=r.fetch("moof"),_=f.getLength();a.data_offset=_+8;var m=r.fetch("saio");if(null!==m){var g=e.getBoxOffset(f,"traf"),y=e.getBoxOffset(s,"senc");m.offset[0]=g+y+16}t.setData(r.write()),t.setParsedData(c.ISOBoxer.parseBuffer(t.getData()))},e.getBoxOffset=function(t,e){for(var r=8,i=0;i<t.boxes.length;i++){if(t.boxes[i].type===e)return r;r+=t.boxes[i].size}return r},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.smoothLoader=null},e}(e.SegmentTimelineMPDHandler),t.trackIDs={videoMp4:2,audioMp4:1},t}var o=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=r(2),s=r(0),a=r(109),c=r(190),h=r(545);e.createSmoothSegmentTemplateMPDHandler=i},251:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(4),o=r(6),n=r(20),s=r(18),a=r(5),c=r(1),h=r(16),p=r(98),u=r(34),l=r(12),d=r(24),f=r(17),_=r(2),m=r(0),g=r(487),y=r(191),v=r(489),x=function(){function t(e){var r=this;if(this.onFailureHandler=function(t,e){var n=new o.PlayerError(i.ErrorCode.SOURCE_COULD_NOT_LOAD_MANIFEST,{statusCode:t.status});0===t.status&&(n=e&&e.name===u.RequestError.TimedOut?new o.PlayerError(i.ErrorCode.NETWORK_MANIFEST_DOWNLOAD_TIMEOUT):new o.PlayerError(i.ErrorCode.NETWORK_ERROR)),r.context.eventHandler.fireError(n)},this.load=function(t){return r.manifestUrl=t||r.manifestUrl,r.manifestUrl?r.getManifestHttpResponse(r.manifestUrl).then(r.handleRequestSuccess)["catch"](function(t){return r.context.logger.debug("Error while loading smooth manifest ",t),null}):(r.context.eventHandler.fireError(new o.PlayerError(i.ErrorCode.SOURCE_INVALID)),Promise.reject("No manifest url provided"))},this.handleRequestSuccess=function(t){return r.loader?(r.context.serviceManager.maybeCall(a.ServiceName.ManifestCachingService,function(e){return e.cacheHttpResponse(t,t.url)}),t.length&&t.elapsedTime&&t.timeToFirstByte&&r.context.store.dispatch(d.addMetricsValue("default",f.MetricType.DownloadInformation,{bytes:t.length,time:t.elapsedTime,timeToFirstByte:t.timeToFirstByte})),null===t.body||t.length<1?(r.context.eventHandler.fireError(new o.PlayerError(i.ErrorCode.SOURCE_MANIFEST_INVALID)),null):r.parseXmlResponse(t.body)):null},this.context=e,this.settings=e.settings,this.loader=new h.DefaultContentLoader(e,{requestType:l.HttpRequestType.MANIFEST_SMOOTH,onFailure:this.onFailureHandler,maxRetries:this.settings.MAX_MPD_RETRIES,retryDelay:this.settings.MPD_RETRY_DELAY}),!t.x2js){var n=_.ModuleManager.get(m.ModuleName.XML).X2JS;t.x2js=new n}}return t.prototype.dispose=function(){this.smoothStreamingParser&&this.smoothStreamingParser.dispose(),this.smoothStreamingParser=null,this.smoothStreamingConverter&&this.smoothStreamingConverter.dispose(),this.smoothStreamingConverter=null,this.settings=null,this.loader=null},t.prototype.getManifestHttpResponse=function(t){var e,r=this.context.serviceManager.maybeCall(a.ServiceName.ManifestCachingService,function(e){return e.getHttpResponse(t)});if(r)return Promise.resolve(r);var i=null===(e=this.context.sourceContext.source.options)||void 0===e?void 0:e.manifestWithCredentials;return this.loader.load(t,l.HttpRequestMethod.GET,null,null,null,i,p.ManifestMimeType.Smooth)},t.prototype.parseXmlResponse=function(e){var r;try{if(null===e)throw"input must not be null";r=t.x2js.xml2js(e.trim())}catch(n){return void this.context.eventHandler.fireError(new o.PlayerError(i.ErrorCode.SOURCE_MANIFEST_INVALID))}if(this.validateManifest(r)){this.smoothStreamingParser?this.smoothStreamingParser.updateManifest(r,this.manifestUrl):this.smoothStreamingParser=new y.SmoothStreamingParser(this.context,r,this.manifestUrl);var s=this.smoothStreamingParser.getParsedManifest();return this.smoothStreamingConverter?this.smoothStreamingConverter.updateManifest(s,Date.now()):this.smoothStreamingConverter=new v.SmoothToMpdConverter(this.context,s,Date.now()),this.smoothStreamingConverter.getDASHManifest()}},t.prototype.createInitSegmentForRepresentation=function(t,e,r){if(!t)return this.context.logger.debug("Cannot create init segment for undefined representation."),void this.context.eventHandler.dispatchEvent(c.PlayerEvent.Warning,new n.PlayerWarning(s.WarningCode.SOURCE_SMOOTH_REPRESENTATION_MISSING));if(!this.smoothStreamingParser)return void this.context.eventHandler.dispatchEvent(c.PlayerEvent.Warning,new n.PlayerWarning(s.WarningCode.SOURCE_SMOOTH_INVALID_INIT_DATA));var a=this.smoothStreamingParser.getParsedManifest(),h=a.clips[Number(t._internalId.periodId)],p=h.streamIndexes.find(function(e){return 0===t._id.indexOf(e.name)});if(!p)return this.context.logger.log("Cannot generate InitSegment, unable to find smooth StreamIndex for: ",t),this.context.eventHandler.fireError(new o.PlayerError(i.ErrorCode.SOURCE_MANIFEST_INVALID,null,"Unable to generate an InitSegment because StreamIndex disappeared")),null;var u=p.qualityInformation.find(function(e){return e.bitrate===t._bandwidth});if(!u)return this.context.logger.log("Cannot generate InitSegment, unable to find smooth QualityInfo for: ",t),this.context.eventHandler.fireError(new o.PlayerError(i.ErrorCode.SOURCE_MANIFEST_INVALID,null,"Unable to generate InitSegment because QualityInformation disappeared")),null;var l={type:p.type,timescale:p.timeScale||a.timeScale||y.DEFAULT_TIMESCALE_FACTOR,trackId:r,codecPrivateData:u.codecPrivateData,lang:p.language,bandwidth:u.bitrate,codecs:t._codecs,id:t._id,internalRepresentationId:t._internalId,periodDuration:a.duration};if("video"===p.type){var d=u;l.width=d.maxWidth,l.height=d.maxHeight}else if("audio"===p.type){var f=u;l.audioChannels=f.noChannels,l.audioSamplingRate=f.samplingRate}var _=new g.InitSegmentGenerator(l,a.protection);return[_.getParsedData(),_.generateArrayBuffer()]},t.prototype.validateManifest=function(t){return!(!t||!t.hasOwnProperty("SmoothStreamingMedia")&&!t.SmoothStreamingMedia)||(this.context.eventHandler.fireError(new o.PlayerError(i.ErrorCode.SOURCE_MANIFEST_INVALID)),!1)},t.prototype.updateRepresentation=function(t){return Promise.resolve(t)},t}();e.SmoothStreamingLoader=x},270:function(t,e,r){/*! codem-isoboxer v0.3.5 https://github.com/madebyhiro/codem-isoboxer/blob/master/LICENSE.txt */
var i={};i.parseBuffer=function(t){return new o(t).parse()},i.addBoxProcessor=function(t,e){"string"==typeof t&&"function"==typeof e&&(n.prototype._boxProcessors[t]=e)},i.createFile=function(){return new o},i.createBox=function(t,e,r){var i=n.create(t);return e&&e.append(i,r),i},i.createFullBox=function(t,e,r){var o=i.createBox(t,e,r);return o.version=0,o.flags=0,o},i.Utils={},i.Utils.dataViewToString=function(t,e){var r=e||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(r).decode(t);var i=[],o=0;if("utf-8"===r)for(;o<t.byteLength;){var n=t.getUint8(o++);n<128||(n<224?(n=(31&n)<<6,n|=63&t.getUint8(o++)):n<240?(n=(15&n)<<12,n|=(63&t.getUint8(o++))<<6,n|=63&t.getUint8(o++)):(n=(7&n)<<18,n|=(63&t.getUint8(o++))<<12,n|=(63&t.getUint8(o++))<<6,n|=63&t.getUint8(o++))),i.push(String.fromCharCode(n))}else for(;o<t.byteLength;)i.push(String.fromCharCode(t.getUint8(o++)));return i.join("")},i.Utils.utf8ToByteArray=function(t){var e,r;if("undefined"!=typeof TextEncoder)e=(new TextEncoder).encode(t);else for(e=[],r=0;r<t.length;++r){var i=t.charCodeAt(r);i<128?e.push(i):i<2048?(e.push(192|i>>6),e.push(128|63&i)):i<65536?(e.push(224|i>>12),e.push(128|63&i>>6),e.push(128|63&i)):(e.push(240|i>>18),e.push(128|63&i>>12),e.push(128|63&i>>6),e.push(128|63&i))}return e},i.Utils.appendBox=function(t,e,r){if(e._offset=t._cursor.offset,e._root=t._root?t._root:t,e._raw=t._raw,e._parent=t,r!==-1){if(void 0===r||null===r)return void t.boxes.push(e);var i,o=-1;if("number"==typeof r)o=r;else{if("string"==typeof r)i=r;else{if("object"!=typeof r||!r.type)return void t.boxes.push(e);i=r.type}for(var n=0;n<t.boxes.length;n++)if(i===t.boxes[n].type){o=n+1;break}}t.boxes.splice(o,0,e)}},e.parseBuffer=i.parseBuffer,e.addBoxProcessor=i.addBoxProcessor,e.createFile=i.createFile,e.createBox=i.createBox,e.createFullBox=i.createFullBox,e.Utils=i.Utils,i.Cursor=function(t){this.offset="undefined"==typeof t?0:t};var o=function(t){this._cursor=new i.Cursor,this.boxes=[],t&&(this._raw=new DataView(t))};o.prototype.fetch=function(t){var e=this.fetchAll(t,!0);return e.length?e[0]:null},o.prototype.fetchAll=function(t,e){var r=[];return o._sweep.call(this,t,r,e),r},o.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var t=n.parse(this);if("undefined"==typeof t.type)break;this.boxes.push(t)}return this},o._sweep=function(t,e,r){this.type&&this.type==t&&e.push(this);for(var i in this.boxes){if(e.length&&r)return;o._sweep.call(this.boxes[i],t,e,r)}},o.prototype.write=function(){var t,e=0;for(t=0;t<this.boxes.length;t++)e+=this.boxes[t].getLength(!1);var r=new Uint8Array(e);for(this._rawo=new DataView(r.buffer),this.bytes=r,this._cursor.offset=0,t=0;t<this.boxes.length;t++)this.boxes[t].write();return r.buffer},o.prototype.append=function(t,e){i.Utils.appendBox(this,t,e)};var n=function(){this._cursor=new i.Cursor};n.parse=function(t){var e=new n;return e._offset=t._cursor.offset,e._root=t._root?t._root:t,e._raw=t._raw,e._parent=t,e._parseBox(),t._cursor.offset=e._raw.byteOffset+e._raw.byteLength,e},n.create=function(t){var e=new n;return e.type=t,e.boxes=[],e},n.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],n.prototype._boxProcessors={},n.prototype._procField=function(t,e,r){this._parsing?this[t]=this._readField(e,r):this._writeField(e,r,this[t])},n.prototype._procFieldArray=function(t,e,r,i){var o;if(this._parsing)for(this[t]=[],o=0;o<e;o++)this[t][o]=this._readField(r,i);else for(o=0;o<this[t].length;o++)this._writeField(r,i,this[t][o])},n.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},n.prototype._procEntries=function(t,e,r){var i;if(this._parsing)for(this[t]=[],i=0;i<e;i++)this[t].push({}),r.call(this,this[t][i]);else for(i=0;i<e;i++)r.call(this,this[t][i])},n.prototype._procSubEntries=function(t,e,r,i){var o;if(this._parsing)for(t[e]=[],o=0;o<r;o++)t[e].push({}),i.call(this,t[e][o]);else for(o=0;o<r;o++)i.call(this,t[e][o])},n.prototype._procEntryField=function(t,e,r,i){this._parsing?t[e]=this._readField(r,i):this._writeField(r,i,t[e])},n.prototype._procSubBoxes=function(t,e){var r;if(this._parsing)for(this[t]=[],r=0;r<e;r++)this[t].push(n.parse(this));else for(r=0;r<e;r++)this._rawo?this[t][r].write():this.size+=this[t][r].getLength()},n.prototype._readField=function(t,e){switch(t){case"uint":return this._readUint(e);case"int":return this._readInt(e);case"template":return this._readTemplate(e);case"string":return e===-1?this._readTerminatedString():this._readString(e);case"data":return this._readData(e);case"utf8":return this._readUTF8String();default:return-1}},n.prototype._readInt=function(t){var e=null,r=this._cursor.offset-this._raw.byteOffset;switch(t){case 8:e=this._raw.getInt8(r);break;case 16:e=this._raw.getInt16(r);break;case 32:e=this._raw.getInt32(r);break;case 64:var i=this._raw.getInt32(r),o=this._raw.getInt32(r+4);e=i*Math.pow(2,32)+o}return this._cursor.offset+=t>>3,e},n.prototype._readUint=function(t){var e,r,i=null,o=this._cursor.offset-this._raw.byteOffset;switch(t){case 8:i=this._raw.getUint8(o);break;case 16:i=this._raw.getUint16(o);break;case 24:e=this._raw.getUint16(o),r=this._raw.getUint8(o+2),i=(e<<8)+r;break;case 32:i=this._raw.getUint32(o);break;case 64:e=this._raw.getUint32(o),r=this._raw.getUint32(o+4),i=e*Math.pow(2,32)+r}return this._cursor.offset+=t>>3,i},n.prototype._readString=function(t){for(var e="",r=0;r<t;r++){var i=this._readUint(8);e+=String.fromCharCode(i)}return e},n.prototype._readTemplate=function(t){var e=this._readUint(t/2),r=this._readUint(t/2);return e+r/Math.pow(2,t/2)},n.prototype._readTerminatedString=function(){for(var t="";this._cursor.offset-this._offset<this._raw.byteLength;){var e=this._readUint(8);if(0===e)break;t+=String.fromCharCode(e)}return t},n.prototype._readData=function(t){var e=t>0?t:this._raw.byteLength-(this._cursor.offset-this._offset);if(e>0){var r=new Uint8Array(this._raw.buffer,this._cursor.offset,e);return this._cursor.offset+=e,r}return null},n.prototype._readUTF8String=function(){var t=this._raw.byteLength-(this._cursor.offset-this._offset),e=null;return t>0&&(e=new DataView(this._raw.buffer,this._cursor.offset,t),this._cursor.offset+=t),e?i.Utils.dataViewToString(e):e},n.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)return void(this._root._incomplete=!0);switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),this._boxContainers.indexOf(this.type)!==-1?this._parseContainerBox():this._data=this._readData())},n.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},n.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(n.parse(this))},n.prototype.append=function(t,e){i.Utils.appendBox(this,t,e)},n.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),this._boxContainers.indexOf(this.type)!==-1)for(var t=0;t<this.boxes.length;t++)this.size+=this.boxes[t].getLength();return this._data&&this._writeData(this._data),this.size},n.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),this._boxContainers.indexOf(this.type)!==-1)for(var t=0;t<this.boxes.length;t++)this.boxes[t].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},n.prototype._writeInt=function(t,e){if(this._rawo){var r=this._cursor.offset-this._rawo.byteOffset;switch(t){case 8:this._rawo.setInt8(r,e);break;case 16:this._rawo.setInt16(r,e);break;case 32:this._rawo.setInt32(r,e);break;case 64:var i=Math.floor(e/Math.pow(2,32)),o=e-i*Math.pow(2,32);this._rawo.setUint32(r,i),this._rawo.setUint32(r+4,o)}this._cursor.offset+=t>>3}else this.size+=t>>3},n.prototype._writeUint=function(t,e){if(this._rawo){var r,i,o=this._cursor.offset-this._rawo.byteOffset;switch(t){case 8:this._rawo.setUint8(o,e);break;case 16:this._rawo.setUint16(o,e);break;case 24:r=(16776960&e)>>8,i=255&e,this._rawo.setUint16(o,r),this._rawo.setUint8(o+2,i);break;case 32:this._rawo.setUint32(o,e);break;case 64:r=Math.floor(e/Math.pow(2,32)),i=e-r*Math.pow(2,32),this._rawo.setUint32(o,r),this._rawo.setUint32(o+4,i)}this._cursor.offset+=t>>3}else this.size+=t>>3},n.prototype._writeString=function(t,e){for(var r=0;r<t;r++)this._writeUint(8,e.charCodeAt(r))},n.prototype._writeTerminatedString=function(t){if(0!==t.length){for(var e=0;e<t.length;e++)this._writeUint(8,t.charCodeAt(e));this._writeUint(8,0)}},n.prototype._writeTemplate=function(t,e){var r=Math.floor(e),i=(e-r)*Math.pow(2,t/2);this._writeUint(t/2,r),this._writeUint(t/2,i)},n.prototype._writeData=function(t){var e;if(t)if(this._rawo){if(t instanceof Array){for(var r=this._cursor.offset-this._rawo.byteOffset,e=0;e<t.length;e++)this._rawo.setInt8(r+e,t[e]);this._cursor.offset+=t.length}t instanceof Uint8Array&&(this._root.bytes.set(t,this._cursor.offset),this._cursor.offset+=t.length)}else this.size+=t.length},n.prototype._writeUTF8String=function(t){var e=i.Utils.utf8ToByteArray(t);if(this._rawo)for(var r=new DataView(this._rawo.buffer,this._cursor.offset,e.length),o=0;o<e.length;o++)r.setUint8(o,e[o]);else this.size+=e.length},n.prototype._writeField=function(t,e,r){switch(t){case"uint":this._writeUint(e,r);break;case"int":this._writeInt(e,r);break;case"template":this._writeTemplate(e,r);break;case"string":e==-1?this._writeTerminatedString(r):this._writeString(e,r);break;case"data":this._writeData(r);break;case"utf8":this._writeUTF8String(r)}},n.prototype._boxProcessors.avc1=n.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},n.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},n.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(t){this._procEntryField(t,"segment_duration","uint",1===this.version?64:32),this._procEntryField(t,"media_time","int",1===this.version?64:32),this._procEntryField(t,"media_rate_integer","int",16),this._procEntryField(t,"media_rate_fraction","int",16)})},n.prototype._boxProcessors.emsg=function(){this._procFullBox(),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("message_data","data",-1)},n.prototype._boxProcessors.free=n.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},n.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},n.prototype._boxProcessors.ftyp=n.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var t=-1;this._parsing&&(t=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",t,"string",4)},n.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},n.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},n.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode((this.language>>10&31)+96,(this.language>>5&31)+96,(31&this.language)+96)),this._procField("pre_defined","uint",16)},n.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},n.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},n.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},n.prototype._boxProcessors.mp4a=n.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},n.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},n.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},n.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},n.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},n.prototype._boxProcessors.sdtp=function(){this._procFullBox();var t=-1;this._parsing&&(t=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",t,"uint",8)},n.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,function(t){this._parsing||(t.reference=(1&t.reference_type)<<31,t.reference|=2147483647&t.referenced_size,t.sap=(1&t.starts_with_SAP)<<31,t.sap|=(3&t.SAP_type)<<28,t.sap|=268435455&t.SAP_delta_time),this._procEntryField(t,"reference","uint",32),this._procEntryField(t,"subsegment_duration","uint",32),this._procEntryField(t,"sap","uint",32),this._parsing&&(t.reference_type=t.reference>>31&1,t.referenced_size=2147483647&t.reference,t.starts_with_SAP=t.sap>>31&1,t.SAP_type=t.sap>>28&7,t.SAP_delta_time=268435455&t.sap)})},n.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},n.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,function(t){this._procEntryField(t,"ranges_count","uint",32),this._procSubEntries(t,"ranges",t.ranges_count,function(t){this._procEntryField(t,"level","uint",8),this._procEntryField(t,"range_size","uint",24)})})},n.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},n.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(t){this._procEntryField(t,"sample_delta","uint",32),this._procEntryField(t,"subsample_count","uint",16),this._procSubEntries(t,"subsamples",t.subsample_count,function(t){this._procEntryField(t,"subsample_size","uint",1===this.version?32:16),this._procEntryField(t,"subsample_priority","uint",8),this._procEntryField(t,"discardable","uint",8),this._procEntryField(t,"codec_specific_parameters","uint",32)})})},n.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},n.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},n.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},n.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,function(t){this._procEntryField(t,"time","uint",1===this.version?64:32),this._procEntryField(t,"moof_offset","uint",1===this.version?64:32),this._procEntryField(t,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(t,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(t,"sample_number","uint",8*(this.length_size_of_sample_num+1))})},n.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},n.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},n.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,function(t){256&this.flags&&this._procEntryField(t,"sample_duration","uint",32),512&this.flags&&this._procEntryField(t,"sample_size","uint",32),1024&this.flags&&this._procEntryField(t,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(t,"sample_composition_time_offset",1===this.version?"int":"uint",32)})},n.prototype._boxProcessors["url "]=n.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},n.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},n.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},n.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},n.prototype._boxProcessors.vtte=function(){}},487:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(2),o=r(0),n=r(190),s=r(191),a=7,c=8,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=function(){function t(e,r){if(this.initInfo=e,this.timescale=this.initInfo.timescale||s.DEFAULT_TIMESCALE_FACTOR,this.trackId=this.initInfo.trackId,r){var n=i.ModuleManager.get(o.ModuleName.DRM),a=new n.PlayReady(null,{});this.contentProtection=r.map(function(e){var r=t.base64ToArrayBuffer(e.content),i=String.fromCharCode.apply(null,r),o=a.getIdentifierFromInitData(i),s=t.base64ToArrayBuffer(o);return n.PlayReady.kidToCENC(s),{header:e,kid:s}})}}return t.prototype.getParsedData=function(){return this.parsedIsoData||this.createIsoFileWithConent(),this.parsedIsoData},t.prototype.generateArrayBuffer=function(){return this.getParsedData().write()},t.prototype.createIsoFileWithConent=function(){var e=n.ISOBoxer.createFile();t.createFtypBox(e),this.createMoovBox(e),this.parsedIsoData=e},t.createFtypBox=function(t){var e=n.ISOBoxer.createBox("ftyp",t);return e.major_brand="iso6",e.minor_version=1,e.compatible_brands=[],e.compatible_brands[0]="isom",e.compatible_brands[1]="iso6",e.compatible_brands[2]="msdh",e},t.prototype.createMoovBox=function(e){var r=n.ISOBoxer.createBox("moov",e);this.createMvhdBox(r);var i=n.ISOBoxer.createBox("trak",r);this.createTkhdBox(i);var o=n.ISOBoxer.createBox("mdia",i);this.createMdhdBox(o),this.createHdlrBox(o);var s=n.ISOBoxer.createBox("minf",o);switch(this.initInfo.type){case"video":t.appendVmhdBox(s);break;case"audio":t.appendSmhdBox(s)}var a=n.ISOBoxer.createBox("dinf",s);t.appendDrefBox(a);var c=n.ISOBoxer.createBox("stbl",s),h=n.ISOBoxer.createFullBox("stts",c);h._data=[0,0,0,0,0,0,0,0];var p=n.ISOBoxer.createFullBox("stsc",c);p._data=[0,0,0,0,0,0,0,0];var u=n.ISOBoxer.createFullBox("stco",c);u._data=[0,0,0,0,0,0,0,0];var l=n.ISOBoxer.createFullBox("stsz",c);l._data=[0,0,0,0,0,0,0,0,0,0,0,0],this.appendStsdBox(c);var d=n.ISOBoxer.createBox("mvex",r);this.appendTrexBox(d),this.contentProtection&&this.contentProtection.forEach(function(e){t.appendProtectionSystemSpecificHeaderBoxForPR(r,e.header.content)})},t.prototype.createMvhdBox=function(t){var e=n.ISOBoxer.createFullBox("mvhd",t);return e.version=1,e.creation_time=0,e.modification_time=0,e.timescale=this.timescale,e.duration=Math.round(this.initInfo.periodDuration*this.timescale),e.rate=1,e.volume=1,e.reserved1=0,e.reserved2=[0,0],e.matrix=[1,0,0,0,1,0,0,0,16384],e.pre_defined=[0,0,0,0,0,0],e.next_track_ID=this.trackId+1,e},t.prototype.createTkhdBox=function(t){var e=n.ISOBoxer.createFullBox("tkhd",t);return e.version=1,e.flags=7,e.creation_time=0,e.modification_time=0,e.track_ID=this.trackId,e.reserved1=0,e.duration=Math.round(this.initInfo.periodDuration*this.timescale),e.reserved2=[0,0],e.layer=0,e.alternate_group=0,e.volume=1,e.matrix=[1,0,0,0,1,0,0,0,16384],e.width=this.initInfo.width,e.height=this.initInfo.height,e},t.prototype.createMdhdBox=function(t){var e=n.ISOBoxer.createFullBox("mdhd",t);return e.version=1,e.creation_time=0,e.modification_time=0,e.timescale=this.timescale,e.duration=Math.round(this.initInfo.periodDuration*this.timescale),e.language=this.initInfo.lang||"und",e.pre_defined=0,e},t.prototype.createHdlrBox=function(t){var e=n.ISOBoxer.createFullBox("hdlr",t);switch(e.pre_defined=0,this.initInfo.type){case"video":e.handler_type="vide";break;case"audio":e.handler_type="soun";break;default:e.handler_type="meta"}return e.name=""+this.initInfo.id,e.reserved=[0,0,0],e},t.appendVmhdBox=function(t){var e=n.ISOBoxer.createFullBox("vmhd",t);e.flags=1,e.graphicsmode=0,e.opcolor=[0,0,0]},t.appendSmhdBox=function(t){var e=n.ISOBoxer.createFullBox("smhd",t);e.flags=1,e.balance=0,e.reserved=0},t.appendDrefBox=function(t){var e=n.ISOBoxer.createFullBox("dref",t);e.entry_count=1,e.entries=[];var r=n.ISOBoxer.createFullBox("url ",e,!1);r.location="",r.flags=1,e.entries.push(r)},t.prototype.appendStsdBox=function(t){var e=n.ISOBoxer.createFullBox("stsd",t);switch(e.entries=[],this.initInfo.type){case"video":case"audio":e.entries.push(this.createSampleEntry(e))}e.entry_count=e.entries.length},t.prototype.createSampleEntry=function(t){var e=this.initInfo.codecs.substring(0,this.initInfo.codecs.indexOf("."));switch(e){case"avc1":return this.createAVCVisualSampleEntry(t,e);case"mp4a":return this.createMP4AudioSampleEntry(t,e);default:throw{name:"Unsupported codec",message:"Unsupported codec",data:{codec:e}}}},t.prototype.createAVCVisualSampleEntry=function(e,r){var i;if(i=this.contentProtection?n.ISOBoxer.createBox("encv",e,!1):n.ISOBoxer.createBox("avc1",e,!1),i.reserved1=[0,0,0,0,0,0],i.data_reference_index=1,i.pre_defined1=0,i.reserved2=0,i.pre_defined2=[0,0,0],i.height=this.initInfo.height,i.width=this.initInfo.width,i.horizresolution=72,i.vertresolution=72,i.frame_count=1,i.compressorname=[10,65,86,67,32,67,111,100,105,110,103,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i.depth=24,i.pre_defined3=65535,i.config=this.createAVC1ConfigurationRecord(),this.contentProtection){var o=n.ISOBoxer.createBox("sinf",i);t.appendOriginalFormatBox(o,r),t.appendSchemeTypeBox(o),this.appendSchemeInformationBox(o)}return i},t.prototype.createAVC1ConfigurationRecord=function(){for(var e,r,i=15,o=[],n=[],s=0,h=0,p=0,u=this.initInfo.codecPrivateData.split("00000001").slice(1),l=0;l<u.length;l++)switch(e=t.hexStringtoBuffer(u[l]),r=31&e[0]){case a:o.push(e),i+=e.length+2;break;case c:n.push(e),i+=e.length+2}o.length>0&&(s=o[0][1],p=o[0][2],h=o[0][3]);var d=new Uint8Array(i),f=0;d[f++]=(4278190080&i)>>24,d[f++]=(16711680&i)>>16,d[f++]=(65280&i)>>8,d[f++]=255&i,d.set([97,118,99,67],f),f+=4,d[f++]=1,d[f++]=s,d[f++]=p,d[f++]=h,d[f++]=255,d[f++]=224|o.length;for(var _=0;_<o.length;_++)d[f++]=(65280&o[_].length)>>8,d[f++]=255&o[_].length,d.set(o[_],f),f+=o[_].length;d[f++]=n.length;for(var _=0;_<n.length;_++)d[f++]=(65280&n[_].length)>>8,d[f++]=255&n[_].length,d.set(n[_],f),f+=n[_].length;return d},t.prototype.createMP4AudioSampleEntry=function(e,r){var i;if(i=this.contentProtection?n.ISOBoxer.createBox("enca",e,!1):n.ISOBoxer.createBox("mp4a",e,!1),i.reserved1=[0,0,0,0,0,0],i.data_reference_index=1,i.reserved2=[0,0],i.channelcount=this.initInfo.audioChannels,i.samplesize=16,i.pre_defined=0,i.samplerate=this.initInfo.audioSamplingRate,i.esds=this.createMPEG4AACESDescriptor(),this.contentProtection){var o=n.ISOBoxer.createBox("sinf",i);t.appendOriginalFormatBox(o,r),t.appendSchemeTypeBox(o),this.appendSchemeInformationBox(o)}return i},t.prototype.createMPEG4AACESDescriptor=function(){var e=t.hexStringtoBuffer(this.initInfo.codecPrivateData),r=34+e.length,i=new Uint8Array(r),o=0;return i[o++]=(4278190080&r)>>24,i[o++]=(16711680&r)>>16,i[o++]=(65280&r)>>8,i[o++]=255&r,i.set([101,115,100,115],o),o+=4,i.set([0,0,0,0],o),o+=4,i[o++]=3,i[o++]=20+e.length,i[o++]=(65280&this.trackId)>>8,i[o++]=255&this.trackId,i[o++]=0,i[o++]=4,i[o++]=15+e.length,i[o++]=64,i[o]=20,i[o]|=0,i[o++]|=1,i[o++]=255,i[o++]=255,i[o++]=255,i[o++]=(4278190080&this.initInfo.bandwidth)>>24,i[o++]=(16711680&this.initInfo.bandwidth)>>16,i[o++]=(65280&this.initInfo.bandwidth)>>8,i[o++]=255&this.initInfo.bandwidth,i[o++]=(4278190080&this.initInfo.bandwidth)>>24,i[o++]=(16711680&this.initInfo.bandwidth)>>16,i[o++]=(65280&this.initInfo.bandwidth)>>8,i[o++]=255&this.initInfo.bandwidth,i[o++]=5,i[o++]=e.length,i.set(e,o),i},t.appendOriginalFormatBox=function(e,r){var i=n.ISOBoxer.createBox("frma",e);i.data_format=t.stringToCharCode(r)},t.appendSchemeTypeBox=function(t){var e=n.ISOBoxer.createFullBox("schm",t);e.flags=0,e.version=0,e.scheme_type=1667591779,e.scheme_version=65536},t.prototype.appendSchemeInformationBox=function(t){var e=n.ISOBoxer.createBox("schi",t);this.appendTrackEncryptionBox(e)},t.appendProtectionSystemSpecificHeaderBoxForPR=function(e,r){var i=n.ISOBoxer.createFullBox("pssh",e),o=t.base64ToArrayBuffer(r);i.flags=0,i.version=0,i.SystemID=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),i.DataSize=o.length,i.Data=o},t.prototype.appendTrackEncryptionBox=function(t){var e=n.ISOBoxer.createFullBox("tenc",t);e.flags=0,e.version=0,e.default_IsEncrypted=1,e.default_IV_size=8,e.default_KID=this.contentProtection?this.contentProtection[0].kid:h},t.prototype.appendTrexBox=function(t){var e=n.ISOBoxer.createFullBox("trex",t);e.track_ID=this.trackId,e.default_sample_description_index=1,e.default_sample_duration=0,e.default_sample_size=0,e.default_sample_flags=0},t.base64ToArrayBuffer=function(t){for(var e=window.atob(t),r=e.length,i=new Uint8Array(r),o=0;o<r;o++)i[o]=e.charCodeAt(o);return i},t.hexStringtoBuffer=function(t){var e,r=new Uint8Array(t.length/2);for(e=0;e<t.length/2;e+=1)r[e]=parseInt(""+t[2*e]+t[2*e+1],16);return r},t.stringToCharCode=function(t){var e,r=0;for(e=0;e<t.length;e+=1)r|=t.charCodeAt(e)<<8*(t.length-e-1);return r},t}();e.InitSegmentGenerator=p},488:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0);e.SmoothModuleDefinition={name:i.ModuleName.Smooth,module:function(){return{SmoothStreamingLoader:r(251).SmoothStreamingLoader,createSmoothSegmentTemplateMPDHandler:r(250).createSmoothSegmentTemplateMPDHandler}},dependencies:[i.ModuleName.EngineBitmovin,i.ModuleName.DASH]},e["default"]=e.SmoothModuleDefinition},489:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(4),o=r(6),n=r(20),s=r(18),a=r(1),c=r(3),h=r(57),p=r(58),u="PT4S",l=function(){function t(t,e,r){this.context=t,this.eventHandler=t.eventHandler,this.updateManifest(e,r)}return t.prototype.getDASHManifest=function(){
return this.isParsed||this.convertManifests(),this.dashManifest},t.prototype.updateManifest=function(t,e){this.isParsed=!1,this.dashManifest=null,this.smoothManifest=t,this.groupIndex=1,this.smoothInfo={format:"smooth"},this.shouldUpdatePresentationTimeOffsets=!1,this.requestTimeStamp=e,this.presentationTimeOffsets={}},t.prototype.convertManifests=function(){var e=this;(this.smoothManifest.canPause||this.smoothManifest.canSeek)&&(this.shouldUpdatePresentationTimeOffsets=!0),this.dashManifest={"_xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance",_xmlns:"urn:mpeg:dash:schema:mpd:2011","_xmlns:xlink":"http://www.w3.org/1999/xlink","_xsi:schemaLocation":"urn:mpeg:DASH:schema:MPD:2011 http://standards.iso.org/ittf/PubliclyAvailableStandards/MPEG-DASH_schema_files/DASH-MPD.xsd",_profiles:"urn:mpeg:dash:profile:isoff-live:2011",_type:this.smoothManifest.isLive?"dynamic":"static",_minimumUpdatePeriod:this.smoothManifest.isLive?u:null,_mediaPresentationDuration:t.convertDurationToSeconds(Number(this.smoothManifest.duration)),_timeShiftBufferDepth:-this.smoothManifest.dvrWindowLength,_requestTimestamp:this.requestTimeStamp,originalFormat:this.smoothInfo,Location:[this.smoothManifest.location],Period:[]},this.smoothManifest.clips.forEach(function(t,r){var i=e.convertClipToPeriod(t,r);e.dashManifest.Period.push(i),e.smoothManifest.isLive&&(e.dashManifest._availabilityStartTime=new Date(e.requestTimeStamp-c.toMilliSeconds(e.smoothManifest.dvrWindowLength)).toISOString(),e.shouldUpdatePresentationTimeOffsets=!1),e.shouldUpdatePresentationTimeOffsets&&e.unifyPresentationTimeOffsets(i),e.groupIndex=1}),this.isParsed=!0},t.prototype.unifyPresentationTimeOffsets=function(t){var e=this,r=this.presentationTimeOffsets[Number(t._id)];0!==r.audio&&0!==r.video&&t.AdaptationSet.forEach(function(t){var i=r.video;if(r[t._contentType]!==i){var o=r[t._contentType],n=(o-i)/e.smoothManifest.timeScale;e.context.logger.debug("Updating the presentation time offset of "+t._contentType+" "+("from: "+o+" to "+i+". Difference: "+n+"s"))}t.SegmentTemplate[0]._presentationTimeOffset=i})},t.convertDurationToSeconds=function(t){return"PT"+t+"S"},t.prototype.convertClipToPeriod=function(e,r){var i=this,o=[];e.streamIndexes.forEach(function(t){o.push(i.convertStreamInfoToAdaptationSet(t,r))});var n=e.ClipBegin/this.smoothManifest.timeScale,s=e.ClipEnd/this.smoothManifest.timeScale,a=s-n,c=0;return this.dashManifest.Period.forEach(function(t){c+=t.duration}),{_id:String(r),_start:t.convertDurationToSeconds(c),start:c,_duration:t.convertDurationToSeconds(a),duration:a,AdaptationSet:o}},t.prototype.convertStreamInfoToAdaptationSet=function(e,r){var i,o,n,s=this,a=e.type,c=1/0,p=0,u=[],l=new h.AdaptationSetId(String(r),String(this.groupIndex));e.qualityInformation&&e.qualityInformation.length>0?(a+=t.buildMimeTypeSuffix(e.qualityInformation[0]),"text"===a&&(a="application/mp4"),e.qualityInformation.forEach(function(t){var r=s.convertQualityInfoToRepresentation(e,t,a,l);c>t.bitrate&&(c=t.bitrate),p<t.bitrate&&(p=t.bitrate),t.maxHeight&&(o=t.maxHeight),t.maxWidth&&(i=t.maxWidth),t.samplingRate&&(r._audioSamplingRate=t.samplingRate),t.noChannels&&(n=t.noChannels),u.push(r)})):(c=0,p=1/0);var d=[this.convertStreamInfoToSegmentTemplate(e,r)],f={_id:String(this.groupIndex),_internalId:l,_group:String(this.groupIndex++),_contentType:e.type,_mimeType:a,_minBandwidth:c,_maxBandwidth:p,_periodId:String(r),_codecs:"",Representation:u,SegmentTemplate:d};return u.forEach(function(t){return t.SegmentTemplate=f.SegmentTemplate}),e.language&&(f._lang=e.language),i&&(f._maxWidth=i),o&&(f._maxHeight=o),n&&(f.AudioChannelConfiguration={_value:n}),f},t.buildMimeTypeSuffix=function(t){switch(t.codec){case"TEXT":return"";case"TTML":return"";default:return"/mp4"}},t.prototype.convertQualityInfoToRepresentation=function(t,e,r,i){var o=[{url:this.convertTemplateUrlToBaseUrl(t.templateUrl)}],n=new p.RepresentationId(i,t.name+"_"+e.bitrate),s={_id:n.representationId,_internalId:n,_requestTimestamp:null,_bandwidth:e.bitrate,_mimeType:r,Uri:o[0].url,_codecs:this.convertCodecInfo(e.codec,e.codecPrivateData),BaseURL:o};return e.maxHeight&&(s._height=e.maxHeight),e.maxWidth&&(s._width=e.maxWidth),s},t.prototype.convertCodecInfo=function(e,r){return r=r?r.toString():"","H264"===e||"AVC1"===e?this.getH264Codec(r):e.indexOf("AAC")>-1?t.getAACCodec(e,r):"TEXT"===e||"TTML"===e?"stpp":(this.context.logger.debug("Unknown codec while converting Smooth Manifest: "+e),this.eventHandler.dispatchEvent(a.PlayerEvent.Warning,new n.PlayerWarning(s.WarningCode.SOURCE_CODEC_OR_FILE_FORMAT_NOT_SUPPORTED)),e)},t.prototype.getH264Codec=function(t){var e=/00000001[0-9]7/.exec(t);if(e&&e.length>0){var r=t.substr(t.indexOf(e[0])+10,6);return"avc1."+r}return this.context.logger.debug("Unable to parse H264-codec information from codecPrivateData: "+t),this.context.eventHandler.fireError(new o.PlayerError(i.ErrorCode.SOURCE_INVALID_H264_CODEC)),null},t.getAACCodec=function(t,e){var r=0;return r="AACH"===t?5:void 0===e||""===e?2:(248&parseInt(e.substr(0,2),16))>>3,"mp4a.40."+r},t.prototype.convertStreamInfoToSegmentTemplate=function(t,e){var r=this.convertTemplateUrlToBaseUrl(t.templateUrl),i=this.convertFragmentInfoToTimeLine(t,e);return{_timescale:String(t.timeScale||this.smoothManifest.timeScale||1e4),_media:r,SegmentTimeline:[i]}},t.prototype.convertTemplateUrlToBaseUrl=function(t){return t.indexOf("{start_time}")>-1&&(this.shouldUpdatePresentationTimeOffsets=!0),t.replace("{bitrate}","$Bandwidth$").replace("{start time}","$Time$").replace("{start_time}","$Time$")},t.prototype.convertFragmentInfoToTimeLine=function(t,e){var r;return t.fragmentInfos&&t.fragmentInfos.length>0&&(this.presentationTimeOffsets[e]||(this.presentationTimeOffsets[e]={}),this.presentationTimeOffsets[e][t.type]=t.fragmentInfos[0].startTime,r=t.fragmentInfos.map(function(t){return{_t:String(t.startTime),_d:String(t.duration),_n:t.index}})),{S:r}},t.prototype.dispose=function(){this.eventHandler=null,this.smoothManifest=null},t}();e.SmoothToMpdConverter=l},545:function(t,e,r){"use strict";function i(){this._procFullBox(),1&this.flags&&(this._procField("aux_info_type","uint",32),this._procField("aux_info_type_parameter","uint",32)),this._procField("entry_count","uint",32),this._procFieldArray("offset",this.entry_count,"uint",1===this.version?64:32)}function o(){this._procFullBox(),1&this.flags&&(this._procField("aux_info_type","uint",32),this._procField("aux_info_type_parameter","uint",32)),this._procField("default_sample_info_size","uint",8),this._procField("sample_count","uint",32),0===this.default_sample_info_size&&this._procFieldArray("sample_info_size",this.sample_count,"uint",8)}function n(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("IV_size","uint",8),this._procEntries("entry",this.sample_count,function(t){this._procEntryField(t,"InitializationVector","data",8),2&this.flags&&(this._procEntryField(t,"NumberOfEntries","uint",16),this._procSubEntries(t,"clearAndCryptedData",t.NumberOfEntries,function(t){this._procEntryField(t,"BytesOfClearData","uint",16),this._procEntryField(t,"BytesOfEncryptedData","uint",32)}))})}function s(){var t=[109,29,155,5,66,213,68,230,128,226,20,29,175,247,87,178],e=[212,128,126,242,202,57,70,149,142,84,38,203,158,70,167,159],r=[162,57,79,82,90,155,79,20,162,68,108,66,124,100,141,244];h.ArrayHelper.comparePrimitiveArrays(this.usertype,t)&&(this._procFullBox(),this._parsing&&(this.type="tfxd"),this._procField("fragment_absolute_time","uint",1===this.version?64:32),this._procField("fragment_duration","uint",1===this.version?64:32)),h.ArrayHelper.comparePrimitiveArrays(this.usertype,e)&&(this._procFullBox(),this._parsing&&(this.type="tfrf"),this._procField("fragment_count","uint",8),this._procEntries("entry",this.fragment_count,function(t){this._procEntryField(t,"fragment_absolute_time","uint",1===this.version?64:32),this._procEntryField(t,"fragment_duration","uint",1===this.version?64:32)})),h.ArrayHelper.comparePrimitiveArrays(this.usertype,r)&&(this._parsing&&(this.type="sepiff"),n.call(this))}function a(){this._procField("configuration_version","uint",8),this._procField("avc_profile_indication","uint",8),this._procField("profile_compatibility","uint",8),this._procField("avc_level_indication","uint",8),this._parsing||(this.temp1=0|this.complete_representation<<7|this.length_size_minus_one),this._procField("temp1","uint",8),this._parsing&&(this.complete_representation=this.temp1>>>7&1,this.length_size_minus_one=3&this.temp1),this._parsing||(this.num_sps&=31),this._procField("num_sps","uint",8),this._parsing&&(this.num_sps&=31),this._procEntries("sps",this.num_sps,function(t){this._procEntryField(t,"length","uint",16),this._procEntryField(t,"data","data",t.length)}),this._parsing||(this.num_pps&=31),this._procField("num_pps","uint",8),this._parsing&&(this.num_pps&=31),this._procEntries("pps",this.num_pps,function(t){this._procEntryField(t,"length","uint",16),this._procEntryField(t,"data","data",t.length)})}function c(){this._procFullBox(),this._procField("reserved","uint",16),this._procField("esId","uint",16),this._procField("streamPriority","uint",8),this.streamPriority&=31,this._procField("reserved2","uint",16),this._procField("decoderConfig","data",17)}Object.defineProperty(e,"__esModule",{value:!0});var h=r(9);e.saioProcessor=i,e.saizProcessor=o,e.sencProcessor=n,e.uuidProcessor=s,e.avccProcessor=a,e.esdsProcessor=c}},[488])});
})();
